<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Blank</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://wangyangyangisme.github.io/"/>
  <updated>2021-05-18T16:56:11.664Z</updated>
  <id>http://wangyangyangisme.github.io/</id>
  
  <author>
    <name>Blank</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>dockerç®¡ç†å·¥å…·</title>
    <link href="http://wangyangyangisme.github.io/posts/1043496/"/>
    <id>http://wangyangyangisme.github.io/posts/1043496/</id>
    <published>2021-05-18T16:56:11.664Z</published>
    <updated>2021-05-18T16:56:11.664Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.portainer.io/">portainer</a> Portaineræ˜¯Dockerçš„å›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼Œæä¾›çŠ¶æ€æ˜¾ç¤ºé¢æ¿ã€åº”ç”¨æ¨¡æ¿å¿«é€Ÿéƒ¨ç½²ã€å®¹å™¨é•œåƒç½‘ç»œæ•°æ®å·çš„åŸºæœ¬æ“ä½œï¼ˆåŒ…æ‹¬ä¸Šä¼ ä¸‹è½½é•œåƒï¼Œåˆ›å»ºå®¹å™¨ç­‰æ“ä½œï¼‰ã€äº‹ä»¶æ—¥å¿—æ˜¾ç¤ºã€å®¹å™¨æ§åˆ¶å°æ“ä½œã€Swarmé›†ç¾¤å’ŒæœåŠ¡ç­‰é›†ä¸­ç®¡ç†å’Œæ“ä½œã€ç™»å½•ç”¨æˆ·ç®¡ç†å’Œæ§åˆ¶ç­‰åŠŸèƒ½ã€‚åŠŸèƒ½ååˆ†å…¨é¢ï¼ŒåŸºæœ¬èƒ½æ»¡è¶³ä¸­å°å‹å•ä½å¯¹å®¹å™¨ç®¡ç†çš„å…¨éƒ¨éœ€æ±‚ã€‚</p><p><a href="https://www.rainbond.com/">rainbond</a> Rainbondä»¥åº”ç”¨ä¸ºä¸­å¿ƒï¼Œé€šè¿‡â€œæ— ä¾µå…¥â€æ¶æ„,æ”¯æ’‘åº”ç”¨å¼€å‘ã€äº¤ä»˜ã€è¿ç»´ï¼Œå¹¶å¯æ¥ç®¡IaaSã€è™šæ‹Ÿæœºå’Œç‰©ç†æœåŠ¡å™¨ç­‰å„ç±»åº•å±‚èµ„æºã€‚è®©ç”¨æˆ·ä¸“æ³¨äºä¸šåŠ¡æœ¬èº«ï¼Œä¸ç”¨å…³å¿ƒåº•å±‚å¤æ‚çš„æŠ€æœ¯ã€‚(k8sç®¡ç†é¢æ¿)</p><p><a href="https://rancher.com/">rancher</a> Rancheræ˜¯ä¸€ä¸ªå¼€æºçš„ä¼ä¸šçº§å®¹å™¨ç®¡ç†å¹³å°ã€‚é€šè¿‡Rancherï¼Œä¼ä¸šå†ä¹Ÿä¸å¿…è‡ªå·±ä½¿ç”¨ä¸€ç³»åˆ—çš„å¼€æºè½¯ä»¶å»ä»å¤´æ­å»ºå®¹å™¨æœåŠ¡å¹³å°ã€‚Rancheræä¾›äº†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨çš„ç®¡ç†Dockerå’ŒKubernetesçš„å…¨æ ˆåŒ–å®¹å™¨éƒ¨ç½²ä¸ç®¡ç†å¹³å°ã€‚</p><p><a href="http://shipyard-project.com/">shipyard</a> hipyardæ˜¯dockerçš„webå¯è§†åŒ–ç•Œé¢ç®¡ç†å·¥å…·ï¼Œæ˜¯å»ºç«‹åœ¨dockeré›†ç¾¤ç®¡ç†å·¥å…·Citadelä¹‹ä¸Šï¼Œå¯ä»¥ç®¡ç†é•œåƒã€å®¹å™¨ã€ä¸»æœºç­‰èµ„æºçš„webå›¾å½¢åŒ–å·¥å…·ï¼ŒåŒ…æ‹¬coreå’Œextensionä¸¤ä¸ªç‰ˆæœ¬ï¼Œcoreå³shipyardä¸»è¦æ˜¯æŠŠå¤šä¸ª Docker hostä¸Šçš„ containers ç»Ÿä¸€ç®¡ç†ï¼ˆæ”¯æŒè·¨è¶Šå¤šä¸ªhostï¼‰ï¼Œextensionå³shipyard-extensionsæ·»åŠ äº†åº”ç”¨è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ã€é›†ä¸­åŒ–æ—¥å¿—ã€éƒ¨ç½²ç­‰ã€‚Shipyardæ˜¯åœ¨Docker Swarmå®ç°å¯¹å®¹å™¨ã€é•œåƒã€dockeré›†ç¾¤ã€ä»“åº“ã€èŠ‚ç‚¹è¿›è¡Œç®¡ç†çš„webç³»ç»Ÿã€‚</p><p><a href="https://github.com/docker/swarm/">Swarm</a> Docker Swarmæ˜¯Dockerå®˜æ–¹æä¾›çš„é›†ç¾¤å·¥å…·ã€‚å®ƒå¯ä»¥å°†ä¸€äº›å…³è”çš„Dockerä¸»æœºè½¬å˜æˆä¸€ä¸ªè™šæ‹ŸDockerä¸»æœºã€‚å› ä¸ºDocker  Swarmç¬¦åˆDocker APIçš„æ ‡å‡†,ä»»ä½•å·²ç»å¯ä»¥ä¸Dockerå®ˆæŠ¤è¿›ç¨‹é€šä¿¡çš„å·¥å…·éƒ½å¯ä»¥ä½¿ç”¨Swarmæ¥é€æ˜åœ°æ‰©å±•åˆ°å¤šä¸ªä¸»æœºã€‚æ”¯æŒå·¥å…·åŒ…æ‹¬:</p><ul><li>Dokku</li><li>Docker Compose</li><li>Docker Machine</li><li>Jenkins</li></ul><p><a href="https://kitematic.com/">kitematic</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://www.portainer.io/&quot;&gt;portainer&lt;/a&gt; Portaineræ˜¯Dockerçš„å›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼Œæä¾›çŠ¶æ€æ˜¾ç¤ºé¢æ¿ã€åº”ç”¨æ¨¡æ¿å¿«é€Ÿéƒ¨ç½²ã€å®¹å™¨é•œåƒç½‘ç»œæ•°æ®å·çš„åŸºæœ¬æ“ä½œï¼ˆåŒ…æ‹¬ä¸Šä¼ ä¸‹è½½é•œåƒï¼Œåˆ›å»ºå®¹å™¨ç­‰æ“ä½œï¼‰ã€äº‹ä»¶æ—¥å¿—æ˜¾ç¤ºã€å®¹å™¨æ§åˆ¶
      
    
    </summary>
    
    
      <category term="docker" scheme="http://wangyangyangisme.github.io/categories/docker/"/>
    
    
  </entry>
  
  <entry>
    <title>GitHub Actionså…¥é—¨æ•™ç¨‹</title>
    <link href="http://wangyangyangisme.github.io/posts/2fcceac/"/>
    <id>http://wangyangyangisme.github.io/posts/2fcceac/</id>
    <published>2021-05-18T15:00:40.000Z</published>
    <updated>2021-05-18T15:00:40.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="GitHub-Actionså…¥é—¨æ•™ç¨‹"><a href="#GitHub-Actionså…¥é—¨æ•™ç¨‹" class="headerlink" title="GitHub Actionså…¥é—¨æ•™ç¨‹"></a>GitHub Actionså…¥é—¨æ•™ç¨‹</h1><blockquote><p><a href="https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html">https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html</a></p><p><a href="https://www.cnblogs.com/i-code/p/12869046.html">https://www.cnblogs.com/i-code/p/12869046.html</a></p><p><a href="https://segmentfault.com/a/1190000022360769">https://segmentfault.com/a/1190000022360769</a></p></blockquote><h2 id="ä¸€ã€GitHub-Actions-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€GitHub-Actions-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€GitHub Actions æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€GitHub Actions æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å¤§å®¶çŸ¥é“ï¼ŒæŒç»­é›†æˆç”±å¾ˆå¤šæ“ä½œç»„æˆï¼Œæ¯”å¦‚æŠ“å–ä»£ç ã€è¿è¡Œæµ‹è¯•ã€ç™»å½•è¿œç¨‹æœåŠ¡å™¨ï¼Œå‘å¸ƒåˆ°ç¬¬ä¸‰æ–¹æœåŠ¡ç­‰ç­‰ã€‚GitHub æŠŠè¿™äº›æ“ä½œå°±ç§°ä¸º actionsã€‚</p><p>å¾ˆå¤šæ“ä½œåœ¨ä¸åŒé¡¹ç›®é‡Œé¢æ˜¯ç±»ä¼¼çš„ï¼Œå®Œå…¨å¯ä»¥å…±äº«ã€‚GitHub æ³¨æ„åˆ°äº†è¿™ä¸€ç‚¹ï¼Œæƒ³å‡ºäº†ä¸€ä¸ªå¾ˆå¦™çš„ç‚¹å­ï¼Œå…è®¸å¼€å‘è€…æŠŠæ¯ä¸ªæ“ä½œå†™æˆç‹¬ç«‹çš„è„šæœ¬æ–‡ä»¶ï¼Œå­˜æ”¾åˆ°ä»£ç ä»“åº“ï¼Œä½¿å¾—å…¶ä»–å¼€å‘è€…å¯ä»¥å¼•ç”¨ã€‚</p><p>å¦‚æœä½ éœ€è¦æŸä¸ª actionï¼Œä¸å¿…è‡ªå·±å†™å¤æ‚çš„è„šæœ¬ï¼Œç›´æ¥å¼•ç”¨ä»–äººå†™å¥½çš„ action å³å¯ï¼Œæ•´ä¸ªæŒç»­é›†æˆè¿‡ç¨‹ï¼Œå°±å˜æˆäº†ä¸€ä¸ª actions çš„ç»„åˆã€‚è¿™å°±æ˜¯ GitHub Actions æœ€ç‰¹åˆ«çš„åœ°æ–¹ã€‚</p><p>GitHub åšäº†ä¸€ä¸ª<a href="https://github.com/marketplace?type=actions">å®˜æ–¹å¸‚åœº</a>ï¼Œå¯ä»¥æœç´¢åˆ°ä»–äººæäº¤çš„ actionsã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª <a href="https://github.com/sdras/awesome-actions">awesome actions</a> çš„ä»“åº“ï¼Œä¹Ÿå¯ä»¥æ‰¾åˆ°ä¸å°‘ actionã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/git/2021-05-18_230758.png" alt="img"></p><p>ä¸Šé¢è¯´äº†ï¼Œæ¯ä¸ª action å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹è„šæœ¬ï¼Œå› æ­¤å¯ä»¥åšæˆä»£ç ä»“åº“ï¼Œä½¿ç”¨<code>userName/repoName</code>çš„è¯­æ³•å¼•ç”¨ actionã€‚æ¯”å¦‚ï¼Œ<code>actions/setup-node</code>å°±è¡¨ç¤º<code>github.com/actions/setup-node</code>è¿™ä¸ª<a href="https://github.com/actions/setup-node">ä»“åº“</a>ï¼Œå®ƒä»£è¡¨ä¸€ä¸ª actionï¼Œä½œç”¨æ˜¯å®‰è£… Node.jsã€‚äº‹å®ä¸Šï¼ŒGitHub å®˜æ–¹çš„ actions éƒ½æ”¾åœ¨ <a href="https://github.com/actions">github.com/actions</a> é‡Œé¢ã€‚</p><p>æ—¢ç„¶ actions æ˜¯ä»£ç ä»“åº“ï¼Œå½“ç„¶å°±æœ‰ç‰ˆæœ¬çš„æ¦‚å¿µï¼Œç”¨æˆ·å¯ä»¥å¼•ç”¨æŸä¸ªå…·ä½“ç‰ˆæœ¬çš„ actionã€‚ä¸‹é¢éƒ½æ˜¯åˆæ³•çš„ action å¼•ç”¨ï¼Œç”¨çš„å°±æ˜¯ Git çš„æŒ‡é’ˆæ¦‚å¿µï¼Œè¯¦è§<a href="https://help.github.com/en/articles/about-actions#versioning-your-action">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">actions/setup-node@74bc508 <span class="comment"># æŒ‡å‘ä¸€ä¸ª commit</span></span><br><span class="line">actions/setup-node@v1.0    <span class="comment"># æŒ‡å‘ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">actions/setup-node@master  <span class="comment"># æŒ‡å‘ä¸€ä¸ªåˆ†æ”¯</span></span><br></pre></td></tr></table></figure><h2 id="äºŒã€åŸºæœ¬æ¦‚å¿µ"><a href="#äºŒã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="äºŒã€åŸºæœ¬æ¦‚å¿µ"></a>äºŒã€åŸºæœ¬æ¦‚å¿µ</h2><p>GitHub Actions æœ‰ä¸€äº›è‡ªå·±çš„æœ¯è¯­ã€‚</p><p>ï¼ˆ1ï¼‰<strong>workflow</strong> ï¼ˆå·¥ä½œæµç¨‹ï¼‰ï¼šæŒç»­é›†æˆä¸€æ¬¡è¿è¡Œçš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ª workflowã€‚</p><p>ï¼ˆ2ï¼‰<strong>job</strong> ï¼ˆä»»åŠ¡ï¼‰ï¼šä¸€ä¸ª workflow ç”±ä¸€ä¸ªæˆ–å¤šä¸ª jobs æ„æˆï¼Œå«ä¹‰æ˜¯ä¸€æ¬¡æŒç»­é›†æˆçš„è¿è¡Œï¼Œå¯ä»¥å®Œæˆå¤šä¸ªä»»åŠ¡ã€‚</p><p>ï¼ˆ3ï¼‰<strong>step</strong>ï¼ˆæ­¥éª¤ï¼‰ï¼šæ¯ä¸ª job ç”±å¤šä¸ª step æ„æˆï¼Œä¸€æ­¥æ­¥å®Œæˆã€‚</p><p>ï¼ˆ4ï¼‰<strong>action</strong> ï¼ˆåŠ¨ä½œï¼‰ï¼šæ¯ä¸ª step å¯ä»¥ä¾æ¬¡æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå‘½ä»¤ï¼ˆactionï¼‰ã€‚</p><h2 id="ä¸‰ã€workflow-æ–‡ä»¶"><a href="#ä¸‰ã€workflow-æ–‡ä»¶" class="headerlink" title="ä¸‰ã€workflow æ–‡ä»¶"></a>ä¸‰ã€workflow æ–‡ä»¶</h2><p>GitHub Actions çš„é…ç½®æ–‡ä»¶å«åš workflow æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ä»£ç ä»“åº“çš„<code>.github/workflows</code>ç›®å½•ã€‚</p><p>workflow æ–‡ä»¶é‡‡ç”¨ <a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html">YAML æ ¼å¼</a>ï¼Œæ–‡ä»¶åå¯ä»¥ä»»æ„å–ï¼Œä½†æ˜¯åç¼€åç»Ÿä¸€ä¸º<code>.yml</code>ï¼Œæ¯”å¦‚<code>foo.yml</code>ã€‚ä¸€ä¸ªåº“å¯ä»¥æœ‰å¤šä¸ª workflow æ–‡ä»¶ã€‚GitHub åªè¦å‘ç°<code>.github/workflows</code>ç›®å½•é‡Œé¢æœ‰<code>.yml</code>æ–‡ä»¶ï¼Œå°±ä¼šè‡ªåŠ¨è¿è¡Œè¯¥æ–‡ä»¶ã€‚</p><p>workflow æ–‡ä»¶çš„é…ç½®å­—æ®µéå¸¸å¤šï¼Œè¯¦è§<a href="https://help.github.com/en/articles/workflow-syntax-for-github-actions">å®˜æ–¹æ–‡æ¡£</a>ã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬å­—æ®µã€‚</p><p><strong>ï¼ˆ1ï¼‰<code>name</code></strong></p><p><code>name</code>å­—æ®µæ˜¯ workflow çš„åç§°ã€‚å¦‚æœçœç•¥è¯¥å­—æ®µï¼Œé»˜è®¤ä¸ºå½“å‰ workflow çš„æ–‡ä»¶åã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">GitHub</span> <span class="string">Actions</span> <span class="string">Demo</span></span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ2ï¼‰<code>on</code></strong></p><p><code>on</code>å­—æ®µæŒ‡å®šè§¦å‘ workflow çš„æ¡ä»¶ï¼Œé€šå¸¸æ˜¯æŸäº›äº‹ä»¶ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æŒ‡å®šï¼Œ<code>push</code>äº‹ä»¶è§¦å‘ workflowã€‚</p><p><code>on</code>å­—æ®µä¹Ÿå¯ä»¥æ˜¯äº‹ä»¶çš„æ•°ç»„ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span> [<span class="string">push</span>, <span class="string">pull_request</span>]</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æŒ‡å®šï¼Œ<code>push</code>äº‹ä»¶æˆ–<code>pull_request</code>äº‹ä»¶éƒ½å¯ä»¥è§¦å‘ workflowã€‚</p><p>å®Œæ•´çš„äº‹ä»¶åˆ—è¡¨ï¼Œè¯·æŸ¥çœ‹<a href="https://help.github.com/en/articles/events-that-trigger-workflows">å®˜æ–¹æ–‡æ¡£</a>ã€‚é™¤äº†ä»£ç åº“äº‹ä»¶ï¼ŒGitHub Actions ä¹Ÿæ”¯æŒå¤–éƒ¨äº‹ä»¶è§¦å‘ï¼Œæˆ–è€…å®šæ—¶è¿è¡Œã€‚</p><p><strong>ï¼ˆ3ï¼‰<code>on.&lt;push|pull_request&gt;.&lt;tags|branches&gt;</code></strong></p><p>æŒ‡å®šè§¦å‘äº‹ä»¶æ—¶ï¼Œå¯ä»¥é™å®šåˆ†æ”¯æˆ–æ ‡ç­¾ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span>    </span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æŒ‡å®šï¼Œåªæœ‰<code>master</code>åˆ†æ”¯å‘ç”Ÿ<code>push</code>äº‹ä»¶æ—¶ï¼Œæ‰ä¼šè§¦å‘ workflowã€‚</p><p><strong>ï¼ˆ4ï¼‰<code>jobs.&lt;job_id&gt;.name</code></strong></p><p>workflow æ–‡ä»¶çš„ä¸»ä½“æ˜¯<code>jobs</code>å­—æ®µï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„ä¸€é¡¹æˆ–å¤šé¡¹ä»»åŠ¡ã€‚</p><p><code>jobs</code>å­—æ®µé‡Œé¢ï¼Œéœ€è¦å†™å‡ºæ¯ä¸€é¡¹ä»»åŠ¡çš„<code>job_id</code>ï¼Œå…·ä½“åç§°è‡ªå®šä¹‰ã€‚<code>job_id</code>é‡Œé¢çš„<code>name</code>å­—æ®µæ˜¯ä»»åŠ¡çš„è¯´æ˜ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">my_first_job:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">My</span> <span class="string">first</span> <span class="string">job</span></span><br><span class="line">  <span class="attr">my_second_job:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">My</span> <span class="string">second</span> <span class="string">job</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„<code>jobs</code>å­—æ®µåŒ…å«ä¸¤é¡¹ä»»åŠ¡ï¼Œ<code>job_id</code>åˆ†åˆ«æ˜¯<code>my_first_job</code>å’Œ<code>my_second_job</code>ã€‚</p><p><strong>ï¼ˆ5ï¼‰<code>jobs.&lt;job_id&gt;.needs</code></strong></p><p><code>needs</code>å­—æ®µæŒ‡å®šå½“å‰ä»»åŠ¡çš„ä¾èµ–å…³ç³»ï¼Œå³è¿è¡Œé¡ºåºã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">job1:</span></span><br><span class="line">  <span class="attr">job2:</span></span><br><span class="line">    <span class="attr">needs:</span> <span class="string">job1</span></span><br><span class="line">  <span class="attr">job3:</span></span><br><span class="line">    <span class="attr">needs:</span> [<span class="string">job1</span>, <span class="string">job2</span>]</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>job1</code>å¿…é¡»å…ˆäº<code>job2</code>å®Œæˆï¼Œè€Œ<code>job3</code>ç­‰å¾…<code>job1</code>å’Œ<code>job2</code>çš„å®Œæˆæ‰èƒ½è¿è¡Œã€‚å› æ­¤ï¼Œè¿™ä¸ª workflow çš„è¿è¡Œé¡ºåºä¾æ¬¡ä¸ºï¼š<code>job1</code>ã€<code>job2</code>ã€<code>job3</code>ã€‚</p><p><strong>ï¼ˆ6ï¼‰<code>jobs.&lt;job_id&gt;.runs-on</code></strong></p><p><code>runs-on</code>å­—æ®µæŒ‡å®šè¿è¡Œæ‰€éœ€è¦çš„è™šæ‹Ÿæœºç¯å¢ƒã€‚å®ƒæ˜¯å¿…å¡«å­—æ®µã€‚ç›®å‰å¯ç”¨çš„è™šæ‹Ÿæœºå¦‚ä¸‹ã€‚</p><ul><li><code>ubuntu-latest</code>ï¼Œ<code>ubuntu-18.04</code>æˆ–<code>ubuntu-16.04</code></li><li><code>windows-latest</code>ï¼Œ<code>windows-2019</code>æˆ–<code>windows-2016</code></li><li><code>macOS-latest</code>æˆ–<code>macOS-10.14</code></li></ul><p>ä¸‹é¢ä»£ç æŒ‡å®šè™šæ‹Ÿæœºç¯å¢ƒä¸º<code>ubuntu-18.04</code>ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">runs-on:</span> <span class="string">ubuntu-18.04</span></span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ7ï¼‰<code>jobs.&lt;job_id&gt;.steps</code></strong></p><p><code>steps</code>å­—æ®µæŒ‡å®šæ¯ä¸ª Job çš„è¿è¡Œæ­¥éª¤ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ã€‚æ¯ä¸ªæ­¥éª¤éƒ½å¯ä»¥æŒ‡å®šä»¥ä¸‹ä¸‰ä¸ªå­—æ®µã€‚</p><ul><li><code>jobs.&lt;job_id&gt;.steps.name</code>ï¼šæ­¥éª¤åç§°ã€‚</li><li><code>jobs.&lt;job_id&gt;.steps.run</code>ï¼šè¯¥æ­¥éª¤è¿è¡Œçš„å‘½ä»¤æˆ–è€… actionã€‚</li><li><code>jobs.&lt;job_id&gt;.steps.env</code>ï¼šè¯¥æ­¥éª¤æ‰€éœ€çš„ç¯å¢ƒå˜é‡ã€‚</li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ workflow æ–‡ä»¶çš„èŒƒä¾‹ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Greeting</span> <span class="string">from</span> <span class="string">Mona</span></span><br><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">my-job:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">My</span> <span class="string">Job</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">a</span> <span class="string">greeting</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="attr">MY_VAR:</span> <span class="string">Hi</span> <span class="string">there!</span> <span class="string">My</span> <span class="string">name</span> <span class="string">is</span></span><br><span class="line">        <span class="attr">FIRST_NAME:</span> <span class="string">Mona</span></span><br><span class="line">        <span class="attr">MIDDLE_NAME:</span> <span class="string">The</span></span><br><span class="line">        <span class="attr">LAST_NAME:</span> <span class="string">Octocat</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">echo</span> <span class="string">$MY_VAR</span> <span class="string">$FIRST_NAME</span> <span class="string">$MIDDLE_NAME</span> <span class="string">$LAST_NAME.</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>steps</code>å­—æ®µåªåŒ…æ‹¬ä¸€ä¸ªæ­¥éª¤ã€‚è¯¥æ­¥éª¤å…ˆæ³¨å…¥å››ä¸ªç¯å¢ƒå˜é‡ï¼Œç„¶åæ‰§è¡Œä¸€æ¡ Bash å‘½ä»¤ã€‚</p><h2 id="å››ã€é¡¹ç›®å‘å¸ƒåˆ°-GitHub-Pages"><a href="#å››ã€é¡¹ç›®å‘å¸ƒåˆ°-GitHub-Pages" class="headerlink" title="å››ã€é¡¹ç›®å‘å¸ƒåˆ° GitHub Pages"></a>å››ã€é¡¹ç›®å‘å¸ƒåˆ° GitHub Pages</h2><blockquote><p><a href="https://github.com/sma11black/hexo-action">https://github.com/sma11black/hexo-action</a></p></blockquote><p><strong>How to add your ssh key pair?</strong></p><ol><li>Run the following terminal command, replacing the email with one connected to your GitHub account.</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C &quot;username@example.com&quot;</span><br></pre></td></tr></table></figure><ol><li>In <em>Github Pages</em> repo: Add the contents of the public key within your repositories deploy keys menu. You can find this option by going to <code>Settings &gt; Deploy Keys</code>, you can name the public key whatever you want, but you <strong>do</strong> need to give it write access.</li><li>In <em>hexo source code</em> repo: Add the contents of the private key to the <code>Settings &gt; Secrets</code> menu as DEPLOY_KEY.</li></ol><p><strong>å¦‚ä½•æ·»åŠ æ‚¨çš„sshå¯†é’¥å¯¹ï¼Ÿ</strong></p><p>1.è¿è¡Œä»¥ä¸‹ç»ˆç«¯å‘½ä»¤ï¼Œå°†ç”µå­é‚®ä»¶æ›¿æ¢ä¸ºè¿æ¥åˆ°æ‚¨çš„GitHubå¸æˆ·çš„ç”µå­é‚®ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;626562203@qq.com&quot;</span></span><br></pre></td></tr></table></figure><p>1.åœ¨<em>Github Pages</em>å­˜å‚¨åº“ä¸­ï¼šåœ¨å­˜å‚¨åº“éƒ¨ç½²å¯†é’¥èœå•ä¸­æ·»åŠ å…¬å…±å¯†é’¥çš„å†…å®¹ã€‚ æ‚¨å¯ä»¥é€šè¿‡è½¬åˆ°â€œSettings &gt; Deploy Keysâ€æ‰¾åˆ°æ­¤é€‰é¡¹ï¼Œå¯ä»¥éšæ„å‘½åå…¬ç”¨å¯†é’¥ï¼Œä½†æ˜¯æ‚¨ç¡®å®éœ€è¦æˆäºˆå…¶å†™è®¿é—®æƒé™ã€‚<br>2.åœ¨â€œ hexoæºä»£ç â€å­˜å‚¨åº“ä¸­ï¼šå°†ç§é’¥çš„å†…å®¹ä½œä¸ºDEPLOY_KEYæ·»åŠ åˆ°â€œSettings &gt; Secretsâ€èœå•ä¸­ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>]</span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">A</span> <span class="string">job</span> <span class="string">to</span> <span class="string">deploy</span> <span class="string">blog.</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/checkout@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">submodules:</span> <span class="literal">true</span> <span class="comment"># Checkout private submodules(themes or something else).</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Caching dependencies to speed up workflows. (GitHub will remove any cache entries that have not been accessed in over 7 days.)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">node</span> <span class="string">modules</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/cache@v1</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">cache</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">node_modules</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-node-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/package-lock.json&#x27;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-node-</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Dependencies</span></span><br><span class="line">      <span class="attr">if:</span> <span class="string">steps.cache.outputs.cache-hit</span> <span class="type">!=</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Deploy hexo blog website.</span></span><br><span class="line">    <span class="comment"># https://github.com/sma11black/hexo-action</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">deploy</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">sma11black/hexo-action@v1.0.4</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">deploy_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DEPLOY_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">user_name:</span> <span class="string">wangyyovo</span>  <span class="comment"># (or delete this input setting to use bot account)</span></span><br><span class="line">        <span class="attr">user_email:</span> <span class="number">626562203</span><span class="string">@qq.com</span>  <span class="comment"># (or delete this input setting to use bot account)</span></span><br><span class="line">        <span class="attr">commit_msg:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.head_commit.message</span> <span class="string">&#125;&#125;</span>  <span class="comment"># (or delete this input setting to use hexo default settings)</span></span><br><span class="line">    <span class="comment"># Use the output from the `deploy` step(use for test action)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">the</span> <span class="string">output</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">echo</span> <span class="string">&quot;$<span class="template-variable">&#123;&#123; steps.deploy.outputs.notify &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h2 id="äº”ã€å‚è€ƒé“¾æ¥"><a href="#äº”ã€å‚è€ƒé“¾æ¥" class="headerlink" title="äº”ã€å‚è€ƒé“¾æ¥"></a>äº”ã€å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://help.github.com/en/categories/automating-your-workflow-with-github-actions">GitHub Pages å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://lukeboyle.com/blog-posts/2019/08/github-actions-for-web-apps/">Github Actions for web apps</a>, Luke Boyle</li><li><a href="https://medium.com/@adam.zolyak/my-first-week-with-github-actions-5d92de4c4851">My First Week With GitHub Actions</a>, Adam Zolyak</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;GitHub-Actionså…¥é—¨æ•™ç¨‹&quot;&gt;&lt;a href=&quot;#GitHub-Actionså…¥é—¨æ•™ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;GitHub Actionså…¥é—¨æ•™ç¨‹&quot;&gt;&lt;/a&gt;GitHub Actionså…¥é—¨æ•™ç¨‹&lt;/h1&gt;&lt;blockquo
      
    
    </summary>
    
    
      <category term="git" scheme="http://wangyangyangisme.github.io/categories/git/"/>
    
    
      <category term="git" scheme="http://wangyangyangisme.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>å›¾è§£è®¾è®¡æ¨¡å¼</title>
    <link href="http://wangyangyangisme.github.io/posts/54deb0e2/"/>
    <id>http://wangyangyangisme.github.io/posts/54deb0e2/</id>
    <published>2021-05-16T15:30:56.000Z</published>
    <updated>2021-05-16T15:30:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å›¾è§£è®¾è®¡æ¨¡å¼"><a href="#å›¾è§£è®¾è®¡æ¨¡å¼" class="headerlink" title="å›¾è§£è®¾è®¡æ¨¡å¼"></a>å›¾è§£è®¾è®¡æ¨¡å¼</h1><blockquote><p><a href="http://tigerb.cn/2021/03/07/patterns-picture/">http://tigerb.cn/2021/03/07/patterns-picture/</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h2><p>å¸¸å¸¸å¬åˆ«äººè¯´è®¾è®¡æ¨¡å¼ä¸å¤ªå®¹æ˜“ç†è§£ï¼Œä»¥åŠå­¦ä¹ è®¾è®¡æ¨¡å¼åˆ°åº•èƒ½å¸®æˆ‘ä»¬è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œä»Šå¤©æˆ‘ä»¬å°±ç”¨å‡ å¼ å›¾æ¥çœ‹çœ‹ï¼š</p><ul><li>è®¾è®¡æ¨¡å¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å­¦ä¹ è®¾è®¡æ¨¡å¼ï¼Ÿ</li></ul><h2 id="æˆ‘ä¹Ÿå†™è¿‡çƒ‚ä»£ç "><a href="#æˆ‘ä¹Ÿå†™è¿‡çƒ‚ä»£ç " class="headerlink" title="æˆ‘ä¹Ÿå†™è¿‡çƒ‚ä»£ç "></a><strong>æˆ‘ä¹Ÿå†™è¿‡çƒ‚ä»£ç </strong></h2><p>æ˜¯çš„ï¼Œæ²¡ä»€ä¹ˆï¼Œæˆ‘ä¹Ÿå†™è¿‡çƒ‚ä»£ç ï¼Œåˆšæ¯•ä¸šæ—¶ä¸šåŠ¡é€»è¾‘ä¹Ÿä¼šä¸€ä¸ªå‡½æ•°å¹²åˆ°åº•ï¼ŒåªçŸ¥é“èƒ½å®ç°åŠŸèƒ½å°±å¯ä»¥äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package demo</span><br><span class="line"> </span><br><span class="line">func YourFunc() &#123;</span><br><span class="line">&#x2F;&#x2F; æ‰€æœ‰çš„é€»è¾‘ä»£ç ä¸€è‚¡è„‘å†™å®Œ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307142851.png" alt="å›¾ç‰‡"></p><h2 id="çŸ¥é“äº†æ‹†åˆ†å‡½æ•°"><a href="#çŸ¥é“äº†æ‹†åˆ†å‡½æ•°" class="headerlink" title="çŸ¥é“äº†æ‹†åˆ†å‡½æ•°"></a><strong>çŸ¥é“äº†æ‹†åˆ†å‡½æ•°</strong></h2><p>è‡ªç„¶è€Œç„¶çŸ¥é“äº†éœ€è¦åˆç†æ‹†åˆ†å‡½æ•°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307144449.png" alt="å›¾ç‰‡"></p><p>ç„¶åæŠŠå„ä¸ªå‡½æ•°ç»„ç»‡èµ·æ¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307144537.png" alt="å›¾ç‰‡"></p><h2 id="é¢ä¸´æ–°çš„å›°å¢ƒ"><a href="#é¢ä¸´æ–°çš„å›°å¢ƒ" class="headerlink" title="é¢ä¸´æ–°çš„å›°å¢ƒ"></a><strong>é¢ä¸´æ–°çš„å›°å¢ƒ</strong></h2><p>æŸä¸€å¤©äº§å“çš„éœ€æ±‚éœ€è¦æ”¯æŒæ–°çš„åœºæ™¯ï¼Œå‘ç°æŸä¸€å¤„çš„ä»£ç é€»è¾‘æœ‰å˜åŠ¨éœ€è¦æ”¯æŒæ–°çš„åœºæ™¯ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><ol><li>æ•´ä¸ªä»£ç æ‹·è´ä¸€ä»½ï¼Ÿä¸ä¼šæœ‰äººè¿™ä¹ˆå¹²å§ï¼Ÿ(å…¶å®æˆ‘è¿˜çœŸè§è¿‡ï¼Œä½ ä»¬å‘¢ğŸ˜)</li><li>æŠŠç»¿è‰²å˜åŠ¨çš„ä»£ç å—ï¼Œå¤åˆ¶æˆä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œä¿®æ”¹ä¸ºæ–°åœºæ™¯ä½¿ç”¨çš„å‡½æ•°ï¼Ÿ</li><li>æŠŠå˜åŠ¨çš„ä»£ç å†æä¸ºä¸¤ä¸ªæ–°å‡½æ•°ï¼Œä¸€ä¸ªç»¿è‰²ä¸ºè€ä»£ç ï¼Œä¸€ä¸ªè“è‰²ä¸ºæ–°åœºæ™¯ä»£ç ï¼Ÿ</li></ol><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307144548.png" alt="å›¾ç‰‡"></p><p>ä¸Šé¢è¿™ç§è§£å†³é—®é¢˜çš„æ–¹å¼å°±æ˜¯é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹æ€æƒ³ã€‚</p><h2 id="æˆ‘ä»¬éƒ½åœ¨å˜ä¼˜ç§€"><a href="#æˆ‘ä»¬éƒ½åœ¨å˜ä¼˜ç§€" class="headerlink" title="æˆ‘ä»¬éƒ½åœ¨å˜ä¼˜ç§€"></a><strong>æˆ‘ä»¬éƒ½åœ¨å˜ä¼˜ç§€</strong></h2><p>éšç€æˆ‘ä»¬ä¸æ–­çš„å­¦ä¹ ï¼Œå­¦ä¼šä½¿ç”¨äº†é¢å‘å¯¹è±¡çš„ç‰¹æ€§ã€‚</p><p>ä»¥å¾€å‡½æ•°å¼ç¼–ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package demo</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; å‡½æ•°å¼ç¼–ç¨‹</span><br><span class="line">&#x2F;&#x2F; æŠŠä¸€ä¸ªä¸ªä½ ä»¥ä¸ºå¯ä»¥ç‹¬ç«‹çš„é€»è¾‘å°ä½åˆ°ä¸€ä¸ªå‡½æ•°é‡Œ</span><br><span class="line">func YourFunc() &#123;</span><br><span class="line">&#x2F;&#x2F; ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package demo</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; é¢å‘å¯¹è±¡ç¼–ç¨‹</span><br><span class="line">&#x2F;&#x2F; æŠŠä¸åŒçš„é€»è¾‘ç‹¬ç«‹æˆä¸€ä¸ªå¯¹è±¡</span><br><span class="line">type DemoStruct struct&#123;&#125;</span><br><span class="line"> </span><br><span class="line">func (d *DemoStruct) YourFunc() &#123;</span><br><span class="line">&#x2F;&#x2F; ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307144805.png" alt="å›¾ç‰‡"></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¦‚ä½•ç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³ç»„ç»‡ä¸Šé¢çš„ä»£ç å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆï¼šç»§æ‰¿ã€‚</p><h2 id="å­¦ä¼šäº†ä½¿ç”¨ç»§æ‰¿"><a href="#å­¦ä¼šäº†ä½¿ç”¨ç»§æ‰¿" class="headerlink" title="å­¦ä¼šäº†ä½¿ç”¨ç»§æ‰¿"></a><strong>å­¦ä¼šäº†ä½¿ç”¨ç»§æ‰¿</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹åˆ«å¤‡æ³¨ï¼šGoé‡Œé¢ç”¨åˆæˆå¤ç”¨</span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªçˆ¶ç±»ï¼Œå¹¶æŠŠå·®å¼‚ä¸šåŠ¡ä»£ç æŠ½è±¡ä¸ºä¸€ä¸ªæŠ½è±¡å‡½æ•°ï¼Œå…¶ä»–ä»£ç é€»è¾‘éƒ½å®ç°åœ¨çˆ¶ç±»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307145233.png" alt="å›¾ç‰‡"></p><p>ä¸åŒçš„åœºæ™¯å®šä¹‰ä¸ºä¸åŒçš„å­ç±»ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå¹¶å®ç°æŠ½è±¡æ–¹æ³•(ä¹Ÿå°±æ˜¯å†™å·®å¼‚ä»£ç )ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç°è‰²ï¼šçˆ¶ç±»</span><br><span class="line">ç»¿è‰²ï¼šåœºæ™¯ä¸€å­ç±»</span><br><span class="line">è“è‰²ï¼šåœºæ™¯äºŒå­ç±»</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307145350.png" alt="å›¾ç‰‡"></p><p>æ˜¯ä¸æ˜¯å¾ˆä¼˜é›…çš„è§£å†³ä¸Šé¢çš„åœºæ™¯çš„é—®é¢˜ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ"></a><strong>ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ</strong></h2><p>ä¼˜é›…çš„è§£å†³ä¸Šé¢åœºæ™¯é—®é¢˜æ—¶ï¼Œåˆ©ç”¨é¢å‘å¯¹è±¡ç‰¹æ€§çš„ç»éªŒæ€»ç»“ï¼Œå°±æ˜¯è®¾è®¡æ¨¡å¼ã€‚ç„¶è€Œåœ¨å†å²çš„é•¿æ²³ä¸­ï¼Œå·²ç»ä¸ºæˆ‘ä»¬æ€»ç»“äº†20+çš„å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬åªéœ€è¦å­¦ä¹ å’ŒåŠ ä»¥çµæ´»è¿ç”¨å³å¯ã€‚æ¯”å¦‚ï¼š</p><h3 id="è¿™ï¼å°±æ˜¯æ¨¡æ¿æ¨¡å¼"><a href="#è¿™ï¼å°±æ˜¯æ¨¡æ¿æ¨¡å¼" class="headerlink" title="è¿™ï¼å°±æ˜¯æ¨¡æ¿æ¨¡å¼"></a><strong>è¿™ï¼å°±æ˜¯æ¨¡æ¿æ¨¡å¼</strong></h3><p>è¿˜è®°å¾—ä¸Šé¢ä½¿ç”¨ç»§æ‰¿çš„è¿‡ç¨‹å—ï¼Ÿå…¶å®æˆ‘ä»¬åªéœ€è¦åšä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯ç»å…¸çš„æ¨¡æ¿æ¨¡å¼äº†ï¼Œæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ç­”æ¡ˆï¼šä¿è¯è¯¥åœºæ™¯ä¸‹çˆ¶ç±»ä¸­å°è£…çš„æ–¹æ³•è°ƒç”¨è¿‡ç¨‹æ˜¯ç¨³å®šä¸å˜çš„ï¼Œåªæ˜¯å…¶ä¸­çš„æ–¹æ³•å¯èƒ½å˜åŒ–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç°è‰²ï¼šçˆ¶ç±»</span><br><span class="line">ç»¿è‰²ï¼šåœºæ™¯ä¸€å­ç±»</span><br><span class="line">è“è‰²ï¼šåœºæ™¯äºŒå­ç±»</span><br><span class="line">é»„è‰²ï¼šåœºæ™¯ä¸‰å­ç±»</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307145530.png" alt="å›¾ç‰‡"></p><h3 id="è¿™ï¼å°±æ˜¯ç­–ç•¥æ¨¡å¼"><a href="#è¿™ï¼å°±æ˜¯ç­–ç•¥æ¨¡å¼" class="headerlink" title="è¿™ï¼å°±æ˜¯ç­–ç•¥æ¨¡å¼"></a><strong>è¿™ï¼å°±æ˜¯ç­–ç•¥æ¨¡å¼</strong></h3><p>æˆ‘ä»¬æŠŠä¸Šé¢ä»£ç åšäº›æ”¹åŠ¨ï¼š</p><ol><li>ä¸ä½¿ç”¨ç»§æ‰¿ã€‚</li><li>å®šä¹‰ä¸€ä¸ªæ¥å£interfaceç±»å‹ã€‚</li><li>å˜æ›´åŸæŠ½è±¡æ–¹æ³•ä¸ºè°ƒç”¨ä¸€ä¸ªæ¥å£interfaceç±»å‹çš„å‡½æ•°ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package demo</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; DemoInterface æ¥å£</span><br><span class="line">type DemoInterface interface &#123;</span><br><span class="line">    DoSomething(ctx *Context) error </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">var CurrentStrategyInstance DemoInterface</span><br><span class="line"> </span><br><span class="line">func Demo() &#123;</span><br><span class="line">&#x2F;&#x2F;.....é€»è¾‘ç•¥......</span><br><span class="line">CurrentStrategyInstance.DoSomething(c)</span><br><span class="line">&#x2F;&#x2F;.....é€»è¾‘ç•¥......</span><br><span class="line">&#125;</span><br><span class="line">ç°è‰²ï¼šä¸»ä¸šåŠ¡ç±»</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307145603.png" alt="å›¾ç‰‡"></p><ol><li>ä¸åŒçš„åœºæ™¯å®šä¹‰ä¸ºä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œä¸”å®ç°ä¸Šé¢çš„interfaceã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç°è‰²ï¼šä¸»ä¸šåŠ¡ç±»</span><br><span class="line">ç»¿è‰²ï¼šåœºæ™¯ä¸€DemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307145617.png" alt="å›¾ç‰‡"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç°è‰²ï¼šä¸»ä¸šåŠ¡ç±»</span><br><span class="line">ç»¿è‰²ï¼šåœºæ™¯ä¸€DemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br><span class="line">è“è‰²ï¼šåœºæ™¯äºŒDemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307145643.png" alt="å›¾ç‰‡"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç°è‰²ï¼šä¸»ä¸šåŠ¡ç±»</span><br><span class="line">ç»¿è‰²ï¼šåœºæ™¯ä¸€DemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br><span class="line">è“è‰²ï¼šåœºæ™¯äºŒDemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br><span class="line">é»„è‰²ï¼šåœºæ™¯ä¸‰DemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307145705.png" alt="å›¾ç‰‡"></p><ol><li>æœ€åæˆ‘ä»¬åˆ¤æ–­ä¸åŒçš„åœºæ™¯åˆå§‹åŒ–ä¸åŒçš„å…·ä½“ç±»ï¼Œå†è°ƒç”¨å³å¯ã€‚</li></ol><h2 id="è¿™ï¼å°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼-ç­–ç•¥æ¨¡å¼"><a href="#è¿™ï¼å°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼-ç­–ç•¥æ¨¡å¼" class="headerlink" title="è¿™ï¼å°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼ + ç­–ç•¥æ¨¡å¼"></a><strong>è¿™ï¼å°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼ + ç­–ç•¥æ¨¡å¼</strong></h2><p>æ¥ç€æˆ‘ä»¬æŠŠåˆ¤æ–­ä¸åŒçš„åœºæ™¯åˆå§‹åŒ–ä¸åŒçš„å…·ä½“ç±»å•ç‹¬å°è£…èµ·æ¥ï¼Œè¿™å°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼ + ç­–ç•¥æ¨¡å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">package demo</span><br><span class="line"> </span><br><span class="line">type DemoFactory struct &#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; Get è·å–å®ä¾‹</span><br><span class="line">func (f *DemoFactory) Get(instanceType string) DemoInterface &#123;</span><br><span class="line">switch instanceType &#123;</span><br><span class="line">case &quot;DemoA&quot;:</span><br><span class="line">return &amp;DemoA&#123;&#125;</span><br><span class="line">case &quot;DemoB&quot;:</span><br><span class="line">return &amp;DemoB&#123;&#125;</span><br><span class="line">case &quot;DemoC&quot;:</span><br><span class="line">return &amp;DemoC&#123;&#125;</span><br><span class="line"> </span><br><span class="line">default:</span><br><span class="line">panic(&quot;ä¸æ”¯æŒçš„ç±»å‹&quot;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; DemoInterface æ¥å£</span><br><span class="line">type DemoInterface interface &#123;</span><br><span class="line">    DoSomething(ctx *Context) error </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">var CurrentStrategyInstance DemoInterface</span><br><span class="line"> </span><br><span class="line">func Demo() &#123;</span><br><span class="line">&#x2F;&#x2F;.....é€»è¾‘ç•¥......</span><br><span class="line">  CurrentStrategyInstance &#x3D; (DemoFactory&#123;&#125;).Get(&quot;DemoA&quot;)</span><br><span class="line">CurrentStrategyInstance.DoSomething(c)</span><br><span class="line">&#x2F;&#x2F;.....é€»è¾‘ç•¥......</span><br><span class="line">&#125;</span><br><span class="line">ç°è‰²(å¤§)ï¼šä¸»ä¸šåŠ¡ç±»</span><br><span class="line">ç°è‰²(å°)ï¼šç®€å•å·¥å‚ç±»</span><br><span class="line">ç»¿è‰²ï¼šåœºæ™¯ä¸€DemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br><span class="line">è“è‰²ï¼šåœºæ™¯äºŒDemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br><span class="line">é»„è‰²ï¼šåœºæ™¯ä¸‰DemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307154154.png" alt="å›¾ç‰‡"></p><h2 id="è¿™ï¼å°±æ˜¯çŠ¶æ€æ¨¡å¼"><a href="#è¿™ï¼å°±æ˜¯çŠ¶æ€æ¨¡å¼" class="headerlink" title="è¿™ï¼å°±æ˜¯çŠ¶æ€æ¨¡å¼"></a><strong>è¿™ï¼å°±æ˜¯çŠ¶æ€æ¨¡å¼</strong></h2><p>å‡è®¾åˆ¤æ–­ä¸Šé¢ä½¿ç”¨ä½•ç§ç­–ç•¥ä¸æ˜¯ä¾èµ–å¤–éƒ¨ï¼Œè€Œæ˜¯ä¾èµ–å†…éƒ¨çŠ¶æ€ï¼Œåˆ™æˆ‘ä»¬è°ƒæ•´ä¸‹ä»£ç ï¼Œåˆ™å°±å˜æˆäº†çŠ¶æ€æ¨¡å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">package demo</span><br><span class="line"></span><br><span class="line">var currentStateInstance DemoInterface</span><br><span class="line"></span><br><span class="line">func init() &#123;</span><br><span class="line">    &#x2F;&#x2F; å®šæ—¶å™¨æ›´æ–°çŠ¶æ€</span><br><span class="line">    go func() &#123;</span><br><span class="line">        for &#123;</span><br><span class="line">            select &#123;</span><br><span class="line">            case t :&#x3D; &lt;-time.NewTicker(1 * time.Second).C:</span><br><span class="line">                &#x2F;&#x2F; æ¨¡æ‹Ÿå˜æˆçŠ¶æ€ StateA</span><br><span class="line">                currentStateInstance &#x3D; setState(&quot;StateA&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; Get è·å–å®ä¾‹</span><br><span class="line">func setState(State string) DemoInterface &#123;</span><br><span class="line">  &#x2F;&#x2F; å˜æ›´çŠ¶æ€</span><br><span class="line">switch State &#123;</span><br><span class="line">case &quot;StateA&quot;:</span><br><span class="line">return &amp;StateA&#123;&#125;</span><br><span class="line">case &quot;StateB&quot;:</span><br><span class="line">return &amp;StateB&#123;&#125;</span><br><span class="line">case &quot;StateC&quot;:</span><br><span class="line">return &amp;StateC&#123;&#125;</span><br><span class="line"> </span><br><span class="line">default:</span><br><span class="line">panic(&quot;ä¸æ”¯æŒçš„çŠ¶æ€&quot;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; DemoInterface æ¥å£</span><br><span class="line">type DemoInterface interface &#123;</span><br><span class="line">    DoSomething(ctx *Context) error </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; type StateA StateB StateC ç•¥</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; æ¨¡æ‹Ÿ</span><br><span class="line">func Demo() &#123;</span><br><span class="line">&#x2F;&#x2F;.....é€»è¾‘ç•¥......</span><br><span class="line">CurrentStateInstance.DoSomething(c)</span><br><span class="line">&#x2F;&#x2F;.....é€»è¾‘ç•¥......</span><br><span class="line">&#125;</span><br><span class="line">ç°è‰²(å¤§)ï¼šä¸»ä¸šåŠ¡ç±»</span><br><span class="line">ç°è‰²(å°)ï¼šä¿®æ”¹å†…éƒ¨çŠ¶æ€çš„å‡½æ•°</span><br><span class="line">ç»¿è‰²ï¼šåœºæ™¯ä¸€DemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br><span class="line">è“è‰²ï¼šåœºæ™¯äºŒDemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br><span class="line">é»„è‰²ï¼šåœºæ™¯ä¸‰DemoInterfaceçš„å…·ä½“å®ç°ç±»</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20210307160512.png" alt="å›¾ç‰‡"></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a><strong>ç»“è¯­</strong></h2><p>ä¸¾äº†è¿™ä¹ˆå¤šğŸŒ°ï¼Œæ‰€ä»¥å…³äºï¼š</p><ul><li>è®¾è®¡æ¨¡å¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å­¦ä¹ è®¾è®¡æ¨¡å¼ï¼Ÿ</li></ul><p>ä½ æœ‰ç­”æ¡ˆäº†å—ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å›¾è§£è®¾è®¡æ¨¡å¼&quot;&gt;&lt;a href=&quot;#å›¾è§£è®¾è®¡æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;å›¾è§£è®¾è®¡æ¨¡å¼&quot;&gt;&lt;/a&gt;å›¾è§£è®¾è®¡æ¨¡å¼&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://tigerb.cn/2021/03/07/patt
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹</title>
    <link href="http://wangyangyangisme.github.io/posts/88f78d2f/"/>
    <id>http://wangyangyangisme.github.io/posts/88f78d2f/</id>
    <published>2021-05-16T15:24:56.000Z</published>
    <updated>2021-05-16T15:24:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹"><a href="#é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹" class="headerlink" title="é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹"></a>é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹</h1><blockquote><p><a href="http://tigerb.cn/2019/10/11/oop/">http://tigerb.cn/2019/10/11/oop/</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä¸€ç›´è®¤ä¸ºåˆ†äº«çš„ç›®çš„ä¸æ˜¯ç‚«æŠ€ã€‚</p><ul><li>ä¸€æ˜¯ï¼Œè‡ªæˆ‘å­¦ä¹ çš„æ€»ç»“ã€‚</li><li>äºŒæ˜¯ï¼Œé™ä½ä»–äººçš„å­¦ä¹ æˆæœ¬ã€‚</li><li>ä¸‰æ˜¯ï¼Œåˆ«äººå¯¹è‡ªå·±å­¦ä¹ ç»“æœçš„å®¡æ ¸ã€‚</li></ul><p>åŒæ—¶ï¼Œæœ¬æ¬¡åˆ†äº«æœ‰ä¸‹é¢å››ä¸ªè¦ç´ ï¼š</p><table><thead><tr><th align="left">è§‚ç‚¹</th><th align="left">æœ¬æ¬¡åˆ†äº«çš„è§‚ç‚¹æ˜¯ä¸€ä¸ªè½¯ä»¶å·¥ç¨‹ä¸­çš„æ€ç»´æ–¹æ³•ï¼Œä¸é™äºç¼–ç¨‹è¯­è¨€</th></tr></thead><tbody><tr><td align="left"><strong>æ¢è®¨</strong></td><td align="left"><strong>æˆ‘å¯èƒ½ç†è§£é”™çš„ï¼Œæˆ–è€…å¤§å®¶æ²¡ç†è§£çš„ï¼Œæ¬¢è¿å¤§å®¶ç§¯æè¯„è®ºï¼Œå°½å¯èƒ½å¤šäº’åŠ¨ï¼Œç›®çš„å¢åŠ ç†è§£</strong></td></tr><tr><td align="left"><strong>ç†è§£</strong></td><td align="left"><strong>çœŸçš„å¸Œæœ›å¤§å®¶èƒ½ç†è§£</strong></td></tr><tr><td align="left"><strong>è¿ç”¨</strong></td><td align="left"><strong>æœ€é‡è¦çš„ï¼Œå¦‚æœä½ è§‰ç€æœ‰å¸®åŠ©ï¼Œä¸€å®šè¦å»åœ¨å®é™…ä¸šåŠ¡ä¸­å®æˆ˜</strong></td></tr></tbody></table><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å·¥ä½œä¸­ï¼Œå‡ ä¹å¤§å®¶ç»å¸¸æŠ±æ€¨åˆ«äººå†™çš„ä»£ç ï¼š</p><ul><li>æ²¡æ³•æ”¹</li><li>è€¦åˆé«˜</li><li>æ— æ³•æ‰©å±•</li></ul><blockquote><p>ä»Šå¤©å°±æ¥æ¢è®¨å¦‚ä½•<strong>å…‹æœ</strong>ä¸Šé¢çš„é—®é¢˜ï½</p></blockquote><h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><p>é¦–å…ˆé—®ä¸ªé—®é¢˜ï¼š</p><blockquote><p>å¹³å¸¸å·¥ä½œä¸­æ¥äº†ä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•å¼€å§‹å†™ä»£ç çš„ï¼Ÿ</p></blockquote><p>æˆ‘æ¨æµ‹å¤§å¤šæ•°äººå¯èƒ½ï¼š</p><ul><li>1ã€æ¢³ç†ä¸šåŠ¡</li><li>2ã€è®¾è®¡æ•°æ®åº“ã€æ¥å£ã€ç¼“å­˜</li><li>3ã€è¯„å®¡</li><li>4ã€äºæ˜¯å°±å¼€å§‹äº† <code>æ€ä¹ˆæ€ä¹ˆæ ·...å¦‚æœæ€ä¹ˆæ€ä¹ˆæ ·...æ€ä¹ˆæ€ä¹ˆæ ·...</code>æ„‰å¿«çš„ç ä»£ç çš„è¿‡ç¨‹</li></ul><blockquote><p>æ­¤å¤„æœ‰äººè§‰ç€æœ‰å•¥é—®é¢˜ä¹ˆï¼Ÿ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¤‡æ³¨ï¼šè¯´å‡ºæ¥é—®é¢˜çš„ï¼Œæœ¬æ¬¡åˆ†äº«å°±å¯ä»¥ç•¥è¿‡äº†~</span><br></pre></td></tr></table></figure><h3 id="ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡åœºæ™¯"><a href="#ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡åœºæ™¯" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡åœºæ™¯"></a>ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡åœºæ™¯</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">æ¯”å¦‚äº§å“æäº†ä¸ªéœ€æ±‚ï¼š</span><br><span class="line">æè¿°â€œæˆ‘ä¸€ä¸ªåŒäº‹â€ä¸€å¤©çš„ç”Ÿæ´»ï¼Œç®€å•æ¥çœ‹çœ‹ä»–ä¸€å¤©å¹²äº›å•¥ï¼š</span><br><span class="line"></span><br><span class="line">1.0 é¥¿äº†åƒé¥­</span><br><span class="line">1.1 åˆ°ç‚¹åƒé¥­</span><br><span class="line"></span><br><span class="line">2.0 æ¸´äº†å–æ°´</span><br><span class="line">2.1 åˆ°ç‚¹å–æ°´</span><br><span class="line"></span><br><span class="line">3.0 å›°äº†ç¡è§‰</span><br><span class="line">3.1 åˆ°ç‚¹ç¡è§‰</span><br><span class="line">3.2 æœ‰å¯èƒ½ä¸€ä¸ªäººç¡è§‰ï¼Œä¹Ÿæœ‰å¯èƒ½... æ˜¯å§ï¼Ÿå¤æ‚</span><br></pre></td></tr></table></figure><p>åˆšå¼€å§‹ï¼Œä¸€ä¸ªä¸šåŠ¡é€»è¾‘ä»å¤´å†™åˆ°å°¾</p><p><a href="http://cdn.tigerb.cn/20191020234013.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020234013.png" alt="img"></a></p><p>ä¸€ä¸ªä¸šåŠ¡é€»è¾‘(æ‹†æˆå¤šä¸ªå‡½æ•°)ä»å¤´å†™åˆ°å°¾ï¼š</p><p><a href="http://cdn.tigerb.cn/20191020234051.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020234051.png" alt="img"></a></p><p>ä¸€ä¸ªä¸šåŠ¡é€»è¾‘(å¼•å…¥ç±»)ä»å¤´å†™åˆ°å°¾ï¼š</p><p><a href="http://cdn.tigerb.cn/20191020234118.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020234118.png" alt="img"></a></p><p>ä¸€ä¸ªä¸šåŠ¡é€»è¾‘(æ‹†æˆå¤šä¸ªç±»æ–¹æ³•)ä»å¤´å†™åˆ°å°¾ï¼Œä¹Ÿè®¸ã€å¯èƒ½ã€è²Œä¼¼ã€çŒœæµ‹å¤§å¤šæ•°äººåœç•™åˆ°äº†è¿™ä¸ªé˜¶æ®µã€‚<br>é—®é¢˜ï¼šæŸä¸€å¤©å¤šäº†ç¤¾äº¤çš„èƒ½åŠ›ï¼Œå’‹åŠï¼Ÿ</p><p><a href="http://cdn.tigerb.cn/20191020234526.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020234526.png" alt="img"></a></p><p>ä¸€ä¸ªä¸šåŠ¡é€»è¾‘(æ‹†æˆå¤šç±»)ä»å¤´å†™åˆ°å°¾ï¼š</p><p><a href="http://cdn.tigerb.cn/20191020234848.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020234848.png" alt="img"></a></p><p>ä¸€ä¸ªä¸šåŠ¡é€»è¾‘(æ‹†æˆç±»ã€æŠ½è±¡ç±»ã€æ¥å£)ä»å¤´å†™åˆ°å°¾ï¼š</p><p><a href="http://cdn.tigerb.cn/20191020235015.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020235015.png" alt="img"></a></p><blockquote><p>æ€è€ƒğŸ¤”ï¼šä¸Šé¢çš„ä»£ç å°±æ²¡å•¥é—®é¢˜äº†å—ï¼Ÿ</p></blockquote><p>ä¸Šé¢å°±æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„ä»£ç ç»“æœã€‚</p><blockquote><p>æ‰€ä»¥ï¼Œå¦‚ä½•è®¾è®¡å‡ºå®Œå…¨é¢å‘å¯¹è±¡çš„ä»£ç ï¼Ÿ</p></blockquote><h2 id="ä»£ç å»ºæ¨¡"><a href="#ä»£ç å»ºæ¨¡" class="headerlink" title="ä»£ç å»ºæ¨¡"></a>ä»£ç å»ºæ¨¡</h2><blockquote><p>ä»€ä¹ˆæ˜¯ä»£ç å»ºæ¨¡ï¼Ÿ</p></blockquote><p>æŠŠä¸šåŠ¡æŠ½è±¡æˆäº‹ç‰©(ç±»classã€æŠ½è±¡ç±»abstact class)å’Œè¡Œä¸º(æ¥å£interface)çš„è¿‡ç¨‹ã€‚</p><h3 id="å®æ —ğŸŒ°åˆ†æ"><a href="#å®æ —ğŸŒ°åˆ†æ" class="headerlink" title="å®æ —ğŸŒ°åˆ†æ"></a>å®æ —ğŸŒ°åˆ†æ</h3><p>åˆæ¥çœ‹ä¸€ä¸ªå®é™…çš„ä¸šåŠ¡åœºæ™¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æœ€è¿‘â€œæˆ‘ä¸€ä¸ªåŒäº‹â€å¼€å§‹åˆ›ä¸šäº†ï¼Œåˆšåˆ›ç«‹äº†ä¸€å®¶ç”µå•†å…¬å¸ï¼ŒB2Cï¼Œè‡ªè¥ä¹¦ç±ã€Š3åˆ†é’Ÿå­¦ä¼šäº¤é™…ã€‹ã€‚æœ€è¿‘å¼€å§‹å†™æäº¤è®¢å•çš„ä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">âš ï¸æ³¨æ„åœºæ™¯ 1.åˆšåˆ›ä¸š 2.ç®€å•çš„å•ä½“åº”ç”¨ 3.æ­¤å¤„ä¸æ¢è®¨æ¶æ„</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ ¹æ®ä¸šåŠ¡éœ€æ±‚ä¸€é¡¿åˆ†æï¼Œå¼€å§‹å®šä¹‰æ¥å£APIã€è®¾è®¡æ•°æ®åº“ã€ç¼“å­˜ã€æŠ€æœ¯è¯„å®¡ç­‰å°±å¼€å§‹ç ä»£ç äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">æ¥å£å‚æ•°ï¼š</span><br><span class="line">uid</span><br><span class="line">address_id</span><br><span class="line">coupon_id</span><br><span class="line">.etc</span><br><span class="line"></span><br><span class="line">ä¸šåŠ¡é€»è¾‘ï¼š</span><br><span class="line">å‚æ•°æ ¡éªŒ-&gt;</span><br><span class="line">åœ°å€æ ¡éªŒ-&gt;</span><br><span class="line">å…¶ä»–æ ¡éªŒ-&gt;</span><br><span class="line">å†™è®¢å•è¡¨-&gt;</span><br><span class="line">å†™è®¢å•å•†å“ä¿¡æ¯è¡¨-&gt;</span><br><span class="line">å†™æ—¥å¿—-&gt;</span><br><span class="line">æ‰£å‡å•†å“åº“å­˜-&gt;</span><br><span class="line">æ¸…ç†è´­ç‰©è½¦-&gt;</span><br><span class="line">æ‰£å‡å„ç§ä¿ƒé”€ä¼˜æƒ æ´»åŠ¨çš„åº“å­˜-&gt;</span><br><span class="line">ä½¿ç”¨ä¼˜æƒ åˆ¸-&gt;</span><br><span class="line">å…¶ä»–è¥é”€é€»è¾‘ç­‰ç­‰-&gt;</span><br><span class="line">å‘é€æ¶ˆæ¯-&gt;</span><br><span class="line">ç­‰ç­‰...</span><br></pre></td></tr></table></figure><p>å°±å¼€å§‹å†™ä»£ç äº†<code>æ€ä¹ˆæ€ä¹ˆæ ·...å¦‚æœæ€ä¹ˆæ€ä¹ˆæ ·...æ€ä¹ˆæ€ä¹ˆæ ·...</code>ä¸€è¹´è€Œå°±ã€æ€è·¯æ¸…æ™°ã€é€»è¾‘æ¸…æ¥šã€å¾ˆå¿«æå®šå®Œä»£ç ï¼Œå¾ˆä¼˜ç§€æ˜¯ä¸æ˜¯ï¼Œå€¼å¾—é¼“åŠ±ã€‚</p><p>ä½†æ˜¯ï¼Œä¸Šé¢çš„ç»“æœå°±æ˜¯å¤§æ¦‚æ‰€æœ‰äººéƒ½è§è¿‡çš„è¿ç»­ä¸Šåƒè¡Œçš„ä»£ç ç­‰ç­‰ã€‚ä¸Šé¢çš„æµç¨‹æ²¡å•¥é—®é¢˜å•Šï¼Œé‚£æ­£ç¡®çš„åšæ³•æ˜¯ä»€ä¹ˆäº†ï¼Ÿå°±æ˜¯æ¥ç€è¦è¯´çš„<strong>ä»£ç å»ºæ¨¡</strong>ã€‚</p><p>æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„åœºæ™¯ï¼Œå¼€å§‹å»ºæ¨¡ã€‚</p><h3 id="ä¸šåŠ¡åˆ†æå°‘ä¸äº†"><a href="#ä¸šåŠ¡åˆ†æå°‘ä¸äº†" class="headerlink" title="ä¸šåŠ¡åˆ†æå°‘ä¸äº†"></a>ä¸šåŠ¡åˆ†æå°‘ä¸äº†</h3><p>åŒæ ·ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬çœ‹çœ‹<code>æäº¤è®¢å•</code>è¿™ä¸ªä¸šåŠ¡åœºæ™¯è¦åšçš„äº‹æƒ…:</p><blockquote><p>æ¢ä¸ªè§’åº¦çœ‹ä¸šåŠ¡å…¶å®å¾ˆç®€å•ï¼šæ ¹æ®ç”¨æˆ·ç›¸å…³ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªè®¢å•ã€‚</p></blockquote><ol><li><p>æ¢³ç†å¾—åˆ°ä¸šåŠ¡é€»è¾‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">å‚æ•°æ ¡éªŒ-&gt;</span><br><span class="line">åœ°å€æ ¡éªŒ-&gt;</span><br><span class="line">å…¶ä»–æ ¡éªŒ-&gt;</span><br><span class="line">å†™è®¢å•è¡¨-&gt;</span><br><span class="line">å†™è®¢å•å•†å“ä¿¡æ¯è¡¨-&gt;</span><br><span class="line">å†™æ—¥å¿—-&gt;</span><br><span class="line">æ‰£å‡å•†å“åº“å­˜-&gt;</span><br><span class="line">æ¸…ç†è´­ç‰©è½¦-&gt;</span><br><span class="line">æ‰£å‡å„ç§ä¿ƒé”€ä¼˜æƒ æ´»åŠ¨çš„åº“å­˜-&gt;</span><br><span class="line">ä½¿ç”¨ä¼˜æƒ åˆ¸-&gt;</span><br><span class="line">å…¶ä»–è¥é”€é€»è¾‘ç­‰ç­‰-&gt;</span><br><span class="line">å‘é€æ¶ˆæ¯-&gt;</span><br><span class="line">ç­‰ç­‰...</span><br></pre></td></tr></table></figure></li><li><p>æ¢³ç†ä¸šåŠ¡é€»è¾‘ä¾èµ–ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">å•†å“ä¿¡æ¯</span><br><span class="line">åœ°å€ä¿¡æ¯</span><br><span class="line">ä¼˜æƒ åˆ¸ä¿¡æ¯</span><br><span class="line">ç­‰ç­‰...</span><br></pre></td></tr></table></figure></li></ol><p>å†æ¬¡å›å½’æ¦‚å¿µ</p><blockquote><p>ä»€ä¹ˆæ˜¯ä»£ç å»ºæ¨¡ï¼ŸæŠŠä¸šåŠ¡æŠ½è±¡æˆäº‹ç‰©(ç±»classã€æŠ½è±¡ç±»abstact class)å’Œè¡Œä¸º(æ¥å£interface)çš„è¿‡ç¨‹ã€‚</p></blockquote><h3 id="è·å–äº‹ç‰©"><a href="#è·å–äº‹ç‰©" class="headerlink" title="è·å–äº‹ç‰©"></a>è·å–äº‹ç‰©</h3><p>æ¯”å¦‚æˆ‘ä»¬æŠŠè®¢å•ç”Ÿæˆçš„è¿‡ç¨‹å¯ä»¥æƒ³è±¡æˆ<code>æœºå™¨äºº</code>ï¼Œä¸€ä¸ªç”Ÿæˆè®¢å•çš„<code>è®¢å•ç”Ÿæˆæœºå™¨äºº</code>ï¼Œæˆ–è€…è®¢å•ç”Ÿæˆæœºå™¨å•¥çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†<code>ä»£ç å»ºæ¨¡</code>è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªäº‹ç‰©ã€‚</p><p>ä»è€Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™ä¸ªäº‹ç‰©è½¬åŒ–æˆä¸€ä¸ªç±»(æˆ–ç»“æ„ä½“)ï¼Œæˆ–è€…æŠ½è±¡ç±»ã€‚</p><p><a href="http://cdn.tigerb.cn/20191020223812.jpg"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020223812.jpg" alt="img"></a></p><h3 id="è·å–è¡Œä¸º"><a href="#è·å–è¡Œä¸º" class="headerlink" title="è·å–è¡Œä¸º"></a>è·å–è¡Œä¸º</h3><p>è¿™äº›æ“ä½œå°±æ˜¯ä¸Šé¢æœºå™¨äººè¦åšçš„äº‹æƒ…ã€‚</p><p>äº‹ç‰©æœ‰äº†ï¼š<code>è®¢å•ç”Ÿæˆæœºå™¨äºº</code><br>è¡Œä¸ºå‘¢ï¼Ÿæ¯«æ— ç–‘é—®å°±æ˜¯ä¸Šé¢å„ç§ä¸šåŠ¡é€»è¾‘ã€‚æŠŠå…·ä½“çš„è¡Œä¸ºæŠ½è±¡æˆä¸€ä¸ªè®¢å•åˆ›å»ºè¡Œä¸ºæ¥å£ï¼š</p><p><a href="http://cdn.tigerb.cn/20191020224230.jpg"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020224230.jpg" alt="img"></a></p><h3 id="å¾—åˆ°UML"><a href="#å¾—åˆ°UML" class="headerlink" title="å¾—åˆ°UML"></a>å¾—åˆ°UML</h3><p><a href="http://cdn.tigerb.cn/20191020233121.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020233121.png" alt="img"></a></p><h3 id="è®¾è®¡ä»£ç "><a href="#è®¾è®¡ä»£ç " class="headerlink" title="è®¾è®¡ä»£ç "></a>è®¾è®¡ä»£ç </h3><ol><li>å®šä¹‰ä¸€ä¸ªç±»</li></ol><p><a href="http://cdn.tigerb.cn/20191020235309.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020235309.png" alt="img"></a></p><ol><li>å®šä¹‰ä¸€ä¸ªè®¢å•åˆ›å»ºè¡Œä¸ºçš„æ¥å£</li></ol><p><a href="http://cdn.tigerb.cn/20191020235643.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020235643.png" alt="img"></a></p><ol><li><p>å®šä¹‰å…·ä½“çš„ä¸åŒè®¢å•åˆ›å»ºè¡Œä¸ºç±»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">å‚æ•°æ ¡éªŒ-&gt;</span><br><span class="line">åœ°å€æ ¡éªŒ-&gt;</span><br><span class="line">å…¶ä»–æ ¡éªŒ-&gt;</span><br><span class="line">å†™è®¢å•è¡¨-&gt;</span><br><span class="line">å†™è®¢å•å•†å“ä¿¡æ¯è¡¨-&gt;</span><br><span class="line">å†™æ—¥å¿—-&gt;</span><br><span class="line">æ‰£å‡å•†å“åº“å­˜-&gt;</span><br><span class="line">æ¸…ç†è´­ç‰©è½¦-&gt;</span><br><span class="line">æ‰£å‡å„ç§ä¿ƒé”€ä¼˜æƒ æ´»åŠ¨çš„åº“å­˜-&gt;</span><br><span class="line">ä½¿ç”¨ä¼˜æƒ åˆ¸-&gt;</span><br><span class="line">å…¶ä»–è¥é”€é€»è¾‘ç­‰ç­‰-&gt;</span><br><span class="line">å‘é€æ¶ˆæ¯-&gt;</span><br><span class="line">ç­‰ç­‰...</span><br></pre></td></tr></table></figure></li></ol><p><a href="http://cdn.tigerb.cn/20191020235840.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191020235840.png" alt="img"></a></p><ol><li>åˆ›å»ºè®¢å•</li></ol><p>è¿™é‡Œçš„ä»£ç è¯¥æ€ä¹ˆå†™ï¼Œè¿™æ ·ï¼Ÿ</p><p><a href="http://cdn.tigerb.cn/20191021000742.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191021000742.png" alt="img"></a></p><p>è¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–å—ï¼Ÿ</p><p><a href="http://cdn.tigerb.cn/20191021001002.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191021001002.png" alt="img"></a></p><p>ä½¿ç”¨é—­åŒ…ã€‚</p><p><a href="http://cdn.tigerb.cn/20191021001305.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191021001305.png" alt="img"></a></p><h3 id="PHPç‰ˆå®Œæ•´ä»£ç "><a href="#PHPç‰ˆå®Œæ•´ä»£ç " class="headerlink" title="PHPç‰ˆå®Œæ•´ä»£ç "></a>PHPç‰ˆå®Œæ•´ä»£ç </h3><p><a href="http://cdn.tigerb.cn/20191024143840.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191024143840.png" alt="img"></a></p><h3 id="GOç‰ˆå®Œæ•´ä»£ç "><a href="#GOç‰ˆå®Œæ•´ä»£ç " class="headerlink" title="GOç‰ˆå®Œæ•´ä»£ç "></a>GOç‰ˆå®Œæ•´ä»£ç </h3><p><a href="http://cdn.tigerb.cn/20191024144623.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191024144623.png" alt="img"></a></p><blockquote><p>ä¸Šé¢çš„ä»£ç æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</p></blockquote><p>å‡å¦‚â€œæˆ‘ä¸€ä¸ªåŒäº‹â€åˆè¦æ–°å¼€å‘ä¸€ä¸ªæ–°çš„åº”ç”¨ï¼Œæ–°çš„åº”ç”¨åˆ›å»ºè®¢å•çš„æ—¶å€™åˆæœ‰æ–°çš„é€»è¾‘ï¼Œæ¯”å¦‚æ²¡æœ‰ä¼˜æƒ é€»è¾‘ã€æ–°å¢äº†å¢åŠ ç”¨æˆ·ç§¯åˆ†çš„é€»è¾‘ç­‰ç­‰ï¼Œå¤ç”¨ä¸Šé¢çš„ä»£ç ï¼Œæ˜¯ä¸æ˜¯å°±å¾ˆç®€å•äº†ã€‚</p><p><a href="http://cdn.tigerb.cn/20191021001739.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191021001739.png" alt="img"></a></p><blockquote><p>æ‰€ä»¥ç°åœ¨ï¼Œä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ï¼Ÿ</p></blockquote><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h3 id="é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™"><a href="#é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™" class="headerlink" title="é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™"></a>é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™</h3><ul><li>å¯¹æ¥å£ç¼–ç¨‹è€Œä¸æ˜¯å¯¹å®ç°ç¼–ç¨‹</li><li>ä¼˜å…ˆä½¿ç”¨å¯¹è±¡ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿</li><li>æŠ½è±¡ç”¨äºä¸åŒçš„äº‹ç‰©ï¼Œè€Œæ¥å£ç”¨äºäº‹ç‰©çš„è¡Œä¸º</li></ul><p>é’ˆå¯¹ä¸Šé¢çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å†å›å¤´å¼€æˆ‘ä»¬ä¸Šé¢çš„ä»£ç </p><blockquote><p>å¯¹æ¥å£ç¼–ç¨‹è€Œä¸æ˜¯å¯¹å®ç°ç¼–ç¨‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼šRobotOrderCreateä¾èµ–äº†BehaviorOrderCreateInterfaceæŠ½è±¡æ¥å£</span><br></pre></td></tr></table></figure><blockquote><p>ä¼˜å…ˆä½¿ç”¨å¯¹è±¡ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼šå®Œå…¨æ²¡æœ‰ä½¿ç”¨ç»§æ‰¿ï¼Œå¤šä¸ªè¡Œä¸ºä¸åŒåœºæ™¯ç»„åˆä½¿ç”¨</span><br></pre></td></tr></table></figure><blockquote><p>æŠ½è±¡ç”¨äºä¸åŒçš„äº‹ç‰©ï¼Œè€Œæ¥å£ç”¨äºäº‹ç‰©çš„è¡Œä¸º</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼š</span><br><span class="line">1. æŠ½è±¡äº†ä¸€ä¸ªåˆ›å»ºè®¢å•çš„æœºå™¨äºº RobotOrderCreate</span><br><span class="line">2. æœºå™¨äººåˆæœ‰ä¸åŒçš„åˆ›å»ºè¡Œä¸º</span><br><span class="line">3. æœºå™¨äººçš„åˆ›å»ºè¡Œä¸ºæœ€ç»ˆä¾èµ–äºBehaviorOrderCreateInterfaceæ¥å£</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å®Œç¾å¥‘åˆï¼Œæ‰€ä»¥è¿™å°±æ˜¯â€œé¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹â€ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç å»ºæ¨¡è¿‡ç¨‹å°±æ˜¯â€œé¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹â€çš„å…·ä½“å®ç°æ–¹å¼.</span><br></pre></td></tr></table></figure><h2 id="é¢„ä¹ "><a href="#é¢„ä¹ " class="headerlink" title="é¢„ä¹ "></a>é¢„ä¹ </h2><h3 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h3><blockquote><p>æœ€åï¼Œè®¾è®¡æ¨¡å¼åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>åŒæ ·ï¼Œæˆ‘ä»¬ä¸‹ç»“åˆä¸Šé¢çš„åœºæ™¯å’Œæ¦‚å¿µé¢„ä¹ ä¸‹è®¾è®¡æ¨¡å¼ã€‚</p><h4 id="è®¾è®¡æ¨¡å¼çš„è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼çš„è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„è®¾è®¡åŸåˆ™"></a>è®¾è®¡æ¨¡å¼çš„è®¾è®¡åŸåˆ™</h4><blockquote><p>å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­</p></blockquote><p>çœ‹çœ‹ä¸Šé¢çš„æœ€ç»ˆçš„ä»£ç æ˜¯ä¸æ˜¯å®Œç¾å¥‘åˆã€‚</p><p><a href="http://cdn.tigerb.cn/20191022131439.png"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20191022131439.png" alt="img"></a></p><blockquote><p>ä¾èµ–å€’è½¬åŸåˆ™ï¼šå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸ä¾èµ–äºå…·ä½“</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼šåˆ›å»ºè®¢å•çš„é€»è¾‘ä»ä¾èµ–å…·ä½“çš„ä¸šåŠ¡è½¬å˜ä¸ºä¾èµ–äºæŠ½è±¡æ¥å£BehaviorOrderCreateInterface</span><br></pre></td></tr></table></figure><blockquote><p>æ¥å£éš”ç¦»åŸåˆ™ï¼šä½¿ç”¨å¤šä¸ªæ¥å£ï¼Œè€Œä¸æ˜¯å¯¹ä¸€ä¸ªæ¥å£ç¼–ç¨‹ï¼Œå»ä¾èµ–é™ä½è€¦åˆ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼šä¸Šé¢çš„åœºæ™¯ï¼Œæˆ‘ä»¬åªç®€å•å®šä¹‰äº†è®¢å•åˆ›å»ºçš„æ¥BehaviorOrderCreateInterfaceã€‚ç”±äºè®¢å•åˆ›å»ºè¿‡ç¨‹å¯èƒ½å‡ºç°å¼‚å¸¸å›æ»šï¼Œæˆ‘ä»¬å°±éœ€è¦å†å®šä¹‰ä¸€ä¸ªè®¢å•åˆ›å»ºå›æ»šçš„æ¥å£</span><br><span class="line">BehaviorOrderCreateRollBackInterface.</span><br></pre></td></tr></table></figure><blockquote><p>è¿ªç±³ç‰¹æ³•åˆ™ï¼Œåˆç§°æœ€å°‘çŸ¥é“åŸåˆ™ï¼šå‡å°‘å†…éƒ¨ä¾èµ–ï¼Œå°½å¯èƒ½çš„ç‹¬ç«‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼šè¿˜æ˜¯ä¸Šé¢é‚£æ®µä»£ç ï¼Œæˆ‘ä»¬æŠŠRobotOrderCreateæœºå™¨äººä¾èµ–çš„è¡Œä¸ºé€šè¿‡å¤–éƒ¨æ³¨å…¥çš„æ–¹å¼ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure><blockquote><p>åˆæˆå¤ç”¨åŸåˆ™ï¼šå¤šä¸ªç‹¬ç«‹çš„å®ä½“åˆæˆèšåˆï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼šRobotOrderCreateä¾èµ–äº†å¤šä¸ªå®é™…çš„è®¢å•åˆ›å»ºè¡Œä¸ºç±»ã€‚</span><br></pre></td></tr></table></figure><blockquote><p>é‡Œæ°ä»£æ¢ï¼šè¶…ç±»ï¼ˆçˆ¶ç±»ï¼‰å‡ºç°çš„åœ°æ–¹ï¼Œæ´¾ç”Ÿç±»ï¼ˆå­ç±»ï¼‰éƒ½å¯ä»¥å‡ºç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼šä¸å¥½æ„æ€ï¼Œæˆ‘ä»¬å®Œå…¨æ²¡ç”¨ç»§æ‰¿ã€‚ï¼ˆå¤‡æ³¨ï¼šç»§æ‰¿å®¹æ˜“é€ æˆçˆ¶ç±»è†¨èƒ€ã€‚ï¼‰</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹&quot;&gt;&lt;/a&gt;é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://tigerb.cn/201
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>å·¥å‚æ¨¡å¼ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</title>
    <link href="http://wangyangyangisme.github.io/posts/bfac6395/"/>
    <id>http://wangyangyangisme.github.io/posts/bfac6395/</id>
    <published>2021-05-16T06:31:03.000Z</published>
    <updated>2021-05-16T06:31:03.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="http://tigerb.cn/">http://tigerb.cn/</a></p></blockquote><p>æˆ‘çš„ä»£ç æ²¡æœ‰<code>else</code>ç³»åˆ—-ç®€å•å·¥å‚</p><p>ç»“åˆå®é™…ä¸šåŠ¡è°ˆè®¾è®¡æ¨¡å¼</p><p>ä¸šåŠ¡åœºæ™¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨ä¸€ä¸ªæœåŠ¡ç”Ÿæˆé™æ€é¡µé¢</span><br><span class="line">ä¸åŒçš„é¡µé¢æ‹¥æœ‰ä¸åŒçš„æ¨¡å—</span><br></pre></td></tr></table></figure><p>ä¸åŒçš„é¡µé¢çš„æ•°æ®ç»“æ„ä¸ä¸€æ ·<br>ç”Ÿæˆä¸åŒçš„é¡µé¢å¯¹è±¡</p><p>æ­£å¸¸ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// CartConst è´­ç‰©è½¦åˆ—è¡¨é¡µé¢</span></span><br><span class="line">CartConst = <span class="string">&quot;cart/list&quot;</span></span><br><span class="line"><span class="comment">// ProductConst å•†å“åˆ—è¡¨é¡µé¢</span></span><br><span class="line">ProductConst = <span class="string">&quot;product/list&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context è¯·æ±‚ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">URI <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PageInterface PageInterface</span></span><br><span class="line"><span class="keyword">type</span> PageInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">MakeData(c *Context) (<span class="keyword">interface</span>&#123;&#125;, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cart è´­ç‰©è½¦é¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> Cart <span class="keyword">struct</span> &#123;</span><br><span class="line">header      <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">footer      <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MakeData æ„å»ºæ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Cart *Cart)</span> <span class="title">MakeData</span><span class="params">(c *Context)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ„å»ºæ•°æ®çš„é¡µé¢ä»£ç ...</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ç”Ÿæˆè´­ç‰©è½¦é™æ€é¡µé¢æ•°æ®å¯¹è±¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> Cart, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Product Spué¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> Product <span class="keyword">struct</span> &#123;</span><br><span class="line">header  <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">footer  <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MakeData æ„å»ºæ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Product *Product)</span> <span class="title">MakeData</span><span class="params">(c *Context)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ„å»ºæ•°æ®çš„é¡µé¢ä»£ç ...</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ç”Ÿæˆspuè¯¦æƒ…é™æ€é¡µé¢æ•°æ®å¯¹è±¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> Product, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := &amp;Context&#123;</span><br><span class="line">URI: <span class="string">&quot;cart/list&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> pageObject PageInterface</span><br><span class="line"><span class="keyword">switch</span> c.URI &#123;</span><br><span class="line"><span class="keyword">case</span> CartConst:</span><br><span class="line">pageObject = &amp;Cart&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> ProductConst:</span><br><span class="line">pageObject = &amp;Product&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;ä¸æ”¯æŒçš„é¡µé¢&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pageObject.MakeData(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç®€å•å·¥å‚æ¨¡å¼çš„æ¦‚å¿µ<br>ç®€å•ç†è§£ï¼Œä¸€å¥è¯ï¼š</p><blockquote><p>ç»Ÿä¸€å°è£…ç”Ÿäº§å¯¹è±¡çš„è¿‡ç¨‹</p></blockquote><p>ç®€å•å·¥å‚æ¨¡å¼ä¸‹çš„ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//ç®€å•å·¥å‚æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// CartConst è´­ç‰©è½¦åˆ—è¡¨é¡µé¢</span></span><br><span class="line">CartConst = <span class="string">&quot;cart/list&quot;</span></span><br><span class="line"><span class="comment">// ProductConst å•†å“åˆ—è¡¨é¡µé¢</span></span><br><span class="line">ProductConst = <span class="string">&quot;product/list&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context è¯·æ±‚ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">URI <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PageInterface PageInterface</span></span><br><span class="line"><span class="keyword">type</span> PageInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">MakeData(c *Context) (<span class="keyword">interface</span>&#123;&#125;, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cart è´­ç‰©è½¦é¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> Cart <span class="keyword">struct</span> &#123;</span><br><span class="line">header <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">footer <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MakeData æ„å»ºæ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Cart *Cart)</span> <span class="title">MakeData</span><span class="params">(c *Context)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ„å»ºæ•°æ®çš„é¡µé¢ä»£ç ...</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ç”Ÿæˆè´­ç‰©è½¦é™æ€é¡µé¢æ•°æ®å¯¹è±¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> Cart, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Product Spué¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> Product <span class="keyword">struct</span> &#123;</span><br><span class="line">header <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">footer <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MakeData æ„å»ºæ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Product *Product)</span> <span class="title">MakeData</span><span class="params">(c *Context)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ„å»ºæ•°æ®çš„é¡µé¢ä»£ç ...</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ç”Ÿæˆspuè¯¦æƒ…é™æ€é¡µé¢æ•°æ®å¯¹è±¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> Product, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PageFactory æ„å»ºé¡µé¢å¯¹è±¡çš„ç®€å•å·¥å‚</span></span><br><span class="line"><span class="keyword">type</span> PageFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">Ctx *Context</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get è·å–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *PageFactory)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">PageInterface</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> p.Ctx.URI &#123;</span><br><span class="line"><span class="keyword">case</span> CartConst:</span><br><span class="line"><span class="keyword">return</span> &amp;Cart&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> ProductConst:</span><br><span class="line"><span class="keyword">return</span> &amp;Product&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;ä¸æ”¯æŒçš„é¡µé¢&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ctx := &amp;Context&#123;</span><br><span class="line">URI: <span class="string">&quot;cart/list&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">pageFactory := &amp;PageFactory&#123;</span><br><span class="line">Ctx: ctx,</span><br><span class="line">&#125;</span><br><span class="line">pageFactory.Get().MakeData(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//å·¥å‚æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// CartConst è´­ç‰©è½¦åˆ—è¡¨é¡µé¢</span></span><br><span class="line">CartConst = <span class="string">&quot;cart/list&quot;</span></span><br><span class="line"><span class="comment">// ProductConst å•†å“åˆ—è¡¨é¡µé¢</span></span><br><span class="line">ProductConst = <span class="string">&quot;product/list&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context è¯·æ±‚ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">URI <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PageInterface PageInterface</span></span><br><span class="line"><span class="keyword">type</span> PageInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">MakeData(c *Context) (<span class="keyword">interface</span>&#123;&#125;, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cart è´­ç‰©è½¦é¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> Cart <span class="keyword">struct</span> &#123;</span><br><span class="line">header <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">footer <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MakeData æ„å»ºæ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Cart *Cart)</span> <span class="title">MakeData</span><span class="params">(c *Context)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ„å»ºæ•°æ®çš„é¡µé¢ä»£ç ...</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ç”Ÿæˆè´­ç‰©è½¦é™æ€é¡µé¢æ•°æ®å¯¹è±¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> Cart, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Product Spué¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> Product <span class="keyword">struct</span> &#123;</span><br><span class="line">header <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">footer <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MakeData æ„å»ºæ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Product *Product)</span> <span class="title">MakeData</span><span class="params">(c *Context)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ„å»ºæ•°æ®çš„é¡µé¢ä»£ç ...</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ç”Ÿæˆspuè¯¦æƒ…é™æ€é¡µé¢æ•°æ®å¯¹è±¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> Product, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PageFactoryInterface é¡µé¢ç®€å•å·¥å‚æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> PageFactoryInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">Get() PageInterface</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CartPageFactory æ„å»ºè´­ç‰©è½¦é¡µé¢å¯¹è±¡çš„ç®€å•å·¥å‚</span></span><br><span class="line"><span class="keyword">type</span> CartPageFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">Ctx *Context</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get è·å–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *CartPageFactory)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">PageInterface</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Cart&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ProductPageFactory æ„å»ºè´­ç‰©è½¦é¡µé¢å¯¹è±¡çš„ç®€å•å·¥å‚</span></span><br><span class="line"><span class="keyword">type</span> ProductPageFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">Ctx *Context</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get è·å–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *ProductPageFactory)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">PageInterface</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Cart&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ctx := &amp;Context&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆè´­ç‰©è½¦é¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line">(&amp;CartPageFactory&#123;</span><br><span class="line">Ctx: ctx,</span><br><span class="line">&#125;).Get().MakeData(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆspuè¯¦æƒ…é¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line">(&amp;ProductPageFactory&#123;</span><br><span class="line">Ctx: ctx,</span><br><span class="line">&#125;).Get().MakeData(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠ½è±¡å·¥å‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//æŠ½è±¡å·¥å‚æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// CartConst è´­ç‰©è½¦åˆ—è¡¨é¡µé¢</span></span><br><span class="line">CartConst = <span class="string">&quot;cart/list&quot;</span></span><br><span class="line"><span class="comment">// ProductConst å•†å“åˆ—è¡¨é¡µé¢</span></span><br><span class="line">ProductConst = <span class="string">&quot;product/list&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context è¯·æ±‚ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">URI <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PageInterface PageInterface</span></span><br><span class="line"><span class="keyword">type</span> PageInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">MakeData(c *Context) (<span class="keyword">interface</span>&#123;&#125;, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cart è´­ç‰©è½¦é¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> Cart <span class="keyword">struct</span> &#123;</span><br><span class="line">header <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">footer <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MakeData æ„å»ºæ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Cart *Cart)</span> <span class="title">MakeData</span><span class="params">(c *Context)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ„å»ºæ•°æ®çš„é¡µé¢ä»£ç ...</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ç”Ÿæˆè´­ç‰©è½¦é™æ€é¡µé¢æ•°æ®å¯¹è±¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> Cart, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Product Spué¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> Product <span class="keyword">struct</span> &#123;</span><br><span class="line">header <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">footer <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MakeData æ„å»ºæ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Product *Product)</span> <span class="title">MakeData</span><span class="params">(c *Context)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ„å»ºæ•°æ®çš„é¡µé¢ä»£ç ...</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ç”Ÿæˆspuè¯¦æƒ…é™æ€é¡µé¢æ•°æ®å¯¹è±¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> Product, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PageFactoryInterface é¡µé¢ç®€å•å·¥å‚æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> PageFactoryInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">Get() PageInterface</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CartPageFactory æ„å»ºè´­ç‰©è½¦é¡µé¢å¯¹è±¡çš„ç®€å•å·¥å‚</span></span><br><span class="line"><span class="keyword">type</span> CartPageFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">Ctx *Context</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get è·å–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *CartPageFactory)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">PageInterface</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Cart&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ProductPageFactory æ„å»ºè´­ç‰©è½¦é¡µé¢å¯¹è±¡çš„ç®€å•å·¥å‚</span></span><br><span class="line"><span class="keyword">type</span> ProductPageFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">Ctx *Context</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get è·å–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *ProductPageFactory)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">PageInterface</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Cart&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ctx := &amp;Context&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆè´­ç‰©è½¦é¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line">(&amp;CartPageFactory&#123;</span><br><span class="line">Ctx: ctx,</span><br><span class="line">&#125;).Get().MakeData(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆspuè¯¦æƒ…é¡µé¢æ•°æ®å¯¹è±¡</span></span><br><span class="line">(&amp;ProductPageFactory&#123;</span><br><span class="line">Ctx: ctx,</span><br><span class="line">&#125;).Get().MakeData(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://tigerb.cn/&quot;&gt;http://tigerb.cn/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘çš„ä»£ç æ²¡æœ‰&lt;code&gt;else&lt;/code&gt;ç³»åˆ—-ç®€å•å·¥å‚&lt;/p&gt;
&lt;p&gt;ç»“åˆå®é™…ä¸šåŠ¡è°ˆè®¾è®¡æ¨¡å¼&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</title>
    <link href="http://wangyangyangisme.github.io/posts/11cee220/"/>
    <id>http://wangyangyangisme.github.io/posts/11cee220/</id>
    <published>2021-05-16T06:31:02.000Z</published>
    <updated>2021-05-16T06:31:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¹¶å‘ç»„ä»¶-Goè®¾è®¡æ¨¡å¼å®æˆ˜"><a href="#å¹¶å‘ç»„ä»¶-Goè®¾è®¡æ¨¡å¼å®æˆ˜" class="headerlink" title="å¹¶å‘ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜"></a>å¹¶å‘ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</h1><blockquote><p>å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ—ï¼Œä¸€ä¸ªè®¾è®¡æ¨¡å¼ä¸šåŠ¡çœŸå®ä½¿ç”¨çš„golangç³»åˆ—ã€‚</p><p><a href="http://tigerb.cn/">http://tigerb.cn/</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç³»åˆ—ä¸»è¦åˆ†äº«ï¼Œå¦‚ä½•åœ¨æˆ‘ä»¬çš„çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨è®¾è®¡æ¨¡å¼ã€‚</p><p>æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦é‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š</p><ul><li>ä»€ä¹ˆæ˜¯ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ä½¿ç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>æ€ä¹ˆç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li></ul><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ã€Œç»„åˆæ¨¡å¼ã€ç»“åˆGoè¯­è¨€å¤©ç”Ÿçš„å¹¶å‘ç‰¹æ€§ï¼Œå¦‚ä½•åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p><p>ä¹‹å‰æ–‡ç« <a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ã€Šä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜ã€‹</a>å·²ç»ä»‹ç»äº†ã€Œç»„åˆæ¨¡å¼ã€çš„æ¦‚å¿µï¼Œä»¥åŠåœ¨ä¸šåŠ¡ä¸­çš„ä½¿ç”¨ã€‚ä»Šå¤©æˆ‘ä»¬ç»“åˆGoè¯­è¨€å¤©ç”Ÿçš„å¹¶å‘ç‰¹æ€§ï¼Œå‡çº§ã€Œç»„åˆæ¨¡å¼ã€ä¸ºã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥ç®€å•å›é¡¾ä¸‹ã€Œç»„åˆæ¨¡å¼ã€çš„çŸ¥è¯†ï¼Œè¯¦ç»†å¯ä»¥æŸ¥çœ‹ä¸Šç¯‡æ–‡ç« <a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ã€Šä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜ã€‹</a></p><h2 id="ä»€ä¹ˆæ˜¯ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ</h2><p>ç»„åˆæ¨¡å¼çš„æ¦‚å¿µï¼š</p><blockquote><p>ä¸€ä¸ªå…·æœ‰å±‚çº§å…³ç³»çš„å¯¹è±¡ç”±ä¸€ç³»åˆ—æ‹¥æœ‰çˆ¶å­å…³ç³»çš„å¯¹è±¡é€šè¿‡æ ‘å½¢ç»“æ„ç»„æˆã€‚</p></blockquote><p>å¹¶å‘ç»„åˆæ¨¡å¼çš„æ¦‚å¿µï¼š</p><blockquote><p>ä¸€ä¸ªå…·æœ‰å±‚çº§å…³ç³»çš„å¯¹è±¡ç”±ä¸€ç³»åˆ—æ‹¥æœ‰çˆ¶å­å…³ç³»çš„å¯¹è±¡é€šè¿‡æ ‘å½¢ç»“æ„ç»„æˆï¼Œå­å¯¹è±¡å³å¯è¢«ä¸²è¡Œæ‰§è¡Œï¼Œä¹Ÿå¯è¢«å¹¶å‘æ‰§è¡Œ</p></blockquote><p>å¹¶å‘ç»„åˆæ¨¡å¼çš„ä¼˜åŠ¿ï¼š</p><ul><li>åŸæœ¬ä¸²è¡Œçš„ä¸šåŠ¡(å­˜åœ¨é˜»å¡çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚ç½‘ç»œIOç­‰)å¯ä»¥è¢«å¹¶å‘æ‰§è¡Œï¼Œåˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿æå‡æ€§èƒ½ã€‚</li></ul><h2 id="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ</h2><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥ã€Œç»„åˆæ¨¡å¼ã€ä¸­çš„â€œè®¢å•ç»“ç®—é¡µé¢â€ä¸ºä¾‹ï¼Œç»§ç»­æ¥çœ‹çœ‹æŸä¸œçš„è®¢å•ç»“ç®—é¡µé¢ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200331124724.jpeg" style="width:30%"></p><p>ä»é¡µé¢çš„å±•ç¤ºå½¢å¼ä¸Šï¼Œå¯ä»¥çœ‹å‡ºï¼š</p><ul><li>é¡µé¢ç”±å¤šä¸ªæ¨¡å—æ„æˆï¼Œæ¯”å¦‚ï¼š<ul><li>åœ°å€æ¨¡å—ï¼šè·å–ç”¨æˆ·åœ°å€æ•°æ®</li><li>æ”¯ä»˜æ–¹å¼æ¨¡å—ï¼šè·å–æ”¯ä»˜æ–¹å¼åˆ—è¡¨</li><li>åº—é“ºæ¨¡å—ï¼šè·å–åº—é“ºã€è´­ç‰©è½¦é€‰ä¸­å•†å“ç­‰ä¿¡æ¯</li><li>å‘ç¥¨æ¨¡å—ï¼šè·å–å‘ç¥¨ç±»å‹åˆ—è¡¨</li><li>ä¼˜æƒ åˆ¸æ¨¡å—ï¼šè·å–ç”¨æˆ·ä¼˜æƒ åˆ¸åˆ—è¡¨</li><li>æŸè±†æ¨¡å—ï¼šè·å–ç”¨æˆ·ç§¯åˆ†ä¿¡æ¯</li><li>ç¤¼å“å¡æ¨¡å—ï¼šè·å–ç¤¼å“å¡åˆ—è¡¨åˆ—è¡¨</li><li>è®¢å•è¯¦ç»†é‡‘é¢æ¨¡å—ï¼šè·å–è®¢å•é‡‘é¢ä¿¡æ¯</li></ul></li><li>å•ä¸ªæ¨¡å—å¯ä»¥ç”±å¤šä¸ªå­æ¨¡å—æ„æˆ<ul><li>åº—é“ºæ¨¡å—ï¼Œåˆç”±å¦‚ä¸‹æ¨¡å—æ„æˆï¼š<ul><li>å•†å“æ¨¡å—ï¼šè·å–è´­ç‰©è½¦é€‰ä¸­å•†å“ä¿¡æ¯</li><li>å”®åæ¨¡å—ï¼šè·å–å•†å“å”®åä¿¡æ¯</li><li>ä¼˜æƒ æ¨¡å—ï¼šè·å–å•†å“å‚ä¸çš„ä¼˜æƒ æ´»åŠ¨ä¿¡æ¯</li><li>ç‰©æµæ¨¡å—ï¼šè·å–å•†å“æ”¯æŒçš„é…é€æ–¹å¼åˆ—è¡¨</li></ul></li></ul></li></ul><p>æŒ‰ç…§ã€Œç»„åˆæ¨¡å¼ã€çš„ä¸šåŠ¡é€»è¾‘æ‰§è¡Œæµç¨‹ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20201103203539.png" style="width:38%"></p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¾ˆæ¸…æ¥šæœ‰äº›æ¨¡å—ä¹‹é—´å¹¶æ²¡æœ‰ä¾èµ–ï¼Œ<strong>ä¸”è¯¥æ¨¡å—æ¶‰åŠæœåŠ¡è¿œç¨‹è°ƒç”¨ç­‰é˜»å¡æ“ä½œ</strong>ï¼Œæ¯”å¦‚ï¼š</p><ul><li>åœ°å€æ¨¡å—è°ƒç”¨åœ°å€æœåŠ¡è·å–ç”¨æˆ·åœ°å€æ•°æ®æ—¶ã€‚</li><li>æ”¯ä»˜æ–¹å¼æ¨¡å—ä¹Ÿå¯ä»¥åŒæ—¶å»è¯»redisè·å–æ”¯ä»˜æ–¹å¼åˆ—è¡¨æ•°æ®ç­‰ç­‰ã€‚</li></ul><p>æ‰€ä»¥:<strong>æœ‰çš„æ¨¡å—å…¶å®å¯ä»¥è¢«å¹¶å‘çš„æ‰§è¡Œ</strong>ã€‚</p><p>å¦‚æœæŠŠä¸Šé¢ä¸å­˜åœ¨ä¾èµ–å…³ç³»çš„æ¨¡å—ä¿®æ”¹ä¸ºå¹¶å‘çš„æ‰§è¡Œï¼Œåˆ™æˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹çš„æ‰§è¡Œæµç¨‹ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20201103203735.png" style="width:100%"></p><h2 id="æ€ä¹ˆç”¨ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ"><a href="#æ€ä¹ˆç”¨ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="æ€ä¹ˆç”¨ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ"></a>æ€ä¹ˆç”¨ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€ï¼Ÿ</h2><p>å…³äºã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€çš„å»ºæ¨¡è¿‡ç¨‹å®Œå…¨å¯ä»¥å‚è€ƒä¹‹å‰æ–‡ç« <a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ã€Šä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜ã€‹</a>ï¼Œæˆ‘ä»¬è¿™é‡Œåªè¯´è¯´éœ€è¦ç€é‡æ³¨æ„çš„åœ°æ–¹ã€‚</p><p>ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€çš„æ ¸å¿ƒè¿˜æ˜¯<code>Component</code>ç»„ä»¶æ¥å£ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ã€Œç»„åˆæ¨¡å¼ã€çš„<code>Component</code>ç»„ä»¶æ¥å£å¦‚ä¸‹(å†ä¹‹å‰çš„æ–‡ç« ä¸Šåšäº†ä¼˜åŒ–ï¼Œè¿›ä¸€æ­¥å°è£…æå–äº†<code>BusinessLogicDo</code>æ–¹æ³•)ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Component ç»„ä»¶æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Component <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Mount(c Component, components ...Component) error</span><br><span class="line"><span class="comment">// ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Remove(c Component) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡å’Œæ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// ctx ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// currentConponent å½“å‰ç»„ä»¶</span></span><br><span class="line">Do(ctx *Context, currentConponent Component) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">BusinessLogicDo(ctx *Context) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">ChildsDo(ctx *Context) error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹çœ‹ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€çš„Component`ç»„ä»¶æ¥å£ï¼Œå¦‚ä¸‹(é‡ç‚¹çœ‹å’Œã€Œç»„åˆæ¨¡å¼ã€çš„åŒºåˆ«)ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Component ç»„ä»¶æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Component <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Mount(c Component, components ...Component) error</span><br><span class="line"><span class="comment">// ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Remove(c Component) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡:`BusinessLogicDo`å’Œæ‰§è¡Œå­ç»„ä»¶:`ChildsDo`</span></span><br><span class="line"><span class="comment">// ctx ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// currentConponent å½“å‰ç»„ä»¶</span></span><br><span class="line"><span class="comment">// wg çˆ¶ç»„ä»¶çš„WaitGroupå¯¹è±¡</span></span><br><span class="line"><span class="comment">// åŒºåˆ«1ï¼šå¢åŠ äº†WaitGroupå¯¹è±¡å‚æ•°ï¼Œç›®çš„æ˜¯ç­‰å¾…å¹¶å‘å­ç»„ä»¶çš„æ‰§è¡Œå®Œæˆã€‚</span></span><br><span class="line">Do(ctx *Context, currentConponent Component, wg *sync.WaitGroup) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="comment">// resChan å›å†™å½“å‰ç»„ä»¶ä¸šåŠ¡æ‰§è¡Œç»“æœçš„channel</span></span><br><span class="line"><span class="comment">// åŒºåˆ«2ï¼šå¢åŠ äº†ä¸€ä¸ªchannelå‚æ•°ï¼Œç›®çš„æ˜¯å¹¶å‘ç»„ä»¶æ‰§è¡Œé€»è¾‘æ—¶å¼•å…¥äº†è¶…æ—¶æœºåˆ¶ï¼Œéœ€è¦ä¸€ä¸ªchannelæ¥å—ç»„ä»¶çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">BusinessLogicDo(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">ChildsDo(ctx *Context) error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¯¦ç»†å†æ¥çœ‹ï¼Œç›¸å¯¹äºã€Œç»„åˆæ¨¡å¼ã€ï¼Œå¼•å…¥å¹¶å‘ä¹‹åéœ€è¦ç€é‡å…³æ³¨å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å¹¶å‘å­ç»„ä»¶éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼šé˜²æ­¢å­ç»„ä»¶æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè§£å†³æ–¹æ¡ˆå…³é”®å­—<code>context.WithTimeout</code></li><li>åŒºåˆ†æ™®é€šç»„ä»¶å’Œå¹¶å‘ç»„ä»¶ï¼šåˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶ï¼Œå°è£…ä¸ºå¹¶å‘åŸºç¡€ç»„ä»¶</li><li>æ‹¥æœ‰å¹¶å‘å­ç»„ä»¶çš„çˆ¶ç»„ä»¶éœ€è¦ç­‰å¾…å¹¶å‘å­ç»„ä»¶æ‰§è¡Œå®Œæ¯•(åŒ…å«è¶…æ—¶)ï¼Œè§£å†³æ–¹æ¡ˆå…³é”®å­—<code>sync.WaitGroup</code></li><li>å¹¶å‘å­ç»„ä»¶æ‰§è¡Œè‡ªèº«ä¸šåŠ¡é€»è¾‘æ˜¯éœ€æ£€æµ‹è¶…æ—¶ï¼šé˜²æ­¢å­ç»„ä»¶å†…éƒ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘æ—¶é—´è¿‡é•¿ï¼Œè§£å†³æ–¹æ¡ˆå…³é”®å­—<code>select</code>å’Œ<code>&lt;-ctx.Done()</code></li></ul><h3 id="ç¬¬ä¸€ç‚¹ï¼šå¹¶å‘å­ç»„ä»¶éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´"><a href="#ç¬¬ä¸€ç‚¹ï¼šå¹¶å‘å­ç»„ä»¶éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´" class="headerlink" title="ç¬¬ä¸€ç‚¹ï¼šå¹¶å‘å­ç»„ä»¶éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´"></a>ç¬¬ä¸€ç‚¹ï¼šå¹¶å‘å­ç»„ä»¶éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Context ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// context.WithTimeoutæ´¾ç”Ÿçš„å­ä¸Šä¸‹æ–‡</span></span><br><span class="line">TimeoutCtx context.Context</span><br><span class="line"><span class="comment">// è¶…æ—¶å‡½æ•°</span></span><br><span class="line">context.CancelFunc</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äºŒç‚¹ï¼šåŒºåˆ†æ™®é€šç»„ä»¶å’Œå¹¶å‘ç»„ä»¶"><a href="#ç¬¬äºŒç‚¹ï¼šåŒºåˆ†æ™®é€šç»„ä»¶å’Œå¹¶å‘ç»„ä»¶" class="headerlink" title="ç¬¬äºŒç‚¹ï¼šåŒºåˆ†æ™®é€šç»„ä»¶å’Œå¹¶å‘ç»„ä»¶"></a>ç¬¬äºŒç‚¹ï¼šåŒºåˆ†æ™®é€šç»„ä»¶å’Œå¹¶å‘ç»„ä»¶</h3><p>å¢åŠ æ–°çš„å¹¶å‘åŸºç¡€ç»„ä»¶ç»“æ„ä½“<code>BaseConcurrencyComponent</code>ï¼Œå¹¶åˆæˆå¤ç”¨ã€Œç»„åˆæ¨¡å¼ã€ä¸­çš„åŸºç¡€ç»„ä»¶<code>BaseComponent</code>ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BaseConcurrencyComponent å¹¶å‘åŸºç¡€ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> BaseConcurrencyComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶æ˜¯å¦æœ‰å¹¶å‘å­ç»„ä»¶</span></span><br><span class="line">HasChildConcurrencyComponents <span class="keyword">bool</span></span><br><span class="line"><span class="comment">// å¹¶å‘å­ç»„ä»¶åˆ—è¡¨</span></span><br><span class="line">ChildConcurrencyComponents []Component</span><br><span class="line"><span class="comment">// wg å¯¹è±¡</span></span><br><span class="line">*sync.WaitGroup</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶ä¸šåŠ¡æ‰§è¡Œç»“æœchannel</span></span><br><span class="line">logicResChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">Err error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸‰ç‚¹ï¼šæ‹¥æœ‰å¹¶å‘å­ç»„ä»¶çš„çˆ¶ç»„ä»¶éœ€è¦ç­‰å¾…å¹¶å‘å­ç»„ä»¶æ‰§è¡Œå®Œæ¯•-åŒ…å«è¶…æ—¶"><a href="#ç¬¬ä¸‰ç‚¹ï¼šæ‹¥æœ‰å¹¶å‘å­ç»„ä»¶çš„çˆ¶ç»„ä»¶éœ€è¦ç­‰å¾…å¹¶å‘å­ç»„ä»¶æ‰§è¡Œå®Œæ¯•-åŒ…å«è¶…æ—¶" class="headerlink" title="ç¬¬ä¸‰ç‚¹ï¼šæ‹¥æœ‰å¹¶å‘å­ç»„ä»¶çš„çˆ¶ç»„ä»¶éœ€è¦ç­‰å¾…å¹¶å‘å­ç»„ä»¶æ‰§è¡Œå®Œæ¯•(åŒ…å«è¶…æ—¶)"></a>ç¬¬ä¸‰ç‚¹ï¼šæ‹¥æœ‰å¹¶å‘å­ç»„ä»¶çš„çˆ¶ç»„ä»¶éœ€è¦ç­‰å¾…å¹¶å‘å­ç»„ä»¶æ‰§è¡Œå®Œæ¯•(åŒ…å«è¶…æ—¶)</h3><p>ä¿®æ”¹ã€Œç»„åˆæ¨¡å¼ã€ä¸­çš„<code>ChildsDo</code>æ–¹æ³•ï¼Œä½¿å…¶æ”¯æŒå¹¶å‘æ‰§è¡Œå­ç»„ä»¶ï¼Œä¸»è¦ä¿®æ”¹å’Œå®ç°å¦‚ä¸‹ï¼š</p><ul><li>é€šè¿‡<code>go</code>å…³é”®å­—æ‰§è¡Œå­ç»„ä»¶</li><li>é€šè¿‡<code>*WaitGroup.Wait()</code>ç­‰å¾…å­ç»„ä»¶æ‰§è¡Œç»“æœ</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ChildsDo æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">ChildsDo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> bc.WaitGroup == <span class="literal">nil</span> &#123;</span><br><span class="line">bc.WaitGroup = &amp;sync.WaitGroup&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå¹¶å‘å­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> _, childComponent := <span class="keyword">range</span> bc.ChildConcurrencyComponents &#123;</span><br><span class="line">bc.WaitGroup.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> childComponent.Do(ctx, childComponent, bc.WaitGroup)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> _, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> err = childComponent.Do(ctx, childComponent, <span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> bc.HasChildConcurrencyComponents &#123;</span><br><span class="line"><span class="comment">// ç­‰å¾…å¹¶å‘ç»„ä»¶æ‰§è¡Œç»“æœ</span></span><br><span class="line">bc.WaitGroup.Wait()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬å››ç‚¹ï¼šå¹¶å‘å­ç»„ä»¶æ‰§è¡Œè‡ªèº«ä¸šåŠ¡é€»è¾‘æ˜¯éœ€æ£€æµ‹è¶…æ—¶"><a href="#ç¬¬å››ç‚¹ï¼šå¹¶å‘å­ç»„ä»¶æ‰§è¡Œè‡ªèº«ä¸šåŠ¡é€»è¾‘æ˜¯éœ€æ£€æµ‹è¶…æ—¶" class="headerlink" title="ç¬¬å››ç‚¹ï¼šå¹¶å‘å­ç»„ä»¶æ‰§è¡Œè‡ªèº«ä¸šåŠ¡é€»è¾‘æ˜¯éœ€æ£€æµ‹è¶…æ—¶"></a>ç¬¬å››ç‚¹ï¼šå¹¶å‘å­ç»„ä»¶æ‰§è¡Œè‡ªèº«ä¸šåŠ¡é€»è¾‘æ˜¯éœ€æ£€æµ‹è¶…æ—¶</h3><p><code>select</code>å…³é”®å­—context.WithTimeout()æ´¾ç”Ÿçš„å­ä¸Šä¸‹æ–‡Done()æ–¹æ¡ˆè¿”å›çš„channelï¼Œå‘ç”Ÿè¶…æ—¶è¯¥channelä¼šè¢«å…³é—­ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Do æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// ctx ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// currentConponent å½“å‰ç»„ä»¶</span></span><br><span class="line"><span class="comment">// wg çˆ¶ç»„ä»¶çš„waitgroupå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context, currentConponent Component, wg *sync.WaitGroup)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å¹¶å‘å­ç»„ä»¶channel</span></span><br><span class="line"><span class="keyword">if</span> bc.logicResChan == <span class="literal">nil</span> &#123;</span><br><span class="line">bc.logicResChan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> currentConponent.BusinessLogicDo(bc.logicResChan)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="comment">// ç­‰å¾…ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="keyword">case</span> &lt;-bc.logicResChan:</span><br><span class="line"><span class="comment">// ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;bc.BusinessLogicDo wait.done...&quot;</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="comment">// è¶…æ—¶ç­‰å¾…</span></span><br><span class="line"><span class="keyword">case</span> &lt;-ctx.TimeoutCtx.Done():</span><br><span class="line"><span class="comment">// è¶…æ—¶é€€å‡º</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;bc.BusinessLogicDo timeout...&quot;</span>)</span><br><span class="line">bc.Err = ErrConcurrencyComponentTimeout</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">err = currentConponent.ChildsDo(ctx)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä»£ç demo"><a href="#ä»£ç demo" class="headerlink" title="ä»£ç demo"></a>ä»£ç demo</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;context&quot;</span></span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//Goè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ—</span></span><br><span class="line"><span class="comment">//ç»„åˆæ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//example:</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ ¹ç»„ä»¶</span></span><br><span class="line"><span class="comment">// å¦‚æœå­ç»„ä»¶å­˜åœ¨å¹¶å‘ç»„ä»¶åˆ™çˆ¶ç»„ä»¶å¿…é¡»ä¸ºå¹¶å‘ç»„ä»¶</span></span><br><span class="line"><span class="comment">// type RootComponent struct &#123;</span></span><br><span class="line"><span class="comment">// BaseConcurrencyComponent</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// func (bc *RootComponent) BusinessLogicDo(resChan chan interface&#123;&#125;) (err error) &#123;</span></span><br><span class="line"><span class="comment">// // do nothing</span></span><br><span class="line"><span class="comment">// return</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå¹¶å‘ç»„ä»¶</span></span><br><span class="line"><span class="comment">// type DemoConcurrenyComponent struct &#123;</span></span><br><span class="line"><span class="comment">// BaseConcurrencyComponent</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// func (bc *DemoConcurrenyComponent) BusinessLogicDo(resChan chan interface&#123;&#125;) (err error) &#123;</span></span><br><span class="line"><span class="comment">// // å¹¶å‘ç»„ä»¶ä¸šåŠ¡é€»è¾‘å¡«å……åˆ°è¿™</span></span><br><span class="line"><span class="comment">// return</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ™®é€šç»„ä»¶</span></span><br><span class="line"><span class="comment">// type DemoComponent struct &#123;</span></span><br><span class="line"><span class="comment">// BaseComponent</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// func (bc *DemoComponent) BusinessLogicDo(resChan chan interface&#123;&#125;) (err error) &#123;</span></span><br><span class="line"><span class="comment">// // æ™®é€šç»„ä»¶ä¸šåŠ¡é€»è¾‘å¡«å……åˆ°è¿™</span></span><br><span class="line"><span class="comment">// return</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// // æ™®é€šç»„ä»¶</span></span><br><span class="line"><span class="comment">// root.Mount(</span></span><br><span class="line"><span class="comment">// &amp;DemoComponent&#123;&#125;,</span></span><br><span class="line"><span class="comment">// )</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// // å¹¶å‘ç»„ä»¶</span></span><br><span class="line"><span class="comment">// root := &amp;RootComponent&#123;&#125;</span></span><br><span class="line"><span class="comment">// root.MountConcurrency(</span></span><br><span class="line"><span class="comment">// &amp;DemoConcurrenyComponent&#123;&#125;,</span></span><br><span class="line"><span class="comment">// )</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// // åˆå§‹åŒ–ä¸šåŠ¡ä¸Šä¸‹æ–‡ å¹¶è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment">// ctx := GetContext(5 * time.Second)</span></span><br><span class="line"><span class="comment">// defer ctx.CancelFunc()</span></span><br><span class="line"><span class="comment">// // å¼€å§‹æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// root.ChildsDo(ctx)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line"><span class="comment">// ErrConcurrencyComponentTimeout å¹¶å‘ç»„ä»¶ä¸šåŠ¡è¶…æ—¶</span></span><br><span class="line">ErrConcurrencyComponentTimeout = errors.New(<span class="string">&quot;Concurrency Component Timeout&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// context.WithTimeoutæ´¾ç”Ÿçš„å­ä¸Šä¸‹æ–‡</span></span><br><span class="line">TimeoutCtx context.Context</span><br><span class="line"><span class="comment">// è¶…æ—¶å‡½æ•°</span></span><br><span class="line">context.CancelFunc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetContext è·å–ä¸šåŠ¡ä¸Šä¸‹æ–‡å®ä¾‹</span></span><br><span class="line"><span class="comment">// d è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetContext</span><span class="params">(d time.Duration)</span> *<span class="title">Context</span></span> &#123;</span><br><span class="line">c := &amp;Context&#123;&#125;</span><br><span class="line">c.TimeoutCtx, c.CancelFunc = context.WithTimeout(context.Background(), d)</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Component ç»„ä»¶æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Component <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Mount(c Component, components ...Component) error</span><br><span class="line"><span class="comment">// ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Remove(c Component) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡:`BusinessLogicDo`å’Œæ‰§è¡Œå­ç»„ä»¶:`ChildsDo`</span></span><br><span class="line"><span class="comment">// ctx ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// currentConponent å½“å‰ç»„ä»¶</span></span><br><span class="line"><span class="comment">// wg çˆ¶ç»„ä»¶çš„waitgroupå¯¹è±¡</span></span><br><span class="line">Do(ctx *Context, currentConponent Component, wg *sync.WaitGroup) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="comment">// resChan å›å†™å½“å‰ç»„ä»¶ä¸šåŠ¡æ‰§è¡Œç»“æœçš„channel</span></span><br><span class="line">BusinessLogicDo(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">ChildsDo(ctx *Context) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BaseComponent åŸºç¡€ç»„ä»¶</span></span><br><span class="line"><span class="comment">// å®ç°Add:æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// å®ç°Remove:ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> BaseComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// å­ç»„ä»¶åˆ—è¡¨</span></span><br><span class="line">ChildComponents []Component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mount æŒ‚è½½ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">Mount</span><span class="params">(c Component, components ...Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents, c)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(components) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents, components...)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">Remove</span><span class="params">(c Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(bc.ChildComponents) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> c == childComponent &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç§»é™¤:&quot;</span>, reflect.TypeOf(childComponent))</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents[:k], bc.ChildComponents[k+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// ctx ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// currentConponent å½“å‰ç»„ä»¶</span></span><br><span class="line"><span class="comment">// wg çˆ¶ç»„ä»¶çš„waitgroupå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context, currentConponent Component, wg *sync.WaitGroup)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">//æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡ä»£ç </span></span><br><span class="line">err = currentConponent.BusinessLogicDo(<span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">return</span> currentConponent.ChildsDo(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å½“å‰ç»„ä»¶ä¸šåŠ¡é€»è¾‘ä»£ç å¡«å……å¤„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChildsDo æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">ChildsDo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> _, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> err = childComponent.Do(ctx, childComponent, <span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BaseConcurrencyComponent å¹¶å‘åŸºç¡€ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> BaseConcurrencyComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶æ˜¯å¦æœ‰å¹¶å‘å­ç»„ä»¶</span></span><br><span class="line">HasChildConcurrencyComponents <span class="keyword">bool</span></span><br><span class="line"><span class="comment">// å¹¶å‘å­ç»„ä»¶åˆ—è¡¨</span></span><br><span class="line">ChildConcurrencyComponents []Component</span><br><span class="line"><span class="comment">// wg å¯¹è±¡</span></span><br><span class="line">*sync.WaitGroup</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶ä¸šåŠ¡æ‰§è¡Œç»“æœchannel</span></span><br><span class="line">logicResChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">Err error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">Remove</span><span class="params">(c Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(bc.ChildComponents) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> c == childComponent &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç§»é™¤:&quot;</span>, reflect.TypeOf(childComponent))</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents[:k], bc.ChildComponents[k+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, childComponent := <span class="keyword">range</span> bc.ChildConcurrencyComponents &#123;</span><br><span class="line"><span class="keyword">if</span> c == childComponent &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç§»é™¤:&quot;</span>, reflect.TypeOf(childComponent))</span><br><span class="line">bc.ChildConcurrencyComponents = <span class="built_in">append</span>(bc.ChildComponents[:k], bc.ChildComponents[k+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MountConcurrency æŒ‚è½½ä¸€ä¸ªå¹¶å‘å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">MountConcurrency</span><span class="params">(c Component, components ...Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">bc.HasChildConcurrencyComponents = <span class="literal">true</span></span><br><span class="line">bc.ChildConcurrencyComponents = <span class="built_in">append</span>(bc.ChildConcurrencyComponents, c)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(components) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">bc.ChildConcurrencyComponents = <span class="built_in">append</span>(bc.ChildConcurrencyComponents, components...)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChildsDo æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">ChildsDo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> bc.WaitGroup == <span class="literal">nil</span> &#123;</span><br><span class="line">bc.WaitGroup = &amp;sync.WaitGroup&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå¹¶å‘å­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> _, childComponent := <span class="keyword">range</span> bc.ChildConcurrencyComponents &#123;</span><br><span class="line">bc.WaitGroup.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> childComponent.Do(ctx, childComponent, bc.WaitGroup)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> _, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> err = childComponent.Do(ctx, childComponent, <span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> bc.HasChildConcurrencyComponents &#123;</span><br><span class="line"><span class="comment">// ç­‰å¾…å¹¶å‘ç»„ä»¶æ‰§è¡Œç»“æœ</span></span><br><span class="line">bc.WaitGroup.Wait()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// ctx ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// currentConponent å½“å‰ç»„ä»¶</span></span><br><span class="line"><span class="comment">// wg çˆ¶ç»„ä»¶çš„waitgroupå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context, currentConponent Component, wg *sync.WaitGroup)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å¹¶å‘å­ç»„ä»¶channel</span></span><br><span class="line"><span class="keyword">if</span> bc.logicResChan == <span class="literal">nil</span> &#123;</span><br><span class="line">bc.logicResChan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> currentConponent.BusinessLogicDo(bc.logicResChan)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="comment">// ç­‰å¾…ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="keyword">case</span> &lt;-bc.logicResChan:</span><br><span class="line"><span class="comment">// ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;bc.BusinessLogicDo wait.done...&quot;</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="comment">// è¶…æ—¶ç­‰å¾…</span></span><br><span class="line"><span class="keyword">case</span> &lt;-ctx.TimeoutCtx.Done():</span><br><span class="line"><span class="comment">// è¶…æ—¶é€€å‡º</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;bc.BusinessLogicDo timeout...&quot;</span>)</span><br><span class="line">bc.Err = ErrConcurrencyComponentTimeout</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">err = currentConponent.ChildsDo(ctx)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CheckoutPageComponent è®¢å•ç»“ç®—é¡µé¢ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> CheckoutPageComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseConcurrencyComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å½“å‰ç»„ä»¶ä¸šåŠ¡é€»è¾‘ä»£ç å¡«å……å¤„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *CheckoutPageComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è®¢å•ç»“ç®—é¡µé¢ç»„ä»¶...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddressComponent åœ°å€ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> AddressComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseConcurrencyComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *AddressComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;åœ°å€ç»„ä»¶...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–åœ°å€ä¿¡æ¯ ing...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿè¿œç¨‹è°ƒç”¨åœ°å€æœåŠ¡</span></span><br><span class="line">http.Get(<span class="string">&quot;http://example.com/&quot;</span>)</span><br><span class="line"></span><br><span class="line">resChan &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// å†™å…¥ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–åœ°å€ä¿¡æ¯ done...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PayMethodComponent æ”¯ä»˜æ–¹å¼ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> PayMethodComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseConcurrencyComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *PayMethodComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ”¯ä»˜æ–¹å¼ç»„ä»¶...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–æ”¯ä»˜æ–¹å¼ ing...&quot;</span>)</span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿè¿œç¨‹è°ƒç”¨åœ°å€æœåŠ¡ ç•¥</span></span><br><span class="line">resChan &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–æ”¯ä»˜æ–¹å¼ done...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StoreComponent åº—é“ºç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> StoreComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *StoreComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;åº—é“ºç»„ä»¶...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SkuComponent å•†å“ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> SkuComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *SkuComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å•†å“ç»„ä»¶...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PromotionComponent ä¼˜æƒ ä¿¡æ¯ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> PromotionComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *PromotionComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä¼˜æƒ ä¿¡æ¯ç»„ä»¶...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ExpressComponent ç‰©æµç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> ExpressComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *ExpressComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç‰©æµç»„ä»¶...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AftersaleComponent å”®åç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> AftersaleComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *AftersaleComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å”®åç»„ä»¶...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// InvoiceComponent å‘ç¥¨ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> InvoiceComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseConcurrencyComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *InvoiceComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å‘ç¥¨ç»„ä»¶...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–å‘ç¥¨ä¿¡æ¯ ing...&quot;</span>)</span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿè¿œç¨‹è°ƒç”¨åœ°å€æœåŠ¡ ç•¥</span></span><br><span class="line">resChan &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// å†™å…¥ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–å‘ç¥¨ä¿¡æ¯ done...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CouponComponent ä¼˜æƒ åˆ¸ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> CouponComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseConcurrencyComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *CouponComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä¼˜æƒ åˆ¸ç»„ä»¶...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–æœ€ä¼˜ä¼˜æƒ åˆ¸ ing...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿè¿œç¨‹è°ƒç”¨ä¼˜æƒ åˆ¸æœåŠ¡</span></span><br><span class="line">http.Get(<span class="string">&quot;http://example.com/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™å…¥ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line">resChan &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–æœ€ä¼˜ä¼˜æƒ åˆ¸ done...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GiftCardComponent ç¤¼å“å¡ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> GiftCardComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseConcurrencyComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å¹¶å‘ç»„ä»¶å®é™…å¡«å……ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *GiftCardComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç¤¼å“å¡ç»„ä»¶...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–ç¤¼å“å¡ä¿¡æ¯ ing...&quot;</span>)</span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿè¿œç¨‹è°ƒç”¨åœ°å€æœåŠ¡ ç•¥</span></span><br><span class="line">resChan &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// å†™å…¥ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–ç¤¼å“å¡ä¿¡æ¯ done...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OrderComponent è®¢å•é‡‘é¢è¯¦ç»†ä¿¡æ¯ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> OrderComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å½“å‰ç»„ä»¶ä¸šåŠ¡é€»è¾‘ä»£ç å¡«å……å¤„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *OrderComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è®¢å•é‡‘é¢è¯¦ç»†ä¿¡æ¯ç»„ä»¶...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Demo ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Demo</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–è®¢å•ç»“ç®—é¡µé¢ è¿™ä¸ªå¤§ç»„ä»¶</span></span><br><span class="line">checkoutPage := &amp;CheckoutPageComponent&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‚è½½å­ç»„ä»¶</span></span><br><span class="line">storeComponent := &amp;StoreComponent&#123;&#125;</span><br><span class="line">skuComponent := &amp;SkuComponent&#123;&#125;</span><br><span class="line">skuComponent.Mount(</span><br><span class="line">&amp;PromotionComponent&#123;&#125;,</span><br><span class="line">&amp;AftersaleComponent&#123;&#125;,</span><br><span class="line">)</span><br><span class="line">storeComponent.Mount(</span><br><span class="line">skuComponent,</span><br><span class="line">&amp;ExpressComponent&#123;&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---æŒ‚è½½ç»„ä»¶---</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ™®é€šç»„ä»¶</span></span><br><span class="line">checkoutPage.Mount(</span><br><span class="line">storeComponent,</span><br><span class="line">&amp;OrderComponent&#123;&#125;,</span><br><span class="line">)</span><br><span class="line"><span class="comment">// å¹¶å‘ç»„ä»¶</span></span><br><span class="line">checkoutPage.MountConcurrency(</span><br><span class="line">&amp;AddressComponent&#123;&#125;,</span><br><span class="line">&amp;PayMethodComponent&#123;&#125;,</span><br><span class="line">&amp;InvoiceComponent&#123;&#125;,</span><br><span class="line">&amp;CouponComponent&#123;&#125;,</span><br><span class="line">&amp;GiftCardComponent&#123;&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ä¸šåŠ¡ä¸Šä¸‹æ–‡ å¹¶è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">ctx := GetContext(<span class="number">5</span> * time.Second)</span><br><span class="line"><span class="keyword">defer</span> ctx.CancelFunc()</span><br><span class="line"><span class="comment">// å¼€å§‹æ„å»ºé¡µé¢ç»„ä»¶æ•°æ®</span></span><br><span class="line">checkoutPage.ChildsDo(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">runtime.GOMAXPROCS(runtime.NumCPU() - <span class="number">1</span>)</span><br><span class="line">Demo()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ­£åœ¨è¿è¡Œçš„å‡½æ•°å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runFuncName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">pc := <span class="built_in">make</span>([]<span class="keyword">uintptr</span>, <span class="number">1</span>)</span><br><span class="line">runtime.Callers(<span class="number">2</span>, pc)</span><br><span class="line">f := runtime.FuncForPC(pc[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> f.Name()</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»£ç è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Running] go run &quot;..&#x2F;easy-tips&#x2F;go&#x2F;patterns&#x2F;composite&#x2F;concurrency&#x2F;composite-concurrency.go&quot;</span><br><span class="line">main.(*StoreComponent).BusinessLogicDo åº—é“ºç»„ä»¶...</span><br><span class="line">main.(*SkuComponent).BusinessLogicDo å•†å“ç»„ä»¶...</span><br><span class="line">main.(*PromotionComponent).BusinessLogicDo ä¼˜æƒ ä¿¡æ¯ç»„ä»¶...</span><br><span class="line">main.(*AftersaleComponent).BusinessLogicDo å”®åç»„ä»¶...</span><br><span class="line">main.(*ExpressComponent).BusinessLogicDo ç‰©æµç»„ä»¶...</span><br><span class="line">main.(*OrderComponent).BusinessLogicDo è®¢å•é‡‘é¢è¯¦ç»†ä¿¡æ¯ç»„ä»¶...</span><br><span class="line">main.(*PayMethodComponent).BusinessLogicDo æ”¯ä»˜æ–¹å¼ç»„ä»¶...</span><br><span class="line">main.(*PayMethodComponent).BusinessLogicDo è·å–æ”¯ä»˜æ–¹å¼ ing...</span><br><span class="line">main.(*InvoiceComponent).BusinessLogicDo å‘ç¥¨ç»„ä»¶...</span><br><span class="line">main.(*InvoiceComponent).BusinessLogicDo è·å–å‘ç¥¨ä¿¡æ¯ ing...</span><br><span class="line">main.(*GiftCardComponent).BusinessLogicDo ç¤¼å“å¡ç»„ä»¶...</span><br><span class="line">main.(*GiftCardComponent).BusinessLogicDo è·å–ç¤¼å“å¡ä¿¡æ¯ ing...</span><br><span class="line">main.(*CouponComponent).BusinessLogicDo ä¼˜æƒ åˆ¸ç»„ä»¶...</span><br><span class="line">main.(*CouponComponent).BusinessLogicDo è·å–å‘ç¥¨ä¿¡æ¯ ing...</span><br><span class="line">main.(*AddressComponent).BusinessLogicDo åœ°å€ç»„ä»¶...</span><br><span class="line">main.(*AddressComponent).BusinessLogicDo è·å–åœ°å€ä¿¡æ¯ ing...</span><br><span class="line">main.(*InvoiceComponent).BusinessLogicDo è·å–å‘ç¥¨ä¿¡æ¯ done...</span><br><span class="line">main.(*BaseConcurrencyComponent).Do bc.BusinessLogicDo wait.done...</span><br><span class="line">main.(*BaseConcurrencyComponent).Do bc.BusinessLogicDo wait.done...</span><br><span class="line">main.(*PayMethodComponent).BusinessLogicDo è·å–æ”¯ä»˜æ–¹å¼ done...</span><br><span class="line">main.(*AddressComponent).BusinessLogicDo è·å–åœ°å€ä¿¡æ¯ done...</span><br><span class="line">main.(*BaseConcurrencyComponent).Do bc.BusinessLogicDo wait.done...</span><br><span class="line">main.(*CouponComponent).BusinessLogicDo è·å–å‘ç¥¨ä¿¡æ¯ done...</span><br><span class="line">main.(*BaseConcurrencyComponent).Do bc.BusinessLogicDo wait.done...</span><br><span class="line">main.(*GiftCardComponent).BusinessLogicDo è·å–ç¤¼å“å¡ä¿¡æ¯ done...</span><br><span class="line">main.(*BaseConcurrencyComponent).Do bc.BusinessLogicDo wait.done...</span><br></pre></td></tr></table></figure><h4 id="ã€Œç»„åˆæ¨¡å¼ã€å’Œã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€åŸºå‡†æµ‹è¯•å¯¹æ¯”"><a href="#ã€Œç»„åˆæ¨¡å¼ã€å’Œã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€åŸºå‡†æµ‹è¯•å¯¹æ¯”" class="headerlink" title="ã€Œç»„åˆæ¨¡å¼ã€å’Œã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€åŸºå‡†æµ‹è¯•å¯¹æ¯”"></a>ã€Œç»„åˆæ¨¡å¼ã€å’Œã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€åŸºå‡†æµ‹è¯•å¯¹æ¯”</h4><p>åŸºå‡†æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> composite</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;easy-tips/go/patterns/composite/concurrency&quot;</span></span><br><span class="line"><span class="string">&quot;easy-tips/go/patterns/composite/normal&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line"><span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// go test -benchmem -run=^$ easy-tips/go/patterns/composite -bench . -v -count=1 --benchtime 20s</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Benchmark_Normal</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">b.SetParallelism(runtime.NumCPU())</span><br><span class="line">b.RunParallel(<span class="function"><span class="keyword">func</span><span class="params">(pb *testing.PB)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> pb.Next() &#123;</span><br><span class="line">normal.Demo()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Benchmark_Concurrency</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">b.SetParallelism(runtime.NumCPU())</span><br><span class="line">b.RunParallel(<span class="function"><span class="keyword">func</span><span class="params">(pb *testing.PB)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> pb.Next() &#123;</span><br><span class="line">concurrency.Demo()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬åœ°æœºå™¨Benchmarkå¯¹æ¯”æµ‹è¯•ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(TIGERB) ğŸ¤” âœ  composite git:(master) âœ— go test -benchmem -run&#x3D;^$ easy-tips&#x2F;go&#x2F;patterns&#x2F;composite -bench . -v -count&#x3D;1 --benchtime 20s </span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: easy-tips&#x2F;go&#x2F;patterns&#x2F;composite</span><br><span class="line">Benchmark_Normal-4                   376          56666895 ns&#x2F;op           35339 B&#x2F;op        286 allocs&#x2F;op</span><br><span class="line">Benchmark_Concurrency-4              715          32669301 ns&#x2F;op           36445 B&#x2F;op        299 allocs&#x2F;op</span><br><span class="line">PASS</span><br><span class="line">ok      easy-tips&#x2F;go&#x2F;patterns&#x2F;composite 68.835s</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„åŸºå‡†æµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºæ¥<code>Benchmark_Concurrency-4</code>å¹³å‡æ¯æ¬¡çš„æ‰§è¡Œæ—¶é—´æ˜¯<code>32669301 ns</code>æ˜¯è¦ä¼˜äº<code>Benchmark_Normal</code>çš„<code>56666895 ns</code>ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€æ˜¯ä¸€ä¸ªç”±ç‰¹å®šçš„è®¾è®¡æ¨¡å¼ç»“åˆGoè¯­è¨€å¤©ç”Ÿçš„å¹¶å‘ç‰¹æ€§ï¼Œé€šè¿‡é€‚å½“å°è£…å½¢æˆçš„â€œæ–°æ¨¡å¼â€ã€‚</p><h2 id="é™„å½•ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€çš„åŸºç¡€ä»£ç æ¨¡æ¿ä¸ä½¿ç”¨è¯´æ˜"><a href="#é™„å½•ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€çš„åŸºç¡€ä»£ç æ¨¡æ¿ä¸ä½¿ç”¨è¯´æ˜" class="headerlink" title="é™„å½•ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€çš„åŸºç¡€ä»£ç æ¨¡æ¿ä¸ä½¿ç”¨è¯´æ˜"></a>é™„å½•ã€Œå¹¶å‘ç»„åˆæ¨¡å¼ã€çš„åŸºç¡€ä»£ç æ¨¡æ¿ä¸ä½¿ç”¨è¯´æ˜</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//Goè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ—</span></span><br><span class="line"><span class="comment">//ç»„åˆæ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//example:</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ ¹ç»„ä»¶</span></span><br><span class="line"><span class="comment">// å¦‚æœå­ç»„ä»¶å­˜åœ¨å¹¶å‘ç»„ä»¶åˆ™çˆ¶ç»„ä»¶å¿…é¡»ä¸ºå¹¶å‘ç»„ä»¶</span></span><br><span class="line"><span class="comment">// type RootComponent struct &#123;</span></span><br><span class="line"><span class="comment">// BaseConcurrencyComponent</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// func (bc *RootComponent) BusinessLogicDo(resChan chan interface&#123;&#125;) (err error) &#123;</span></span><br><span class="line"><span class="comment">// // do nothing</span></span><br><span class="line"><span class="comment">// return</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå¹¶å‘ç»„ä»¶</span></span><br><span class="line"><span class="comment">// type DemoConcurrenyComponent struct &#123;</span></span><br><span class="line"><span class="comment">// BaseConcurrencyComponent</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// func (bc *DemoConcurrenyComponent) BusinessLogicDo(resChan chan interface&#123;&#125;) (err error) &#123;</span></span><br><span class="line"><span class="comment">// // å¹¶å‘ç»„ä»¶ä¸šåŠ¡é€»è¾‘å¡«å……åˆ°è¿™</span></span><br><span class="line"><span class="comment">// return</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ™®é€šç»„ä»¶</span></span><br><span class="line"><span class="comment">// type DemoComponent struct &#123;</span></span><br><span class="line"><span class="comment">// BaseComponent</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// func (bc *DemoComponent) BusinessLogicDo(resChan chan interface&#123;&#125;) (err error) &#123;</span></span><br><span class="line"><span class="comment">// // æ™®é€šç»„ä»¶ä¸šåŠ¡é€»è¾‘å¡«å……åˆ°è¿™</span></span><br><span class="line"><span class="comment">// return</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// // æ™®é€šç»„ä»¶</span></span><br><span class="line"><span class="comment">// root.Mount(</span></span><br><span class="line"><span class="comment">// &amp;DemoComponent&#123;&#125;,</span></span><br><span class="line"><span class="comment">// )</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// // å¹¶å‘ç»„ä»¶</span></span><br><span class="line"><span class="comment">// root := &amp;RootComponent&#123;&#125;</span></span><br><span class="line"><span class="comment">// root.MountConcurrency(</span></span><br><span class="line"><span class="comment">// &amp;DemoConcurrenyComponent&#123;&#125;,</span></span><br><span class="line"><span class="comment">// )</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// // åˆå§‹åŒ–ä¸šåŠ¡ä¸Šä¸‹æ–‡ å¹¶è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment">// ctx := GetContext(5 * time.Second)</span></span><br><span class="line"><span class="comment">// defer ctx.CancelFunc()</span></span><br><span class="line"><span class="comment">// // å¼€å§‹æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// root.ChildsDo(ctx)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line"><span class="comment">// ErrConcurrencyComponentTimeout å¹¶å‘ç»„ä»¶ä¸šåŠ¡è¶…æ—¶</span></span><br><span class="line">ErrConcurrencyComponentTimeout = errors.New(<span class="string">&quot;Concurrency Component Timeout&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// context.WithTimeoutæ´¾ç”Ÿçš„å­ä¸Šä¸‹æ–‡</span></span><br><span class="line">TimeoutCtx context.Context</span><br><span class="line"><span class="comment">// è¶…æ—¶å‡½æ•°</span></span><br><span class="line">context.CancelFunc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetContext è·å–ä¸šåŠ¡ä¸Šä¸‹æ–‡å®ä¾‹</span></span><br><span class="line"><span class="comment">// d è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetContext</span><span class="params">(d time.Duration)</span> *<span class="title">Context</span></span> &#123;</span><br><span class="line">c := &amp;Context&#123;&#125;</span><br><span class="line">c.TimeoutCtx, c.CancelFunc = context.WithTimeout(context.Background(), d)</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Component ç»„ä»¶æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Component <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Mount(c Component, components ...Component) error</span><br><span class="line"><span class="comment">// ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Remove(c Component) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡:`BusinessLogicDo`å’Œæ‰§è¡Œå­ç»„ä»¶:`ChildsDo`</span></span><br><span class="line"><span class="comment">// ctx ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// currentConponent å½“å‰ç»„ä»¶</span></span><br><span class="line"><span class="comment">// wg çˆ¶ç»„ä»¶çš„waitgroupå¯¹è±¡</span></span><br><span class="line">Do(ctx *Context, currentConponent Component, wg *sync.WaitGroup) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="comment">// resChan å›å†™å½“å‰ç»„ä»¶ä¸šåŠ¡æ‰§è¡Œç»“æœçš„channel</span></span><br><span class="line">BusinessLogicDo(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">ChildsDo(ctx *Context) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BaseComponent åŸºç¡€ç»„ä»¶</span></span><br><span class="line"><span class="comment">// å®ç°Add:æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// å®ç°Remove:ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> BaseComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// å­ç»„ä»¶åˆ—è¡¨</span></span><br><span class="line">ChildComponents []Component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mount æŒ‚è½½ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">Mount</span><span class="params">(c Component, components ...Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents, c)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(components) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents, components...)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">Remove</span><span class="params">(c Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(bc.ChildComponents) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> c == childComponent &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç§»é™¤:&quot;</span>, reflect.TypeOf(childComponent))</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents[:k], bc.ChildComponents[k+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// ctx ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// currentConponent å½“å‰ç»„ä»¶</span></span><br><span class="line"><span class="comment">// wg çˆ¶ç»„ä»¶çš„waitgroupå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context, currentConponent Component, wg *sync.WaitGroup)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">//æ‰§è¡Œå½“å‰ç»„ä»¶ä¸šåŠ¡ä»£ç </span></span><br><span class="line">err = currentConponent.BusinessLogicDo(<span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">return</span> currentConponent.ChildsDo(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BusinessLogicDo å½“å‰ç»„ä»¶ä¸šåŠ¡é€»è¾‘ä»£ç å¡«å……å¤„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">BusinessLogicDo</span><span class="params">(resChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChildsDo æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">ChildsDo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> _, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> err = childComponent.Do(ctx, childComponent, <span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BaseConcurrencyComponent å¹¶å‘åŸºç¡€ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> BaseConcurrencyComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶æ˜¯å¦æœ‰å¹¶å‘å­ç»„ä»¶</span></span><br><span class="line">HasChildConcurrencyComponents <span class="keyword">bool</span></span><br><span class="line"><span class="comment">// å¹¶å‘å­ç»„ä»¶åˆ—è¡¨</span></span><br><span class="line">ChildConcurrencyComponents []Component</span><br><span class="line"><span class="comment">// wg å¯¹è±¡</span></span><br><span class="line">*sync.WaitGroup</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶ä¸šåŠ¡æ‰§è¡Œç»“æœchannel</span></span><br><span class="line">logicResChan <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">Err error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">Remove</span><span class="params">(c Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(bc.ChildComponents) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> c == childComponent &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç§»é™¤:&quot;</span>, reflect.TypeOf(childComponent))</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents[:k], bc.ChildComponents[k+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, childComponent := <span class="keyword">range</span> bc.ChildConcurrencyComponents &#123;</span><br><span class="line"><span class="keyword">if</span> c == childComponent &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç§»é™¤:&quot;</span>, reflect.TypeOf(childComponent))</span><br><span class="line">bc.ChildConcurrencyComponents = <span class="built_in">append</span>(bc.ChildComponents[:k], bc.ChildComponents[k+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MountConcurrency æŒ‚è½½ä¸€ä¸ªå¹¶å‘å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">MountConcurrency</span><span class="params">(c Component, components ...Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">bc.HasChildConcurrencyComponents = <span class="literal">true</span></span><br><span class="line">bc.ChildConcurrencyComponents = <span class="built_in">append</span>(bc.ChildConcurrencyComponents, c)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(components) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">bc.ChildConcurrencyComponents = <span class="built_in">append</span>(bc.ChildConcurrencyComponents, components...)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChildsDo æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">ChildsDo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> bc.WaitGroup == <span class="literal">nil</span> &#123;</span><br><span class="line">bc.WaitGroup = &amp;sync.WaitGroup&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå¹¶å‘å­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> _, childComponent := <span class="keyword">range</span> bc.ChildConcurrencyComponents &#123;</span><br><span class="line">bc.WaitGroup.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> childComponent.Do(ctx, childComponent, bc.WaitGroup)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> _, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> err = childComponent.Do(ctx, childComponent, <span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> bc.HasChildConcurrencyComponents &#123;</span><br><span class="line"><span class="comment">// ç­‰å¾…å¹¶å‘ç»„ä»¶æ‰§è¡Œç»“æœ</span></span><br><span class="line">bc.WaitGroup.Wait()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// ctx ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// currentConponent å½“å‰ç»„ä»¶</span></span><br><span class="line"><span class="comment">// wg çˆ¶ç»„ä»¶çš„waitgroupå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseConcurrencyComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context, currentConponent Component, wg *sync.WaitGroup)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å¹¶å‘å­ç»„ä»¶channel</span></span><br><span class="line"><span class="keyword">if</span> bc.logicResChan == <span class="literal">nil</span> &#123;</span><br><span class="line">bc.logicResChan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> currentConponent.BusinessLogicDo(bc.logicResChan)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="comment">// ç­‰å¾…ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="keyword">case</span> &lt;-bc.logicResChan:</span><br><span class="line"><span class="comment">// ä¸šåŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;bc.BusinessLogicDo wait.done...&quot;</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="comment">// è¶…æ—¶ç­‰å¾…</span></span><br><span class="line"><span class="keyword">case</span> &lt;-ctx.TimeoutCtx.Done():</span><br><span class="line"><span class="comment">// è¶…æ—¶é€€å‡º</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;bc.BusinessLogicDo timeout...&quot;</span>)</span><br><span class="line">bc.Err = ErrConcurrencyComponentTimeout</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">err = currentConponent.ChildsDo(ctx)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹åˆ«è¯´æ˜ï¼š</span><br><span class="line">æœ¬ç³»åˆ—çš„ä¸€äº›è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µå¯èƒ½å’ŒåŸæ¦‚å¿µå­˜åœ¨å·®å¼‚ï¼Œå› ä¸ºä¼šç»“åˆå®é™…ä½¿ç”¨ï¼Œå–å…¶ç²¾åï¼Œé€‚å½“æ”¹å˜ï¼Œçµæ´»ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure><h1 id="æ–‡ç« åˆ—è¡¨"><a href="#æ–‡ç« åˆ—è¡¨" class="headerlink" title="æ–‡ç« åˆ—è¡¨"></a>æ–‡ç« åˆ—è¡¨</h1><ul><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/template">ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/responsibility">é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/observer">è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/strategy">å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/state">çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li></ul><blockquote><p><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns">Goè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ— æ›´å¤šæ–‡ç«  ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å¹¶å‘ç»„ä»¶-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;a href=&quot;#å¹¶å‘ç»„ä»¶-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot; class=&quot;headerlink&quot; title=&quot;å¹¶å‘ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;/a&gt;å¹¶å‘ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</title>
    <link href="http://wangyangyangisme.github.io/posts/20ee7783/"/>
    <id>http://wangyangyangisme.github.io/posts/20ee7783/</id>
    <published>2021-05-16T06:31:01.000Z</published>
    <updated>2021-05-16T06:31:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="çŠ¶æ€å˜æ¢-Goè®¾è®¡æ¨¡å¼å®æˆ˜"><a href="#çŠ¶æ€å˜æ¢-Goè®¾è®¡æ¨¡å¼å®æˆ˜" class="headerlink" title="çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜"></a>çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</h1><blockquote><p>å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ—ï¼Œä¸€ä¸ªè®¾è®¡æ¨¡å¼ä¸šåŠ¡çœŸå®ä½¿ç”¨çš„golangç³»åˆ—ã€‚</p><p><a href="http://tigerb.cn/">http://tigerb.cn/</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç³»åˆ—ä¸»è¦åˆ†äº«ï¼Œå¦‚ä½•åœ¨æˆ‘ä»¬çš„çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨è®¾è®¡æ¨¡å¼ã€‚</p><p>æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦é‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š</p><ul><li>ä»€ä¹ˆæ˜¯ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ä½¿ç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>æ€ä¹ˆç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li></ul><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ã€ŒçŠ¶æ€æ¨¡å¼ã€å¦‚ä½•åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p><p>ã€ŒçŠ¶æ€æ¨¡å¼ã€æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç®—æ³•çš„é€‰å–å–å†³äºäºè‡ªå·±çš„å†…éƒ¨çŠ¶æ€ã€‚ç›¸è¾ƒäºã€Œç­–ç•¥æ¨¡å¼ã€ç®—æ³•çš„é€‰å–ç”±ç”¨æˆ·å†³ç­–å˜æˆå†…éƒ¨çŠ¶æ€å†³ç­–ï¼Œã€Œç­–ç•¥æ¨¡å¼ã€æ˜¯ç”¨æˆ·(å®¢æˆ·ç«¯)é€‰æ‹©å…·ä½“çš„ç®—æ³•ï¼Œã€ŒçŠ¶æ€æ¨¡å¼ã€åªæ˜¯é€šè¿‡å†…éƒ¨ä¸åŒçš„çŠ¶æ€é€‰æ‹©å…·ä½“çš„ç®—æ³•ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ</h2><blockquote><p>ä¸åŒçš„ç®—æ³•æŒ‰ç…§ç»Ÿä¸€çš„æ ‡å‡†å°è£…ï¼Œæ ¹æ®ä¸åŒçš„<strong>å†…éƒ¨çŠ¶æ€</strong>ï¼Œå†³ç­–ä½¿ç”¨ä½•ç§ç®—æ³•</p></blockquote><h3 id="ã€ŒçŠ¶æ€æ¨¡å¼ã€å’Œã€Œç­–ç•¥æ¨¡å¼ã€çš„åŒºåˆ«"><a href="#ã€ŒçŠ¶æ€æ¨¡å¼ã€å’Œã€Œç­–ç•¥æ¨¡å¼ã€çš„åŒºåˆ«" class="headerlink" title="ã€ŒçŠ¶æ€æ¨¡å¼ã€å’Œã€Œç­–ç•¥æ¨¡å¼ã€çš„åŒºåˆ«"></a>ã€ŒçŠ¶æ€æ¨¡å¼ã€å’Œã€Œç­–ç•¥æ¨¡å¼ã€çš„åŒºåˆ«</h3><ul><li>ç­–ç•¥æ¨¡å¼ï¼šä¾é å®¢æˆ·å†³ç­–</li><li>çŠ¶æ€æ¨¡å¼ï¼šä¾é å†…éƒ¨çŠ¶æ€å†³ç­–</li></ul><h2 id="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ</h2><blockquote><p>å…·ä½“ç®—æ³•çš„é€‰å–æ˜¯ç”±å†…éƒ¨çŠ¶æ€å†³å®šçš„</p></blockquote><ul><li>é¦–å…ˆï¼Œå†…éƒ¨å­˜åœ¨å¤šç§çŠ¶æ€</li><li>å…¶æ¬¡ï¼Œä¸åŒçš„çŠ¶æ€çš„ä¸šåŠ¡é€»è¾‘å„ä¸ç›¸åŒ</li></ul><blockquote><p>æˆ‘ä»¬æœ‰å“ªäº›çœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€ŒçŠ¶æ€æ¨¡å¼ã€å‘¢ï¼Ÿ</p></blockquote><p>æ¯”å¦‚ï¼Œå‘é€çŸ­ä¿¡æ¥å£ã€é™æµç­‰ç­‰ã€‚</p><ul><li>çŸ­ä¿¡æ¥å£<ul><li>æœåŠ¡å†…éƒ¨æ ¹æ®æœ€ä¼˜ç®—æ³•ï¼Œå®æ—¶æ¨ä¸¾å‡ºæœ€ä¼˜çš„çŸ­ä¿¡æœåŠ¡å•†ï¼Œå¹¶ä¿®æ”¹<strong>ä½¿ç”¨ä½•ç§çŸ­ä¿¡æœåŠ¡å•†çš„çŠ¶æ€</strong></li></ul></li><li>é™æµ<ul><li>æœåŠ¡å†…éƒ¨æ ¹æ®å½“å‰çš„å®æ—¶æµé‡ï¼Œé€‰æ‹©ä¸åŒçš„é™æµç®—æ³•ï¼Œå¹¶ä¿®æ”¹<strong>ä½¿ç”¨ä½•ç§é™æµç®—æ³•çš„çŠ¶æ€</strong></li></ul></li></ul><h2 id="æ€ä¹ˆç”¨ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ"><a href="#æ€ä¹ˆç”¨ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="æ€ä¹ˆç”¨ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ"></a>æ€ä¹ˆç”¨ã€ŒçŠ¶æ€æ¨¡å¼ã€ï¼Ÿ</h2><p>å…³äºæ€ä¹ˆç”¨ï¼Œå®Œå…¨å¯ä»¥ç”Ÿæ¬ç¡¬å¥—æˆ‘æ€»ç»“çš„ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä¸šåŠ¡æ¢³ç†</li><li>ä¸šåŠ¡æµç¨‹å›¾</li><li>ä»£ç å»ºæ¨¡</li><li>ä»£ç demo</li></ul><h4 id="ä¸šåŠ¡æ¢³ç†"><a href="#ä¸šåŠ¡æ¢³ç†" class="headerlink" title="ä¸šåŠ¡æ¢³ç†"></a>ä¸šåŠ¡æ¢³ç†</h4><p>å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªçŸ­ä¿¡éªŒè¯ç ç™»å½•çš„ç•Œé¢ã€‚</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200522131127.png" style="width:100%"></p><p>å¯ä»¥å¾—åˆ°ï¼š</p><ul><li>å‘é€çŸ­ä¿¡ï¼Œç”¨æˆ·åªéœ€è¦è¾“å…¥æ‰‹æœºå·å³å¯</li><li>è‡³äºçŸ­ä¿¡æœåŠ¡ä½¿ç”¨ä½•ç§çŸ­ä¿¡æœåŠ¡å•†ï¼Œæ˜¯ç”±çŸ­ä¿¡æœåŠ¡è‡ªèº«çš„<strong>å½“å‰çŸ­ä¿¡æœåŠ¡å•†å®ä¾‹çš„çŠ¶æ€</strong>å†³å®š</li><li><strong>å½“å‰çŸ­ä¿¡æœåŠ¡å•†å®ä¾‹çš„çŠ¶æ€</strong>åˆæ˜¯ç”±æœåŠ¡è‡ªèº«çš„ç®—æ³•ä¿®æ”¹</li></ul><h4 id="ä¸šåŠ¡æµç¨‹å›¾"><a href="#ä¸šåŠ¡æµç¨‹å›¾" class="headerlink" title="ä¸šåŠ¡æµç¨‹å›¾"></a>ä¸šåŠ¡æµç¨‹å›¾</h4><p>æˆ‘ä»¬é€šè¿‡æ¢³ç†çš„æ–‡æœ¬ä¸šåŠ¡æµç¨‹å¾—åˆ°äº†å¦‚ä¸‹çš„ä¸šåŠ¡æµç¨‹å›¾ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200522130715.png" style="width:100%"></p><h4 id="ä»£ç å»ºæ¨¡"><a href="#ä»£ç å»ºæ¨¡" class="headerlink" title="ä»£ç å»ºæ¨¡"></a>ä»£ç å»ºæ¨¡</h4><p>ã€ŒçŠ¶æ€æ¨¡å¼ã€çš„æ ¸å¿ƒæ˜¯ï¼š</p><ul><li>ä¸€ä¸ªæ¥å£:<ul><li>çŸ­ä¿¡æœåŠ¡æ¥å£<code>SmsServiceInterface</code></li></ul></li><li>ä¸€ä¸ªå®ä½“ç±»:<ul><li>çŠ¶æ€ç®¡ç†å®ä½“ç±»<code>StateManager</code></li></ul></li></ul><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å®šä¹‰ä¸€ä¸ªçŸ­ä¿¡æœåŠ¡æ¥å£</span><br><span class="line">- æ¥å£&#96;SmsServiceInterface&#96;</span><br><span class="line">+ æŠ½è±¡æ–¹æ³•&#96;Send(ctx *Context) error&#96;å‘é€çŸ­ä¿¡çš„æŠ½è±¡æ–¹æ³•</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å®šä¹‰å…·ä½“çš„çŸ­ä¿¡æœåŠ¡å®ä½“ç±» å®ç°æ¥å£&#96;SmsServiceInterface&#96;</span><br><span class="line"></span><br><span class="line">- å®ä½“ç±»&#96;ServiceProviderAliyun&#96;</span><br><span class="line">+ æˆå‘˜æ–¹æ³•&#96;Send(ctx *Context) error&#96;å…·ä½“çš„å‘é€çŸ­ä¿¡é€»è¾‘</span><br><span class="line">- å®ä½“ç±»&#96;ServiceProviderTencent&#96;</span><br><span class="line">+ æˆå‘˜æ–¹æ³•&#96;Send(ctx *Context) error&#96;å…·ä½“çš„å‘é€çŸ­ä¿¡é€»è¾‘</span><br><span class="line">- å®ä½“ç±»&#96;ServiceProviderYunpian&#96;</span><br><span class="line">+ æˆå‘˜æ–¹æ³•&#96;Send(ctx *Context) error&#96;å…·ä½“çš„å‘é€çŸ­ä¿¡é€»è¾‘</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å®šä¹‰çŠ¶æ€ç®¡ç†å®ä½“ç±»&#96;StateManager&#96;</span><br><span class="line">- æˆå‘˜å±æ€§</span><br><span class="line">+ &#96;currentProviderType ProviderType&#96;å½“å‰ä½¿ç”¨çš„æœåŠ¡æä¾›å•†ç±»å‹</span><br><span class="line">+ &#96;currentProvider SmsServiceInterface&#96;å½“å‰ä½¿ç”¨çš„æœåŠ¡æä¾›å•†å®ä¾‹</span><br><span class="line">+ &#96;setStateDuration time.Duration&#96;æ›´æ–°çŠ¶æ€æ—¶é—´é—´éš”</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;initState(duration time.Duration)&#96;åˆå§‹åŒ–çŠ¶æ€</span><br><span class="line">+ &#96;setState(t time.Time)&#96;è®¾ç½®çŠ¶æ€</span><br></pre></td></tr></table></figure><p>åŒæ—¶å¾—åˆ°äº†æˆ‘ä»¬çš„UMLå›¾ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200527141350.jpg" style="width:100%"></p><h4 id="ä»£ç demo"><a href="#ä»£ç demo" class="headerlink" title="ä»£ç demo"></a>ä»£ç demo</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//çŠ¶æ€æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">Tel        <span class="keyword">string</span> <span class="comment">// æ‰‹æœºå·</span></span><br><span class="line">Text       <span class="keyword">string</span> <span class="comment">// çŸ­ä¿¡å†…å®¹</span></span><br><span class="line">TemplateID <span class="keyword">string</span> <span class="comment">// çŸ­ä¿¡æ¨¡æ¿ID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SmsServiceInterface çŸ­ä¿¡æœåŠ¡æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> SmsServiceInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">Send(ctx *Context) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ServiceProviderAliyun é˜¿é‡Œäº‘</span></span><br><span class="line"><span class="keyword">type</span> ServiceProviderAliyun <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send Send</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *ServiceProviderAliyun)</span> <span class="title">Send</span><span class="params">(ctx *Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ã€é˜¿é‡Œäº‘ã€‘çŸ­ä¿¡å‘é€æˆåŠŸï¼Œæ‰‹æœºå·:&quot;</span>+ctx.Tel)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ServiceProviderTencent è…¾è®¯äº‘</span></span><br><span class="line"><span class="keyword">type</span> ServiceProviderTencent <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send Send</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *ServiceProviderTencent)</span> <span class="title">Send</span><span class="params">(ctx *Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ã€è…¾è®¯äº‘ã€‘çŸ­ä¿¡å‘é€æˆåŠŸï¼Œæ‰‹æœºå·:&quot;</span>+ctx.Tel)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ServiceProviderYunpian äº‘ç‰‡</span></span><br><span class="line"><span class="keyword">type</span> ServiceProviderYunpian <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send Send</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *ServiceProviderYunpian)</span> <span class="title">Send</span><span class="params">(ctx *Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ã€äº‘ç‰‡ã€‘çŸ­ä¿¡å‘é€æˆåŠŸï¼Œæ‰‹æœºå·:&quot;</span>+ctx.Tel)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ­£åœ¨è¿è¡Œçš„å‡½æ•°å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runFuncName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">pc := <span class="built_in">make</span>([]<span class="keyword">uintptr</span>, <span class="number">1</span>)</span><br><span class="line">runtime.Callers(<span class="number">2</span>, pc)</span><br><span class="line">f := runtime.FuncForPC(pc[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> f.Name()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ProviderType çŸ­ä¿¡æœåŠ¡æä¾›å•†ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> ProviderType <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// ProviderTypeAliyun é˜¿é‡Œäº‘</span></span><br><span class="line">ProviderTypeAliyun ProviderType = <span class="string">&quot;aliyun&quot;</span></span><br><span class="line"><span class="comment">// ProviderTypeTencent è…¾è®¯äº‘</span></span><br><span class="line">ProviderTypeTencent ProviderType = <span class="string">&quot;tencent&quot;</span></span><br><span class="line"><span class="comment">// ProviderTypeYunpian äº‘ç‰‡</span></span><br><span class="line">ProviderTypeYunpian ProviderType = <span class="string">&quot;yunpian&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line"><span class="comment">// stateManagerInstance å½“å‰ä½¿ç”¨çš„æœåŠ¡æä¾›å•†å®ä¾‹</span></span><br><span class="line"><span class="comment">// é»˜è®¤aliyun</span></span><br><span class="line">stateManagerInstance *StateManager</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// StateManager çŠ¶æ€ç®¡ç†</span></span><br><span class="line"><span class="keyword">type</span> StateManager <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// CurrentProviderType å½“å‰ä½¿ç”¨çš„æœåŠ¡æä¾›å•†ç±»å‹</span></span><br><span class="line"><span class="comment">// é»˜è®¤aliyun</span></span><br><span class="line">currentProviderType ProviderType</span><br><span class="line"></span><br><span class="line"><span class="comment">// CurrentProvider å½“å‰ä½¿ç”¨çš„æœåŠ¡æä¾›å•†å®ä¾‹</span></span><br><span class="line"><span class="comment">// é»˜è®¤aliyun</span></span><br><span class="line">currentProvider SmsServiceInterface</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°çŠ¶æ€æ—¶é—´é—´éš”</span></span><br><span class="line">setStateDuration time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// initState åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *StateManager)</span> <span class="title">initState</span><span class="params">(duration time.Duration)</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">m.setStateDuration = duration</span><br><span class="line">m.setState(time.Now())</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šæ—¶å™¨æ›´æ–°çŠ¶æ€</span></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="comment">// æ¯ä¸€æ®µæ—¶é—´åæ ¹æ®å›è°ƒçš„å‘é€æˆåŠŸç‡ è®¡ç®—å¾—åˆ°å½“å‰åº”è¯¥ä½¿ç”¨çš„ å‚å•†</span></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> t := &lt;-time.NewTicker(m.setStateDuration).C:</span><br><span class="line">m.setState(t)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setState è®¾ç½®çŠ¶æ€</span></span><br><span class="line"><span class="comment">// æ ¹æ®çŸ­ä¿¡äº‘å•†å›è°ƒçš„çŸ­ä¿¡å‘é€æˆåŠŸç‡ å¾—åˆ°ä¸‹é˜¶æ®µå‘é€çŸ­ä¿¡ä½¿ç”¨å“ªä¸ªå‚å•†çš„æœåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *StateManager)</span> <span class="title">setState</span><span class="params">(t time.Time)</span></span> &#123;</span><br><span class="line"><span class="comment">// è¿™é‡Œç”¨éšæœºæ¨¡æ‹Ÿ</span></span><br><span class="line">ProviderTypeArray := [<span class="number">3</span>]ProviderType&#123;</span><br><span class="line">ProviderTypeAliyun,</span><br><span class="line">ProviderTypeTencent,</span><br><span class="line">ProviderTypeYunpian,</span><br><span class="line">&#125;</span><br><span class="line">m.currentProviderType = ProviderTypeArray[rand.Intn(<span class="built_in">len</span>(ProviderTypeArray))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> m.currentProviderType &#123;</span><br><span class="line"><span class="keyword">case</span> ProviderTypeAliyun:</span><br><span class="line">m.currentProvider = &amp;ServiceProviderAliyun&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> ProviderTypeTencent:</span><br><span class="line">m.currentProvider = &amp;ServiceProviderTencent&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> ProviderTypeYunpian:</span><br><span class="line">m.currentProvider = &amp;ServiceProviderYunpian&#123;&#125;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;æ— æ•ˆçš„çŸ­ä¿¡æœåŠ¡å•†&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;æ—¶é—´ï¼š%s| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: %s \n&quot;</span>, t.Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>), m.currentProviderType)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getState è·å–å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *StateManager)</span> <span class="title">getState</span><span class="params">()</span> <span class="title">SmsServiceInterface</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> m.currentProvider</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetState è·å–å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetState</span><span class="params">()</span> <span class="title">SmsServiceInterface</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> stateManagerInstance.getState()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–çŠ¶æ€ç®¡ç†</span></span><br><span class="line">stateManagerInstance = &amp;StateManager&#123;&#125;</span><br><span class="line">stateManagerInstance.initState(<span class="number">300</span> * time.Millisecond)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿå‘é€çŸ­ä¿¡çš„æ¥å£</span></span><br><span class="line">sendSms := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// å‘é€çŸ­ä¿¡</span></span><br><span class="line">GetState().Send(&amp;Context&#123;</span><br><span class="line">Tel:        <span class="string">&quot;+8613666666666&quot;</span>,</span><br><span class="line">Text:       <span class="string">&quot;3232&quot;</span>,</span><br><span class="line">TemplateID: <span class="string">&quot;TYSHK_01&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿç”¨æˆ·è°ƒç”¨å‘é€çŸ­ä¿¡çš„æ¥å£</span></span><br><span class="line">sendSms()</span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">sendSms()</span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">sendSms()</span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">sendSms()</span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">sendSms()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[Running] go run &quot;.&#x2F;easy-tips&#x2F;go&#x2F;src&#x2F;patterns&#x2F;state&#x2F;state.go&quot;</span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:37| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: yunpian </span><br><span class="line">main.(*ServiceProviderYunpian).Send ã€äº‘ç‰‡ã€‘çŸ­ä¿¡å‘é€æˆåŠŸï¼Œæ‰‹æœºå·:+8613666666666</span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:37| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: aliyun </span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:38| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: yunpian </span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:38| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: yunpian </span><br><span class="line">main.(*ServiceProviderYunpian).Send ã€äº‘ç‰‡ã€‘çŸ­ä¿¡å‘é€æˆåŠŸï¼Œæ‰‹æœºå·:+8613666666666</span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:38| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: tencent </span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:39| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: aliyun </span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:39| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: tencent </span><br><span class="line">main.(*ServiceProviderTencent).Send ã€è…¾è®¯äº‘ã€‘çŸ­ä¿¡å‘é€æˆåŠŸï¼Œæ‰‹æœºå·:+8613666666666</span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:39| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: yunpian </span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:40| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: tencent </span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:40| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: aliyun </span><br><span class="line">main.(*ServiceProviderAliyun).Send ã€é˜¿é‡Œäº‘ã€‘çŸ­ä¿¡å‘é€æˆåŠŸï¼Œæ‰‹æœºå·:+8613666666666</span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:40| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: yunpian </span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:40| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: tencent </span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:41| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: aliyun </span><br><span class="line">æ—¶é—´ï¼š2020-05-30 18:02:41| å˜æ›´çŸ­ä¿¡å‘é€å‚å•†ä¸º: yunpian </span><br><span class="line">main.(*ServiceProviderYunpian).Send ã€äº‘ç‰‡ã€‘çŸ­ä¿¡å‘é€æˆåŠŸï¼Œæ‰‹æœºå·:+8613666666666</span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ€åæ€»ç»“ä¸‹ï¼Œã€ŒçŠ¶æ€æ¨¡å¼ã€æŠ½è±¡è¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯ï¼š</p><ul><li>æ¯ä¸€ä¸ªçŠ¶æ€æ˜ å°„å¯¹åº”è¡Œä¸º</li><li>è¡Œä¸ºå®ç°åŒä¸€ä¸ªæ¥å£<code>interface</code></li><li>è¡Œä¸ºæ˜¯å†…éƒ¨çš„ä¸€ä¸ªçŠ¶æ€</li><li>çŠ¶æ€æ˜¯ä¸æ–­å˜åŒ–çš„</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹åˆ«è¯´æ˜ï¼š</span><br><span class="line">1. æˆ‘çš„ä»£ç æ²¡æœ‰&#96;else&#96;ï¼Œåªæ˜¯ä¸€ä¸ªåœ¨ä»£ç åˆç†è®¾è®¡çš„æƒ…å†µä¸‹è‡ªç„¶è€Œç„¶æ— é™æ¥è¿‘æˆ–è€…è¾¾åˆ°çš„ç»“æœï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç¡¬æ€§çš„ç›®æ ‡ï¼ŒåŠ¡å¿…è¾ƒçœŸã€‚</span><br><span class="line">2. æœ¬ç³»åˆ—çš„ä¸€äº›è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µå¯èƒ½å’ŒåŸæ¦‚å¿µå­˜åœ¨å·®å¼‚ï¼Œå› ä¸ºä¼šç»“åˆå®é™…ä½¿ç”¨ï¼Œå–å…¶ç²¾åï¼Œé€‚å½“æ”¹å˜ï¼Œçµæ´»ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure><h1 id="æ–‡ç« åˆ—è¡¨"><a href="#æ–‡ç« åˆ—è¡¨" class="headerlink" title="æ–‡ç« åˆ—è¡¨"></a>æ–‡ç« åˆ—è¡¨</h1><ul><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/template">ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/responsibility">é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/observer">è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/strategy">å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/state">çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li></ul><blockquote><p><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns">Goè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ— æ›´å¤šæ–‡ç«  ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;çŠ¶æ€å˜æ¢-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;a href=&quot;#çŠ¶æ€å˜æ¢-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot; class=&quot;headerlink&quot; title=&quot;çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;/a&gt;çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜</title>
    <link href="http://wangyangyangisme.github.io/posts/aee36e49/"/>
    <id>http://wangyangyangisme.github.io/posts/aee36e49/</id>
    <published>2021-05-16T06:31:00.000Z</published>
    <updated>2021-05-16T06:31:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®¢æˆ·å†³ç­–-Goè®¾è®¡æ¨¡å¼å®æˆ˜"><a href="#å®¢æˆ·å†³ç­–-Goè®¾è®¡æ¨¡å¼å®æˆ˜" class="headerlink" title="å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜"></a>å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜</h1><blockquote><p>å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ—ï¼Œä¸€ä¸ªè®¾è®¡æ¨¡å¼ä¸šåŠ¡çœŸå®ä½¿ç”¨çš„golangç³»åˆ—ã€‚</p><p><a href="http://tigerb.cn/">http://tigerb.cn/</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç³»åˆ—ä¸»è¦åˆ†äº«ï¼Œå¦‚ä½•åœ¨æˆ‘ä»¬çš„çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨è®¾è®¡æ¨¡å¼ã€‚</p><p>æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦é‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š</p><ul><li>ä»€ä¹ˆæ˜¯ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ä½¿ç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>æ€ä¹ˆç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li></ul><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ã€Œç­–ç•¥æ¨¡å¼ã€å¦‚ä½•åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ</h2><p>ã€Œç­–ç•¥æ¨¡å¼ã€æ¯”è¾ƒç®€å•ï¼Œå¤§å®¶å¹³å¸¸å·¥ä½œä¸­åº”è¯¥ç»å¸¸ä½¿ç”¨åˆ°ï¼Œæ‰€ä»¥æœ¬æ–‡ä½œä¸ºå¤ä¹ ï¼Œå¸®åŠ©å¤§å®¶æ¸©æ•…çŸ¥æ–°ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å®šä¹‰ï¼š</p><blockquote><p>ä¸åŒçš„ç®—æ³•æŒ‰ç…§ç»Ÿä¸€çš„æ ‡å‡†å°è£…ï¼Œå®¢æˆ·ç«¯æ ¹æ®ä¸åŒçš„åœºæ™¯ï¼Œå†³ç­–ä½¿ç”¨ä½•ç§ç®—æ³•ã€‚</p></blockquote><p>ä¸Šé¢çš„æ¦‚å¿µçš„å…³é”®è¯ï¼š</p><ul><li>ç®—æ³•ï¼šå°±æ˜¯è¡Œä¸º</li><li>æ ‡å‡†ï¼šå°±æ˜¯interface</li><li>å®¢æˆ·ç«¯ï¼šå®¢æˆ·ç«¯æ˜¯ç›¸å¯¹çš„ï¼Œè°è°ƒç”¨è°å°±æ˜¯å®¢æˆ·ç«¯</li><li>åœºæ™¯ï¼šåˆ¤æ–­æ¡ä»¶</li><li>å†³ç­–ï¼šåˆ¤æ–­çš„è¿‡ç¨‹</li></ul><p>æ¦‚å¿µå¾ˆå®¹æ˜“ç†è§£ï¼Œä¸å¤šè¯´ã€‚</p><p>ã€Œç­–ç•¥æ¨¡å¼ã€çš„ä¼˜åŠ¿ï¼š</p><ul><li>å…¸å‹çš„é«˜å†…èšï¼šç®—æ³•å’Œç®—æ³•ä¹‹é—´å®Œå…¨ç‹¬ç«‹ã€äº’ä¸å¹²æ‰°</li><li>å…¸å‹çš„æ¾è€¦åˆï¼šå®¢æˆ·ç«¯ä¾èµ–çš„æ˜¯æ¥å£çš„æŠ½è±¡æ–¹æ³•</li><li>æ²‰æ·€ï¼šæ¯ä¸€ä¸ªå°è£…å¥½çš„ç®—æ³•éƒ½æ˜¯è¿™ä¸ªæŠ€æœ¯å›¢é˜Ÿçš„è´¢å¯Œï¼Œä¸”æœªæ¥å¯ä»¥è¢«è½»æ˜“çš„ä¿®æ”¹ã€å¤ç”¨</li></ul><h2 id="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ</h2><blockquote><p>æ¯ä¸€è¡Œä»£ç ä¸‹é¢çš„åå­—è·¯å£</p></blockquote><p>å½“ä»£ç çš„ä¸‹ä¸€æ­¥é¢ä¸´é€‰æ‹©çš„æ—¶å€™éƒ½å¯ä»¥ä½¿ç”¨ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Œæˆ‘ä»¬æŠŠä¸åŒé€‰æ‹©çš„ç®—æ³•æŒ‰ç…§ç»Ÿä¸€çš„æ ‡å‡†å°è£…ï¼Œå¾—åˆ°ä¸€ç±»ç®—æ³•é›†çš„è¿‡ç¨‹ï¼Œå°±æ˜¯å®ç°ã€Œç­–ç•¥æ¨¡å¼ã€çš„è¿‡ç¨‹ã€‚</p><blockquote><p>æˆ‘ä»¬æœ‰å“ªäº›çœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç­–ç•¥æ¨¡å¼ã€å‘¢ï¼Ÿ</p></blockquote><p>æ¯”å¦‚ï¼š</p><ul><li>ç¼“å­˜: ä½¿ç”¨ä»€ä¹ˆæ ·çš„nosql</li><li>å­˜å‚¨: ä½¿ç”¨ä»€ä¹ˆæ ·çš„DB</li><li>æ”¯ä»˜: ä½¿ç”¨ä»€ä¹ˆæ ·çš„æ”¯ä»˜æ–¹å¼</li><li>ç­‰ç­‰... </li></ul><p>æœ¬æ–‡ä»¥<strong>æ”¯ä»˜æ¥å£</strong>ä¸¾ä¾‹ï¼Œè¯´æ˜ã€Œç­–ç•¥æ¨¡å¼ã€çš„å…·ä½“ä½¿ç”¨ã€‚</p><h2 id="æ€ä¹ˆç”¨ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ"><a href="#æ€ä¹ˆç”¨ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="æ€ä¹ˆç”¨ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ"></a>æ€ä¹ˆç”¨ã€Œç­–ç•¥æ¨¡å¼ã€ï¼Ÿ</h2><p>å…³äºæ€ä¹ˆç”¨ï¼Œå®Œå…¨å¯ä»¥ç”Ÿæ¬ç¡¬å¥—æˆ‘æ€»ç»“çš„ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä¸šåŠ¡æ¢³ç†</li><li>ä¸šåŠ¡æµç¨‹å›¾</li><li>ä»£ç å»ºæ¨¡</li><li>ä»£ç demo</li></ul><h4 id="ä¸šåŠ¡æ¢³ç†"><a href="#ä¸šåŠ¡æ¢³ç†" class="headerlink" title="ä¸šåŠ¡æ¢³ç†"></a>ä¸šåŠ¡æ¢³ç†</h4><p>æˆ‘ä»¬ä»¥æŸå›¢çš„è®¢å•æ”¯ä»˜é¡µé¢ä¸ºä¾‹ï¼Œé¡µé¢ä¸Šçš„æ¯ä¸€ä¸ªæ”¯ä»˜é€‰é¡¹éƒ½æ˜¯ä¸€ä¸ªæ”¯ä»˜ç­–ç•¥ã€‚å¦‚ä¸‹ï¼š</p><p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ï¼š</p><ul><li>ç¾å›¢æ”¯ä»˜(ç­–ç•¥)</li><li>å¾®ä¿¡æ”¯ä»˜(ç­–ç•¥)</li><li>æ”¯ä»˜å®æ”¯ä»˜(ç­–ç•¥)</li></ul><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200424131625.png" style="width:50%"></p><p>ç”¨æˆ·å†³å®šä½¿ç”¨ç¾å›¢æ”¯ä»˜ä¸‹çš„é“¶è¡Œå¡æ”¯ä»˜æ–¹å¼çš„å‚æ•°</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200424132214.png" style="width:50%"></p><p>ç”¨æˆ·å†³å®šä½¿ç”¨æ”¯ä»˜å®ç½‘é¡µç‰ˆæ”¯ä»˜æ–¹å¼çš„å‚æ•°</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200424132232.png" style="width:50%"></p><blockquote><p>æ³¨ï¼šä¸ä¸€å®šå®Œå…¨å‡†ç¡®ã€‚</p></blockquote><h4 id="ä¸šåŠ¡æµç¨‹å›¾"><a href="#ä¸šåŠ¡æµç¨‹å›¾" class="headerlink" title="ä¸šåŠ¡æµç¨‹å›¾"></a>ä¸šåŠ¡æµç¨‹å›¾</h4><p>æˆ‘ä»¬é€šè¿‡æ¢³ç†çš„æ–‡æœ¬ä¸šåŠ¡æµç¨‹å¾—åˆ°äº†å¦‚ä¸‹çš„ä¸šåŠ¡æµç¨‹å›¾ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200425192752.png" style="width:100%"></p><blockquote><p>æ³¨ï¼šæµç¨‹ä¸ä¸€å®šå®Œå…¨å‡†ç¡®ã€‚</p></blockquote><h4 id="ä»£ç å»ºæ¨¡"><a href="#ä»£ç å»ºæ¨¡" class="headerlink" title="ä»£ç å»ºæ¨¡"></a>ä»£ç å»ºæ¨¡</h4><p>ã€Œç­–ç•¥æ¨¡å¼ã€çš„æ ¸å¿ƒæ˜¯æ¥å£ï¼š</p><ul><li><code>PaymentInterface</code><ul><li><code>Pay(ctx *Context) error</code> å½“å‰æ”¯ä»˜æ–¹å¼çš„æ”¯ä»˜é€»è¾‘</li><li><code>Refund(ctx *Context) error</code> å½“å‰æ”¯ä»˜æ–¹å¼çš„é€€æ¬¾é€»è¾‘</li></ul></li></ul><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å®šä¹‰ä¸€ä¸ªæ”¯ä»˜æ¥å£</span><br><span class="line">- &#96;PaymentInterface&#96;</span><br><span class="line">    + æŠ½è±¡æ–¹æ³•&#96;Pay(ctx *Context) error&#96;: å½“å‰æ”¯ä»˜æ–¹å¼çš„æ”¯ä»˜é€»è¾‘</span><br><span class="line">+ æŠ½è±¡æ–¹æ³•&#96;Refund(ctx *Context) error&#96;: å½“å‰æ”¯ä»˜æ–¹å¼çš„é€€æ¬¾é€»è¾‘</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å®šä¹‰å…·ä½“çš„æ”¯ä»˜æ–¹å¼ å®ç°æ¥å£&#96;PaymentInterface&#96;</span><br><span class="line"></span><br><span class="line">- å…·ä½“çš„å¾®ä¿¡æ”¯ä»˜æ–¹å¼&#96;WechatPay&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Pay&#96;: æ”¯ä»˜é€»è¾‘</span><br><span class="line">+  å®ç°æ–¹æ³•&#96;Refund&#96;: æ”¯ä»˜é€»è¾‘</span><br><span class="line">- å…·ä½“çš„æ”¯ä»˜å®æ”¯ä»˜ç½‘é¡µç‰ˆæ–¹å¼&#96;AliPayWap&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Pay&#96;: æ”¯ä»˜é€»è¾‘</span><br><span class="line">+  å®ç°æ–¹æ³•&#96;Refund&#96;: æ”¯ä»˜é€»è¾‘</span><br><span class="line">- å…·ä½“çš„æ”¯ä»˜å®æ”¯ä»˜ç½‘é¡µç‰ˆæ–¹å¼&#96;BankPay&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Pay&#96;: æ”¯ä»˜é€»è¾‘</span><br><span class="line">+  å®ç°æ–¹æ³•&#96;Refund&#96;: æ”¯ä»˜é€»è¾‘</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å®¢æˆ·ç«¯ä»£ç </span><br><span class="line">é€šè¿‡æ¥å£å‚æ•°pay_typeçš„å€¼åˆ¤æ–­æ˜¯å“ªç§æ”¯ä»˜æ–¹å¼ç­–ç•¥</span><br></pre></td></tr></table></figure><p>åŒæ—¶å¾—åˆ°äº†æˆ‘ä»¬çš„UMLå›¾ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200425151733.jpg" style="width:100%"></p><h4 id="ä»£ç demo"><a href="#ä»£ç demo" class="headerlink" title="ä»£ç demo"></a>ä»£ç demo</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//ç­–ç•¥æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// ConstWechatPay å¾®ä¿¡æ”¯ä»˜</span></span><br><span class="line">ConstWechatPay = <span class="string">&quot;wechat_pay&quot;</span></span><br><span class="line"><span class="comment">// ConstAliPayWap æ”¯ä»˜å®æ”¯ä»˜ ç½‘é¡µç‰ˆ</span></span><br><span class="line">ConstAliPayWap = <span class="string">&quot;AliPayWapwap&quot;</span></span><br><span class="line"><span class="comment">// ConstBankPay é“¶è¡Œå¡æ”¯ä»˜</span></span><br><span class="line">ConstBankPay = <span class="string">&quot;quickbank&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// ç”¨æˆ·é€‰æ‹©çš„æ”¯ä»˜æ–¹å¼</span></span><br><span class="line">PayType <span class="keyword">string</span> <span class="string">`json:&quot;pay_type&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PaymentInterface æ”¯ä»˜æ–¹å¼æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> PaymentInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">Pay(ctx *Context) error    <span class="comment">// æ”¯ä»˜</span></span><br><span class="line">Refund(ctx *Context) error <span class="comment">// é€€æ¬¾</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WechatPay å¾®ä¿¡æ”¯ä»˜</span></span><br><span class="line"><span class="keyword">type</span> WechatPay <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pay å½“å‰æ”¯ä»˜æ–¹å¼çš„æ”¯ä»˜é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *WechatPay)</span> <span class="title">Pay</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç­–ç•¥çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Refund å½“å‰æ”¯ä»˜æ–¹å¼çš„æ”¯ä»˜é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *WechatPay)</span> <span class="title">Refund</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç­–ç•¥çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä½¿ç”¨å¾®ä¿¡é€€æ¬¾...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AliPayWap æ”¯ä»˜å®ç½‘é¡µç‰ˆ</span></span><br><span class="line"><span class="keyword">type</span> AliPayWap <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pay å½“å‰æ”¯ä»˜æ–¹å¼çš„æ”¯ä»˜é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *AliPayWap)</span> <span class="title">Pay</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç­–ç•¥çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä½¿ç”¨æ”¯ä»˜å®ç½‘é¡µç‰ˆæ”¯ä»˜...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Refund å½“å‰æ”¯ä»˜æ–¹å¼çš„æ”¯ä»˜é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *AliPayWap)</span> <span class="title">Refund</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç­–ç•¥çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä½¿ç”¨æ”¯ä»˜å®ç½‘é¡µç‰ˆé€€æ¬¾...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BankPay é“¶è¡Œå¡æ”¯ä»˜</span></span><br><span class="line"><span class="keyword">type</span> BankPay <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pay å½“å‰æ”¯ä»˜æ–¹å¼çš„æ”¯ä»˜é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *BankPay)</span> <span class="title">Pay</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç­–ç•¥çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä½¿ç”¨é“¶è¡Œå¡æ”¯ä»˜...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Refund å½“å‰æ”¯ä»˜æ–¹å¼çš„æ”¯ä»˜é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *BankPay)</span> <span class="title">Refund</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç­–ç•¥çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä½¿ç”¨é“¶è¡Œå¡é€€æ¬¾...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ­£åœ¨è¿è¡Œçš„å‡½æ•°å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runFuncName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">pc := <span class="built_in">make</span>([]<span class="keyword">uintptr</span>, <span class="number">1</span>)</span><br><span class="line">runtime.Callers(<span class="number">2</span>, pc)</span><br><span class="line">f := runtime.FuncForPC(pc[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> f.Name()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// ç›¸å¯¹äºè¢«è°ƒç”¨çš„æ”¯ä»˜ç­–ç•¥ è¿™é‡Œå°±æ˜¯æ”¯ä»˜ç­–ç•¥çš„å®¢æˆ·ç«¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸šåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line">ctx := &amp;Context&#123;</span><br><span class="line">PayType: <span class="string">&quot;wechat_pay&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ”¯ä»˜æ–¹å¼</span></span><br><span class="line"><span class="keyword">var</span> instance PaymentInterface</span><br><span class="line"><span class="keyword">switch</span> ctx.PayType &#123;</span><br><span class="line"><span class="keyword">case</span> ConstWechatPay:</span><br><span class="line">instance = &amp;WechatPay&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> ConstAliPayWap:</span><br><span class="line">instance = &amp;AliPayWap&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> ConstBankPay:</span><br><span class="line">instance = &amp;BankPay&#123;&#125;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;æ— æ•ˆçš„æ”¯ä»˜æ–¹å¼&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¯ä»˜</span></span><br><span class="line">instance.Pay(ctx)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Running] go run &quot;..&#x2F;easy-tips&#x2F;go&#x2F;src&#x2F;patterns&#x2F;strategy&#x2F;strategy.go&quot;</span><br><span class="line">main.(*WechatPay).Pay ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜...</span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ€åæ€»ç»“ä¸‹ï¼Œã€Œç­–ç•¥æ¨¡å¼ã€æŠ½è±¡è¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯ï¼š</p><p>åœ¨<code>æ¯ä¸€è¡Œä»£ç ä¸‹é¢çš„åå­—è·¯å£</code></p><ul><li>å£°æ˜æ ‡å‡†ï¼šå®šä¹‰<code>interface</code></li><li>å°è£…ç®—æ³•ï¼šæŒ‰ç…§æ ‡å‡†<code>interface</code>å°è£…åˆ†æ”¯ä»£ç ï¼Œå¾—åˆ°æ¯ä¸€ä¸ªå…·ä½“ç­–ç•¥</li><li>æ„å»ºç®—æ³•é›†ï¼šæ¯ä¸€ä¸ªå…·ä½“ç­–ç•¥æ„æˆç­–ç•¥æ± å­ -&gt; è¿™å°±æ˜¯æ²‰æ·€çš„è¿‡ç¨‹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹åˆ«è¯´æ˜ï¼š</span><br><span class="line">1. æˆ‘çš„ä»£ç æ²¡æœ‰&#96;else&#96;ï¼Œåªæ˜¯ä¸€ä¸ªåœ¨ä»£ç åˆç†è®¾è®¡çš„æƒ…å†µä¸‹è‡ªç„¶è€Œç„¶æ— é™æ¥è¿‘æˆ–è€…è¾¾åˆ°çš„ç»“æœï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç¡¬æ€§çš„ç›®æ ‡ï¼ŒåŠ¡å¿…è¾ƒçœŸã€‚</span><br><span class="line">2. æœ¬ç³»åˆ—çš„ä¸€äº›è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µå¯èƒ½å’ŒåŸæ¦‚å¿µå­˜åœ¨å·®å¼‚ï¼Œå› ä¸ºä¼šç»“åˆå®é™…ä½¿ç”¨ï¼Œå–å…¶ç²¾åï¼Œé€‚å½“æ”¹å˜ï¼Œçµæ´»ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure><h1 id="æ–‡ç« åˆ—è¡¨"><a href="#æ–‡ç« åˆ—è¡¨" class="headerlink" title="æ–‡ç« åˆ—è¡¨"></a>æ–‡ç« åˆ—è¡¨</h1><ul><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/template">ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/responsibility">é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/observer">è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/strategy">å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/state">çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li></ul><blockquote><p><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns">Goè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ— æ›´å¤šæ–‡ç«  ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å®¢æˆ·å†³ç­–-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;a href=&quot;#å®¢æˆ·å†³ç­–-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot; class=&quot;headerlink&quot; title=&quot;å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;/a&gt;å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</title>
    <link href="http://wangyangyangisme.github.io/posts/32bdf73d/"/>
    <id>http://wangyangyangisme.github.io/posts/32bdf73d/</id>
    <published>2021-05-16T06:30:59.000Z</published>
    <updated>2021-05-16T06:30:59.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è®¢é˜…é€šçŸ¥-Goè®¾è®¡æ¨¡å¼å®æˆ˜"><a href="#è®¢é˜…é€šçŸ¥-Goè®¾è®¡æ¨¡å¼å®æˆ˜" class="headerlink" title="è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜"></a>è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</h1><blockquote><p>å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ—ï¼Œä¸€ä¸ªè®¾è®¡æ¨¡å¼ä¸šåŠ¡çœŸå®ä½¿ç”¨çš„golangç³»åˆ—ã€‚</p><p><a href="http://tigerb.cn/">http://tigerb.cn/</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç³»åˆ—ä¸»è¦åˆ†äº«ï¼Œå¦‚ä½•åœ¨æˆ‘ä»¬çš„çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨è®¾è®¡æ¨¡å¼ã€‚</p><p>æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦é‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š</p><ul><li>ä»€ä¹ˆæ˜¯ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ä½¿ç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>æ€ä¹ˆç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li></ul><p>è™½ç„¶æœ¬æ–‡çš„é¢˜ç›®å«åšâ€œè®¢é˜…é€šçŸ¥â€ï¼Œä½†æ˜¯å‘¢ï¼Œæœ¬æ–‡å´ä¸»è¦ä»‹ç»ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€å¦‚ä½•åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨ã€‚æ˜¯ä¸æ˜¯æœ‰äº›ä¸ç†è§£ï¼Ÿè§£é‡Šä¸‹ï¼š</p><ul><li>åŸå› ä¸€ï¼Œã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€å…¶å®çœ‹èµ·æ¥åƒâ€œè®¢é˜…é€šçŸ¥â€</li><li>åŸå› äºŒï¼Œâ€œè®¢é˜…é€šçŸ¥â€æ›´å®¹æ˜“è¢«ç†è§£</li></ul><h2 id="ä»€ä¹ˆæ˜¯ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ</h2><blockquote><p>è§‚å¯Ÿè€…è§‚å¯Ÿè¢«è§‚å¯Ÿè€…ï¼Œè¢«è§‚å¯Ÿè€…é€šçŸ¥è§‚å¯Ÿè€…</p></blockquote><p>æˆ‘ä»¬ç”¨â€œè®¢é˜…é€šçŸ¥â€ç¿»è¯‘ä¸‹ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€çš„æ¦‚å¿µï¼Œç»“æœï¼š</p><blockquote><p>â€œè®¢é˜…è€…è®¢é˜…ä¸»é¢˜ï¼Œä¸»é¢˜é€šçŸ¥è®¢é˜…è€…â€</p></blockquote><p>æ˜¯ä¸æ˜¯å®¹æ˜“ç†è§£å¤šäº†ï¼Œæˆ‘ä»¬å†æ¥æ‹†è§£ä¸‹è¿™å¥è¯ï¼Œå¾—åˆ°ï¼š</p><ul><li>ä¸¤ä¸ªå¯¹è±¡<ul><li>è¢«è§‚å¯Ÿè€… -&gt; ä¸»é¢˜</li><li>è§‚å¯Ÿè€… -&gt; è®¢é˜…è€…</li></ul></li><li>ä¸¤ä¸ªåŠ¨ä½œ<ul><li>è®¢é˜… -&gt; è®¢é˜…è€…<strong>è®¢é˜…</strong>ä¸»é¢˜</li><li>é€šçŸ¥ -&gt; ä¸»é¢˜å‘ç”Ÿå˜åŠ¨<strong>é€šçŸ¥</strong>è®¢é˜…è€…</li></ul></li></ul><p>è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜åŠ¿ï¼š</p><ul><li>é«˜å†…èš -&gt; ä¸åŒä¸šåŠ¡ä»£ç å˜åŠ¨äº’ä¸å½±å“</li><li>å¯å¤ç”¨ -&gt; æ–°çš„ä¸šåŠ¡(å°±æ˜¯æ–°çš„è®¢é˜…è€…)è®¢é˜…ä¸åŒæ¥å£(ä¸»é¢˜ï¼Œå°±æ˜¯è¿™é‡Œçš„æ¥å£)</li><li>ææ˜“æ‰©å±• -&gt; æ–°å¢æ¥å£(å°±æ˜¯æ–°å¢ä¸»é¢˜)ï¼›æ–°å¢ä¸šåŠ¡(å°±æ˜¯æ–°å¢è®¢é˜…è€…)ï¼›</li></ul><p>å…¶å®è¯´ç™½äº†ï¼Œå°±æ˜¯åˆ†å¸ƒå¼æ¶æ„ä¸­ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶MQè§£è€¦ä¸šåŠ¡çš„ä¼˜åŠ¿ï¼Œæ˜¯ä¸æ˜¯è¿™ä¹ˆä¸€æƒ³å¾ˆå®¹æ˜“ç†è§£äº†ã€‚</p><h2 id="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ</h2><blockquote><p>æ‰€æœ‰å‘ç”Ÿå˜æ›´ï¼Œéœ€è¦é€šçŸ¥çš„ä¸šåŠ¡åœºæ™¯</p></blockquote><p>è¯¦ç»†è¯´ï¼šåªè¦å‘ç”Ÿäº†æŸäº›å˜åŒ–ï¼Œéœ€è¦é€šçŸ¥ä¾èµ–äº†è¿™äº›å˜åŒ–çš„å…·ä½“äº‹ç‰©çš„ä¸šåŠ¡åœºæ™¯ã€‚</p><blockquote><p>æˆ‘ä»¬æœ‰å“ªäº›çœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€å‘¢ï¼Ÿ</p></blockquote><p>æ¯”å¦‚ï¼Œè®¢å•é€†å‘æµï¼Œä¹Ÿå°±æ˜¯è®¢å•æˆç«‹ä¹‹åçš„å„ç§å–æ¶ˆæ“ä½œ(æœ¬æ–‡ä¸è®¨è®ºå”®å)ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å–æ¶ˆç±»å‹ï¼š</p><table><thead><tr><th>è®¢å•å–æ¶ˆç±»å‹</th></tr></thead><tbody><tr><td>æœªæ”¯ä»˜å–æ¶ˆè®¢å•</td></tr><tr><td>è¶…æ—¶å…³å•</td></tr><tr><td>å·²æ”¯ä»˜å–æ¶ˆè®¢å•</td></tr><tr><td>å–æ¶ˆå‘è´§å•</td></tr><tr><td>æ‹’æ”¶</td></tr></tbody></table><p>åœ¨è§¦å‘è¿™äº›<strong>å–æ¶ˆæ“ä½œ</strong>éƒ½è¦è¿›è¡Œå„ç§å„æ ·çš„å­æ“ä½œï¼Œæ˜¾è€Œæ˜“è§ä¸åŒçš„<strong>å–æ¶ˆæ“ä½œ</strong>æ‰€æ¶‰åŠçš„å­æ“ä½œæ˜¯å­˜åœ¨äº¤é›†çš„ã€‚å…¶æ¬¡ï¼Œå·²æ”¯ä»˜å–æ¶ˆè®¢å•çš„å­æ“ä½œåº”è¯¥æ˜¯æ‰€æœ‰è®¢å•å–æ¶ˆç±»å‹æœ€å…¨çš„ï¼Œå…¶ä»–ç±»å‹çš„å¤ç”¨ä»£ç å³å¯ï¼Œé™¤äº†åˆ†è£…æˆå‡½æ•°ç‰‡æ®µï¼Œè¿˜æœ‰ä»€ä¹ˆæ›´å¥½çš„å°è£…æ–¹å¼å—ï¼Ÿç­”æ¡ˆï¼šã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ã€‚</p><p>æ¥ç€æˆ‘ä»¬æ¥åˆ†æä¸‹è®¢å•é€†å‘æµä¸šåŠ¡ä¸­çš„<strong>å˜</strong>ä¸<strong>ä¸å˜</strong>ï¼š</p><ul><li>å˜<ul><li>æ–°å¢å–æ¶ˆç±»å‹</li><li>æ–°å¢å­æ“ä½œ</li><li>ä¿®æ”¹æŸä¸ªå­æ“ä½œçš„é€»è¾‘</li><li>å–æ¶ˆç±»å‹å’Œå­æ“ä½œçš„å¯¹åº”å…³ç³»</li></ul></li><li>ä¸å˜<ul><li>å·²å­˜åœ¨çš„å–æ¶ˆç±»å‹</li><li>å·²å­˜åœ¨çš„å­æ“ä½œ(åœ¨å¤–ç•Œçœ‹æ¥)</li></ul></li></ul><h2 id="æ€ä¹ˆç”¨ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ"><a href="#æ€ä¹ˆç”¨ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="æ€ä¹ˆç”¨ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ"></a>æ€ä¹ˆç”¨ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Ÿ</h2><p>å…³äºæ€ä¹ˆç”¨ï¼Œå®Œå…¨å¯ä»¥ç”Ÿæ¬ç¡¬å¥—æˆ‘æ€»ç»“çš„ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä¸šåŠ¡æ¢³ç†</li><li>ä¸šåŠ¡æµç¨‹å›¾</li><li>ä»£ç å»ºæ¨¡</li><li>ä»£ç demo</li></ul><h4 id="ä¸šåŠ¡æ¢³ç†"><a href="#ä¸šåŠ¡æ¢³ç†" class="headerlink" title="ä¸šåŠ¡æ¢³ç†"></a>ä¸šåŠ¡æ¢³ç†</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ³¨ï¼šæœ¬æ–‡äºå•ä½“æ¶æ„èƒŒæ™¯æ¢è®¨ä¸šåŠ¡çš„å®ç°è¿‡ç¨‹ï¼Œç®€å•å®¹æ˜“ç†è§£ã€‚</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥ï¼Œæ¢³ç†å‡ºæ‰€æœ‰å­˜åœ¨çš„çš„é€†å‘ä¸šåŠ¡çš„å­æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ‰€æœ‰å­æ“ä½œ</th></tr></thead><tbody><tr><td>ä¿®æ”¹è®¢å•çŠ¶æ€</td></tr><tr><td>è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—</td></tr><tr><td>é€€ä¼˜æƒ åˆ¸</td></tr><tr><td>è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼</td></tr><tr><td>è¿˜åº“å­˜</td></tr><tr><td>è¿˜ç¤¼å“å¡</td></tr><tr><td>é€€é’±åŒ…ä½™é¢</td></tr><tr><td>ä¿®æ”¹å‘è´§å•çŠ¶æ€</td></tr><tr><td>è®°å½•å‘è´§å•çŠ¶æ€å˜æ›´æ—¥å¿—</td></tr><tr><td>ç”Ÿæˆé€€æ¬¾å•</td></tr><tr><td>ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨</td></tr><tr><td>å‘é‚®ä»¶</td></tr><tr><td>å‘çŸ­ä¿¡</td></tr><tr><td>å‘å¾®ä¿¡æ¶ˆæ¯</td></tr></tbody></table><p>ç¬¬äºŒæ­¥ï¼Œæ‰¾åˆ°ä¸åŒè®¢å•å–æ¶ˆç±»å‹å’Œè¿™äº›å­æ“ä½œçš„å…³ç³»ï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th>è®¢å•å–æ¶ˆç±»å‹(â€œä¸»é¢˜â€)(è¢«è§‚å¯Ÿè€…)</th><th>å­æ“ä½œ(â€œè®¢é˜…è€…â€)(è§‚å¯Ÿè€…)</th></tr></thead><tbody><tr><td>å–æ¶ˆæœªæ”¯ä»˜è®¢å•</td><td>-</td></tr><tr><td>-</td><td>ä¿®æ”¹è®¢å•çŠ¶æ€</td></tr><tr><td>-</td><td>è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—</td></tr><tr><td>-</td><td>é€€ä¼˜æƒ åˆ¸</td></tr><tr><td>-</td><td>è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼</td></tr><tr><td>-</td><td>è¿˜åº“å­˜</td></tr><tr><td>è¶…æ—¶å…³å•</td><td>-</td></tr><tr><td>-</td><td>ä¿®æ”¹è®¢å•çŠ¶æ€</td></tr><tr><td>-</td><td>è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—</td></tr><tr><td>-</td><td>é€€ä¼˜æƒ åˆ¸</td></tr><tr><td>-</td><td>è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼</td></tr><tr><td>-</td><td>è¿˜åº“å­˜</td></tr><tr><td>-</td><td>å‘é‚®ä»¶</td></tr><tr><td>-</td><td>å‘çŸ­ä¿¡</td></tr><tr><td>-</td><td>å‘å¾®ä¿¡æ¶ˆæ¯</td></tr><tr><td>å·²æ”¯ä»˜å–æ¶ˆè®¢å•(æœªç”Ÿæˆå‘è´§å•)</td><td>-</td></tr><tr><td>-</td><td>ä¿®æ”¹è®¢å•çŠ¶æ€</td></tr><tr><td>-</td><td>è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—</td></tr><tr><td>-</td><td>è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼(çœ‹æƒ…å†µ)</td></tr><tr><td>-</td><td>è¿˜åº“å­˜</td></tr><tr><td>-</td><td>è¿˜ç¤¼å“å¡</td></tr><tr><td>-</td><td>é€€é’±åŒ…ä½™é¢</td></tr><tr><td>-</td><td>ç”Ÿæˆé€€æ¬¾å•</td></tr><tr><td>-</td><td>ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨</td></tr><tr><td>-</td><td>å‘é‚®ä»¶</td></tr><tr><td>-</td><td>å‘çŸ­ä¿¡</td></tr><tr><td>-</td><td>å‘å¾®ä¿¡æ¶ˆæ¯</td></tr><tr><td>å–æ¶ˆå‘è´§å•(æœªå‘è´§)</td><td>-</td></tr><tr><td>-</td><td>ä¿®æ”¹è®¢å•çŠ¶æ€</td></tr><tr><td>-</td><td>è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—</td></tr><tr><td>-</td><td>ä¿®æ”¹å‘è´§å•çŠ¶æ€</td></tr><tr><td>-</td><td>è®°å½•å‘è´§å•çŠ¶æ€å˜æ›´æ—¥å¿—</td></tr><tr><td>-</td><td>è¿˜åº“å­˜</td></tr><tr><td>-</td><td>è¿˜ç¤¼å“å¡</td></tr><tr><td>-</td><td>é€€é’±åŒ…ä½™é¢</td></tr><tr><td>-</td><td>ç”Ÿæˆé€€æ¬¾å•</td></tr><tr><td>-</td><td>ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨</td></tr><tr><td>-</td><td>å‘é‚®ä»¶</td></tr><tr><td>-</td><td>å‘çŸ­ä¿¡</td></tr><tr><td>-</td><td>å‘å¾®ä¿¡æ¶ˆæ¯</td></tr><tr><td>æ‹’æ”¶</td><td>-</td></tr><tr><td>-</td><td>ä¿®æ”¹è®¢å•çŠ¶æ€</td></tr><tr><td>-</td><td>è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—</td></tr><tr><td>-</td><td>ä¿®æ”¹å‘è´§å•çŠ¶æ€</td></tr><tr><td>-</td><td>è®°å½•å‘è´§å•çŠ¶æ€å˜æ›´æ—¥å¿—</td></tr><tr><td>-</td><td>è¿˜åº“å­˜</td></tr><tr><td>-</td><td>è¿˜ç¤¼å“å¡</td></tr><tr><td>-</td><td>é€€é’±åŒ…ä½™é¢</td></tr><tr><td>-</td><td>ç”Ÿæˆé€€æ¬¾å•</td></tr><tr><td>-</td><td>ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨</td></tr><tr><td>-</td><td>å‘é‚®ä»¶</td></tr><tr><td>-</td><td>å‘çŸ­ä¿¡</td></tr><tr><td>-</td><td>å‘å¾®ä¿¡æ¶ˆæ¯</td></tr></tbody></table><blockquote><p>æ³¨ï¼šæµç¨‹ä¸ä¸€å®šå®Œå…¨å‡†ç¡®ã€å…¨é¢ã€‚</p></blockquote><p>ç»“è®ºï¼š</p><ul><li>ä¸åŒçš„è®¢å•å–æ¶ˆç±»å‹çš„å­æ“ä½œå­˜åœ¨äº¤é›†ï¼Œå­æ“ä½œå¯è¢«å¤ç”¨ã€‚</li><li>å­æ“ä½œå¯è¢«çœ‹ä½œâ€œè®¢é˜…è€…â€(ä¹Ÿå°±æ˜¯è§‚å¯Ÿè€…)</li><li>è®¢å•å–æ¶ˆç±»å‹å¯è¢«çœ‹ä½œæ˜¯â€œä¸»é¢˜â€(ä¹Ÿå°±æ˜¯è¢«è§‚å¯Ÿè€…)</li><li>ä¸åŒå­æ“ä½œ(â€œè®¢é˜…è€…â€)(è§‚å¯Ÿè€…)<strong>è®¢é˜…</strong>è®¢å•å–æ¶ˆç±»å‹(â€œä¸»é¢˜â€)(è¢«è§‚å¯Ÿè€…)</li><li>è®¢å•å–æ¶ˆç±»å‹(â€œä¸»é¢˜â€)(è¢«è§‚å¯Ÿè€…)<strong>é€šçŸ¥</strong>å­æ“ä½œ(â€œè®¢é˜…è€…â€)(è§‚å¯Ÿè€…)</li></ul><h4 id="ä¸šåŠ¡æµç¨‹å›¾"><a href="#ä¸šåŠ¡æµç¨‹å›¾" class="headerlink" title="ä¸šåŠ¡æµç¨‹å›¾"></a>ä¸šåŠ¡æµç¨‹å›¾</h4><p>æˆ‘ä»¬é€šè¿‡æ¢³ç†çš„æ–‡æœ¬ä¸šåŠ¡æµç¨‹å¾—åˆ°äº†å¦‚ä¸‹çš„ä¸šåŠ¡æµç¨‹å›¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ³¨ï¼šæœ¬æ–‡äºå•ä½“æ¶æ„èƒŒæ™¯æ¢è®¨ä¸šåŠ¡çš„å®ç°è¿‡ç¨‹ï¼Œç®€å•å®¹æ˜“ç†è§£ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200410131427.png" alt=""></p><h4 id="ä»£ç å»ºæ¨¡"><a href="#ä»£ç å»ºæ¨¡" class="headerlink" title="ä»£ç å»ºæ¨¡"></a>ä»£ç å»ºæ¨¡</h4><p>ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€çš„æ ¸å¿ƒæ˜¯ä¸¤ä¸ªæ¥å£ï¼š</p><ul><li>â€œä¸»é¢˜â€(è¢«è§‚å¯Ÿè€…)æ¥å£<code>Observable</code><ul><li>æŠ½è±¡æ–¹æ³•<code>Attach</code>: å¢åŠ â€œè®¢é˜…è€…â€</li><li>æŠ½è±¡æ–¹æ³•<code>Detach</code>: åˆ é™¤â€œè®¢é˜…è€…â€</li><li>æŠ½è±¡æ–¹æ³•<code>Notify</code>: é€šçŸ¥â€œè®¢é˜…è€…â€</li></ul></li><li>â€œè®¢é˜…è€…â€(è§‚å¯Ÿè€…)æ¥å£<code>ObserverInterface</code><ul><li>æŠ½è±¡æ–¹æ³•<code>Do</code>: è‡ªèº«çš„ä¸šåŠ¡</li></ul></li></ul><p>è®¢å•é€†å‘æµçš„ä¸šåŠ¡ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è¿™ä¸¤ä¸ªæ¥å£:</p><ul><li>å…·ä½“è®¢å•å–æ¶ˆçš„åŠ¨ä½œå®ç°â€œä¸»é¢˜â€æ¥å£<code>Observable</code></li><li>å­é€»è¾‘å®ç°â€œè®¢é˜…è€…â€æ¥å£<code>ObserverInterface</code></li></ul><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ------------è¿™é‡Œå®ç°ä¸€ä¸ªå…·ä½“çš„â€œä¸»é¢˜â€------------</span><br><span class="line"></span><br><span class="line">å…·ä½“è®¢å•å–æ¶ˆçš„åŠ¨ä½œå®ç°â€œä¸»é¢˜â€(è¢«è§‚å¯Ÿè€…)æ¥å£&#96;Observable&#96;ã€‚å¾—åˆ°ä¸€ä¸ªå…·ä½“çš„â€œä¸»é¢˜â€:</span><br><span class="line"></span><br><span class="line">- è®¢å•å–æ¶ˆçš„åŠ¨ä½œçš„â€œä¸»é¢˜â€ç»“æ„ä½“&#96;ObservableConcrete&#96;</span><br><span class="line">    +  æˆå‘˜å±æ€§&#96;observerList []ObserverInterface&#96;:è®¢é˜…è€…åˆ—è¡¨</span><br><span class="line">    +  å…·ä½“æ–¹æ³•&#96;Attach&#96;: å¢åŠ å­é€»è¾‘</span><br><span class="line">    +  å…·ä½“æ–¹æ³•&#96;Detach&#96;: åˆ é™¤å­é€»è¾‘</span><br><span class="line">    +  å…·ä½“æ–¹æ³•&#96;Notify&#96;: é€šçŸ¥å­é€»è¾‘</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ------------è¿™é‡Œå®ç°æ‰€æœ‰å…·ä½“çš„â€œè®¢é˜…è€…â€------------</span><br><span class="line"></span><br><span class="line">å­é€»è¾‘å®ç°â€œè®¢é˜…è€…â€æ¥å£&#96;ObserverInterface&#96;:</span><br><span class="line"></span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;OrderStatus&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: ä¿®æ”¹è®¢å•çŠ¶æ€</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;OrderStatusLog&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;CouponRefund&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: é€€ä¼˜æƒ åˆ¸</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;PromotionRefund&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;StockRefund&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: è¿˜åº“å­˜</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;GiftCardRefund&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: è¿˜ç¤¼å“å¡</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;WalletRefund&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: é€€é’±åŒ…ä½™é¢</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;DeliverBillStatus&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: ä¿®æ”¹å‘è´§å•çŠ¶æ€</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;DeliverBillStatusLog&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: è®°å½•å‘è´§å•çŠ¶æ€å˜æ›´æ—¥å¿—</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;Refund&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: ç”Ÿæˆé€€æ¬¾å•</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;Invoice&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;Email&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: å‘é‚®ä»¶</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;Sms&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: å‘çŸ­ä¿¡</span><br><span class="line">- å…·ä½“â€œè®¢é˜…è€…â€ä¹Ÿå°±æ˜¯å­é€»è¾‘&#96;WechatNotify&#96;</span><br><span class="line">    +  å®ç°æ–¹æ³•&#96;Do&#96;: å‘å¾®ä¿¡æ¶ˆæ¯</span><br></pre></td></tr></table></figure><p>åŒæ—¶å¾—åˆ°äº†æˆ‘ä»¬çš„UMLå›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200411181215.jpg" alt=""></p><h4 id="ä»£ç demo"><a href="#ä»£ç demo" class="headerlink" title="ä»£ç demo"></a>ä»£ç demo</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//è§‚å¯Ÿè€…æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Observable è¢«è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="keyword">type</span> Observable <span class="keyword">interface</span> &#123;</span><br><span class="line">Attach(observer ...ObserverInterface) Observable</span><br><span class="line">Detach(observer ObserverInterface) Observable</span><br><span class="line">Notify() error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ObservableConcrete ä¸€ä¸ªå…·ä½“çš„ è®¢å•çŠ¶æ€å˜åŒ–çš„è¢«è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="keyword">type</span> ObservableConcrete <span class="keyword">struct</span> &#123;</span><br><span class="line">observerList []ObserverInterface</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Attach æ³¨å†Œè§‚å¯Ÿè€…</span></span><br><span class="line"><span class="comment">// @param $observer ObserverInterface è§‚å¯Ÿè€…åˆ—è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *ObservableConcrete)</span> <span class="title">Attach</span><span class="params">(observer ...ObserverInterface)</span> <span class="title">Observable</span></span> &#123;</span><br><span class="line">o.observerList = <span class="built_in">append</span>(o.observerList, observer...)</span><br><span class="line"><span class="keyword">return</span> o</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Detach æ³¨é”€è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="comment">// @param $observer ObserverInterface å¾…æ³¨é”€çš„è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *ObservableConcrete)</span> <span class="title">Detach</span><span class="params">(observer ObserverInterface)</span> <span class="title">Observable</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(o.observerList) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> o</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, observerItem := <span class="keyword">range</span> o.observerList &#123;</span><br><span class="line"><span class="keyword">if</span> observer == observerItem &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ³¨é”€:&quot;</span>, reflect.TypeOf(observer))</span><br><span class="line">o.observerList = <span class="built_in">append</span>(o.observerList[:k], o.observerList[k+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> o</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Notify é€šçŸ¥è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *ObservableConcrete)</span> <span class="title">Notify</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code ...</span></span><br><span class="line"><span class="keyword">for</span> _, observer := <span class="keyword">range</span> o.observerList &#123;</span><br><span class="line"><span class="keyword">if</span> err = observer.Do(o); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ObserverInterface å®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…çš„æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> ObserverInterface <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// è‡ªèº«çš„ä¸šåŠ¡</span></span><br><span class="line">Do(o Observable) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OrderStatus ä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line"><span class="keyword">type</span> OrderStatus <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *OrderStatus)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä¿®æ”¹è®¢å•çŠ¶æ€...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OrderStatusLog è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—</span></span><br><span class="line"><span class="keyword">type</span> OrderStatusLog <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *OrderStatusLog)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CouponRefund é€€ä¼˜æƒ åˆ¸</span></span><br><span class="line"><span class="keyword">type</span> CouponRefund <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *CouponRefund)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;é€€ä¼˜æƒ åˆ¸...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PromotionRefund è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼</span></span><br><span class="line"><span class="keyword">type</span> PromotionRefund <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *PromotionRefund)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StockRefund è¿˜åº“å­˜</span></span><br><span class="line"><span class="keyword">type</span> StockRefund <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *StockRefund)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è¿˜åº“å­˜...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GiftCardRefund è¿˜ç¤¼å“å¡</span></span><br><span class="line"><span class="keyword">type</span> GiftCardRefund <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *GiftCardRefund)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è¿˜ç¤¼å“å¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WalletRefund é€€é’±åŒ…ä½™é¢</span></span><br><span class="line"><span class="keyword">type</span> WalletRefund <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *WalletRefund)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;é€€é’±åŒ…ä½™é¢...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DeliverBillStatus ä¿®æ”¹å‘è´§å•çŠ¶æ€</span></span><br><span class="line"><span class="keyword">type</span> DeliverBillStatus <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *DeliverBillStatus)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä¿®æ”¹å‘è´§å•çŠ¶æ€...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DeliverBillStatusLog è®°å½•å‘è´§å•çŠ¶æ€å˜æ›´æ—¥å¿—</span></span><br><span class="line"><span class="keyword">type</span> DeliverBillStatusLog <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *DeliverBillStatusLog)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è®°å½•å‘è´§å•çŠ¶æ€å˜æ›´æ—¥å¿—...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Refund ç”Ÿæˆé€€æ¬¾å•</span></span><br><span class="line"><span class="keyword">type</span> Refund <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *Refund)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç”Ÿæˆé€€æ¬¾å•...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Invoice ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨</span></span><br><span class="line"><span class="keyword">type</span> Invoice <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *Invoice)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Email å‘é‚®ä»¶</span></span><br><span class="line"><span class="keyword">type</span> Email <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *Email)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å‘é‚®ä»¶...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sms å‘çŸ­ä¿¡</span></span><br><span class="line"><span class="keyword">type</span> Sms <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *Sms)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å‘çŸ­ä¿¡...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WechatNotify å‘å¾®ä¿¡æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">type</span> WechatNotify <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do å…·ä½“ä¸šåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(observer *WechatNotify)</span> <span class="title">Do</span><span class="params">(o Observable)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// code...</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å‘å¾®ä¿¡æ¶ˆæ¯...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯è°ƒç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º æœªæ”¯ä»˜å–æ¶ˆè®¢å• â€œä¸»é¢˜â€</span></span><br><span class="line">fmt.Println(<span class="string">&quot;----------------------- æœªæ”¯ä»˜å–æ¶ˆè®¢å• â€œä¸»é¢˜â€&quot;</span>)</span><br><span class="line">orderUnPaidCancelSubject := &amp;ObservableConcrete&#123;&#125;</span><br><span class="line">orderUnPaidCancelSubject.Attach(</span><br><span class="line">&amp;OrderStatus&#123;&#125;,</span><br><span class="line">&amp;OrderStatusLog&#123;&#125;,</span><br><span class="line">&amp;CouponRefund&#123;&#125;,</span><br><span class="line">&amp;PromotionRefund&#123;&#125;,</span><br><span class="line">&amp;StockRefund&#123;&#125;,</span><br><span class="line">)</span><br><span class="line">orderUnPaidCancelSubject.Notify()</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º è¶…æ—¶å…³å• â€œä¸»é¢˜â€</span></span><br><span class="line">fmt.Println(<span class="string">&quot;----------------------- è¶…æ—¶å…³å• â€œä¸»é¢˜â€&quot;</span>)</span><br><span class="line">orderOverTimeSubject := &amp;ObservableConcrete&#123;&#125;</span><br><span class="line">orderOverTimeSubject.Attach(</span><br><span class="line">&amp;OrderStatus&#123;&#125;,</span><br><span class="line">&amp;OrderStatusLog&#123;&#125;,</span><br><span class="line">&amp;CouponRefund&#123;&#125;,</span><br><span class="line">&amp;PromotionRefund&#123;&#125;,</span><br><span class="line">&amp;StockRefund&#123;&#125;,</span><br><span class="line">&amp;Email&#123;&#125;,</span><br><span class="line">&amp;Sms&#123;&#125;,</span><br><span class="line">&amp;WechatNotify&#123;&#125;,</span><br><span class="line">)</span><br><span class="line">orderOverTimeSubject.Notify()</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º å·²æ”¯ä»˜å–æ¶ˆè®¢å• â€œä¸»é¢˜â€</span></span><br><span class="line">fmt.Println(<span class="string">&quot;----------------------- å·²æ”¯ä»˜å–æ¶ˆè®¢å• â€œä¸»é¢˜â€&quot;</span>)</span><br><span class="line">orderPaidCancelSubject := &amp;ObservableConcrete&#123;&#125;</span><br><span class="line">orderPaidCancelSubject.Attach(</span><br><span class="line">&amp;OrderStatus&#123;&#125;,</span><br><span class="line">&amp;OrderStatusLog&#123;&#125;,</span><br><span class="line">&amp;CouponRefund&#123;&#125;,</span><br><span class="line">&amp;PromotionRefund&#123;&#125;,</span><br><span class="line">&amp;StockRefund&#123;&#125;,</span><br><span class="line">&amp;GiftCardRefund&#123;&#125;,</span><br><span class="line">&amp;WalletRefund&#123;&#125;,</span><br><span class="line">&amp;Refund&#123;&#125;,</span><br><span class="line">&amp;Invoice&#123;&#125;,</span><br><span class="line">&amp;Email&#123;&#125;,</span><br><span class="line">&amp;Sms&#123;&#125;,</span><br><span class="line">&amp;WechatNotify&#123;&#125;,</span><br><span class="line">)</span><br><span class="line">orderPaidCancelSubject.Notify()</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º å–æ¶ˆå‘è´§å• â€œä¸»é¢˜â€</span></span><br><span class="line">fmt.Println(<span class="string">&quot;----------------------- å–æ¶ˆå‘è´§å• â€œä¸»é¢˜â€&quot;</span>)</span><br><span class="line">deliverBillCancelSubject := &amp;ObservableConcrete&#123;&#125;</span><br><span class="line">deliverBillCancelSubject.Attach(</span><br><span class="line">&amp;OrderStatus&#123;&#125;,</span><br><span class="line">&amp;OrderStatusLog&#123;&#125;,</span><br><span class="line">&amp;DeliverBillStatus&#123;&#125;,</span><br><span class="line">&amp;DeliverBillStatusLog&#123;&#125;,</span><br><span class="line">&amp;StockRefund&#123;&#125;,</span><br><span class="line">&amp;GiftCardRefund&#123;&#125;,</span><br><span class="line">&amp;WalletRefund&#123;&#125;,</span><br><span class="line">&amp;Refund&#123;&#125;,</span><br><span class="line">&amp;Invoice&#123;&#125;,</span><br><span class="line">&amp;Email&#123;&#125;,</span><br><span class="line">&amp;Sms&#123;&#125;,</span><br><span class="line">&amp;WechatNotify&#123;&#125;,</span><br><span class="line">)</span><br><span class="line">deliverBillCancelSubject.Notify()</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º æ‹’æ”¶ â€œä¸»é¢˜â€</span></span><br><span class="line">fmt.Println(<span class="string">&quot;----------------------- æ‹’æ”¶ â€œä¸»é¢˜â€&quot;</span>)</span><br><span class="line">deliverBillRejectSubject := &amp;ObservableConcrete&#123;&#125;</span><br><span class="line">deliverBillRejectSubject.Attach(</span><br><span class="line">&amp;OrderStatus&#123;&#125;,</span><br><span class="line">&amp;OrderStatusLog&#123;&#125;,</span><br><span class="line">&amp;DeliverBillStatus&#123;&#125;,</span><br><span class="line">&amp;DeliverBillStatusLog&#123;&#125;,</span><br><span class="line">&amp;StockRefund&#123;&#125;,</span><br><span class="line">&amp;GiftCardRefund&#123;&#125;,</span><br><span class="line">&amp;WalletRefund&#123;&#125;,</span><br><span class="line">&amp;Refund&#123;&#125;,</span><br><span class="line">&amp;Invoice&#123;&#125;,</span><br><span class="line">&amp;Email&#123;&#125;,</span><br><span class="line">&amp;Sms&#123;&#125;,</span><br><span class="line">&amp;WechatNotify&#123;&#125;,</span><br><span class="line">)</span><br><span class="line">deliverBillRejectSubject.Notify()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœªæ¥å¯ä»¥å¿«é€Ÿçš„æ ¹æ®ä¸šåŠ¡çš„å˜åŒ– åˆ›å»ºæ–°çš„ä¸»é¢˜ ä»è€Œå¿«é€Ÿæ„å»ºæ–°çš„ä¸šåŠ¡æ¥å£</span></span><br><span class="line">fmt.Println(<span class="string">&quot;----------------------- æœªæ¥çš„æ‰©å±•...&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ­£åœ¨è¿è¡Œçš„å‡½æ•°å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runFuncName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">pc := <span class="built_in">make</span>([]<span class="keyword">uintptr</span>, <span class="number">1</span>)</span><br><span class="line">runtime.Callers(<span class="number">2</span>, pc)</span><br><span class="line">f := runtime.FuncForPC(pc[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> f.Name()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[Running] go run &quot;..&#x2F;easy-tips&#x2F;go&#x2F;src&#x2F;patterns&#x2F;observer&#x2F;observer.go&quot;</span><br><span class="line">----------------------- æœªæ”¯ä»˜å–æ¶ˆè®¢å• â€œä¸»é¢˜â€</span><br><span class="line">main.(*OrderStatus).Do ä¿®æ”¹è®¢å•çŠ¶æ€...</span><br><span class="line">main.(*OrderStatusLog).Do è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—...</span><br><span class="line">main.(*CouponRefund).Do é€€ä¼˜æƒ åˆ¸...</span><br><span class="line">main.(*PromotionRefund).Do è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼...</span><br><span class="line">main.(*StockRefund).Do è¿˜åº“å­˜...</span><br><span class="line">----------------------- è¶…æ—¶å…³å• â€œä¸»é¢˜â€</span><br><span class="line">main.(*OrderStatus).Do ä¿®æ”¹è®¢å•çŠ¶æ€...</span><br><span class="line">main.(*OrderStatusLog).Do è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—...</span><br><span class="line">main.(*CouponRefund).Do é€€ä¼˜æƒ åˆ¸...</span><br><span class="line">main.(*PromotionRefund).Do è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼...</span><br><span class="line">main.(*StockRefund).Do è¿˜åº“å­˜...</span><br><span class="line">main.(*Email).Do å‘é‚®ä»¶...</span><br><span class="line">main.(*Sms).Do å‘çŸ­ä¿¡...</span><br><span class="line">main.(*WechatNotify).Do å‘å¾®ä¿¡æ¶ˆæ¯...</span><br><span class="line">----------------------- å·²æ”¯ä»˜å–æ¶ˆè®¢å• â€œä¸»é¢˜â€</span><br><span class="line">main.(*OrderStatus).Do ä¿®æ”¹è®¢å•çŠ¶æ€...</span><br><span class="line">main.(*OrderStatusLog).Do è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—...</span><br><span class="line">main.(*CouponRefund).Do é€€ä¼˜æƒ åˆ¸...</span><br><span class="line">main.(*PromotionRefund).Do è¿˜ä¼˜æƒ æ´»åŠ¨èµ„æ ¼...</span><br><span class="line">main.(*StockRefund).Do è¿˜åº“å­˜...</span><br><span class="line">main.(*GiftCardRefund).Do è¿˜ç¤¼å“å¡...</span><br><span class="line">main.(*WalletRefund).Do é€€é’±åŒ…ä½™é¢...</span><br><span class="line">main.(*Refund).Do ç”Ÿæˆé€€æ¬¾å•...</span><br><span class="line">main.(*Invoice).Do ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨...</span><br><span class="line">main.(*Email).Do å‘é‚®ä»¶...</span><br><span class="line">main.(*Sms).Do å‘çŸ­ä¿¡...</span><br><span class="line">main.(*WechatNotify).Do å‘å¾®ä¿¡æ¶ˆæ¯...</span><br><span class="line">----------------------- å–æ¶ˆå‘è´§å• â€œä¸»é¢˜â€</span><br><span class="line">main.(*OrderStatus).Do ä¿®æ”¹è®¢å•çŠ¶æ€...</span><br><span class="line">main.(*OrderStatusLog).Do è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—...</span><br><span class="line">main.(*DeliverBillStatus).Do ä¿®æ”¹å‘è´§å•çŠ¶æ€...</span><br><span class="line">main.(*DeliverBillStatusLog).Do è®°å½•å‘è´§å•çŠ¶æ€å˜æ›´æ—¥å¿—...</span><br><span class="line">main.(*StockRefund).Do è¿˜åº“å­˜...</span><br><span class="line">main.(*GiftCardRefund).Do è¿˜ç¤¼å“å¡...</span><br><span class="line">main.(*WalletRefund).Do é€€é’±åŒ…ä½™é¢...</span><br><span class="line">main.(*Refund).Do ç”Ÿæˆé€€æ¬¾å•...</span><br><span class="line">main.(*Invoice).Do ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨...</span><br><span class="line">main.(*Email).Do å‘é‚®ä»¶...</span><br><span class="line">main.(*Sms).Do å‘çŸ­ä¿¡...</span><br><span class="line">main.(*WechatNotify).Do å‘å¾®ä¿¡æ¶ˆæ¯...</span><br><span class="line">----------------------- æ‹’æ”¶ â€œä¸»é¢˜â€</span><br><span class="line">main.(*OrderStatus).Do ä¿®æ”¹è®¢å•çŠ¶æ€...</span><br><span class="line">main.(*OrderStatusLog).Do è®°å½•è®¢å•çŠ¶æ€å˜æ›´æ—¥å¿—...</span><br><span class="line">main.(*DeliverBillStatus).Do ä¿®æ”¹å‘è´§å•çŠ¶æ€...</span><br><span class="line">main.(*DeliverBillStatusLog).Do è®°å½•å‘è´§å•çŠ¶æ€å˜æ›´æ—¥å¿—...</span><br><span class="line">main.(*StockRefund).Do è¿˜åº“å­˜...</span><br><span class="line">main.(*GiftCardRefund).Do è¿˜ç¤¼å“å¡...</span><br><span class="line">main.(*WalletRefund).Do é€€é’±åŒ…ä½™é¢...</span><br><span class="line">main.(*Refund).Do ç”Ÿæˆé€€æ¬¾å•...</span><br><span class="line">main.(*Invoice).Do ç”Ÿæˆå‘ç¥¨-çº¢ç¥¨...</span><br><span class="line">main.(*Email).Do å‘é‚®ä»¶...</span><br><span class="line">main.(*Sms).Do å‘çŸ­ä¿¡...</span><br><span class="line">main.(*WechatNotify).Do å‘å¾®ä¿¡æ¶ˆæ¯...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ€åæ€»ç»“ä¸‹ï¼Œã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€æŠ½è±¡è¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯ï¼š</p><ul><li>è¢«ä¾èµ–çš„â€œä¸»é¢˜â€</li><li>è¢«é€šçŸ¥çš„â€œè®¢é˜…è€…â€</li><li>â€œè®¢é˜…è€…â€æŒ‰éœ€<strong>è®¢é˜…</strong>â€œä¸»é¢˜â€</li><li>â€œä¸»é¢˜â€å˜åŒ–<strong>é€šçŸ¥</strong>â€œè®¢é˜…è€…â€</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹åˆ«è¯´æ˜ï¼š</span><br><span class="line">1. æˆ‘çš„ä»£ç æ²¡æœ‰&#96;else&#96;ï¼Œåªæ˜¯ä¸€ä¸ªåœ¨ä»£ç åˆç†è®¾è®¡çš„æƒ…å†µä¸‹è‡ªç„¶è€Œç„¶æ— é™æ¥è¿‘æˆ–è€…è¾¾åˆ°çš„ç»“æœï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç¡¬æ€§çš„ç›®æ ‡ï¼ŒåŠ¡å¿…è¾ƒçœŸã€‚</span><br><span class="line">2. æœ¬ç³»åˆ—çš„ä¸€äº›è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µå¯èƒ½å’ŒåŸæ¦‚å¿µå­˜åœ¨å·®å¼‚ï¼Œå› ä¸ºä¼šç»“åˆå®é™…ä½¿ç”¨ï¼Œå–å…¶ç²¾åï¼Œé€‚å½“æ”¹å˜ï¼Œçµæ´»ä½¿ç”¨ã€‚</span><br><span class="line">3. è§‚å¯Ÿè€…æ¨¡å¼ä¸è®¢é˜…é€šçŸ¥å®é™…è¿˜æ˜¯æœ‰å·®å¼‚ï¼Œæœ¬æ–‡å‡åŠ ä¸Šäº†åŒå¼•å·ã€‚è®¢é˜…é€šçŸ¥ï¼šè®¢é˜…æ–¹ä¸æ˜¯ç›´æ¥ä¾èµ–ä¸»é¢˜æ–¹(è”æƒ³ä¸‹mqç­‰æ¶ˆæ¯ä¸­é—´ä»¶çš„ä½¿ç”¨)ï¼›è€Œè§‚å¯Ÿè€…æ¨¡å¼ï¼šè§‚å¯Ÿè€…æ˜¯ç›´æ¥ä¾èµ–äº†è¢«è§‚å¯Ÿè€…ï¼Œä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¸…æ™°çš„çœ‹å‡ºæ¥è¿™ä¸ªå·®å¼‚ã€‚</span><br></pre></td></tr></table></figure><h1 id="æ–‡ç« åˆ—è¡¨"><a href="#æ–‡ç« åˆ—è¡¨" class="headerlink" title="æ–‡ç« åˆ—è¡¨"></a>æ–‡ç« åˆ—è¡¨</h1><ul><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/template">ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/responsibility">é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/observer">è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/strategy">å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/state">çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li></ul><blockquote><p><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns">Goè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ— æ›´å¤šæ–‡ç«  ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;è®¢é˜…é€šçŸ¥-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;a href=&quot;#è®¢é˜…é€šçŸ¥-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot; class=&quot;headerlink&quot; title=&quot;è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;/a&gt;è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</title>
    <link href="http://wangyangyangisme.github.io/posts/b38a76c0/"/>
    <id>http://wangyangyangisme.github.io/posts/b38a76c0/</id>
    <published>2021-05-16T06:30:58.000Z</published>
    <updated>2021-05-16T06:30:58.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»£ç ç»„ä»¶-Goè®¾è®¡æ¨¡å¼å®æˆ˜"><a href="#ä»£ç ç»„ä»¶-Goè®¾è®¡æ¨¡å¼å®æˆ˜" class="headerlink" title="ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜"></a>ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</h1><blockquote><p>å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ—ï¼Œä¸€ä¸ªè®¾è®¡æ¨¡å¼ä¸šåŠ¡çœŸå®ä½¿ç”¨çš„golangç³»åˆ—ã€‚</p><p><a href="http://tigerb.cn/">http://tigerb.cn/</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç³»åˆ—ä¸»è¦åˆ†äº«ï¼Œå¦‚ä½•åœ¨æˆ‘ä»¬çš„çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨è®¾è®¡æ¨¡å¼ã€‚</p><p>æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦é‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š</p><ul><li>ä»€ä¹ˆæ˜¯ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ä½¿ç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>æ€ä¹ˆç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li></ul><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ã€Œç»„åˆæ¨¡å¼ã€å¦‚ä½•åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ</h2><blockquote><p>ä¸€ä¸ªå…·æœ‰å±‚çº§å…³ç³»çš„å¯¹è±¡ç”±ä¸€ç³»åˆ—æ‹¥æœ‰çˆ¶å­å…³ç³»çš„å¯¹è±¡é€šè¿‡æ ‘å½¢ç»“æ„ç»„æˆã€‚</p></blockquote><p>ç»„åˆæ¨¡å¼çš„ä¼˜åŠ¿ï¼š</p><ul><li>æ‰€è§å³æ‰€ç ï¼šä½ æ‰€çœ‹è§çš„ä»£ç ç»“æ„å°±æ˜¯ä¸šåŠ¡çœŸå®çš„å±‚çº§å…³ç³»ï¼Œæ¯”å¦‚Uiç•Œé¢ä½ çœŸå®çœ‹åˆ°çš„é‚£æ ·ã€‚</li><li>é«˜åº¦å°è£…ï¼šå•ä¸€èŒè´£ã€‚</li><li>å¯å¤ç”¨ï¼šä¸åŒä¸šåŠ¡åœºæ™¯ï¼Œç›¸åŒçš„ç»„ä»¶å¯è¢«é‡å¤ä½¿ç”¨ã€‚</li></ul><h2 id="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ</h2><p>æ»¡è¶³å¦‚ä¸‹è¦æ±‚çš„æ‰€æœ‰åœºæ™¯:</p><blockquote><p>Getè¯·æ±‚è·å–é¡µé¢æ•°æ®çš„æ‰€æœ‰æ¥å£</p></blockquote><p>å‰ç«¯å¤§è¡Œç»„ä»¶åŒ–çš„å½“ä»Šï¼Œæˆ‘ä»¬åœ¨å†™åç«¯æ¥å£ä»£ç çš„æ—¶å€™è¿˜æ˜¯æŒ‰ç…§ä¸šåŠ¡æ€è·¯ä¸€å¤´å†™åˆ°å°¾å—ï¼Ÿæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ€ç´¢ï¼Œã€Œåç«¯æ¥å£ä¸šåŠ¡ä»£ç å¦‚ä½•å¯ä»¥ç®€å•å¿«é€Ÿç»„ä»¶åŒ–ï¼Ÿã€ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œè¿™å°±æ˜¯ã€Œç»„åˆæ¨¡å¼ã€çš„ä½œç”¨ã€‚</p><p>æˆ‘ä»¬åˆ©ç”¨ã€Œç»„åˆæ¨¡å¼ã€çš„å®šä¹‰å’Œå‰ç«¯æ¨¡å—çš„åˆ’åˆ†å»æ„å»ºåç«¯ä¸šåŠ¡ä»£ç ç»“æ„ï¼š</p><ul><li>å‰ç«¯å•ä¸ªæ¨¡å— -&gt; å¯¹åº”åç«¯ï¼šå…·ä½“å•ä¸ªç±» -&gt; å°è£…çš„è¿‡ç¨‹</li><li>å‰ç«¯æ¨¡å—çˆ¶å­ç»„ä»¶ -&gt;  å¯¹åº”åç«¯ï¼šçˆ¶ç±»å†…éƒ¨æŒæœ‰å¤šä¸ªå­ç±»(éç»§æ‰¿å…³ç³»ï¼Œåˆæˆå¤ç”¨å…³ç³») -&gt; çˆ¶å­å…³ç³»çš„æ ‘å½¢ç»“æ„</li></ul><blockquote><p>æˆ‘ä»¬æœ‰å“ªäº›çœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œç»„åˆæ¨¡å¼ã€å‘¢ï¼Ÿ</p></blockquote><p>æ¯”å¦‚æˆ‘ä»¬ä»¥â€œå¤æ‚çš„è®¢å•ç»“ç®—é¡µé¢â€ä¸ºä¾‹ï¼Œä¸‹é¢æ˜¯æŸä¸œçš„è®¢å•ç»“ç®—é¡µé¢ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200331124724.jpeg" style="width:38%"></p><p>ä»é¡µé¢çš„å±•ç¤ºå½¢å¼ä¸Šï¼Œå¯ä»¥çœ‹å‡ºï¼š</p><ul><li>é¡µé¢ç”±å¤šä¸ªæ¨¡å—æ„æˆï¼Œæ¯”å¦‚ï¼š<ul><li>åœ°å€æ¨¡å—</li><li>æ”¯ä»˜æ–¹å¼æ¨¡å—</li><li>åº—é“ºæ¨¡å—</li><li>å‘ç¥¨æ¨¡å—</li><li>ä¼˜æƒ åˆ¸æ¨¡å—</li><li>æŸè±†æ¨¡å—</li><li>ç¤¼å“å¡æ¨¡å—</li><li>è®¢å•è¯¦ç»†é‡‘é¢æ¨¡å—</li></ul></li><li>å•ä¸ªæ¨¡å—å¯ä»¥ç”±å¤šä¸ªå­æ¨¡å—æ„æˆ<ul><li>åº—é“ºæ¨¡å—ï¼Œåˆç”±å¦‚ä¸‹æ¨¡å—æ„æˆï¼š<ul><li>å•†å“æ¨¡å—</li><li>å”®åæ¨¡å—</li><li>ä¼˜æƒ æ¨¡å—</li><li>ç‰©æµæ¨¡å—</li></ul></li></ul></li></ul><h2 id="æ€ä¹ˆç”¨ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ"><a href="#æ€ä¹ˆç”¨ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="æ€ä¹ˆç”¨ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ"></a>æ€ä¹ˆç”¨ã€Œç»„åˆæ¨¡å¼ã€ï¼Ÿ</h2><p>å…³äºæ€ä¹ˆç”¨ï¼Œå®Œå…¨å¯ä»¥ç”Ÿæ¬ç¡¬å¥—æˆ‘æ€»ç»“çš„ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä¸šåŠ¡æ¢³ç†</li><li>ä¸šåŠ¡æµç¨‹å›¾</li><li>ä»£ç å»ºæ¨¡</li><li>ä»£ç demo</li></ul><h4 id="ä¸šåŠ¡æ¢³ç†"><a href="#ä¸šåŠ¡æ¢³ç†" class="headerlink" title="ä¸šåŠ¡æ¢³ç†"></a>ä¸šåŠ¡æ¢³ç†</h4><p>æŒ‰ç…§å¦‚ä¸ŠæŸä¸œçš„è®¢å•ç»“ç®—é¡µé¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¾—åˆ°äº†å¦‚ä¸‹çš„è®¢å•ç»“ç®—é¡µé¢æ¨¡å—ç»„æˆå›¾ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200329222214.png" style="width:46%"></p><blockquote><p>æ³¨ï¼šæ¨¡å—ä¸ä¸€å®šå®Œå…¨å‡†ç¡®</p></blockquote><h4 id="ä»£ç å»ºæ¨¡"><a href="#ä»£ç å»ºæ¨¡" class="headerlink" title="ä»£ç å»ºæ¨¡"></a>ä»£ç å»ºæ¨¡</h4><p>è´£ä»»é“¾æ¨¡å¼ä¸»è¦ç±»ä¸»è¦åŒ…å«å¦‚ä¸‹ç‰¹æ€§ï¼š</p><ul><li>æˆå‘˜å±æ€§<ul><li><code>ChildComponents</code>: å­ç»„ä»¶åˆ—è¡¨ -&gt; ç¨³å®šä¸å˜çš„</li></ul></li><li>æˆå‘˜æ–¹æ³•<ul><li><code>Mount</code>: æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶ -&gt; ç¨³å®šä¸å˜çš„</li><li><code>Remove</code>: ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶ -&gt; ç¨³å®šä¸å˜çš„</li><li><code>Do</code>: æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶ -&gt; å˜åŒ–çš„</li></ul></li></ul><p>å¥—ç”¨åˆ°è®¢å•ç»“ç®—é¡µé¢ä¿¡æ¯æ¥å£ä¼ªä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ä¸ªçˆ¶ç±»(æŠ½è±¡ç±»)ï¼š</span><br><span class="line">- æˆå‘˜å±æ€§</span><br><span class="line">+ &#96;ChildComponents&#96;: å­ç»„ä»¶åˆ—è¡¨</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Mount&#96;: å®ç°æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span><br><span class="line">+ &#96;Remove&#96;: å®ç°ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span><br><span class="line">+ &#96;Do&#96;: æŠ½è±¡æ–¹æ³•</span><br><span class="line"></span><br><span class="line">ç»„ä»¶ä¸€ï¼Œè®¢å•ç»“ç®—é¡µé¢ç»„ä»¶ç±»(ç»§æ‰¿çˆ¶ç±»ã€çœ‹æˆä¸€ä¸ªå¤§çš„ç»„ä»¶)ï¼š </span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶äºŒï¼Œåœ°å€ç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶ä¸‰ï¼Œæ”¯ä»˜æ–¹å¼ç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶å››ï¼Œåº—é“ºç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶äº”ï¼Œå•†å“ç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶å…­ï¼Œä¼˜æƒ ä¿¡æ¯ç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶ä¸ƒï¼Œç‰©æµç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶å…«ï¼Œå‘ç¥¨ç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶ä¹ï¼Œä¼˜æƒ åˆ¸ç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶åï¼Œç¤¼å“å¡ç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶åä¸€ï¼Œè®¢å•é‡‘é¢è¯¦ç»†ä¿¡æ¯ç»„ä»¶(ç»§æ‰¿çˆ¶ç±»)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line">ç»„ä»¶åäºŒï¼Œå”®åç»„ä»¶(ç»§æ‰¿çˆ¶ç±»ï¼Œæœªæ¥æ‰©å±•çš„ç»„ä»¶)ï¼š</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œgolangé‡Œæ²¡æœ‰çš„ç»§æ‰¿çš„æ¦‚å¿µï¼Œè¦å¤ç”¨æˆå‘˜å±æ€§<code>ChildComponents</code>ã€æˆå‘˜æ–¹æ³•<code>Mount</code>ã€æˆå‘˜æ–¹æ³•<code>Remove</code>æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨<code>åˆæˆå¤ç”¨</code>çš„ç‰¹æ€§å˜ç›¸è¾¾åˆ°â€œç»§æ‰¿å¤ç”¨â€çš„ç›®çš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ä¸ªæ¥å£(interface)ï¼š</span><br><span class="line">+ æŠ½è±¡æ–¹æ³•&#96;Mount&#96;: æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span><br><span class="line">+ æŠ½è±¡æ–¹æ³•&#96;Remove&#96;: ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span><br><span class="line">+ æŠ½è±¡æ–¹æ³•&#96;Do&#96;: æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªåŸºç¡€ç»“æ„ä½“&#96;BaseComponent&#96;ï¼š</span><br><span class="line">- æˆå‘˜å±æ€§</span><br><span class="line">+ &#96;ChildComponents&#96;: å­ç»„ä»¶åˆ—è¡¨</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ å®ä½“æ–¹æ³•&#96;Mount&#96;: æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span><br><span class="line">+ å®ä½“æ–¹æ³•&#96;Remove&#96;: ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span><br><span class="line">+ å®ä½“æ–¹æ³•&#96;ChildsDo&#96;: æ‰§è¡Œå­ç»„ä»¶</span><br><span class="line"></span><br><span class="line">ç»„ä»¶ä¸€ï¼Œè®¢å•ç»“ç®—é¡µé¢ç»„ä»¶ç±»ï¼š </span><br><span class="line">- åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“&#96;BaseComponent&#96; </span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶äºŒï¼Œåœ°å€ç»„ä»¶ï¼š</span><br><span class="line">- åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“&#96;BaseComponent&#96; </span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">ç»„ä»¶ä¸‰ï¼Œæ”¯ä»˜æ–¹å¼ç»„ä»¶ï¼š</span><br><span class="line">- åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“&#96;BaseComponent&#96; </span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">...ç•¥</span><br><span class="line"></span><br><span class="line">ç»„ä»¶åä¸€ï¼Œè®¢å•é‡‘é¢è¯¦ç»†ä¿¡æ¯ç»„ä»¶ï¼š</span><br><span class="line">- åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“&#96;BaseComponent&#96; </span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ &#96;Do&#96;: æ‰§è¡Œå½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œæ‰§è¡Œå­ç»„ä»¶çš„é€»è¾‘</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŒæ—¶å¾—åˆ°äº†æˆ‘ä»¬çš„UMLå›¾ï¼š</p><p align="center">  <img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200403125814.jpg" style="width:100%"></p><h4 id="ä»£ç demo"><a href="#ä»£ç demo" class="headerlink" title="ä»£ç demo"></a>ä»£ç demo</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//ç»„åˆæ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Context ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Component ç»„ä»¶æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Component <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Mount(c Component, components ...Component) error</span><br><span class="line"><span class="comment">// ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line">Remove(c Component) error</span><br><span class="line"><span class="comment">// æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line">Do(ctx *Context) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BaseComponent åŸºç¡€ç»„ä»¶</span></span><br><span class="line"><span class="comment">// å®ç°Add:æ·»åŠ ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="comment">// å®ç°Remove:ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> BaseComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// å­ç»„ä»¶åˆ—è¡¨</span></span><br><span class="line">ChildComponents []Component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mount æŒ‚è½½ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">Mount</span><span class="params">(c Component, components ...Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents, c)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(components) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents, components...)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove ç§»é™¤ä¸€ä¸ªå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">Remove</span><span class="params">(c Component)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(bc.ChildComponents) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> c == childComponent &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç§»é™¤:&quot;</span>, reflect.TypeOf(childComponent))</span><br><span class="line">bc.ChildComponents = <span class="built_in">append</span>(bc.ChildComponents[:k], bc.ChildComponents[k+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChildsDo æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BaseComponent)</span> <span class="title">ChildsDo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> _, childComponent := <span class="keyword">range</span> bc.ChildComponents &#123;</span><br><span class="line"><span class="keyword">if</span> err = childComponent.Do(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CheckoutPageComponent è®¢å•ç»“ç®—é¡µé¢ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> CheckoutPageComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *CheckoutPageComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è®¢å•ç»“ç®—é¡µé¢ç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddressComponent åœ°å€ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> AddressComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *AddressComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;åœ°å€ç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PayMethodComponent æ”¯ä»˜æ–¹å¼ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> PayMethodComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *PayMethodComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ”¯ä»˜æ–¹å¼ç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StoreComponent åº—é“ºç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> StoreComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *StoreComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;åº—é“ºç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SkuComponent å•†å“ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> SkuComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *SkuComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å•†å“ç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PromotionComponent ä¼˜æƒ ä¿¡æ¯ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> PromotionComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *PromotionComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä¼˜æƒ ä¿¡æ¯ç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ExpressComponent ç‰©æµç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> ExpressComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *ExpressComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç‰©æµç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AftersaleComponent å”®åç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> AftersaleComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *AftersaleComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å”®åç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// InvoiceComponent å‘ç¥¨ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> InvoiceComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *InvoiceComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å‘ç¥¨ç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CouponComponent ä¼˜æƒ åˆ¸ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> CouponComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *CouponComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä¼˜æƒ åˆ¸ç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GiftCardComponent ç¤¼å“å¡ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> GiftCardComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *GiftCardComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç¤¼å“å¡ç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OrderComponent è®¢å•é‡‘é¢è¯¦ç»†ä¿¡æ¯ç»„ä»¶</span></span><br><span class="line"><span class="keyword">type</span> OrderComponent <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨åŸºç¡€ç»„ä»¶</span></span><br><span class="line">BaseComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ‰§è¡Œç»„ä»¶&amp;å­ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *OrderComponent)</span> <span class="title">Do</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è®¢å•é‡‘é¢è¯¦ç»†ä¿¡æ¯ç»„ä»¶...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œå­ç»„ä»¶</span></span><br><span class="line">bc.ChildsDo(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å†™è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–è®¢å•ç»“ç®—é¡µé¢ è¿™ä¸ªå¤§ç»„ä»¶</span></span><br><span class="line">checkoutPage := &amp;CheckoutPageComponent&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‚è½½å­ç»„ä»¶</span></span><br><span class="line">storeComponent := &amp;StoreComponent&#123;&#125;</span><br><span class="line">skuComponent := &amp;SkuComponent&#123;&#125;</span><br><span class="line">skuComponent.Mount(</span><br><span class="line">&amp;PromotionComponent&#123;&#125;,</span><br><span class="line">&amp;AftersaleComponent&#123;&#125;,</span><br><span class="line">)</span><br><span class="line">storeComponent.Mount(</span><br><span class="line">skuComponent,</span><br><span class="line">&amp;ExpressComponent&#123;&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‚è½½ç»„ä»¶</span></span><br><span class="line">checkoutPage.Mount(</span><br><span class="line">&amp;AddressComponent&#123;&#125;,</span><br><span class="line">&amp;PayMethodComponent&#123;&#125;,</span><br><span class="line">storeComponent,</span><br><span class="line">&amp;InvoiceComponent&#123;&#125;,</span><br><span class="line">&amp;CouponComponent&#123;&#125;,</span><br><span class="line">&amp;GiftCardComponent&#123;&#125;,</span><br><span class="line">&amp;OrderComponent&#123;&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§»é™¤ç»„ä»¶æµ‹è¯•</span></span><br><span class="line"><span class="comment">// checkoutPage.Remove(storeComponent)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å§‹æ„å»ºé¡µé¢ç»„ä»¶æ•°æ®</span></span><br><span class="line">checkoutPage.Do(&amp;Context&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ­£åœ¨è¿è¡Œçš„å‡½æ•°å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runFuncName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">pc := <span class="built_in">make</span>([]<span class="keyword">uintptr</span>, <span class="number">1</span>)</span><br><span class="line">runtime.Callers(<span class="number">2</span>, pc)</span><br><span class="line">f := runtime.FuncForPC(pc[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> f.Name()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»£ç è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Running] go run &quot;..&#x2F;easy-tips&#x2F;go&#x2F;src&#x2F;patterns&#x2F;composite&#x2F;composite.go&quot;</span><br><span class="line">main.(*CheckoutPageComponent).Do è®¢å•ç»“ç®—é¡µé¢ç»„ä»¶...</span><br><span class="line">main.(*AddressComponent).Do åœ°å€ç»„ä»¶...</span><br><span class="line">main.(*PayMethodComponent).Do æ”¯ä»˜æ–¹å¼ç»„ä»¶...</span><br><span class="line">main.(*StoreComponent).Do åº—é“ºç»„ä»¶...</span><br><span class="line">main.(*SkuComponent).Do å•†å“ç»„ä»¶...</span><br><span class="line">main.(*PromotionComponent).Do ä¼˜æƒ ä¿¡æ¯ç»„ä»¶...</span><br><span class="line">main.(*AftersaleComponent).Do å”®åç»„ä»¶...</span><br><span class="line">main.(*ExpressComponent).Do ç‰©æµç»„ä»¶...</span><br><span class="line">main.(*InvoiceComponent).Do å‘ç¥¨ç»„ä»¶...</span><br><span class="line">main.(*CouponComponent).Do ä¼˜æƒ åˆ¸ç»„ä»¶...</span><br><span class="line">main.(*GiftCardComponent).Do ç¤¼å“å¡ç»„ä»¶...</span><br><span class="line">main.(*OrderComponent).Do è®¢å•é‡‘é¢è¯¦ç»†ä¿¡æ¯ç»„ä»¶...</span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ€åæ€»ç»“ä¸‹ï¼Œã€Œç»„åˆæ¨¡å¼ã€æŠ½è±¡è¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯ï¼š</p><ul><li>æŒ‰æ¨¡å—åˆ’åˆ†ï¼šä¸šåŠ¡é€»è¾‘å½’ç±»ï¼Œæ”¶æ•›çš„è¿‡ç¨‹ã€‚</li><li>çˆ¶å­å…³ç³»(æ ‘)ï¼šæŠŠæ”¶æ•›ä¹‹åçš„ä¸šåŠ¡å¯¹è±¡æŒ‰çˆ¶å­å…³ç³»ç»‘å®šï¼Œä¾æ¬¡è¢«æ‰§è¡Œã€‚</li></ul><p>ä¸ã€Œè´£ä»»é“¾æ¨¡å¼ã€çš„åŒºåˆ«ï¼š</p><ul><li>è´£ä»»é“¾æ¨¡å¼: é“¾è¡¨</li><li>ç»„åˆæ¨¡å¼ï¼šæ ‘</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹åˆ«è¯´æ˜ï¼š</span><br><span class="line">1. æˆ‘çš„ä»£ç æ²¡æœ‰&#96;else&#96;ï¼Œåªæ˜¯ä¸€ä¸ªåœ¨ä»£ç åˆç†è®¾è®¡çš„æƒ…å†µä¸‹è‡ªç„¶è€Œç„¶æ— é™æ¥è¿‘æˆ–è€…è¾¾åˆ°çš„ç»“æœï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç¡¬æ€§çš„ç›®æ ‡ï¼ŒåŠ¡å¿…è¾ƒçœŸã€‚</span><br><span class="line">2. æœ¬ç³»åˆ—çš„ä¸€äº›è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µå¯èƒ½å’ŒåŸæ¦‚å¿µå­˜åœ¨å·®å¼‚ï¼Œå› ä¸ºä¼šç»“åˆå®é™…ä½¿ç”¨ï¼Œå–å…¶ç²¾åï¼Œé€‚å½“æ”¹å˜ï¼Œçµæ´»ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure><h1 id="æ–‡ç« åˆ—è¡¨"><a href="#æ–‡ç« åˆ—è¡¨" class="headerlink" title="æ–‡ç« åˆ—è¡¨"></a>æ–‡ç« åˆ—è¡¨</h1><ul><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/template">ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/responsibility">é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/observer">è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/strategy">å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/state">çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li></ul><blockquote><p><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns">Goè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ— æ›´å¤šæ–‡ç«  ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ä»£ç ç»„ä»¶-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;a href=&quot;#ä»£ç ç»„ä»¶-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot; class=&quot;headerlink&quot; title=&quot;ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;/a&gt;ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</title>
    <link href="http://wangyangyangisme.github.io/posts/c59af70a/"/>
    <id>http://wangyangyangisme.github.io/posts/c59af70a/</id>
    <published>2021-05-16T06:30:57.000Z</published>
    <updated>2021-05-16T06:30:57.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é“¾å¼è°ƒç”¨-Goè®¾è®¡æ¨¡å¼å®æˆ˜"><a href="#é“¾å¼è°ƒç”¨-Goè®¾è®¡æ¨¡å¼å®æˆ˜" class="headerlink" title="é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜"></a>é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</h1><blockquote><p>å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ—ï¼Œä¸€ä¸ªè®¾è®¡æ¨¡å¼ä¸šåŠ¡çœŸå®ä½¿ç”¨çš„golangç³»åˆ—ã€‚</p><p><a href="http://tigerb.cn/">http://tigerb.cn/</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç³»åˆ—ä¸»è¦åˆ†äº«ï¼Œå¦‚ä½•åœ¨æˆ‘ä»¬çš„çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨è®¾è®¡æ¨¡å¼ã€‚</p><p>æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦é‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š</p><ul><li>ä»€ä¹ˆæ˜¯ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ä½¿ç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>æ€ä¹ˆç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li></ul><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ã€Œè´£ä»»é“¾æ¨¡å¼ã€å¦‚ä½•åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯ã€Œè´£ä»»é“¾æ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ã€Œè´£ä»»é“¾æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ã€Œè´£ä»»é“¾æ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ã€Œè´£ä»»é“¾æ¨¡å¼ã€ï¼Ÿ</h2><blockquote><p>é¦–å…ˆæŠŠä¸€ç³»åˆ—ä¸šåŠ¡æŒ‰èŒè´£åˆ’åˆ†æˆä¸åŒçš„å¯¹è±¡ï¼Œæ¥ç€æŠŠè¿™ä¸€ç³»åˆ—å¯¹è±¡æ„æˆä¸€ä¸ªé“¾ï¼Œç„¶ååœ¨è¿™ä¸€ç³»åˆ—å¯¹è±¡ä¸­ä¼ é€’è¯·æ±‚å¯¹è±¡ï¼Œç›´åˆ°è¢«å¤„ç†ä¸ºæ­¢ã€‚</p></blockquote><p>æˆ‘ä»¬ä»æ¦‚å¿µä¸­å¯ä»¥çœ‹å‡ºè´£ä»»é“¾æ¨¡å¼æœ‰å¦‚ä¸‹æ˜æ˜¾çš„ä¼˜åŠ¿ï¼š</p><ul><li>æŒ‰èŒè´£åˆ’åˆ†ï¼šè§£è€¦</li><li>å¯¹è±¡é“¾ï¼šé€»è¾‘æ¸…æ™°</li></ul><p>ä½†æ˜¯æœ‰ä¸€ç‚¹<code>ç›´åˆ°è¢«å¤„ç†ä¸ºæ­¢</code>ï¼Œä»£è¡¨æœ€ç»ˆåªä¼šè¢«ä¸€ä¸ªå®é™…çš„ä¸šåŠ¡å¯¹è±¡æ‰§è¡Œäº†å®é™…çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ˜æ˜¾é€‚ç”¨çš„åœºæ™¯å¹¶ä¸å¤šã€‚ä½†æ˜¯é™¤æ­¤ä¹‹å¤–ï¼Œä¸Šé¢çš„é‚£ä¸¤ç‚¹ä¼˜åŠ¿è¿˜æ˜¯è®©äººå¾ˆå¿ƒåŠ¨ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†é€‚ç”¨äºç›®å‰æ‰€æ¥è§¦çš„ç»å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ï¼ŒæŠŠæ¦‚å¿µè¿›è¡Œäº†ç®€å•çš„è°ƒæ•´ï¼Œå¦‚ä¸‹ï¼š</p><blockquote><p>é¦–å…ˆæŠŠä¸€ç³»åˆ—ä¸šåŠ¡æŒ‰èŒè´£åˆ’åˆ†æˆä¸åŒçš„å¯¹è±¡ï¼Œæ¥ç€æŠŠè¿™ä¸€ç³»åˆ—å¯¹è±¡æ„æˆä¸€ä¸ªé“¾ï¼Œç›´åˆ°â€œé“¾è·¯ç»“æŸâ€ä¸ºæ­¢ã€‚(ç»“æŸï¼šå¼‚å¸¸ç»“æŸï¼Œæˆ–é“¾è·¯æ‰§è¡Œå®Œæ¯•ç»“æŸ)</p></blockquote><p>ç®€å•çš„<code>ç›´åˆ°â€œé“¾è·¯ç»“æŸâ€ä¸ºæ­¢</code>è½¬æ¢å¯ä»¥è®©æˆ‘ä»¬æŠŠè´£ä»»é“¾æ¨¡å¼é€‚ç”¨äºä»»ä½•å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ã€‚</p><p>ä»¥ä¸‹æ˜¯è´£ä»»é“¾æ¨¡å¼çš„å…·ä½“ä¼˜åŠ¿ï¼š</p><ul><li>ç›´è§‚ï¼šä¸€çœ¼å¯è§‚çš„ä¸šåŠ¡è°ƒç”¨è¿‡ç¨‹</li><li>æ— é™æ‰©å±•ï¼šå¯æ— é™æ‰©å±•çš„ä¸šåŠ¡é€»è¾‘</li><li>é«˜åº¦å°è£…ï¼šå¤æ‚ä¸šåŠ¡ä»£ç ä¾ç„¶é«˜åº¦å°è£…</li><li>ææ˜“è¢«ä¿®æ”¹ï¼šå¤æ‚ä¸šåŠ¡ä»£ç ä¸‹ä¿®æ”¹ä»£ç åªéœ€è¦ä¸“æ³¨å¯¹åº”çš„ä¸šåŠ¡ç±»(ç»“æ„ä½“)æ–‡ä»¶å³å¯ï¼Œä»¥åŠææ˜“è¢«è°ƒæ•´çš„ä¸šåŠ¡æ‰§è¡Œé¡ºåº</li></ul><h2 id="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè´£ä»»é“¾æ¨¡å¼-æ”¹-ã€ï¼Ÿ"><a href="#ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè´£ä»»é“¾æ¨¡å¼-æ”¹-ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè´£ä»»é“¾æ¨¡å¼(æ”¹)ã€ï¼Ÿ"></a>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè´£ä»»é“¾æ¨¡å¼(æ”¹)ã€ï¼Ÿ</h2><p>æ»¡è¶³å¦‚ä¸‹è¦æ±‚çš„åœºæ™¯:</p><blockquote><p>ä¸šåŠ¡æåº¦å¤æ‚çš„æ‰€æœ‰åœºæ™¯</p></blockquote><p>ä»»ä½•æ‚ä¹±æ— ç« çš„ä¸šåŠ¡ä»£ç ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼(æ”¹)å»é‡æ„ã€è®¾è®¡ã€‚</p><blockquote><p>æˆ‘ä»¬æœ‰å“ªäº›çœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œè´£ä»»é“¾æ¨¡å¼(æ”¹)ã€å‘¢ï¼Ÿ</p></blockquote><p>æ¯”å¦‚ç”µå•†ç³»ç»Ÿçš„ä¸‹å•æ¥å£ï¼Œéšç€ä¸šåŠ¡å‘å±•ä¸æ–­çš„å‘å±•ï¼Œè¯¥æ¥å£ä¼šå……æ–¥ç€å„ç§å„æ ·çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><h2 id="æ€ä¹ˆç”¨ã€Œè´£ä»»é“¾æ¨¡å¼-æ”¹-ã€ï¼Ÿ"><a href="#æ€ä¹ˆç”¨ã€Œè´£ä»»é“¾æ¨¡å¼-æ”¹-ã€ï¼Ÿ" class="headerlink" title="æ€ä¹ˆç”¨ã€Œè´£ä»»é“¾æ¨¡å¼(æ”¹)ã€ï¼Ÿ"></a>æ€ä¹ˆç”¨ã€Œè´£ä»»é“¾æ¨¡å¼(æ”¹)ã€ï¼Ÿ</h2><p>å…³äºæ€ä¹ˆç”¨ï¼Œå®Œå…¨å¯ä»¥ç”Ÿæ¬ç¡¬å¥—æˆ‘æ€»ç»“çš„ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä¸šåŠ¡æ¢³ç†</li><li>ä¸šåŠ¡æµç¨‹å›¾</li><li>ä»£ç å»ºæ¨¡</li><li>ä»£ç demo</li></ul><h4 id="ä¸šåŠ¡æ¢³ç†"><a href="#ä¸šåŠ¡æ¢³ç†" class="headerlink" title="ä¸šåŠ¡æ¢³ç†"></a>ä¸šåŠ¡æ¢³ç†</h4><table><thead><tr><th>æ­¥éª¤</th><th>é€»è¾‘</th></tr></thead><tbody><tr><td>1</td><td>å‚æ•°æ ¡éªŒ</td></tr><tr><td>2</td><td>è·å–åœ°å€ä¿¡æ¯</td></tr><tr><td>3</td><td>åœ°å€ä¿¡æ¯æ ¡éªŒ</td></tr><tr><td>4</td><td>è·å–è´­ç‰©è½¦æ•°æ®</td></tr><tr><td>5</td><td>è·å–å•†å“åº“å­˜ä¿¡æ¯</td></tr><tr><td>6</td><td>å•†å“åº“å­˜æ ¡éªŒ</td></tr><tr><td>7</td><td>è·å–ä¼˜æƒ ä¿¡æ¯</td></tr><tr><td>8</td><td>è·å–è¿è´¹ä¿¡æ¯</td></tr><tr><td>9</td><td>ä½¿ç”¨ä¼˜æƒ ä¿¡æ¯</td></tr><tr><td>10</td><td>æ‰£åº“å­˜</td></tr><tr><td>11</td><td>æ¸…ç†è´­ç‰©è½¦</td></tr><tr><td>12</td><td>å†™è®¢å•è¡¨</td></tr><tr><td>13</td><td>å†™è®¢å•å•†å“è¡¨</td></tr><tr><td>14</td><td>å†™è®¢å•ä¼˜æƒ ä¿¡æ¯è¡¨</td></tr><tr><td>XX</td><td>ä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘...</td></tr></tbody></table><p>ä¸šåŠ¡çš„ä¸æ–­å‘å±•å˜åŒ–çš„ï¼š</p><ul><li>æ–°çš„ä¸šåŠ¡è¢«å¢åŠ </li><li>æ—§çš„ä¸šåŠ¡è¢«ä¿®æ”¹</li></ul><p>æ¯”å¦‚å¢åŠ çš„æ–°çš„ä¸šåŠ¡ï¼Œè®¢é‡‘é¢„å”®ï¼š</p><ul><li>åœ¨<code>4|è·å–è´­ç‰©è½¦æ•°æ®</code>åï¼Œéœ€è¦æ ¡éªŒå•†å“å‚è§è®¢é‡‘é¢„å”®æ´»åŠ¨çš„æœ‰æ•ˆæ€§ç­‰é€»è¾‘ã€‚</li><li>ç­‰ç­‰é€»è¾‘</li></ul><blockquote><p>æ³¨ï¼šæµç¨‹ä¸ä¸€å®šå®Œå…¨å‡†ç¡®</p></blockquote><h4 id="ä¸šåŠ¡æµç¨‹å›¾"><a href="#ä¸šåŠ¡æµç¨‹å›¾" class="headerlink" title="ä¸šåŠ¡æµç¨‹å›¾"></a>ä¸šåŠ¡æµç¨‹å›¾</h4><p>æˆ‘ä»¬é€šè¿‡æ¢³ç†çš„æ–‡æœ¬ä¸šåŠ¡æµç¨‹å¾—åˆ°äº†å¦‚ä¸‹çš„ä¸šåŠ¡æµç¨‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200327205310.png" alt=""></p><h4 id="ä»£ç å»ºæ¨¡"><a href="#ä»£ç å»ºæ¨¡" class="headerlink" title="ä»£ç å»ºæ¨¡"></a>ä»£ç å»ºæ¨¡</h4><p>è´£ä»»é“¾æ¨¡å¼ä¸»è¦ç±»ä¸»è¦åŒ…å«å¦‚ä¸‹ç‰¹æ€§ï¼š</p><ul><li>æˆå‘˜å±æ€§<ul><li><code>nextHandler</code>: ä¸‹ä¸€ä¸ªç­‰å¾…è¢«è°ƒç”¨çš„å¯¹è±¡å®ä¾‹ -&gt; ç¨³å®šä¸å˜çš„</li></ul></li><li>æˆå‘˜æ–¹æ³•<ul><li><code>SetNext</code>: æŠŠä¸‹ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ç»‘å®šåˆ°å½“å‰å¯¹è±¡çš„<code>nextHandler</code>å±æ€§ä¸Š -&gt; ç¨³å®šä¸å˜çš„</li><li><code>Do</code>: å½“å‰å¯¹è±¡ä¸šåŠ¡é€»è¾‘å…¥å£ -&gt; å˜åŒ–çš„</li><li><code>Run</code>: è°ƒç”¨å½“å‰å¯¹è±¡çš„<code>Do</code>ï¼Œ<code>nextHandler</code>ä¸ä¸ºç©ºåˆ™è°ƒç”¨<code>nextHandler.Do</code> -&gt; ç¨³å®šä¸å˜çš„</li></ul></li></ul><p>å¥—ç”¨åˆ°ä¸‹å•æ¥å£ä¼ªä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ä¸ªçˆ¶ç±»(æŠ½è±¡ç±»)ï¼š</span><br><span class="line"></span><br><span class="line">- æˆå‘˜å±æ€§</span><br><span class="line">+ &#96;nextHandler&#96;: ä¸‹ä¸€ä¸ªç­‰å¾…è¢«è°ƒç”¨çš„å¯¹è±¡å®ä¾‹</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ å®ä½“æ–¹æ³•&#96;SetNext&#96;: å®ç°æŠŠä¸‹ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ç»‘å®šåˆ°å½“å‰å¯¹è±¡çš„&#96;nextHandler&#96;å±æ€§ä¸Š</span><br><span class="line">+ æŠ½è±¡æ–¹æ³•&#96;Do&#96;: å½“å‰å¯¹è±¡ä¸šåŠ¡é€»è¾‘å…¥å£</span><br><span class="line">+ å®ä½“æ–¹æ³•&#96;Run&#96;: å®ç°è°ƒç”¨å½“å‰å¯¹è±¡çš„&#96;Do&#96;ï¼Œ&#96;nextHandler&#96;ä¸ä¸ºç©ºåˆ™è°ƒç”¨&#96;nextHandler.Do&#96;</span><br><span class="line"></span><br><span class="line">å­ç±»ä¸€(å‚æ•°æ ¡éªŒ)</span><br><span class="line">- ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•&#96;Do&#96;ï¼šå…·ä½“çš„å‚æ•°æ ¡éªŒé€»è¾‘</span><br><span class="line"></span><br><span class="line">å­ç±»äºŒ(è·å–åœ°å€ä¿¡æ¯)</span><br><span class="line">- ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•&#96;Do&#96;ï¼šå…·ä½“è·å–åœ°å€ä¿¡æ¯çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">å­ç±»ä¸‰(è·å–è´­ç‰©è½¦æ•°æ®)</span><br><span class="line">- ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•&#96;Do&#96;ï¼šå…·ä½“è·å–è´­ç‰©è½¦æ•°æ®çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">......ç•¥</span><br><span class="line"></span><br><span class="line">å­ç±»X(ä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘)</span><br><span class="line">- ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•&#96;Do&#96;ï¼šä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œgolangé‡Œæ²¡æœ‰çš„ç»§æ‰¿çš„æ¦‚å¿µï¼Œè¦å¤ç”¨æˆå‘˜å±æ€§<code>nextHandler</code>ã€æˆå‘˜æ–¹æ³•<code>SetNext</code>ã€æˆå‘˜æ–¹æ³•<code>Run</code>æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨<code>åˆæˆå¤ç”¨</code>çš„ç‰¹æ€§å˜ç›¸è¾¾åˆ°â€œç»§æ‰¿å¤ç”¨â€çš„ç›®çš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ä¸ªæ¥å£(interface)ï¼š</span><br><span class="line"></span><br><span class="line">- æŠ½è±¡æ–¹æ³•&#96;SetNext&#96;: å¾…å®ç°æŠŠä¸‹ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ç»‘å®šåˆ°å½“å‰å¯¹è±¡çš„&#96;nextHandler&#96;å±æ€§ä¸Š</span><br><span class="line">- æŠ½è±¡æ–¹æ³•&#96;Do&#96;: å¾…å®ç°å½“å‰å¯¹è±¡ä¸šåŠ¡é€»è¾‘å…¥å£</span><br><span class="line">- æŠ½è±¡æ–¹æ³•&#96;Run&#96;: å¾…å®ç°è°ƒç”¨å½“å‰å¯¹è±¡çš„&#96;Do&#96;ï¼Œ&#96;nextHandler&#96;ä¸ä¸ºç©ºåˆ™è°ƒç”¨&#96;nextHandler.Do&#96;</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªåŸºç¡€ç»“æ„ä½“ï¼š</span><br><span class="line"></span><br><span class="line">- æˆå‘˜å±æ€§</span><br><span class="line">+ &#96;nextHandler&#96;: ä¸‹ä¸€ä¸ªç­‰å¾…è¢«è°ƒç”¨çš„å¯¹è±¡å®ä¾‹</span><br><span class="line">- æˆå‘˜æ–¹æ³•</span><br><span class="line">+ å®ä½“æ–¹æ³•&#96;SetNext&#96;: å®ç°æŠŠä¸‹ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ç»‘å®šåˆ°å½“å‰å¯¹è±¡çš„&#96;nextHandler&#96;å±æ€§ä¸Š</span><br><span class="line">+ å®ä½“æ–¹æ³•&#96;Run&#96;: å®ç°è°ƒç”¨å½“å‰å¯¹è±¡çš„&#96;Do&#96;ï¼Œ&#96;nextHandler&#96;ä¸ä¸ºç©ºåˆ™è°ƒç”¨&#96;nextHandler.Do&#96;</span><br><span class="line"></span><br><span class="line">å­ç±»ä¸€(å‚æ•°æ ¡éªŒ)</span><br><span class="line">- åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•&#96;Do&#96;ï¼šå…·ä½“çš„å‚æ•°æ ¡éªŒé€»è¾‘</span><br><span class="line"></span><br><span class="line">å­ç±»äºŒ(è·å–åœ°å€ä¿¡æ¯)</span><br><span class="line">- åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•&#96;Do&#96;ï¼šå…·ä½“è·å–åœ°å€ä¿¡æ¯çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">å­ç±»ä¸‰(è·å–è´­ç‰©è½¦æ•°æ®)</span><br><span class="line">- åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•&#96;Do&#96;ï¼šå…·ä½“è·å–è´­ç‰©è½¦æ•°æ®çš„é€»è¾‘</span><br><span class="line"></span><br><span class="line">......ç•¥</span><br><span class="line"></span><br><span class="line">å­ç±»X(ä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘)</span><br><span class="line">- åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•&#96;Do&#96;ï¼šä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘</span><br></pre></td></tr></table></figure><p>åŒæ—¶å¾—åˆ°äº†æˆ‘ä»¬çš„UMLå›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200328220913.jpg" alt=""></p><h4 id="ä»£ç demo"><a href="#ä»£ç demo" class="headerlink" title="ä»£ç demo"></a>ä»£ç demo</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//è´£ä»»é“¾æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//---------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context Context</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handler å¤„ç†</span></span><br><span class="line"><span class="keyword">type</span> Handler <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// è‡ªèº«çš„ä¸šåŠ¡</span></span><br><span class="line">Do(c *Context) error</span><br><span class="line"><span class="comment">// è®¾ç½®ä¸‹ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">SetNext(h Handler) Handler</span><br><span class="line"><span class="comment">// æ‰§è¡Œ</span></span><br><span class="line">Run(c *Context) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Next æŠ½è±¡å‡ºæ¥çš„ å¯è¢«åˆæˆå¤ç”¨çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> Next <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// ä¸‹ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">nextHandler Handler</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetNext å®ç°å¥½çš„ å¯è¢«å¤ç”¨çš„SetNextæ–¹æ³•</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼æ˜¯ä¸‹ä¸€ä¸ªå¯¹è±¡ æ–¹ä¾¿å†™æˆé“¾å¼ä»£ç ä¼˜é›…</span></span><br><span class="line"><span class="comment">// ä¾‹å¦‚ nullHandler.SetNext(argumentsHandler).SetNext(signHandler).SetNext(frequentHandler)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Next)</span> <span class="title">SetNext</span><span class="params">(h Handler)</span> <span class="title">Handler</span></span> &#123;</span><br><span class="line">n.nextHandler = h</span><br><span class="line"><span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run æ‰§è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Next)</span> <span class="title">Run</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// ç”±äºgoæ— ç»§æ‰¿çš„æ¦‚å¿µ è¿™é‡Œæ— æ³•æ‰§è¡Œå½“å‰handlerçš„Do</span></span><br><span class="line"><span class="comment">// n.Do(c)</span></span><br><span class="line"><span class="keyword">if</span> n.nextHandler != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨ä¸‹çš„å˜ç§</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œä¸‹ä¸€ä¸ªhandlerçš„Do</span></span><br><span class="line"><span class="keyword">if</span> err = (n.nextHandler).Do(c); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œä¸‹ä¸€ä¸ªhandlerçš„Run</span></span><br><span class="line"><span class="keyword">return</span> (n.nextHandler).Run(c)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NullHandler ç©ºHandler</span></span><br><span class="line"><span class="comment">// ç”±äºgoæ— ç»§æ‰¿çš„æ¦‚å¿µ ä½œä¸ºé“¾å¼è°ƒç”¨çš„ç¬¬ä¸€ä¸ªè½½ä½“ è®¾ç½®å®é™…çš„ä¸‹ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> NullHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Nextçš„`nextHandler`æˆå‘˜å±æ€§ã€`SetNext`æˆå‘˜æ–¹æ³•ã€`Run`æˆå‘˜æ–¹æ³•</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do ç©ºHandlerçš„Do</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *NullHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// ç©ºHandler è¿™é‡Œä»€ä¹ˆä¹Ÿä¸åš åªæ˜¯è½½ä½“ do nothing...</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ArgumentsHandler æ ¡éªŒå‚æ•°çš„handler</span></span><br><span class="line"><span class="keyword">type</span> ArgumentsHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *ArgumentsHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ ¡éªŒå‚æ•°æˆåŠŸ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddressInfoHandler åœ°å€ä¿¡æ¯handler</span></span><br><span class="line"><span class="keyword">type</span> AddressInfoHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *AddressInfoHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–åœ°å€ä¿¡æ¯...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;åœ°å€ä¿¡æ¯æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CartInfoHandler è·å–è´­ç‰©è½¦æ•°æ®handler</span></span><br><span class="line"><span class="keyword">type</span> CartInfoHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *CartInfoHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–è´­ç‰©è½¦æ•°æ®...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StockInfoHandler å•†å“åº“å­˜handler</span></span><br><span class="line"><span class="keyword">type</span> StockInfoHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *StockInfoHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–å•†å“åº“å­˜ä¿¡æ¯...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å•†å“åº“å­˜æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PromotionInfoHandler è·å–ä¼˜æƒ ä¿¡æ¯handler</span></span><br><span class="line"><span class="keyword">type</span> PromotionInfoHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *PromotionInfoHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–ä¼˜æƒ ä¿¡æ¯...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ShipmentInfoHandler è·å–è¿è´¹ä¿¡æ¯handler</span></span><br><span class="line"><span class="keyword">type</span> ShipmentInfoHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *ShipmentInfoHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–è¿è´¹ä¿¡æ¯...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PromotionUseHandler ä½¿ç”¨ä¼˜æƒ ä¿¡æ¯handler</span></span><br><span class="line"><span class="keyword">type</span> PromotionUseHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *PromotionUseHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ä½¿ç”¨ä¼˜æƒ ä¿¡æ¯...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StockSubtractHandler åº“å­˜æ“ä½œhandler</span></span><br><span class="line"><span class="keyword">type</span> StockSubtractHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *StockSubtractHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ‰£åº“å­˜...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CartDelHandler æ¸…ç†è´­ç‰©è½¦handler</span></span><br><span class="line"><span class="keyword">type</span> CartDelHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *CartDelHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ¸…ç†è´­ç‰©è½¦...&quot;</span>)</span><br><span class="line"><span class="comment">// err = fmt.Errorf(&quot;CartDelHandler.Do fail&quot;)</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DBTableOrderHandler å†™è®¢å•è¡¨handler</span></span><br><span class="line"><span class="keyword">type</span> DBTableOrderHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *DBTableOrderHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å†™è®¢å•è¡¨...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DBTableOrderSkusHandler å†™è®¢å•å•†å“è¡¨handler</span></span><br><span class="line"><span class="keyword">type</span> DBTableOrderSkusHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *DBTableOrderSkusHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å†™è®¢å•å•†å“è¡¨...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DBTableOrderPromotionsHandler å†™è®¢å•ä¼˜æƒ ä¿¡æ¯è¡¨handler</span></span><br><span class="line"><span class="keyword">type</span> DBTableOrderPromotionsHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *DBTableOrderPromotionsHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å†™è®¢å•ä¼˜æƒ ä¿¡æ¯è¡¨...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ­£åœ¨è¿è¡Œçš„å‡½æ•°å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runFuncName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">pc := <span class="built_in">make</span>([]<span class="keyword">uintptr</span>, <span class="number">1</span>)</span><br><span class="line">runtime.Callers(<span class="number">2</span>, pc)</span><br><span class="line">f := runtime.FuncForPC(pc[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> f.Name()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ç©ºhandler</span></span><br><span class="line">nullHandler := &amp;NullHandler&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é“¾å¼è°ƒç”¨ ä»£ç æ˜¯ä¸æ˜¯å¾ˆä¼˜é›…</span></span><br><span class="line"><span class="comment">// å¾ˆæ˜æ˜¾çš„é“¾ é€»è¾‘å…³ç³»ä¸€è§ˆæ— ä½™</span></span><br><span class="line">nullHandler.SetNext(&amp;ArgumentsHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;AddressInfoHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;CartInfoHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;StockInfoHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;PromotionInfoHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;ShipmentInfoHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;PromotionUseHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;StockSubtractHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;CartDelHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;DBTableOrderHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;DBTableOrderSkusHandler&#123;&#125;).</span><br><span class="line">SetNext(&amp;DBTableOrderPromotionsHandler&#123;&#125;)</span><br><span class="line"><span class="comment">//æ— é™æ‰©å±•ä»£ç ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å§‹æ‰§è¡Œä¸šåŠ¡</span></span><br><span class="line"><span class="keyword">if</span> err := nullHandler.Run(&amp;Context&#123;&#125;); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="comment">// å¼‚å¸¸</span></span><br><span class="line">fmt.Println(<span class="string">&quot;Fail | Error:&quot;</span> + err.Error())</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æˆåŠŸ</span></span><br><span class="line">fmt.Println(<span class="string">&quot;Success&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Running] go run &quot;..&#x2F;easy-tips&#x2F;go&#x2F;src&#x2F;patterns&#x2F;responsibility&#x2F;responsibility-order-submit.go&quot;</span><br><span class="line">main.(*ArgumentsHandler).Do æ ¡éªŒå‚æ•°æˆåŠŸ...</span><br><span class="line">main.(*AddressInfoHandler).Do è·å–åœ°å€ä¿¡æ¯...</span><br><span class="line">main.(*AddressInfoHandler).Do åœ°å€ä¿¡æ¯æ ¡éªŒ...</span><br><span class="line">main.(*CartInfoHandler).Do è·å–è´­ç‰©è½¦æ•°æ®...</span><br><span class="line">main.(*StockInfoHandler).Do è·å–å•†å“åº“å­˜ä¿¡æ¯...</span><br><span class="line">main.(*StockInfoHandler).Do å•†å“åº“å­˜æ ¡éªŒ...</span><br><span class="line">main.(*PromotionInfoHandler).Do è·å–ä¼˜æƒ ä¿¡æ¯...</span><br><span class="line">main.(*ShipmentInfoHandler).Do è·å–è¿è´¹ä¿¡æ¯...</span><br><span class="line">main.(*PromotionUseHandler).Do ä½¿ç”¨ä¼˜æƒ ä¿¡æ¯...</span><br><span class="line">main.(*StockSubtractHandler).Do æ‰£åº“å­˜...</span><br><span class="line">main.(*CartDelHandler).Do æ¸…ç†è´­ç‰©è½¦...</span><br><span class="line">main.(*DBTableOrderHandler).Do å†™è®¢å•è¡¨...</span><br><span class="line">main.(*DBTableOrderSkusHandler).Do å†™è®¢å•å•†å“è¡¨...</span><br><span class="line">main.(*DBTableOrderPromotionsHandler).Do å†™è®¢å•ä¼˜æƒ ä¿¡æ¯è¡¨...</span><br><span class="line">Success</span><br></pre></td></tr></table></figure><h4 id="demo2"><a href="#demo2" class="headerlink" title="demo2"></a>demo2</h4><p>middlewares</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//è´£ä»»é“¾æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//---------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context Context</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handler å¤„ç†</span></span><br><span class="line"><span class="keyword">type</span> Handler <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// è‡ªèº«çš„ä¸šåŠ¡</span></span><br><span class="line">Do(c *Context) error</span><br><span class="line"><span class="comment">// è®¾ç½®ä¸‹ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">SetNext(h Handler) Handler</span><br><span class="line"><span class="comment">// æ‰§è¡Œ</span></span><br><span class="line">Run(c *Context)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Next æŠ½è±¡å‡ºæ¥çš„ å¯è¢«åˆæˆå¤ç”¨çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> Next <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// ä¸‹ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">nextHandler Handler</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetNext å®ç°å¥½çš„ å¯è¢«å¤ç”¨çš„SetNextæ–¹æ³•</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼æ˜¯ä¸‹ä¸€ä¸ªå¯¹è±¡ æ–¹ä¾¿å†™æˆé“¾å¼ä»£ç ä¼˜é›…</span></span><br><span class="line"><span class="comment">// ä¾‹å¦‚ nullHandler.SetNext(argumentsHandler).SetNext(signHandler).SetNext(frequentHandler)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Next)</span> <span class="title">SetNext</span><span class="params">(h Handler)</span> <span class="title">Handler</span></span> &#123;</span><br><span class="line">n.nextHandler = h</span><br><span class="line"><span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run æ‰§è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Next)</span> <span class="title">Run</span><span class="params">(c *Context)</span></span> &#123;</span><br><span class="line"><span class="comment">// ç”±äºgoæ— ç»§æ‰¿çš„æ¦‚å¿µ è¿™é‡Œæ— æ³•æ‰§è¡Œå½“å‰handlerçš„Do</span></span><br><span class="line"><span class="comment">// n.Do(c)</span></span><br><span class="line"><span class="keyword">if</span> n.nextHandler != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨ä¸‹çš„å˜ç§</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œä¸‹ä¸€ä¸ªhandlerçš„Do</span></span><br><span class="line">(n.nextHandler).Do(c)</span><br><span class="line"><span class="comment">// æ‰§è¡Œä¸‹ä¸€ä¸ªhandlerçš„Run</span></span><br><span class="line">(n.nextHandler).Run(c)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NullHandler ç©ºHandler</span></span><br><span class="line"><span class="comment">// ç”±äºgoæ— ç»§æ‰¿çš„æ¦‚å¿µ ä½œä¸ºé“¾å¼è°ƒç”¨çš„ç¬¬ä¸€ä¸ªè½½ä½“ è®¾ç½®å®é™…çš„ä¸‹ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> NullHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Nextçš„`nextHandler`æˆå‘˜å±æ€§ã€`SetNext`æˆå‘˜æ–¹æ³•ã€`Run`æˆå‘˜æ–¹æ³•</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do ç©ºHandlerçš„Do</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *NullHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// ç©ºHandler è¿™é‡Œä»€ä¹ˆä¹Ÿä¸åš åªæ˜¯è½½ä½“ do nothing...</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SignHandler æ ¡éªŒè¯·æ±‚ç­¾åçš„handler</span></span><br><span class="line"><span class="keyword">type</span> SignHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒè¯·æ±‚ç­¾åé€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *SignHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;æ ¡éªŒç­¾åæˆåŠŸ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ArgumentsHandler æ ¡éªŒå‚æ•°çš„handler</span></span><br><span class="line"><span class="keyword">type</span> ArgumentsHandler <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨Next</span></span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *ArgumentsHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;æ ¡éªŒå‚æ•°æˆåŠŸ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FrequentHandler æ ¡éªŒè¯·æ±‚é¢‘ç‡çš„hanlder</span></span><br><span class="line"><span class="keyword">type</span> FrequentHandler <span class="keyword">struct</span> &#123;</span><br><span class="line">Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do æ ¡éªŒè¯·æ±‚é¢‘ç‡é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *FrequentHandler)</span> <span class="title">Do</span><span class="params">(c *Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;æ ¡éªŒè¯·æ±‚é¢‘ç‡æˆåŠŸ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ç©ºhandler</span></span><br><span class="line">nullHandler := &amp;NullHandler&#123;&#125;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å‚æ•°handler</span></span><br><span class="line">argumentsHandler := &amp;ArgumentsHandler&#123;&#125;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ç­¾åhandler</span></span><br><span class="line">signHandler := &amp;SignHandler&#123;&#125;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–é¢‘ç‡handler</span></span><br><span class="line">frequentHandler := &amp;FrequentHandler&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é“¾å¼è°ƒç”¨ ä»£ç æ˜¯ä¸æ˜¯å¾ˆä¼˜é›…</span></span><br><span class="line"><span class="comment">// å¾ˆæ˜æ˜¾çš„é“¾ é€»è¾‘å…³ç³»ä¸€è§ˆæ— ä½™</span></span><br><span class="line">nullHandler.SetNext(argumentsHandler).SetNext(signHandler).SetNext(frequentHandler)</span><br><span class="line">nullHandler.Run(&amp;Context&#123;&#125;)</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;----------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">middlewares := <span class="built_in">make</span>([]Handler, <span class="number">0</span>)</span><br><span class="line">middlewares = <span class="built_in">append</span>(middlewares, nullHandler)</span><br><span class="line">middlewares = <span class="built_in">append</span>(middlewares, argumentsHandler)</span><br><span class="line">middlewares = <span class="built_in">append</span>(middlewares, signHandler)</span><br><span class="line">middlewares = <span class="built_in">append</span>(middlewares, frequentHandler)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, handler := <span class="keyword">range</span> middlewares &#123;</span><br><span class="line"><span class="keyword">if</span> k == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">middlewares[k<span class="number">-1</span>].SetNext(handler)</span><br><span class="line">&#125;</span><br><span class="line">nullHandler.Run(&amp;Context&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ€åæ€»ç»“ä¸‹ï¼Œã€Œè´£ä»»é“¾æ¨¡å¼(æ”¹)ã€æŠ½è±¡è¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯ï¼š</p><ul><li>æŒ‰èŒè´£åˆ’åˆ†ï¼šä¸šåŠ¡é€»è¾‘å½’ç±»ï¼Œæ”¶æ•›çš„è¿‡ç¨‹ã€‚</li><li>å¯¹è±¡é“¾ï¼šæŠŠæ”¶æ•›ä¹‹åçš„ä¸šåŠ¡å¯¹è±¡æ„æˆå¯¹è±¡é“¾ï¼Œä¾æ¬¡è¢«æ‰§è¡Œã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹åˆ«è¯´æ˜ï¼š</span><br><span class="line">1. æˆ‘çš„ä»£ç æ²¡æœ‰&#96;else&#96;ï¼Œåªæ˜¯ä¸€ä¸ªåœ¨ä»£ç åˆç†è®¾è®¡çš„æƒ…å†µä¸‹è‡ªç„¶è€Œç„¶æ— é™æ¥è¿‘æˆ–è€…è¾¾åˆ°çš„ç»“æœï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç¡¬æ€§çš„ç›®æ ‡ï¼ŒåŠ¡å¿…è¾ƒçœŸã€‚</span><br><span class="line">2. æœ¬ç³»åˆ—çš„ä¸€äº›è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µå¯èƒ½å’ŒåŸæ¦‚å¿µå­˜åœ¨å·®å¼‚ï¼Œå› ä¸ºä¼šç»“åˆå®é™…ä½¿ç”¨ï¼Œå–å…¶ç²¾åï¼Œé€‚å½“æ”¹å˜ï¼Œçµæ´»ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure><h1 id="æ–‡ç« åˆ—è¡¨"><a href="#æ–‡ç« åˆ—è¡¨" class="headerlink" title="æ–‡ç« åˆ—è¡¨"></a>æ–‡ç« åˆ—è¡¨</h1><ul><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/template">ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/responsibility">é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/observer">è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/strategy">å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/state">çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li></ul><blockquote><p><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns">Goè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ— æ›´å¤šæ–‡ç«  ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;é“¾å¼è°ƒç”¨-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;a href=&quot;#é“¾å¼è°ƒç”¨-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot; class=&quot;headerlink&quot; title=&quot;é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;/a&gt;é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</title>
    <link href="http://wangyangyangisme.github.io/posts/e7bf6f31/"/>
    <id>http://wangyangyangisme.github.io/posts/e7bf6f31/</id>
    <published>2021-05-16T06:30:56.000Z</published>
    <updated>2021-05-16T06:30:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»£ç æ¨¡æ¿-Goè®¾è®¡æ¨¡å¼å®æˆ˜"><a href="#ä»£ç æ¨¡æ¿-Goè®¾è®¡æ¨¡å¼å®æˆ˜" class="headerlink" title="ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜"></a>ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</h1><blockquote><p>å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ—ï¼Œä¸€ä¸ªè®¾è®¡æ¨¡å¼ä¸šåŠ¡çœŸå®ä½¿ç”¨çš„golangç³»åˆ—ã€‚</p><p><a href="http://tigerb.cn/">http://tigerb.cn/</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç³»åˆ—ä¸»è¦åˆ†äº«ï¼Œå¦‚ä½•åœ¨æˆ‘ä»¬çš„çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨è®¾è®¡æ¨¡å¼ã€‚</p><p>æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦é‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š</p><ul><li>ä»€ä¹ˆæ˜¯ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ä½¿ç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li><li>æ€ä¹ˆç”¨ã€ŒXXè®¾è®¡æ¨¡å¼ã€ï¼Ÿ</li></ul><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ã€Œæ¨¡æ¿æ¨¡å¼ã€å¦‚ä½•åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ</h2><p>æŠ½è±¡ç±»é‡Œå®šä¹‰å¥½<strong>ç®—æ³•çš„æ‰§è¡Œæ­¥éª¤</strong>å’Œ<strong>å…·ä½“ç®—æ³•</strong>ï¼Œä»¥åŠå¯èƒ½å‘ç”Ÿå˜åŒ–çš„ç®—æ³•å®šä¹‰ä¸º<strong>æŠ½è±¡æ–¹æ³•</strong>ã€‚ä¸åŒçš„å­ç±»ç»§æ‰¿è¯¥æŠ½è±¡ç±»ï¼Œå¹¶å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ã€‚</p><p>æ¨¡æ¿æ¨¡å¼çš„ä¼˜åŠ¿ï¼š</p><ul><li>ä¸å˜çš„ç®—æ³•è¢«ç»§æ‰¿å¤ç”¨ï¼šä¸å˜çš„éƒ¨åˆ†é«˜åº¦å°è£…ã€å¤ç”¨ã€‚</li><li>å˜åŒ–çš„ç®—æ³•å­ç±»ç»§æ‰¿å¹¶å…·ä½“å®ç°ï¼šå˜åŒ–çš„éƒ¨åˆ†å­ç±»åªéœ€è¦å…·ä½“å®ç°æŠ½è±¡çš„éƒ¨åˆ†å³å¯ï¼Œæ–¹ä¾¿æ‰©å±•ï¼Œä¸”å¯æ— é™æ‰©å±•ã€‚</li></ul><h2 id="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ"><a href="#ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ"></a>ä»€ä¹ˆçœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ</h2><p>æ»¡è¶³å¦‚ä¸‹è¦æ±‚çš„æ‰€æœ‰åœºæ™¯:</p><blockquote><p>ç®—æ³•æ‰§è¡Œçš„æ­¥éª¤æ˜¯ç¨³å®š<strong>ä¸å˜çš„</strong>ï¼Œä½†æ˜¯å…·ä½“çš„æŸäº›ç®—æ³•å¯èƒ½å­˜åœ¨<strong>å˜</strong>åŒ–çš„åœºæ™¯ã€‚</p></blockquote><p>æ€ä¹ˆç†è§£ï¼Œä¸¾ä¸ªä¾‹å­ï¼š<code>æ¯”å¦‚è¯´ä½ ç…®ä¸ªé¢ï¼Œå¿…ç„¶éœ€è¦å…ˆçƒ§æ°´ï¼Œæ°´çƒ§å¼€ä¹‹åå†æ”¾é¢è¿›å»</code>ï¼Œä»¥ä¸Šçš„æµç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸º<code>ç…®é¢è¿‡ç¨‹</code>ã€‚å¯çŸ¥ï¼šè¿™ä¸ª<code>ç…®é¢è¿‡ç¨‹</code>çš„æ­¥éª¤æ˜¯ç¨³å®šä¸å˜çš„ï¼Œä½†æ˜¯åœ¨ä¸åŒçš„ç¯å¢ƒçƒ§æ°´çš„æ–¹å¼å¯èƒ½ä¸å°½ç›¸åŒï¼Œä¹Ÿè®¸æœ‰çš„äººç”¨å¤©ç„¶æ°”çƒ§æ°´ã€æœ‰çš„äººç”¨ç”µç£ç‚‰çƒ§æ°´ã€æœ‰çš„äººç”¨æŸ´ç«çƒ§æ°´ï¼Œç­‰ç­‰ã€‚æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ç»“è®ºï¼š</p><ul><li><code>ç…®é¢è¿‡ç¨‹</code>çš„æ­¥éª¤æ˜¯ç¨³å®šä¸å˜çš„</li><li><code>ç…®é¢è¿‡ç¨‹</code>çš„çƒ§æ°´æ–¹å¼æ˜¯å¯å˜çš„</li></ul><blockquote><p>æˆ‘ä»¬æœ‰å“ªäº›çœŸå®ä¸šåŠ¡åœºæ™¯å¯ä»¥ç”¨ã€Œæ¨¡æ¿æ¨¡å¼ã€å‘¢ï¼Ÿ</p></blockquote><p>æ¯”å¦‚æŠ½å¥–ç³»ç»Ÿçš„æŠ½å¥–æ¥å£ï¼Œä¸ºä»€ä¹ˆï¼š</p><ul><li>æŠ½å¥–çš„æ­¥éª¤æ˜¯ç¨³å®šä¸å˜çš„ -&gt; <strong>ä¸å˜çš„</strong>ç®—æ³•æ‰§è¡Œæ­¥éª¤</li><li>ä¸åŒæŠ½å¥–ç±»å‹æ´»åŠ¨åœ¨æŸäº›é€»è¾‘å¤„ç†æ–¹å¼å¯èƒ½ä¸åŒ -&gt; <strong>å˜çš„</strong>æŸäº›ç®—æ³•</li></ul><h2 id="æ€ä¹ˆç”¨ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ"><a href="#æ€ä¹ˆç”¨ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ" class="headerlink" title="æ€ä¹ˆç”¨ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ"></a>æ€ä¹ˆç”¨ã€Œæ¨¡æ¿æ¨¡å¼ã€ï¼Ÿ</h2><p>å…³äºæ€ä¹ˆç”¨ï¼Œå®Œå…¨å¯ä»¥ç”Ÿæ¬ç¡¬å¥—æˆ‘æ€»ç»“çš„ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä¸šåŠ¡æ¢³ç†</li><li>ä¸šåŠ¡æµç¨‹å›¾</li><li>ä»£ç å»ºæ¨¡</li><li>ä»£ç demo</li></ul><h4 id="ä¸šåŠ¡æ¢³ç†"><a href="#ä¸šåŠ¡æ¢³ç†" class="headerlink" title="ä¸šåŠ¡æ¢³ç†"></a>ä¸šåŠ¡æ¢³ç†</h4><p>æˆ‘é€šè¿‡å†å²ä¸Šæ¥è§¦è¿‡çš„å„ç§æŠ½å¥–åœºæ™¯ï¼ˆçº¢åŒ…é›¨ã€ç³–æœé›¨ã€æ‰“åœ°é¼ ã€å¤§è½¬ç›˜(ä¹å®«æ ¼)ã€è€ƒçœ¼åŠ›ã€ç­”é¢˜é—¯å…³ã€æ¸¸æˆé—¯å…³ã€æ”¯ä»˜åˆ®åˆ®ä¹ã€ç§¯åˆ†åˆ®åˆ®ä¹ç­‰ç­‰ï¼‰ï¼ŒæŒ‰ç…§çœŸå®ä¸šåŠ¡éœ€æ±‚æ¢³ç†äº†ä»¥ä¸‹æŠ½å¥–ä¸šåŠ¡æŠ½å¥–æ¥å£çš„å¤§è‡´æ–‡æœ¬æµç¨‹ã€‚</p><p>äº†è§£å…·ä½“ä¸šåŠ¡è¯·ç‚¹å‡»<a href="http://tigerb.cn/2019/12/23/skr-lottery/">ã€Šé€šç”¨æŠ½å¥–å·¥å…·ä¹‹éœ€æ±‚åˆ†æ | SkrShopã€‹</a></p><table><thead><tr><th>ä¸»æ­¥éª¤</th><th>ä¸»é€»è¾‘</th><th>æŠ½å¥–ç±»å‹</th><th>å­æ­¥éª¤</th><th>å­é€»è¾‘</th></tr></thead><tbody><tr><td>1</td><td>æ ¡éªŒæ´»åŠ¨ç¼–å·(serial_no)æ˜¯å¦å­˜åœ¨ã€å¹¶è·å–æ´»åŠ¨ä¿¡æ¯</td><td>-</td><td>-</td><td>-</td></tr><tr><td>2</td><td>æ ¡éªŒæ´»åŠ¨ã€åœºæ¬¡æ˜¯å¦æ­£åœ¨è¿›è¡Œ</td><td>-</td><td>-</td><td>-</td></tr><tr><td>3</td><td>å…¶ä»–å‚æ•°æ ¡éªŒ(<strong>ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ</strong>)</td><td>-</td><td>-</td><td>-</td></tr><tr><td>4</td><td>æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ(åŒæ—¶æ‰£å‡)</td><td>-</td><td>-</td><td>-</td></tr><tr><td>5</td><td>æ´»åŠ¨æ˜¯å¦éœ€è¦æ¶ˆè´¹ç§¯åˆ†</td><td>-</td><td>-</td><td>-</td></tr><tr><td>6</td><td>åœºæ¬¡æŠ½å¥–æ¬¡æ•°æ ¡éªŒ(åŒæ—¶æ‰£å‡)</td><td>-</td><td>-</td><td>-</td></tr><tr><td>7</td><td>è·å–åœºæ¬¡å¥–å“ä¿¡æ¯</td><td>-</td><td>-</td><td>-</td></tr><tr><td>8</td><td>è·å–nodeå¥–å“ä¿¡æ¯(<strong>ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ</strong>)</td><td><strong>æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹</strong></td><td>1</td><td>do nothing(æŠ½å–è¯¥åœºæ¬¡çš„å¥–å“å³å¯ï¼Œæ— éœ€å…¶ä»–é€»è¾‘)</td></tr><tr><td>8</td><td></td><td><strong>æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–ç±»å‹</strong></td><td>1</td><td>åˆ¤æ–­æ˜¯è¯¥ç”¨æˆ·ç¬¬å‡ æ¬¡æŠ½å¥–</td></tr><tr><td>8</td><td></td><td></td><td>2</td><td>è·å–å¯¹åº”nodeçš„å¥–å“ä¿¡æ¯</td></tr><tr><td>8</td><td></td><td></td><td>3</td><td>å¤å†™åŸæ‰€æœ‰å¥–å“ä¿¡æ¯(æŠ½å–è¯¥nodeèŠ‚ç‚¹çš„å¥–å“)</td></tr><tr><td>8</td><td></td><td><strong>æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–</strong></td><td>1</td><td>åˆ¤æ–­å±äºå“ªä¸ªæ•°é¢åŒºé—´</td></tr><tr><td>8</td><td></td><td></td><td>2</td><td>è·å–å¯¹åº”nodeçš„å¥–å“ä¿¡æ¯</td></tr><tr><td>8</td><td></td><td></td><td>3</td><td>å¤å†™åŸæ‰€æœ‰å¥–å“ä¿¡æ¯(æŠ½å–è¯¥nodeèŠ‚ç‚¹çš„å¥–å“)</td></tr><tr><td>9</td><td>æŠ½å¥–</td><td>-</td><td>-</td><td>-</td></tr><tr><td>10</td><td>å¥–å“æ•°é‡åˆ¤æ–­</td><td>-</td><td>-</td><td>-</td></tr><tr><td>11</td><td>ç»„è£…å¥–å“ä¿¡æ¯</td><td>-</td><td>-</td><td>-</td></tr></tbody></table><blockquote><p>æ³¨ï¼šæµç¨‹ä¸ä¸€å®šå®Œå…¨å‡†ç¡®</p></blockquote><p>ç»“è®ºï¼š</p><ul><li><code>ä¸»é€»è¾‘</code>æ˜¯ç¨³å®šä¸å˜çš„</li><li><code>å…¶ä»–å‚æ•°æ ¡éªŒ</code>å’Œ<code>è·å–nodeå¥–å“ä¿¡æ¯</code>çš„ç®—æ³•æ˜¯å¯å˜çš„</li></ul><h4 id="ä¸šåŠ¡æµç¨‹å›¾"><a href="#ä¸šåŠ¡æµç¨‹å›¾" class="headerlink" title="ä¸šåŠ¡æµç¨‹å›¾"></a>ä¸šåŠ¡æµç¨‹å›¾</h4><p>æˆ‘ä»¬é€šè¿‡æ¢³ç†çš„æ–‡æœ¬ä¸šåŠ¡æµç¨‹å¾—åˆ°äº†å¦‚ä¸‹çš„ä¸šåŠ¡æµç¨‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200325205347.png" alt=""></p><h4 id="ä»£ç å»ºæ¨¡"><a href="#ä»£ç å»ºæ¨¡" class="headerlink" title="ä»£ç å»ºæ¨¡"></a>ä»£ç å»ºæ¨¡</h4><p>é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ä¸ªæŠ½è±¡ç±»</span><br><span class="line">- å…·ä½“å…±æœ‰æ–¹æ³•&#96;Run&#96;ï¼Œé‡Œé¢å®šä¹‰äº†ç®—æ³•çš„æ‰§è¡Œæ­¥éª¤</span><br><span class="line">- å…·ä½“ç§æœ‰æ–¹æ³•ï¼Œä¸ä¼šå‘ç”Ÿå˜åŒ–çš„å…·ä½“æ–¹æ³•</span><br><span class="line">- æŠ½è±¡æ–¹æ³•ï¼Œä¼šå‘ç”Ÿå˜åŒ–çš„æ–¹æ³•</span><br><span class="line"></span><br><span class="line">å­ç±»ä¸€(æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹)</span><br><span class="line">- ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•</span><br><span class="line"></span><br><span class="line">å­ç±»äºŒ(æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–ç±»å‹)</span><br><span class="line">- ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•</span><br><span class="line"></span><br><span class="line">å­ç±»ä¸‰(æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–)</span><br><span class="line">- ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»</span><br><span class="line">- å®ç°æŠ½è±¡æ–¹æ³•</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯golangé‡Œé¢æ²¡æœ‰ç»§æ‰¿çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å°±æŠŠå¯¹æŠ½è±¡ç±»é‡ŒæŠ½è±¡æ–¹æ³•çš„ä¾èµ–è½¬åŒ–æˆå¯¹æ¥å£<code>interface</code>é‡ŒæŠ½è±¡æ–¹æ³•çš„ä¾èµ–ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨<code>åˆæˆå¤ç”¨</code>çš„æ–¹å¼â€œç»§æ‰¿â€æ¨¡æ¿:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">æŠ½è±¡è¡Œä¸ºçš„æ¥å£&#96;BehaviorInterface&#96;(åŒ…å«å¦‚ä¸‹éœ€è¦å®ç°çš„æ–¹æ³•)</span><br><span class="line">- å…¶ä»–å‚æ•°æ ¡éªŒçš„æ–¹æ³•&#96;checkParams&#96;</span><br><span class="line">- è·å–nodeå¥–å“ä¿¡æ¯çš„æ–¹æ³•&#96;getPrizesByNode&#96;</span><br><span class="line"></span><br><span class="line">æŠ½å¥–ç»“æ„ä½“ç±»</span><br><span class="line">- å…·ä½“å…±æœ‰æ–¹æ³•&#96;Run&#96;ï¼Œé‡Œé¢å®šä¹‰äº†ç®—æ³•çš„æ‰§è¡Œæ­¥éª¤</span><br><span class="line">- å…·ä½“ç§æœ‰æ–¹æ³•&#96;checkParams&#96; é‡Œé¢çš„é€»è¾‘å®é™…ä¾èµ–çš„æ¥å£BehaviorInterface.checkParams(ctx)çš„æŠ½è±¡æ–¹æ³•</span><br><span class="line">- å…·ä½“ç§æœ‰æ–¹æ³•&#96;getPrizesByNode&#96; é‡Œé¢çš„é€»è¾‘å®é™…ä¾èµ–çš„æ¥å£BehaviorInterface.getPrizesByNode(ctx)çš„æŠ½è±¡æ–¹æ³•</span><br><span class="line">- å…¶ä»–å…·ä½“ç§æœ‰æ–¹æ³•ï¼Œä¸ä¼šå‘ç”Ÿå˜åŒ–çš„å…·ä½“æ–¹æ³•</span><br><span class="line"></span><br><span class="line">å®ç°&#96;BehaviorInterface&#96;çš„ç»“æ„ä½“ä¸€(æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹)</span><br><span class="line">- å®ç°æ¥å£æ–¹æ³•</span><br><span class="line"></span><br><span class="line">å®ç°&#96;BehaviorInterface&#96;çš„ç»“æ„ä½“äºŒ(æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–ç±»å‹)</span><br><span class="line">- å®ç°æ¥å£æ–¹æ³•</span><br><span class="line"></span><br><span class="line">å®ç°&#96;BehaviorInterface&#96;çš„ç»“æ„ä½“ä¸‰(æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–)</span><br><span class="line">- å®ç°æ¥å£æ–¹æ³•</span><br></pre></td></tr></table></figure><p>åŒæ—¶å¾—åˆ°äº†æˆ‘ä»¬çš„UMLå›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/easy-tips/20200326201327.jpg" alt=""></p><h4 id="ä»£ç demo"><a href="#ä»£ç demo" class="headerlink" title="ä»£ç demo"></a>ä»£ç demo</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//æ¨¡æ¿æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// ConstActTypeTime æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹</span></span><br><span class="line">ConstActTypeTime <span class="keyword">int32</span> = <span class="number">1</span></span><br><span class="line"><span class="comment">// ConstActTypeTimes æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–</span></span><br><span class="line">ConstActTypeTimes <span class="keyword">int32</span> = <span class="number">2</span></span><br><span class="line"><span class="comment">// ConstActTypeAmount æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–</span></span><br><span class="line">ConstActTypeAmount <span class="keyword">int32</span> = <span class="number">3</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">ActInfo *ActInfo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ActInfo ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> ActInfo <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// æ´»åŠ¨æŠ½å¥–ç±»å‹1: æŒ‰æ—¶é—´æŠ½å¥– 2: æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥– 3:æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–</span></span><br><span class="line">ActivityType <span class="keyword">int32</span></span><br><span class="line"><span class="comment">// å…¶ä»–å­—æ®µç•¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BehaviorInterface ä¸åŒæŠ½å¥–ç±»å‹çš„è¡Œä¸ºå·®å¼‚çš„æŠ½è±¡æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> BehaviorInterface <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line">checkParams(ctx *Context) error</span><br><span class="line"><span class="comment">// è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line">getPrizesByNode(ctx *Context) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TimeDraw å…·ä½“æŠ½å¥–è¡Œä¸º</span></span><br><span class="line"><span class="comment">// æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹ æ¯”å¦‚çº¢åŒ…é›¨</span></span><br><span class="line"><span class="keyword">type</span> TimeDraw <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkParams å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw TimeDraw)</span> <span class="title">checkParams</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹:ç‰¹æ®Šå‚æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesByNode è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw TimeDraw)</span> <span class="title">getPrizesByNode</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;do nothing(æŠ½å–è¯¥åœºæ¬¡çš„å¥–å“å³å¯ï¼Œæ— éœ€å…¶ä»–é€»è¾‘)...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TimesDraw å…·ä½“æŠ½å¥–è¡Œä¸º</span></span><br><span class="line"><span class="comment">// æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–ç±»å‹ æ¯”å¦‚ç­”é¢˜é—¯å…³</span></span><br><span class="line"><span class="keyword">type</span> TimesDraw <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkParams å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw TimesDraw)</span> <span class="title">checkParams</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–ç±»å‹:ç‰¹æ®Šå‚æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesByNode è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw TimesDraw)</span> <span class="title">getPrizesByNode</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;1. åˆ¤æ–­æ˜¯è¯¥ç”¨æˆ·ç¬¬å‡ æ¬¡æŠ½å¥–...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;2. è·å–å¯¹åº”nodeçš„å¥–å“ä¿¡æ¯...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;3. å¤å†™åŸæ‰€æœ‰å¥–å“ä¿¡æ¯(æŠ½å–è¯¥nodeèŠ‚ç‚¹çš„å¥–å“)...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AmountDraw å…·ä½“æŠ½å¥–è¡Œä¸º</span></span><br><span class="line"><span class="comment">// æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥– æ¯”å¦‚è®¢å•é‡‘é¢åˆ®å¥–</span></span><br><span class="line"><span class="keyword">type</span> AmountDraw <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkParams å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw *AmountDraw)</span> <span class="title">checkParams</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–:ç‰¹æ®Šå‚æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesByNode è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw *AmountDraw)</span> <span class="title">getPrizesByNode</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;1. åˆ¤æ–­å±äºå“ªä¸ªæ•°é¢åŒºé—´...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;2. è·å–å¯¹åº”nodeçš„å¥–å“ä¿¡æ¯...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;3. å¤å†™åŸæ‰€æœ‰å¥–å“ä¿¡æ¯(æŠ½å–è¯¥nodeèŠ‚ç‚¹çš„å¥–å“)...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Lottery æŠ½å¥–æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">type</span> Lottery <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// ä¸åŒæŠ½å¥–ç±»å‹çš„æŠ½è±¡è¡Œä¸º</span></span><br><span class="line">concreteBehavior BehaviorInterface</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run æŠ½å¥–ç®—æ³•</span></span><br><span class="line"><span class="comment">// ç¨³å®šä¸å˜çš„ç®—æ³•æ­¥éª¤</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">Run</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæ ¡éªŒæ´»åŠ¨ç¼–å·(serial_no)æ˜¯å¦å­˜åœ¨ã€å¹¶è·å–æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkSerialNo(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæ ¡éªŒæ´»åŠ¨ã€åœºæ¬¡æ˜¯å¦æ­£åœ¨è¿›è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkStatus(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â€æŠ½è±¡æ–¹æ³•â€œï¼šå…¶ä»–å‚æ•°æ ¡éªŒ</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkParams(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ(åŒæ—¶æ‰£å‡)</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkTimesByAct(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæ´»åŠ¨æ˜¯å¦éœ€è¦æ¶ˆè´¹ç§¯åˆ†</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.consumePointsByAct(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šåœºæ¬¡æŠ½å¥–æ¬¡æ•°æ ¡éªŒ(åŒæ—¶æ‰£å‡)</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkTimesBySession(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šè·å–åœºæ¬¡å¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.getPrizesBySession(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â€æŠ½è±¡æ–¹æ³•â€œï¼šè·å–nodeå¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.getPrizesByNode(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæŠ½å¥–</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.drawPrizes(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šå¥–å“æ•°é‡åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkPrizesStock(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šç»„è£…å¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.packagePrizeInfo(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkSerialNo æ ¡éªŒæ´»åŠ¨ç¼–å·(serial_no)æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkSerialNo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ ¡éªŒæ´»åŠ¨ç¼–å·(serial_no)æ˜¯å¦å­˜åœ¨ã€å¹¶è·å–æ´»åŠ¨ä¿¡æ¯...&quot;</span>)</span><br><span class="line"><span class="comment">// è·å–æ´»åŠ¨ä¿¡æ¯ä¼ªä»£ç </span></span><br><span class="line">ctx.ActInfo = &amp;ActInfo&#123;</span><br><span class="line"><span class="comment">// å‡è®¾å½“å‰çš„æ´»åŠ¨ç±»å‹ä¸ºæŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–</span></span><br><span class="line">ActivityType: ConstActTypeTimes,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å½“å‰æŠ½å¥–ç±»å‹çš„å…·ä½“è¡Œä¸º</span></span><br><span class="line"><span class="keyword">switch</span> ctx.ActInfo.ActivityType &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"><span class="comment">// æŒ‰æ—¶é—´æŠ½å¥–</span></span><br><span class="line">lottery.concreteBehavior = &amp;TimeDraw&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line"><span class="comment">// æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–</span></span><br><span class="line">lottery.concreteBehavior = &amp;TimesDraw&#123;&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line"><span class="comment">// æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–</span></span><br><span class="line">lottery.concreteBehavior = &amp;AmountDraw&#123;&#125;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;ä¸å­˜åœ¨çš„æ´»åŠ¨ç±»å‹&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkStatus æ ¡éªŒæ´»åŠ¨ã€åœºæ¬¡æ˜¯å¦æ­£åœ¨è¿›è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkStatus</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ ¡éªŒæ´»åŠ¨ã€åœºæ¬¡æ˜¯å¦æ­£åœ¨è¿›è¡Œ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkParams å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="comment">// ä¸åŒåœºæ™¯å˜åŒ–çš„ç®—æ³• è½¬åŒ–ä¸ºä¾èµ–æŠ½è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkParams</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å®é™…ä¾èµ–çš„æ¥å£çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">return</span> lottery.concreteBehavior.checkParams(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkTimesByAct æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkTimesByAct</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// consumePointsByAct æ´»åŠ¨æ˜¯å¦éœ€è¦æ¶ˆè´¹ç§¯åˆ†</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">consumePointsByAct</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ´»åŠ¨æ˜¯å¦éœ€è¦æ¶ˆè´¹ç§¯åˆ†...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkTimesBySession æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkTimesBySession</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesBySession è·å–åœºæ¬¡å¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">getPrizesBySession</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–åœºæ¬¡å¥–å“ä¿¡æ¯...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesByNode è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="comment">// ä¸åŒåœºæ™¯å˜åŒ–çš„ç®—æ³• è½¬åŒ–ä¸ºä¾èµ–æŠ½è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">getPrizesByNode</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å®é™…ä¾èµ–çš„æ¥å£çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">return</span> lottery.concreteBehavior.getPrizesByNode(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// drawPrizes æŠ½å¥–</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">drawPrizes</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æŠ½å¥–...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkPrizesStock å¥–å“æ•°é‡åˆ¤æ–­</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkPrizesStock</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å¥–å“æ•°é‡åˆ¤æ–­...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// packagePrizeInfo ç»„è£…å¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">packagePrizeInfo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç»„è£…å¥–å“ä¿¡æ¯...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">(&amp;Lottery&#123;&#125;).Run(&amp;Context&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ­£åœ¨è¿è¡Œçš„å‡½æ•°å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runFuncName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">pc := <span class="built_in">make</span>([]<span class="keyword">uintptr</span>, <span class="number">1</span>)</span><br><span class="line">runtime.Callers(<span class="number">2</span>, pc)</span><br><span class="line">f := runtime.FuncForPC(pc[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> f.Name()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä»£ç æ‰§è¡Œç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Running] go run &quot;...&#x2F;easy-tips&#x2F;go&#x2F;src&#x2F;patterns&#x2F;template&#x2F;template.go&quot;</span><br><span class="line">main.(*Lottery).checkSerialNo æ ¡éªŒæ´»åŠ¨ç¼–å·(serial_no)æ˜¯å¦å­˜åœ¨ã€å¹¶è·å–æ´»åŠ¨ä¿¡æ¯...</span><br><span class="line">main.(*Lottery).checkStatus æ ¡éªŒæ´»åŠ¨ã€åœºæ¬¡æ˜¯å¦æ­£åœ¨è¿›è¡Œ...</span><br><span class="line">main.TimesDraw.checkParams æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–ç±»å‹:ç‰¹æ®Šå‚æ•°æ ¡éªŒ...</span><br><span class="line">main.(*Lottery).checkTimesByAct æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ...</span><br><span class="line">main.(*Lottery).consumePointsByAct æ´»åŠ¨æ˜¯å¦éœ€è¦æ¶ˆè´¹ç§¯åˆ†...</span><br><span class="line">main.(*Lottery).checkTimesBySession æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ...</span><br><span class="line">main.(*Lottery).getPrizesBySession è·å–åœºæ¬¡å¥–å“ä¿¡æ¯...</span><br><span class="line">main.TimesDraw.getPrizesByNode 1. åˆ¤æ–­æ˜¯è¯¥ç”¨æˆ·ç¬¬å‡ æ¬¡æŠ½å¥–...</span><br><span class="line">main.TimesDraw.getPrizesByNode 2. è·å–å¯¹åº”nodeçš„å¥–å“ä¿¡æ¯...</span><br><span class="line">main.TimesDraw.getPrizesByNode 3. å¤å†™åŸæ‰€æœ‰å¥–å“ä¿¡æ¯(æŠ½å–è¯¥nodeèŠ‚ç‚¹çš„å¥–å“)...</span><br><span class="line">main.(*Lottery).drawPrizes æŠ½å¥–...</span><br><span class="line">main.(*Lottery).checkPrizesStock å¥–å“æ•°é‡åˆ¤æ–­...</span><br><span class="line">main.(*Lottery).packagePrizeInfo ç»„è£…å¥–å“ä¿¡æ¯...</span><br></pre></td></tr></table></figure><p>demoä»£ç åœ°å€ï¼š<a href="https://github.com/TIGERB/easy-tips/blob/master/go/src/patterns/template/template.go">https://github.com/TIGERB/easy-tips/blob/master/go/src/patterns/template/template.go</a></p><h4 id="ä»£ç demo2-åˆ©ç”¨golangçš„åˆæˆå¤ç”¨ç‰¹æ€§å®ç°"><a href="#ä»£ç demo2-åˆ©ç”¨golangçš„åˆæˆå¤ç”¨ç‰¹æ€§å®ç°" class="headerlink" title="ä»£ç demo2(åˆ©ç”¨golangçš„åˆæˆå¤ç”¨ç‰¹æ€§å®ç°)"></a>ä»£ç demo2(åˆ©ç”¨golangçš„<code>åˆæˆå¤ç”¨</code>ç‰¹æ€§å®ç°)</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//æˆ‘çš„ä»£ç æ²¡æœ‰`else`ç³»åˆ—</span></span><br><span class="line"><span class="comment">//æ¨¡æ¿æ¨¡å¼</span></span><br><span class="line"><span class="comment">//@auhtor TIGERB&lt;https://github.com/TIGERB&gt;</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// ConstActTypeTime æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹</span></span><br><span class="line">ConstActTypeTime <span class="keyword">int32</span> = <span class="number">1</span></span><br><span class="line"><span class="comment">// ConstActTypeTimes æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–</span></span><br><span class="line">ConstActTypeTimes <span class="keyword">int32</span> = <span class="number">2</span></span><br><span class="line"><span class="comment">// ConstActTypeAmount æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–</span></span><br><span class="line">ConstActTypeAmount <span class="keyword">int32</span> = <span class="number">3</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">ActInfo *ActInfo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ActInfo ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">type</span> ActInfo <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// æ´»åŠ¨æŠ½å¥–ç±»å‹1: æŒ‰æ—¶é—´æŠ½å¥– 2: æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥– 3:æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–</span></span><br><span class="line">ActivityType <span class="keyword">int32</span></span><br><span class="line"><span class="comment">// å…¶ä»–å­—æ®µç•¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BehaviorInterface ä¸åŒæŠ½å¥–ç±»å‹çš„è¡Œä¸ºå·®å¼‚çš„æŠ½è±¡æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> BehaviorInterface <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line">checkParams(ctx *Context) error</span><br><span class="line"><span class="comment">// è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line">getPrizesByNode(ctx *Context) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TimeDraw å…·ä½“æŠ½å¥–è¡Œä¸º</span></span><br><span class="line"><span class="comment">// æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹ æ¯”å¦‚çº¢åŒ…é›¨</span></span><br><span class="line"><span class="keyword">type</span> TimeDraw <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨æ¨¡æ¿</span></span><br><span class="line">Lottery</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkParams å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw TimeDraw)</span> <span class="title">checkParams</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹:ç‰¹æ®Šå‚æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesByNode è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw TimeDraw)</span> <span class="title">getPrizesByNode</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;do nothing(æŠ½å–è¯¥åœºæ¬¡çš„å¥–å“å³å¯ï¼Œæ— éœ€å…¶ä»–é€»è¾‘)...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TimesDraw å…·ä½“æŠ½å¥–è¡Œä¸º</span></span><br><span class="line"><span class="comment">// æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–ç±»å‹ æ¯”å¦‚ç­”é¢˜é—¯å…³</span></span><br><span class="line"><span class="keyword">type</span> TimesDraw <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨æ¨¡æ¿</span></span><br><span class="line">Lottery</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkParams å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw TimesDraw)</span> <span class="title">checkParams</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–ç±»å‹:ç‰¹æ®Šå‚æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesByNode è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw TimesDraw)</span> <span class="title">getPrizesByNode</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;1. åˆ¤æ–­æ˜¯è¯¥ç”¨æˆ·ç¬¬å‡ æ¬¡æŠ½å¥–...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;2. è·å–å¯¹åº”nodeçš„å¥–å“ä¿¡æ¯...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;3. å¤å†™åŸæ‰€æœ‰å¥–å“ä¿¡æ¯(æŠ½å–è¯¥nodeèŠ‚ç‚¹çš„å¥–å“)...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AmountDraw å…·ä½“æŠ½å¥–è¡Œä¸º</span></span><br><span class="line"><span class="comment">// æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥– æ¯”å¦‚è®¢å•é‡‘é¢åˆ®å¥–</span></span><br><span class="line"><span class="keyword">type</span> AmountDraw <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åˆæˆå¤ç”¨æ¨¡æ¿</span></span><br><span class="line">Lottery</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkParams å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw *AmountDraw)</span> <span class="title">checkParams</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–:ç‰¹æ®Šå‚æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesByNode è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(draw *AmountDraw)</span> <span class="title">getPrizesByNode</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;1. åˆ¤æ–­å±äºå“ªä¸ªæ•°é¢åŒºé—´...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;2. è·å–å¯¹åº”nodeçš„å¥–å“ä¿¡æ¯...&quot;</span>)</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;3. å¤å†™åŸæ‰€æœ‰å¥–å“ä¿¡æ¯(æŠ½å–è¯¥nodeèŠ‚ç‚¹çš„å¥–å“)...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Lottery æŠ½å¥–æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">type</span> Lottery <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// ä¸åŒæŠ½å¥–ç±»å‹çš„æŠ½è±¡è¡Œä¸º</span></span><br><span class="line">ConcreteBehavior BehaviorInterface</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run æŠ½å¥–ç®—æ³•</span></span><br><span class="line"><span class="comment">// ç¨³å®šä¸å˜çš„ç®—æ³•æ­¥éª¤</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">Run</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæ ¡éªŒæ´»åŠ¨ç¼–å·(serial_no)æ˜¯å¦å­˜åœ¨ã€å¹¶è·å–æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkSerialNo(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæ ¡éªŒæ´»åŠ¨ã€åœºæ¬¡æ˜¯å¦æ­£åœ¨è¿›è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkStatus(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â€æŠ½è±¡æ–¹æ³•â€œï¼šå…¶ä»–å‚æ•°æ ¡éªŒ</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkParams(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ(åŒæ—¶æ‰£å‡)</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkTimesByAct(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæ´»åŠ¨æ˜¯å¦éœ€è¦æ¶ˆè´¹ç§¯åˆ†</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.consumePointsByAct(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šåœºæ¬¡æŠ½å¥–æ¬¡æ•°æ ¡éªŒ(åŒæ—¶æ‰£å‡)</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkTimesBySession(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šè·å–åœºæ¬¡å¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.getPrizesBySession(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â€æŠ½è±¡æ–¹æ³•â€œï¼šè·å–nodeå¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.getPrizesByNode(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šæŠ½å¥–</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.drawPrizes(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šå¥–å“æ•°é‡åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.checkPrizesStock(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ–¹æ³•ï¼šç»„è£…å¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> err = lottery.packagePrizeInfo(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkSerialNo æ ¡éªŒæ´»åŠ¨ç¼–å·(serial_no)æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkSerialNo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ ¡éªŒæ´»åŠ¨ç¼–å·(serial_no)æ˜¯å¦å­˜åœ¨ã€å¹¶è·å–æ´»åŠ¨ä¿¡æ¯...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkStatus æ ¡éªŒæ´»åŠ¨ã€åœºæ¬¡æ˜¯å¦æ­£åœ¨è¿›è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkStatus</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ ¡éªŒæ´»åŠ¨ã€åœºæ¬¡æ˜¯å¦æ­£åœ¨è¿›è¡Œ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkParams å…¶ä»–å‚æ•°æ ¡éªŒ(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="comment">// ä¸åŒåœºæ™¯å˜åŒ–çš„ç®—æ³• è½¬åŒ–ä¸ºä¾èµ–æŠ½è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkParams</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å®é™…ä¾èµ–çš„æ¥å£çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">return</span> lottery.ConcreteBehavior.checkParams(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkTimesByAct æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkTimesByAct</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// consumePointsByAct æ´»åŠ¨æ˜¯å¦éœ€è¦æ¶ˆè´¹ç§¯åˆ†</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">consumePointsByAct</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ´»åŠ¨æ˜¯å¦éœ€è¦æ¶ˆè´¹ç§¯åˆ†...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkTimesBySession æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkTimesBySession</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesBySession è·å–åœºæ¬¡å¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">getPrizesBySession</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;è·å–åœºæ¬¡å¥–å“ä¿¡æ¯...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getPrizesByNode è·å–nodeå¥–å“ä¿¡æ¯(ä¸åŒæ´»åŠ¨ç±»å‹å®ç°ä¸åŒ)</span></span><br><span class="line"><span class="comment">// ä¸åŒåœºæ™¯å˜åŒ–çš„ç®—æ³• è½¬åŒ–ä¸ºä¾èµ–æŠ½è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">getPrizesByNode</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="comment">// å®é™…ä¾èµ–çš„æ¥å£çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">return</span> lottery.ConcreteBehavior.getPrizesByNode(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// drawPrizes æŠ½å¥–</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">drawPrizes</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;æŠ½å¥–...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkPrizesStock å¥–å“æ•°é‡åˆ¤æ–­</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">checkPrizesStock</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;å¥–å“æ•°é‡åˆ¤æ–­...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// packagePrizeInfo ç»„è£…å¥–å“ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lottery *Lottery)</span> <span class="title">packagePrizeInfo</span><span class="params">(ctx *Context)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">fmt.Println(runFuncName(), <span class="string">&quot;ç»„è£…å¥–å“ä¿¡æ¯...&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ctx := &amp;Context&#123;</span><br><span class="line">ActInfo: &amp;ActInfo&#123;</span><br><span class="line">ActivityType: ConstActTypeAmount,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> ctx.ActInfo.ActivityType &#123;</span><br><span class="line"><span class="keyword">case</span> ConstActTypeTime: <span class="comment">// æŒ‰æ—¶é—´æŠ½å¥–ç±»å‹</span></span><br><span class="line">instance := &amp;TimeDraw&#123;&#125;</span><br><span class="line">instance.ConcreteBehavior = instance</span><br><span class="line">instance.Run(ctx)</span><br><span class="line"><span class="keyword">case</span> ConstActTypeTimes: <span class="comment">// æŒ‰æŠ½å¥–æ¬¡æ•°æŠ½å¥–</span></span><br><span class="line">instance := &amp;TimesDraw&#123;&#125;</span><br><span class="line">instance.ConcreteBehavior = instance</span><br><span class="line">instance.Run(ctx)</span><br><span class="line"><span class="keyword">case</span> ConstActTypeAmount: <span class="comment">// æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–</span></span><br><span class="line">instance := &amp;AmountDraw&#123;&#125;</span><br><span class="line">instance.ConcreteBehavior = instance</span><br><span class="line">instance.Run(ctx)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="comment">// æŠ¥é”™</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ­£åœ¨è¿è¡Œçš„å‡½æ•°å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runFuncName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">pc := <span class="built_in">make</span>([]<span class="keyword">uintptr</span>, <span class="number">1</span>)</span><br><span class="line">runtime.Callers(<span class="number">2</span>, pc)</span><br><span class="line">f := runtime.FuncForPC(pc[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> f.Name()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä»£ç æ‰§è¡Œç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Running] go run &quot;...&#x2F;easy-tips&#x2F;go&#x2F;src&#x2F;patterns&#x2F;template&#x2F;templateOther.go&quot;</span><br><span class="line">main.(*Lottery).checkSerialNo æ ¡éªŒæ´»åŠ¨ç¼–å·(serial_no)æ˜¯å¦å­˜åœ¨ã€å¹¶è·å–æ´»åŠ¨ä¿¡æ¯...</span><br><span class="line">main.(*Lottery).checkStatus æ ¡éªŒæ´»åŠ¨ã€åœºæ¬¡æ˜¯å¦æ­£åœ¨è¿›è¡Œ...</span><br><span class="line">main.(*AmountDraw).checkParams æŒ‰æ•°é¢èŒƒå›´åŒºé—´æŠ½å¥–:ç‰¹æ®Šå‚æ•°æ ¡éªŒ...</span><br><span class="line">main.(*Lottery).checkTimesByAct æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ...</span><br><span class="line">main.(*Lottery).consumePointsByAct æ´»åŠ¨æ˜¯å¦éœ€è¦æ¶ˆè´¹ç§¯åˆ†...</span><br><span class="line">main.(*Lottery).checkTimesBySession æ´»åŠ¨æŠ½å¥–æ¬¡æ•°æ ¡éªŒ...</span><br><span class="line">main.(*Lottery).getPrizesBySession è·å–åœºæ¬¡å¥–å“ä¿¡æ¯...</span><br><span class="line">main.(*AmountDraw).getPrizesByNode 1. åˆ¤æ–­å±äºå“ªä¸ªæ•°é¢åŒºé—´...</span><br><span class="line">main.(*AmountDraw).getPrizesByNode 2. è·å–å¯¹åº”nodeçš„å¥–å“ä¿¡æ¯...</span><br><span class="line">main.(*AmountDraw).getPrizesByNode 3. å¤å†™åŸæ‰€æœ‰å¥–å“ä¿¡æ¯(æŠ½å–è¯¥nodeèŠ‚ç‚¹çš„å¥–å“)...</span><br><span class="line">main.(*Lottery).drawPrizes æŠ½å¥–...</span><br><span class="line">main.(*Lottery).checkPrizesStock å¥–å“æ•°é‡åˆ¤æ–­...</span><br><span class="line">main.(*Lottery).packagePrizeInfo ç»„è£…å¥–å“ä¿¡æ¯...</span><br></pre></td></tr></table></figure><p>demo2ä»£ç åœ°å€ï¼š<a href="https://github.com/TIGERB/easy-tips/blob/master/go/src/patterns/template/templateOther.go">https://github.com/TIGERB/easy-tips/blob/master/go/src/patterns/template/templateOther.go</a></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ€åæ€»ç»“ä¸‹ï¼Œã€Œæ¨¡æ¿æ¨¡å¼ã€æŠ½è±¡è¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯æŠŠæ¡<strong>ä¸å˜</strong>ä¸<strong>å˜</strong>ï¼š</p><ul><li>ä¸å˜ï¼š<code>Run</code>æ–¹æ³•é‡Œçš„æŠ½å¥–æ­¥éª¤ -&gt; <code>è¢«ç»§æ‰¿å¤ç”¨</code></li><li>å˜ï¼šä¸åŒåœºæ™¯ä¸‹ -&gt; <code>è¢«å…·ä½“å®ç°</code><ul><li><code>checkParams</code>å‚æ•°æ ¡éªŒé€»è¾‘</li><li><code>getPrizesByNode</code>è·å–è¯¥èŠ‚ç‚¹å¥–å“çš„é€»è¾‘</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹åˆ«è¯´æ˜ï¼š</span><br><span class="line">1. æˆ‘çš„ä»£ç æ²¡æœ‰&#96;else&#96;ï¼Œåªæ˜¯ä¸€ä¸ªåœ¨ä»£ç åˆç†è®¾è®¡çš„æƒ…å†µä¸‹è‡ªç„¶è€Œç„¶æ— é™æ¥è¿‘æˆ–è€…è¾¾åˆ°çš„ç»“æœï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç¡¬æ€§çš„ç›®æ ‡ï¼ŒåŠ¡å¿…è¾ƒçœŸã€‚</span><br><span class="line">2. æœ¬ç³»åˆ—çš„ä¸€äº›è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µå¯èƒ½å’ŒåŸæ¦‚å¿µå­˜åœ¨å·®å¼‚ï¼Œå› ä¸ºä¼šç»“åˆå®é™…ä½¿ç”¨ï¼Œå–å…¶ç²¾åï¼Œé€‚å½“æ”¹å˜ï¼Œçµæ´»ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure><h1 id="æ–‡ç« åˆ—è¡¨"><a href="#æ–‡ç« åˆ—è¡¨" class="headerlink" title="æ–‡ç« åˆ—è¡¨"></a>æ–‡ç« åˆ—è¡¨</h1><ul><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/template">ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/responsibility">é“¾å¼è°ƒç”¨ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/composite">ä»£ç ç»„ä»¶ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/observer">è®¢é˜…é€šçŸ¥ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/strategy">å®¢æˆ·å†³ç­– | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li><li><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns/state">çŠ¶æ€å˜æ¢ | Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li></ul><blockquote><p><a href="https://github.com/TIGERB/easy-tips/tree/master/go/patterns">Goè®¾è®¡æ¨¡å¼å®æˆ˜ç³»åˆ— æ›´å¤šæ–‡ç«  ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ä»£ç æ¨¡æ¿-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;a href=&quot;#ä»£ç æ¨¡æ¿-Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot; class=&quot;headerlink&quot; title=&quot;ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&quot;&gt;&lt;/a&gt;ä»£ç æ¨¡æ¿ | Goè®¾è®¡æ¨¡å¼å®æˆ˜&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å—¯ï¼ŒGoè®¾è®¡æ¨¡å¼å®
      
    
    </summary>
    
    
      <category term="easy-tips" scheme="http://wangyangyangisme.github.io/categories/easy-tips/"/>
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/easy-tips/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>è®¿é—®è€…å’ŒåŒåˆ†æ´¾</title>
    <link href="http://wangyangyangisme.github.io/posts/d31de58/"/>
    <id>http://wangyangyangisme.github.io/posts/d31de58/</id>
    <published>2021-05-04T14:50:54.000Z</published>
    <updated>2021-05-04T14:50:54.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://refactoringguru.cn/design-patterns/visitor-double-dispatch">https://refactoringguru.cn/design-patterns/visitor-double-dispatch</a></p></blockquote><h1 id="è®¿é—®è€…å’ŒåŒåˆ†æ´¾"><a href="#è®¿é—®è€…å’ŒåŒåˆ†æ´¾" class="headerlink" title="è®¿é—®è€…å’ŒåŒåˆ†æ´¾"></a>è®¿é—®è€…å’ŒåŒåˆ†æ´¾</h1><p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢å‡ ä½•å›¾å½¢ç±»çš„å±‚æ¬¡ç»“æ„ ï¼ˆæ³¨æ„ä¼ªä»£ç ï¼‰ï¼š</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Graphic <span class="keyword">is</span></span><br><span class="line">    method draw()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Shape <span class="keyword">implements</span> Graphic <span class="keyword">is</span></span><br><span class="line">    field id</span><br><span class="line">    method draw()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Dot extends Shape <span class="keyword">is</span></span><br><span class="line">    field x, y</span><br><span class="line">    method draw()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Circle extends Dot <span class="keyword">is</span></span><br><span class="line">    field radius</span><br><span class="line">    method draw()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Rectangle extends Shape <span class="keyword">is</span></span><br><span class="line">    field width, height</span><br><span class="line">    method draw()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> CompoundGraphic <span class="keyword">implements</span> Graphic <span class="keyword">is</span></span><br><span class="line">    field children: <span class="keyword">array</span> <span class="keyword">of</span> Graphic</span><br><span class="line">    method draw()</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>è¿™äº›ä»£ç è¿è¡Œæ­£å¸¸ä¸”ç¨‹åºå¤„äºå¼€å‘é˜¶æ®µã€‚ ä½†æŸå¤©ä½ å†³å®šå¼€å‘å¯¼å‡ºåŠŸèƒ½ã€‚ å¦‚æœå°†å¯¼å‡ºåŠŸèƒ½çš„ä»£ç æ”¾å…¥è¿™äº›ç±»ä¸­ï¼Œ å®ƒä»¬çœ‹ä¸Šå»ä¼šå¾ˆå¥‡æ€ªã€‚ å› æ­¤ï¼Œ ä½ å†³å®šä¸åœ¨å±‚æ¬¡ç»“æ„é‡Œçš„ç±»ä¸­æ·»åŠ å¯¼å‡ºåŠŸèƒ½ï¼Œ è€Œæ˜¯åœ¨å±‚æ¬¡ç»“æ„å¤–åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯¼å‡ºé€»è¾‘çš„æ–°ç±»ã€‚ è¯¥ç±»å°†åŒ…å«å°†æ¯ä¸ªå¯¹è±¡çš„å…¬æœ‰çŠ¶æ€å¯¼å‡ºä¸º XML å­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Exporter <span class="keyword">is</span></span><br><span class="line">    method <span class="keyword">export</span>(s: Shape) <span class="keyword">is</span></span><br><span class="line">        print(&quot;å¯¼å‡ºå½¢çŠ¶&quot;)</span><br><span class="line">    method <span class="keyword">export</span>(d: Dot)</span><br><span class="line">        print(&quot;å¯¼å‡ºç‚¹&quot;)</span><br><span class="line">    method <span class="keyword">export</span>(c: Circle)</span><br><span class="line">        print(&quot;å¯¼å‡ºåœ†å½¢&quot;)</span><br><span class="line">    method <span class="keyword">export</span>(r: Rectangle)</span><br><span class="line">        print(&quot;å¯¼å‡ºçŸ©å½¢&quot;)</span><br><span class="line">    method <span class="keyword">export</span>(cs: CompoundGraphic)</span><br><span class="line">        print(&quot;å¯¼å‡ºç»„åˆå›¾å½¢&quot;)</span><br></pre></td></tr></table></figure><p>è¿™äº›ä»£ç çœ‹ä¸Šå»ä¸é”™ï¼Œ è®©æˆ‘ä»¬è¿è¡Œè¯•è¯•ï¼š</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> App() <span class="keyword">is</span></span><br><span class="line">    method <span class="keyword">export</span>(shape: Shape) <span class="keyword">is</span></span><br><span class="line">        Exporter exporter = new Exporter()</span><br><span class="line">        exporter.<span class="keyword">export</span>(shape);</span><br><span class="line"></span><br><span class="line">app.<span class="keyword">export</span>(new Circle());</span><br><span class="line"><span class="comment">// ä¸å¹¸çš„æ˜¯ï¼Œè¿™é‡Œå°†è¾“å‡ºâ€œå¯¼å‡ºå½¢çŠ¶â€ã€‚</span></span><br></pre></td></tr></table></figure><p>ç­‰ç­‰ï¼ ä¸ºä»€ä¹ˆï¼Ÿï¼</p><h2 id="åƒç¼–è¯‘å™¨ä¸€æ ·æ€è€ƒ"><a href="#åƒç¼–è¯‘å™¨ä¸€æ ·æ€è€ƒ" class="headerlink" title="åƒç¼–è¯‘å™¨ä¸€æ ·æ€è€ƒ"></a>åƒç¼–è¯‘å™¨ä¸€æ ·æ€è€ƒ</h2><p>æ³¨æ„ï¼š ä¸‹é¢çš„å†…å®¹å¯¹äºç»å¤§å¤šæ•°é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ç°ä»£è¯­è¨€ ï¼ˆJavaã€ C# å’Œ PHP ç­‰ï¼‰ æ¥è¯´éƒ½æ˜¯æˆç«‹çš„ã€‚</p><h3 id="åæœŸ-åŠ¨æ€ç»‘å®š"><a href="#åæœŸ-åŠ¨æ€ç»‘å®š" class="headerlink" title="åæœŸ/åŠ¨æ€ç»‘å®š"></a>åæœŸ/åŠ¨æ€ç»‘å®š</h3><p>å‡è®¾ä½ æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ã€‚ ä½ å¿…é¡»å†³å®šå¦‚ä½•ç¼–è¯‘ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">method drawShape(shape: Shape) <span class="keyword">is</span></span><br><span class="line">    shape.draw();</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬çœ‹çœ‹... <code>Shape</code>å½¢çŠ¶ç±»ä¸­å®šä¹‰äº†ã€€ <code>draw</code>ç»˜åˆ¶æ–¹æ³•ã€‚ ç¨ç­‰ï¼Œ è¿˜æœ‰å››ä¸ªå­ç±»é‡å†™äº†è¯¥æ–¹æ³•ã€‚ æˆ‘ä»¬èƒ½å¦æœ‰æŠŠæ¡åœ°å†³å®šè°ƒç”¨å“ªä¸ªå®ç°å‘¢ï¼Ÿ çœ‹ä¸Šå»ä¸å¤ªå¯èƒ½ã€‚ ç¡®è®¤çš„å”¯ä¸€æ–¹å¼æ˜¯å¯åŠ¨ç¨‹åºå¹¶æ£€æŸ¥ä¼ é€’ç»™è¯¥æ–¹æ³•çš„å¯¹è±¡æ‰€å±çš„ç±»ã€‚ æˆ‘ä»¬åªçŸ¥é“ä¸€ä»¶äº‹æƒ…ï¼š è¯¥å¯¹è±¡<strong>å°†åŒ…å«</strong> <code>draw</code>æ–¹æ³•çš„å®ç°ã€‚</p><p>å› æ­¤ï¼Œ æœ€ç»ˆçš„æœºå™¨ä»£ç å°†æ£€æŸ¥ <code>s</code>å‚æ•°çš„ç±»å¹¶ä¸”ä»åˆé€‚çš„ç±»ä¸­é€‰æ‹© <code>draw</code>æ–¹æ³•çš„å®ç°ã€‚</p><p>è¿™ç§åŠ¨æ€ç±»å‹æ£€æŸ¥è¢«ç§°ä¸ºåæœŸ ï¼ˆæˆ–åŠ¨æ€ï¼‰ ç»‘å®šï¼š</p><ul><li><strong>åæœŸ</strong>ï¼Œ æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ç¼–è¯‘åå’Œè¿è¡Œæ—¶æ‰å°†å¯¹è±¡åŠå…¶å®ç°é“¾æ¥èµ·æ¥ã€‚</li><li><strong>åŠ¨æ€</strong>ï¼Œ æ˜¯å› ä¸ºæ¯ä¸ªæ–°å¯¹è±¡éƒ½å¯èƒ½éœ€è¦é“¾æ¥åˆ°ä¸åŒçš„å®ç°ã€‚</li></ul><h3 id="å‰æœŸ-é™æ€ç»‘å®š"><a href="#å‰æœŸ-é™æ€ç»‘å®š" class="headerlink" title="å‰æœŸ/é™æ€ç»‘å®š"></a>å‰æœŸ/é™æ€ç»‘å®š</h3><p>ç°åœ¨ï¼Œ è®©æˆ‘ä»¬æ¥ â€œç¼–è¯‘â€ ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">method exportShape(shape: Shape) <span class="keyword">is</span></span><br><span class="line">    Exporter exporter = new Exporter()</span><br><span class="line">    exporter.<span class="keyword">export</span>(shape);</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒè¡Œä»£ç å¾ˆæ¸…æ¥šï¼š  <code>Exporter</code>ç±»æ²¡æœ‰æ„é€ æ–¹æ³•ï¼Œ å› æ­¤æˆ‘ä»¬ä»…èƒ½å°†å¯¹è±¡åˆå§‹åŒ–ã€‚ é‚£ä¹ˆå¯¹ <code>export</code>å¯¼å‡ºæ–¹æ³•çš„è°ƒç”¨å‘¢ï¼Ÿ  <code>Exporter</code>æœ‰äº”ä¸ªåŒåä½†å‚æ•°ä¸åŒçš„æ–¹æ³•ã€‚ è°ƒç”¨å“ªä¸€ä¸ªå‘¢ï¼Ÿ çœ‹æ¥æˆ‘ä»¬åœ¨è¿™é‡Œä¹Ÿéœ€è¦åŠ¨æ€ç»‘å®šã€‚</p><p>ä½†è¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ã€‚ å¦‚æœ <code>å¯¼å‡ºå™¨</code>ç±»ä¸­æœ‰ä¸€ä¸ªå›¾å½¢ç±»æ²¡æœ‰ç›¸åº”çš„ <code>export</code>æ–¹æ³•æ€ä¹ˆåŠï¼Ÿ ä¾‹å¦‚ï¼Œ ä¸€ä¸ª <code>Ellipse</code>æ¤­åœ†å¯¹è±¡ã€‚ ç¼–è¯‘å™¨ä¸èƒ½ç¡®ä¿å­˜åœ¨é€‚å½“çš„ä¸é‡å†™åçš„æ–¹æ³•ç›¸å¯¹åº”çš„é‡è½½æ–¹æ³•ã€‚ ç¼–è¯‘å™¨æ— æ³•åº”å¯¹è¿™ç§æ¨¡å‡Œä¸¤å¯çš„æƒ…å†µã€‚</p><p>å› æ­¤ï¼Œ ç¼–è¯‘å™¨å¼€å‘è€…ä¼šé€‰æ‹©å®‰å…¨çš„æ–¹å¼ï¼š ä½¿ç”¨å‰æœŸ ï¼ˆæˆ–é™æ€ï¼‰ ç»‘å®šæ¥å¤„ç†é‡è½½æ–¹æ³•ã€‚</p><ul><li><strong>å‰æœŸ</strong>ï¼Œ æ˜¯å› ä¸ºå®ƒå‘ç”Ÿåœ¨è¿è¡Œç¨‹åºå‰ç¼–è¯‘çš„æ—¶å€™ã€‚ --<strong>é™æ€</strong>ï¼Œ æ˜¯å› ä¸ºå®ƒæ— æ³•åœ¨è¿è¡Œæ—¶æ›´æ”¹ã€‚</li></ul><p>è®©æˆ‘ä»¬å›åˆ°ä¹‹å‰çš„ç¤ºä¾‹ã€‚ æˆ‘ä»¬å¯ä»¥ç¡®å®šä¼ é€’è¿‡æ¥çš„å‚æ•°ç±»å‹å±äº <code>Shape</code>ç±»å±‚æ¬¡ç»“æ„ä¸­ï¼š è¦ä¹ˆæ˜¯ <code>Shape</code>ç±»ï¼Œ è¦ä¹ˆæ˜¯å®ƒçš„å­ç±»ã€‚ æˆ‘ä»¬è¿˜çŸ¥é“ <code>Exporter</code>ç±»åŒ…å«æ”¯æŒ <code>Shape</code>ç±»çš„å¯¼å‡ºåŠŸèƒ½åŸºç¡€å®ç°ï¼š  <code>export(s: Shape)</code> ã€‚</p><p>è¿™æ˜¯å”¯ä¸€èƒ½å¤Ÿå®‰å…¨é“¾æ¥å½“å‰ä»£ç è€Œä¸ä¼šé€ æˆæ¨¡å‡Œä¸¤å¯æƒ…å½¢çš„å®ç°ã€‚ å› æ­¤å°½ç®¡æˆ‘ä»¬å°† <code>Rectangle</code>å¯¹è±¡ä¼ é€’ç»™äº† <code>exportÂ­Shape</code> ï¼Œ å¯¼å‡ºç±»ä»å°†è°ƒç”¨ <code>export(s: Shape)</code>æ–¹æ³•ã€‚</p><h2 id="åŒåˆ†æ´¾"><a href="#åŒåˆ†æ´¾" class="headerlink" title="åŒåˆ†æ´¾"></a>åŒåˆ†æ´¾</h2><p><strong>åŒåˆ†æ´¾</strong>æ˜¯ä¸€ä¸ªå…è®¸åœ¨é‡è½½æ—¶ä½¿ç”¨åŠ¨æ€ç»‘å®šçš„æŠ€å·§ã€‚ ä¸‹é¢æ˜¯å…¶å®ç°æ–¹å¼ï¼š</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Visitor <span class="keyword">is</span></span><br><span class="line">    method visit(s: Shape) <span class="keyword">is</span></span><br><span class="line">        print(&quot;è®¿é—®å½¢çŠ¶&quot;)</span><br><span class="line">    method visit(d: Dot)</span><br><span class="line">        print(&quot;è®¿é—®ç‚¹&quot;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Graphic <span class="keyword">is</span></span><br><span class="line">    method accept(v: Visitor)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Shape <span class="keyword">implements</span> Graphic <span class="keyword">is</span></span><br><span class="line">    method accept(v: Visitor)</span><br><span class="line">        <span class="comment">// ç¼–è¯‘å™¨æ˜ç¡®çŸ¥é“ `this` çš„ç±»å‹æ˜¯ `Shape`ã€‚</span></span><br><span class="line">        <span class="comment">// å› æ­¤å¯ä»¥å®‰å…¨åœ°è°ƒç”¨ `visit(s: Shape)`ã€‚</span></span><br><span class="line">        v.visit(this)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Dot extends Shape <span class="keyword">is</span></span><br><span class="line">    method accept(v: Visitor)</span><br><span class="line">        <span class="comment">// ç¼–è¯‘å™¨æ˜ç¡®çŸ¥é“ `this` çš„ç±»å‹æ˜¯ `Dot`ã€‚</span></span><br><span class="line">        <span class="comment">// å› æ­¤å¯ä»¥å®‰å…¨åœ°è°ƒç”¨ `visit(s: Dot)`ã€‚</span></span><br><span class="line">        v.visit(this)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Visitor v = new Visitor();</span><br><span class="line">Graphic g = new Dot();</span><br><span class="line"></span><br><span class="line"><span class="comment">// `accept` æ–¹æ³•æ˜¯é‡å†™è€Œä¸æ˜¯é‡è½½çš„ã€‚ç¼–è¯‘å™¨å¯ä»¥è¿›è¡ŒåŠ¨æ€ç»‘å®šã€‚</span></span><br><span class="line"><span class="comment">// å› æ­¤åœ¨å¯¹è±¡è°ƒç”¨æŸä¸ªæ–¹æ³•æ—¶ï¼Œå°†æ‰§è¡Œå…¶æ‰€å±ç±»ä¸­çš„ `accept`</span></span><br><span class="line"><span class="comment">// æ–¹æ³•ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ `Dot` ç±»ï¼‰ã€‚</span></span><br><span class="line">g.accept(v);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š&quot;è®¿é—®ç‚¹&quot;</span></span><br></pre></td></tr></table></figure><h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><p>å°½ç®¡<a href="https://refactoringguru.cn/design-patterns/visitor">è®¿é—®è€…</a>æ¨¡å¼åŸºäºåŒåˆ†æ´¾çš„åŸåˆ™åˆ›å»ºï¼Œ ä½†è¿™å¹¶ä¸æ˜¯å…¶ä¸»è¦ç›®çš„ã€‚ è®¿é—®è€…çš„ç›®çš„æ˜¯è®©ä½ èƒ½ä¸ºæ•´ä¸ªç±»å±‚æ¬¡ç»“æ„æ·»åŠ  â€œå¤–éƒ¨â€ æ“ä½œï¼Œ è€Œæ— éœ€ä¿®æ”¹è¿™äº›ç±»çš„å·²æœ‰ä»£ç ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://refactoringguru.cn/design-patterns/visitor-double-dispatch&quot;&gt;https://refactoringguru.cn/design-patterns/visi
      
    
    </summary>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>å·¥å‚æ¨¡å¼æ¯”è¾ƒ</title>
    <link href="http://wangyangyangisme.github.io/posts/63b2a10f/"/>
    <id>http://wangyangyangisme.github.io/posts/63b2a10f/</id>
    <published>2021-05-04T14:24:54.000Z</published>
    <updated>2021-05-04T14:24:54.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://refactoringguru.cn/design-patterns/factory-comparison">https://refactoringguru.cn/design-patterns/factory-comparison</a></p></blockquote><h1 id="å·¥å‚æ¨¡å¼æ¯”è¾ƒ"><a href="#å·¥å‚æ¨¡å¼æ¯”è¾ƒ" class="headerlink" title="å·¥å‚æ¨¡å¼æ¯”è¾ƒ"></a>å·¥å‚æ¨¡å¼æ¯”è¾ƒ</h1><p>æœ¬æ–‡å°†å¯¹ä¸‹åˆ—æ¦‚å¿µä¹‹é—´çš„å·®å¼‚è¿›è¡Œè¯´æ˜ï¼š</p><ol><li>å·¥å‚</li><li>æ„å»ºæ–¹æ³•</li><li>é™æ€æ„å»º ï¼ˆæˆ–å·¥å‚ï¼‰ æ–¹æ³•</li><li>ç®€å•å·¥å‚</li><li><a href="https://refactoringguru.cn/design-patterns/factory-method">å·¥å‚æ–¹æ³•</a></li><li><a href="https://refactoringguru.cn/design-patterns/abstract-factory">æŠ½è±¡å·¥å‚</a></li></ol><p>ä½ å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°è¿™äº›æœ¯è¯­çš„å‚è€ƒä¿¡æ¯ã€‚ å°½ç®¡å®ƒä»¬çœ‹ä¸Šå»ç›¸ä¼¼ï¼Œ ä½†å…¶å«ä¹‰éƒ½ä¸ä¸€æ ·ã€‚ è®¸å¤šäººæ²¡æœ‰æ„è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œ ä»è€Œå‡ºç°äº†æ··æ·†å’Œè¯¯è§£ã€‚</p><p>å› æ­¤è®©æˆ‘ä»¬ææ¸…æ¥šå…¶ä¸­çš„ä¸åŒä¹‹å¤„ï¼Œ ä¸€åŠ³æ°¸é€¸åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="1-å·¥å‚"><a href="#1-å·¥å‚" class="headerlink" title="1. å·¥å‚"></a>1. å·¥å‚</h2><p><strong>å·¥å‚</strong>æ˜¯ä¸€ä¸ªå«ä¹‰æ¨¡ç³Šçš„æœ¯è¯­ï¼Œ è¡¨ç¤ºå¯ä»¥åˆ›å»ºä¸€äº›ä¸œè¥¿çš„å‡½æ•°ã€ æ–¹æ³•æˆ–ç±»ã€‚ æœ€å¸¸è§çš„æƒ…å†µä¸‹ï¼Œ å·¥å‚åˆ›å»ºçš„æ˜¯å¯¹è±¡ã€‚ ä½†æ˜¯å®ƒä»¬ä¹Ÿå¯ä»¥åˆ›å»ºæ–‡ä»¶å’Œæ•°æ®åº“è®°å½•ç­‰å…¶ä»–ä¸œè¥¿ã€‚</p><p>ä¾‹å¦‚ï¼Œ ä¸‹é¢è¿™äº›ä¸œè¥¿éƒ½å¯ä»¥éæ­£å¼åœ°è¢«ç§°ä¸º â€œå·¥å‚â€ï¼š</p><ul><li>åˆ›å»ºç¨‹åº GUI çš„å‡½æ•°æˆ–æ–¹æ³•ï¼›</li><li>åˆ›å»ºç”¨æˆ·çš„ç±»ï¼›</li><li>ä»¥ç‰¹å®šæ–¹å¼è°ƒç”¨ç±»æ„é€ å‡½æ•°çš„é™æ€æ–¹æ³•ã€‚</li><li>ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ã€‚</li></ul><p>å½“æŸäººè¯´åˆ° â€œå·¥å‚â€ è¿™ä¸ªè¯æ—¶ï¼Œ å…¶å…·ä½“å«ä¹‰é€šå¸¸å¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡æ¥ç¡®å®šã€‚ ä½†å¦‚æœä½ æœ‰ç–‘é—®ï¼Œ å¯ä»¥ç›´æ¥æé—®ã€‚ æ¯•ç«Ÿä½œè€…æœ¬äººæœ‰æ—¶å€™ä¹Ÿæ²¡æœ‰ææ¸…æ¥šã€‚</p><h2 id="2-æ„å»ºæ–¹æ³•"><a href="#2-æ„å»ºæ–¹æ³•" class="headerlink" title="2. æ„å»ºæ–¹æ³•"></a>2. æ„å»ºæ–¹æ³•</h2><p>æ„å»ºæ–¹æ³•åœ¨ ã€Š<a href="https://refactoringguru.cn/ref-to-patterns-book">é‡æ„ä¸æ¨¡å¼</a>ã€‹ ä¸­è¢«å®šä¹‰ä¸º â€œåˆ›å»ºå¯¹è±¡çš„æ–¹æ³•â€ã€‚ è¿™æ„å‘³ç€æ¯ä¸ªå·¥å‚æ–¹æ³•æ¨¡å¼çš„ç»“æœéƒ½æ˜¯ â€œæ„å»ºæ–¹æ³•â€ï¼Œ ä½†åè¿‡æ¥åˆ™å¹¶éå¦‚æ­¤ã€‚ è¿™ä¹Ÿæ„å‘³ç€ä½ å¯ä»¥ç”¨ â€œæ„å»ºæ–¹æ³•â€ æ¥æ›¿ä»£é©¬ä¸Â·ç¦å‹’åœ¨<a href="https://refactoring.guru/ref-book">é‡æ„</a>ä¸­ä½¿ç”¨çš„ â€œå·¥å‚æ–¹æ³•â€ å’Œä¹”æ–¯åÂ·å¸ƒæ´›å…‹åœ¨ ã€Š<a href="https://refactoringguru.cn/effective-java-book">Effective Java</a>ã€‹ ä¸­ä½¿ç”¨çš„ â€œé™æ€å·¥å‚æ–¹æ³•â€ã€‚</p><p>åœ¨å®é™…ä¸­ï¼Œ æ„å»ºæ–¹æ³•åªæ˜¯æ„é€ å‡½æ•°è°ƒç”¨çš„å°è£…å™¨ã€‚ å®ƒå¯èƒ½åªæ˜¯ä¸€ä¸ªèƒ½æ›´å¥½åœ°è¡¨è¾¾æ„å›¾çš„åç§°ã€‚ æ­¤å¤–ï¼Œ å®ƒå¯ä»¥è®©ä½ çš„ä»£ç ç‹¬ç«‹äºæ„é€ å‡½æ•°çš„æ”¹åŠ¨ï¼Œ ç”šè‡³è¿˜å¯ä»¥åŒ…å«ä¸€äº›ç‰¹æ®Šçš„é€»è¾‘ï¼Œ è¿”å›å·²æœ‰å¯¹è±¡ä»¥è€Œä¸æ˜¯åˆ›å»ºæ–°å¯¹è±¡ã€‚</p><p>è®¸å¤šäººä¼šä»…ä»…å› ä¸ºè¿™äº›æ–¹æ³•åˆ›å»ºäº†æ–°å¯¹è±¡è€Œç§°ä¹‹ä¸º â€œå·¥å‚æ–¹æ³•â€ã€‚ å…¶ä¸­çš„é€»è¾‘å¾ˆç›´æ¥ï¼š æ‰€æœ‰çš„<em>å·¥å‚</em>éƒ½ä¼šåˆ›å»ºå¯¹è±¡ï¼Œ è€Œè¯¥æ–¹æ³•ä¼šåˆ›å»ºå¯¹è±¡ï¼Œ æ‰€ä»¥æ˜¾ç„¶å®ƒæ˜¯ä¸€ä¸ª<em>å·¥å‚æ–¹æ³•</em>ã€‚ å½“é‡åˆ°çœŸæ­£çš„<a href="https://refactoringguru.cn/design-patterns/factory-method">å·¥å‚æ–¹æ³•</a>æ—¶ï¼Œ è¿™è‡ªç„¶ä¼šé€ æˆè®¸å¤šæ··æ·†ã€‚</p><p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ  <code>next</code>æ˜¯ä¸€ä¸ªæ„å»ºæ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Number</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;value = $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Number (<span class="keyword">$this</span>-&gt;value + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-é™æ€æ„å»ºæ–¹æ³•"><a href="#3-é™æ€æ„å»ºæ–¹æ³•" class="headerlink" title="3. é™æ€æ„å»ºæ–¹æ³•"></a>3. é™æ€æ„å»ºæ–¹æ³•</h2><p><strong>é™æ€æ„å»ºæ–¹æ³•</strong>æ˜¯è¢«å£°æ˜ä¸º <code>static</code>çš„æ„å»ºæ–¹æ³•ã€‚ æ¢å¥è¯è¯´ï¼Œ ä½ æ— éœ€åˆ›å»ºå¯¹è±¡å°±èƒ½åœ¨æŸä¸ªç±»ä¸Šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><p>ä¸è¦å› ä¸ºæŸäº›äººå°†è¿™äº›æ–¹æ³•ç§°ä¸º â€œé™æ€å·¥å‚æ–¹æ³•â€ è€Œè¢«å…¶è¿·æƒ‘ã€‚ è¿™ç§ç§°å‘¼åªæ˜¯ä¸€ä¸ªåä¹ æƒ¯ã€‚ <a href="https://refactoringguru.cn/design-patterns/factory-method">å·¥å‚æ–¹æ³•</a>æ˜¯ä¸€ç§ä¾èµ–äºç»§æ‰¿çš„è®¾è®¡æ¨¡å¼ã€‚ å¦‚æœå°†å®ƒè®¾ç½®ä¸º <code>static</code> ï¼Œ ä½ å°±ä¸èƒ½åœ¨å­ç±»ä¸­å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼Œ è¿™å°±ç ´åäº†è¯¥æ¨¡å¼çš„ç›®çš„ã€‚</p><p>å½“é™æ€æ„å»ºæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡æ—¶ï¼Œ å®ƒå°±æˆä¸ºäº†æ„é€ å‡½æ•°çš„æ›¿ä»£å“ã€‚</p><p>åœ¨ä¸‹åˆ—æƒ…å†µä¸­ï¼Œ è¿™å¯èƒ½ä¼šéå¸¸å®ç”¨ï¼š</p><ul><li>ä½ å¿…é¡»é’ˆå¯¹ä¸åŒçš„ç›®çš„æä¾›å¤šä¸ªä¸åŒçš„æ„é€ å‡½æ•°ï¼Œ ä½†æ˜¯å…¶ç­¾åç›¸åŒæ—¶ã€‚ ä¾‹å¦‚ï¼Œ åœ¨ Javaã€ C++ã€ C# ä»¥åŠå…¶ä»–è®¸å¤šè¯­è¨€ä¸­ä¸å¯èƒ½åŒæ—¶å­˜åœ¨ <code>RandomÂ­(int max)</code>å’Œ <code>RandomÂ­(int min)</code>å‡½æ•°ã€‚ æœ€å¸¸ç”¨çš„å˜é€šæ–¹å¼æ˜¯åˆ›å»ºå¤šä¸ªè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°çš„é™æ€æ–¹æ³•ï¼Œ å¹¶äºç¨åå†è®¾ç½®é€‚å½“çš„æ•°å€¼ã€‚</li><li>ä½ å¸Œæœ›å¤ç”¨å·²æœ‰å¯¹è±¡è€Œä¸æ˜¯åˆå§‹åŒ–æ–°å¯¹è±¡æ—¶ ï¼ˆå‚è€ƒ<a href="https://refactoringguru.cn/design-patterns/singleton">å•ä¾‹</a>æ¨¡å¼ï¼‰ã€‚ ç»å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€çš„æ„é€ å‡½æ•°å¿…é¡»éƒ½è¿”å›ä¸€ä¸ªæ–°çš„ç±»å®ä¾‹ã€‚ é™æ€æ„å»ºæ–¹æ³•æ˜¯åº”å¯¹è¯¥é™åˆ¶çš„å˜é€šæ–¹æ³•ã€‚ åœ¨é™æ€æ–¹æ³•å†…éƒ¨ï¼Œ ä½ çš„ä»£ç ä¼šå†³å®šæ˜¯è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå…¨æ–°å®ä¾‹ï¼Œ è¿˜æ˜¯è¿”å›ä¸€ä¸ªåœ¨ç¼“å­˜ä¸­å·²æœ‰çš„å¯¹è±¡ã€‚</li></ul><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ  <code>load</code>æ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€æ„å»ºæ–¹æ³•ã€‚ å®ƒæä¾›äº†ä¸€ç§ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·çš„çµæ´»æ–¹å¼ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $id, $name, $email, $phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$id, $name, $email, $phone</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id = $id;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;email = $email;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;phone = $phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params">$id</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>($id, $name, $email, $phone) = DB::load_data(<span class="string">&#x27;users&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>);</span><br><span class="line">        $user = <span class="keyword">new</span> User($id, $name, $email, $phone);</span><br><span class="line">        <span class="keyword">return</span> $user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-ç®€å•å·¥å‚æ¨¡å¼"><a href="#4-ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="4. ç®€å•å·¥å‚æ¨¡å¼"></a>4. ç®€å•å·¥å‚æ¨¡å¼</h2><p><strong>ç®€å•å·¥å‚</strong>æ¨¡å¼ æè¿°äº†ä¸€ä¸ªç±»ï¼Œ å®ƒæ‹¥æœ‰ä¸€ä¸ªåŒ…å«å¤§é‡æ¡ä»¶è¯­å¥çš„æ„å»ºæ–¹æ³•ï¼Œ å¯æ ¹æ®æ–¹æ³•çš„å‚æ•°æ¥é€‰æ‹©å¯¹ä½•ç§äº§å“è¿›è¡Œåˆå§‹åŒ–å¹¶å°†å…¶è¿”å›ã€‚</p><p>äººä»¬é€šå¸¸ä¼šå°†<em>ç®€å•å·¥å‚</em>ä¸æ™®é€šçš„<em>å·¥å‚</em>æˆ–å…¶å®ƒåˆ›å»ºå‹è®¾è®¡æ¨¡å¼æ··æ·†ã€‚ åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ ç®€å•å·¥å‚æ˜¯å¼•å…¥<a href="https://refactoringguru.cn/design-patterns/factory-method">å·¥å‚æ–¹æ³•</a>æˆ–<a href="https://refactoringguru.cn/design-patterns/abstract-factory">æŠ½è±¡å·¥å‚</a>æ¨¡å¼æ—¶çš„ä¸€ä¸ªä¸­é—´æ­¥éª¤ã€‚</p><p>ç®€å•å·¥å‚é€šå¸¸æ²¡æœ‰å­ç±»ã€‚ ä½†å½“ä»ä¸€ä¸ªç®€å•å·¥å‚ä¸­æŠ½å–å‡ºå­ç±»åï¼Œ å®ƒçœ‹ä¸Šå»å°±ä¼šæ›´åƒç»å…¸çš„<em>å·¥å‚æ–¹æ³•</em>æ¨¡å¼äº†ã€‚</p><p>é¡ºä¾¿æä¸€å¥ï¼Œ å¦‚æœä½ å°†ä¸€ä¸ªç®€å•å·¥å‚å£°æ˜ä¸º <code>abstract</code>ç±»å‹ï¼Œ å®ƒå¹¶ä¸ä¼šç¥å¥‡åœ°å˜æˆ<em>æŠ½è±¡å·¥å‚</em>æ¨¡å¼ã€‚</p><p>è¿™é‡Œæ˜¯ä¸€ä¸ª<em>ç®€å•å·¥å‚</em>çš„ä¾‹å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">$type</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> ($type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;user&#x27;</span>: <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;customer&#x27;</span>: <span class="keyword">return</span> <span class="keyword">new</span> Customer();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;admin&#x27;</span>: <span class="keyword">return</span> <span class="keyword">new</span> Admin();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;ä¼ é€’çš„ç”¨æˆ·ç±»å‹é”™è¯¯ã€‚&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#5-å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="5. å·¥å‚æ–¹æ³•æ¨¡å¼"></a>5. å·¥å‚æ–¹æ³•æ¨¡å¼</h2><p><strong>å·¥å‚æ–¹æ³•</strong> æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œ å…¶åœ¨çˆ¶ç±»ä¸­æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼Œ å…è®¸å­ç±»å†³å®šå®ä¾‹åŒ–å¯¹è±¡çš„ç±»å‹ã€‚</p><p>å¦‚æœåœ¨åŸºç±»åŠå…¶æ‰©å±•çš„å­ç±»ä¸­éƒ½æœ‰ä¸€ä¸ªæ„å»ºæ–¹æ³•çš„è¯ï¼Œ é‚£å®ƒå¯èƒ½å°±æ˜¯å·¥å‚æ–¹æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="function"><span class="keyword">function</span> <span class="title">createEmployee</span>(<span class="params">$id</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fire</span>(<span class="params">$id</span>) </span>&#123;</span><br><span class="line">        $employee = <span class="keyword">$this</span>-&gt;createEmployee($id);</span><br><span class="line">        $employee-&gt;paySalary();</span><br><span class="line">        $employee-&gt;dismiss();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ITDepartment</span> <span class="keyword">extends</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createEmployee</span>(<span class="params">$id</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Programmer($id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountingDepartment</span> <span class="keyword">extends</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createEmployee</span>(<span class="params">$id</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Accountant($id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#6-æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="6. æŠ½è±¡å·¥å‚æ¨¡å¼"></a>6. æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p><strong>æŠ½è±¡å·¥å‚</strong> ã€‹ æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œ å®ƒèƒ½åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„å¯¹è±¡ï¼Œ è€Œæ— éœ€æŒ‡å®šå…¶å…·ä½“ç±»ã€‚</p><p>ä»€ä¹ˆæ˜¯ â€œç³»åˆ—å¯¹è±¡â€ï¼Ÿ ä¾‹å¦‚æœ‰è¿™æ ·ä¸€ç»„çš„å¯¹è±¡ï¼š  <code>è¿è¾“å·¥å…·</code>+ <code>å¼•æ“</code>+ <code>æ§åˆ¶å™¨</code> ã€‚ å®ƒå¯èƒ½ä¼šæœ‰å‡ ä¸ªå˜ä½“ï¼š</p><ol><li><code>æ±½è½¦</code>+ <code>å†…ç‡ƒæœº</code>+ <code>æ–¹å‘ç›˜</code></li><li><code>é£æœº</code>+ <code>å–·æ°”å¼å‘åŠ¨æœº</code>+ <code>æ“çºµæ†</code></li></ol><p>å¦‚æœä½ çš„ç¨‹åºä¸­å¹¶ä¸æ¶‰åŠäº§å“ç³»åˆ—çš„è¯ï¼Œ é‚£å°±ä¸éœ€è¦æŠ½è±¡å·¥å‚ã€‚</p><p>å†æ¬¡é‡ç”³ï¼Œ è®¸å¤šäººåˆ†ä¸æ¸…<em>æŠ½è±¡å·¥å‚</em>æ¨¡å¼å’Œå£°æ˜ä¸º <code>abstract</code>çš„ç®€å•å·¥å‚ã€‚ ä¸è¦çŠ¯è¿™ä¸ªé”™è¯¯ï¼</p><h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><p>ç°åœ¨ä½ çŸ¥é“äº†å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Œ è¯•è¯•ç”¨å…¨æ–°çœ¼å…‰çœ‹å¾…ä¸‹é¢çš„è®¾è®¡æ¨¡å¼å§ï¼š</p><ul><li><a href="https://refactoringguru.cn/design-patterns/factory-method">å·¥å‚æ–¹æ³•</a></li><li><a href="https://refactoringguru.cn/design-patterns/abstract-factory">æŠ½è±¡å·¥å‚</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://refactoringguru.cn/design-patterns/factory-comparison&quot;&gt;https://refactoringguru.cn/design-patterns/factory-c
      
    
    </summary>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>è¡Œä¸ºæ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼</title>
    <link href="http://wangyangyangisme.github.io/posts/ab521f7f/"/>
    <id>http://wangyangyangisme.github.io/posts/ab521f7f/</id>
    <published>2021-05-04T13:55:31.000Z</published>
    <updated>2021-05-04T13:55:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è¡Œä¸ºæ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼"><a href="#è¡Œä¸ºæ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="è¡Œä¸ºæ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼"></a>è¡Œä¸ºæ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼</h1><p><strong>äº¦ç§°ï¼š</strong> interpreter</p><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>è§£é‡Šå™¨æ¨¡å¼ï¼šå®šä¹‰<code>ä¸€ç§æ–¹æ³•å’Œå¯¹åº”çš„è§£é‡Šå™¨</code>ï¼Œä½¿ç”¨è§£é‡Šå™¨<code>è§£é‡Šæ­¤æ–¹æ³•çš„è¯­å¥</code>æ¥æ‰§è¡Œï¼›</p><ul><li>è§£é‡Šå™¨æ¨¡å¼éœ€è¦ä¸Šä¸‹æ–‡ç±»æ¥<code>å®šä¹‰å’Œå­˜å‚¨ä¸Šä¸‹æ–‡</code>ï¼Œè§£é‡Šå™¨ç±»ç”¨æ¥å°†è¯­å¥æ¥ç¿»è¯‘æˆå¯æ‰§è¡Œç¨‹åºï¼›</li><li>è§£é‡Šå™¨æ‰©å±•å’Œæ”¹å˜æ–‡åŒ–éå¸¸ç®€å•ï¼Œæ„å»ºå®Œæˆåå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ•°æ®æ ¼å¼ï¼›</li><li>è§£é‡Šå™¨æ¨¡å¼ä¼šå°†éç»ˆç»“è¡¨è¾¾å¼<code>é€’å½’è§£é‡Š</code>ï¼Œç›´åˆ°è§£é‡Šä¸ºç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼›</li></ul><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><ul><li>è§£é‡Šå™¨æ¨¡å¼é€‚ç”¨äºæ•°æ®ç»“æ„ä¸è§„åˆ™ï¼Œä½†æ•°æ®è¦ç´ ç›¸åŒçš„æƒ…å†µï¼›</li><li>è¯­æ³•ä¸èƒ½å¤ªå¤æ‚ï¼Œå¤æ‚çš„æœ€å¥½ä½¿ç”¨è§£é‡Šå½¢è¯­è¨€æ¥å®ç°ä»¥é™ä½å¤æ‚æ€§ï¼›</li></ul><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/interpreter.png" alt=""></p><div class="tabs" id="tags"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#tags-1">golang</button></li><li class="tab"><button type="button" data-href="#tags-2">java</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="tags-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„å›¾ï¼šç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥æ ‡è¯†æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚</span></span><br><span class="line"><span class="comment">//ä¸»è¦è§£å†³ï¼šå¯¹äºä¸€äº›å›ºå®šæ–‡æ³•æ„å»ºä¸€ä¸ªè§£é‡Šå¥å­çš„è§£é‡Šå™¨ã€‚</span></span><br><span class="line"><span class="comment">//ä½•æ—¶ä½¿ç”¨ï¼šå¦‚æœä¸€ç§ç‰¹å®šç±»å‹çš„é—®é¢˜å‘ç”Ÿçš„é¢‘ç‡è¶³å¤Ÿé«˜ï¼Œé‚£ä¹ˆå¯èƒ½å°±å€¼å¾—å°†è¯¥é—®é¢˜çš„å„ä¸ªå®ä¾‹è¡¨è¿°ä¸ºä¸€ä¸ªç®€å•è¯­è¨€ä¸­çš„å¥å­ã€‚è¿™æ ·å°±å¯ä»¥æ„å»ºä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¯¥è§£é‡Šå™¨é€šè¿‡è§£é‡Šè¿™äº›å¥å­æ¥è§£å†³è¯¥é—®é¢˜ã€‚</span></span><br><span class="line"><span class="comment">//å¦‚ä½•è§£å†³ï¼šæ„ä»¶è¯­æ³•æ ‘ï¼Œå®šä¹‰ç»ˆç»“ç¬¦ä¸éç»ˆç»“ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">//å…³é”®ä»£ç ï¼šæ„ä»¶ç¯å¢ƒç±»ï¼ŒåŒ…å«è§£é‡Šå™¨ä¹‹å¤–çš„ä¸€äº›å…¨å±€ä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯ HashMapã€‚</span></span><br><span class="line"><span class="comment">//åº”ç”¨å®ä¾‹ï¼šç¼–è¯‘å™¨ã€è¿ç®—è¡¨è¾¾å¼è®¡ç®—ã€‚SQL è§£æã€ç¬¦å·å¤„ç†å¼•æ“ç­‰</span></span><br><span class="line"><span class="comment">//ä¼˜ç‚¹ï¼š 1ã€å¯æ‰©å±•æ€§æ¯”è¾ƒå¥½ï¼Œçµæ´»ã€‚ 2ã€å¢åŠ äº†æ–°çš„è§£é‡Šè¡¨è¾¾å¼çš„æ–¹å¼ã€‚ 3ã€æ˜“äºå®ç°ç®€å•æ–‡æ³•ã€‚</span></span><br><span class="line"><span class="comment">//ç¼ºç‚¹ï¼š 1ã€å¯åˆ©ç”¨åœºæ™¯æ¯”è¾ƒå°‘ã€‚ 2ã€å¯¹äºå¤æ‚çš„æ–‡æ³•æ¯”è¾ƒéš¾ç»´æŠ¤ã€‚ 3ã€è§£é‡Šå™¨æ¨¡å¼ä¼šå¼•èµ·ç±»è†¨èƒ€ã€‚ 4ã€è§£é‡Šå™¨æ¨¡å¼é‡‡ç”¨é€’å½’è°ƒç”¨æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨åœºæ™¯ï¼š 1ã€å¯ä»¥å°†ä¸€ä¸ªéœ€è¦è§£é‡Šæ‰§è¡Œçš„è¯­è¨€ä¸­çš„å¥å­è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ã€‚ 2ã€ä¸€äº›é‡å¤å‡ºç°çš„é—®é¢˜å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„è¯­è¨€æ¥è¿›è¡Œè¡¨è¾¾ã€‚ 3ã€ä¸€ä¸ªç®€å•è¯­æ³•éœ€è¦è§£é‡Šçš„åœºæ™¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ä¾‹:åˆ¤æ–­ç‰¹å®šçš„æ–‡æœ¬æ˜¯å¦ç¬¦åˆæ­£ç¡®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Expression <span class="keyword">interface</span> &#123;</span><br><span class="line">Interpret(context <span class="keyword">string</span>) <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TerminalExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">Word <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»ˆç»“ç¬¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(te *TerminalExpression)</span> <span class="title">Interpret</span><span class="params">(context <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> strings.Contains(context, te.Word) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"><span class="keyword">type</span> OrExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">A Expression</span><br><span class="line">B Expression</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(oe *OrExpression)</span> <span class="title">Interpret</span><span class="params">(context <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> oe.A.Interpret(context) || oe.B.Interpret(context)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸</span></span><br><span class="line"><span class="keyword">type</span> AndExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">A Expression</span><br><span class="line">B Expression</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ae *AndExpression)</span> <span class="title">Interpret</span><span class="params">(context <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> ae.A.Interpret(context) &amp;&amp; ae.B.Interpret(context)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">isMale := &amp;OrExpression&#123;&amp;TerminalExpression&#123;<span class="string">&quot;Robert&quot;</span>&#125;, &amp;TerminalExpression&#123;<span class="string">&quot;John&quot;</span>&#125;&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;John is male?&quot;</span>, isMale.Interpret(<span class="string">&quot;John&quot;</span>))</span><br><span class="line">isMarriedWoman := &amp;AndExpression&#123;&amp;TerminalExpression&#123;<span class="string">&quot;Julie&quot;</span>&#125;, &amp;TerminalExpression&#123;<span class="string">&quot;Married&quot;</span>&#125;&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;Julie is a married women?&quot;</span>, isMarriedWoman.Interpret(<span class="string">&quot;Married Julie&quot;</span>))</span><br><span class="line"><span class="comment">//OutPut:</span></span><br><span class="line"><span class="comment">//John is male? true</span></span><br><span class="line"><span class="comment">//Julie is a married women? true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-2"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;è¡Œä¸ºæ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼&quot;&gt;&lt;a href=&quot;#è¡Œä¸ºæ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;è¡Œä¸ºæ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼&quot;&gt;&lt;/a&gt;è¡Œä¸ºæ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;äº¦ç§°ï¼š&lt;/strong&gt; interpreter&lt;/p&gt;
&lt;
      
    
    </summary>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>è¡Œä¸ºæ¨¡å¼-è®¿é—®è€…æ¨¡å¼</title>
    <link href="http://wangyangyangisme.github.io/posts/ff280d74/"/>
    <id>http://wangyangyangisme.github.io/posts/ff280d74/</id>
    <published>2021-05-04T13:50:44.000Z</published>
    <updated>2021-05-04T13:50:44.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://refactoringguru.cn/design-patterns/visitor">https://refactoringguru.cn/design-patterns/visitor</a></p></blockquote><h1 id="è¡Œä¸ºæ¨¡å¼-è®¿é—®è€…æ¨¡å¼"><a href="#è¡Œä¸ºæ¨¡å¼-è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è¡Œä¸ºæ¨¡å¼-è®¿é—®è€…æ¨¡å¼"></a>è¡Œä¸ºæ¨¡å¼-è®¿é—®è€…æ¨¡å¼</h1><p><strong>äº¦ç§°ï¼š</strong> Visitor</p><h2 id="æ„å›¾"><a href="#æ„å›¾" class="headerlink" title="æ„å›¾"></a>æ„å›¾</h2><p><strong>è®¿é—®è€…æ¨¡å¼</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å®ƒèƒ½å°†ç®—æ³•ä¸å…¶æ‰€ä½œç”¨çš„å¯¹è±¡éš”ç¦»å¼€æ¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/visitor.png" alt=""></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>å‡å¦‚ä½ çš„å›¢é˜Ÿå¼€å‘äº†ä¸€æ¬¾èƒ½å¤Ÿä½¿ç”¨å·¨å‹å›¾åƒä¸­åœ°ç†ä¿¡æ¯çš„åº”ç”¨ç¨‹åºã€‚ å›¾åƒä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ—¢èƒ½ä»£è¡¨å¤æ‚å®ä½“ ï¼ˆä¾‹å¦‚ä¸€åº§åŸå¸‚ï¼‰ï¼Œ ä¹Ÿèƒ½ä»£è¡¨æ›´ç²¾ç»†çš„å¯¹è±¡ ï¼ˆä¾‹å¦‚å·¥ä¸šåŒºå’Œæ—…æ¸¸æ™¯ç‚¹ç­‰ï¼‰ã€‚ å¦‚æœèŠ‚ç‚¹ä»£è¡¨çš„çœŸå®å¯¹è±¡ä¹‹é—´å­˜åœ¨å…¬è·¯ï¼Œ é‚£ä¹ˆè¿™äº›èŠ‚ç‚¹å°±ä¼šç›¸äº’è¿æ¥ã€‚ åœ¨ç¨‹åºå†…éƒ¨ï¼Œ æ¯ä¸ªèŠ‚ç‚¹çš„ç±»å‹éƒ½ç”±å…¶æ‰€å±çš„ç±»æ¥è¡¨ç¤ºï¼Œ æ¯ä¸ªç‰¹å®šçš„èŠ‚ç‚¹åˆ™æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/problem1-visitor.png" alt="å°†å›¾åƒå¯¼å‡ºä¸º XMLã€‚"></p><p>ä¸€æ®µæ—¶é—´åï¼Œ ä½ æ¥åˆ°äº†å®ç°å°†å›¾åƒå¯¼å‡ºåˆ° XML æ–‡ä»¶ä¸­çš„ä»»åŠ¡ã€‚ è¿™äº›å·¥ä½œæœ€åˆçœ‹ä¸Šå»éå¸¸ç®€å•ã€‚ ä½ è®¡åˆ’ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç±»æ·»åŠ å¯¼å‡ºå‡½æ•°ï¼Œ ç„¶åé€’å½’æ‰§è¡Œå›¾åƒä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å¯¼å‡ºå‡½æ•°ã€‚ è§£å†³æ–¹æ¡ˆç®€å•ä¸”ä¼˜é›…ï¼š ä½¿ç”¨å¤šæ€æœºåˆ¶å¯ä»¥è®©å¯¼å‡ºæ–¹æ³•çš„è°ƒç”¨ä»£ç ä¸ä¼šå’Œå…·ä½“çš„èŠ‚ç‚¹ç±»ç›¸è€¦åˆã€‚</p><p>ä½†ä½ ä¸å¤ªèµ°è¿ï¼Œ ç³»ç»Ÿæ¶æ„å¸ˆæ‹’ç»æ‰¹å‡†å¯¹å·²æœ‰èŠ‚ç‚¹ç±»è¿›è¡Œä¿®æ”¹ã€‚ ä»–è®¤ä¸ºè¿™äº›ä»£ç å·²ç»æ˜¯äº§å“äº†ï¼Œ ä¸æƒ³å†’é™©å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œ å› ä¸ºä¿®æ”¹å¯èƒ½ä¼šå¼•å…¥æ½œåœ¨çš„ç¼ºé™·ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/problem2-zh-visitor.png" alt="æ‰€æœ‰èŠ‚ç‚¹çš„ç±»ä¸­éƒ½å¿…é¡»æ·»åŠ å¯¼å‡ºè‡³ XML æ–‡ä»¶çš„æ–¹æ³•ï¼Œ ä½†å¦‚æœåœ¨ä¿®æ”¹ä»£ç çš„è¿‡ç¨‹ä¸­å¼•å…¥äº†ä»»ä½•ç¼ºé™·ï¼Œ é‚£ä¹ˆæ•´ä¸ªç¨‹åºéƒ½ä¼šé¢ä¸´é£é™©ã€‚"></p><p>æ­¤å¤–ï¼Œ ä»–è¿˜è´¨ç–‘åœ¨èŠ‚ç‚¹ç±»ä¸­åŒ…å«å¯¼å‡º XML æ–‡ä»¶çš„ä»£ç æ˜¯å¦æœ‰æ„ä¹‰ã€‚ è¿™äº›ç±»çš„ä¸»è¦å·¥ä½œæ˜¯å¤„ç†åœ°ç†æ•°æ®ã€‚ å¯¼å‡º XML æ–‡ä»¶çš„ä»£ç æ”¾åœ¨è¿™é‡Œå¹¶ä¸åˆé€‚ã€‚</p><p>è¿˜æœ‰å¦ä¸€ä¸ªåŸå› ï¼Œ é‚£å°±æ˜¯åœ¨æ­¤é¡¹ä»»åŠ¡å®Œæˆåï¼Œ è¥é”€éƒ¨é—¨å¾ˆæœ‰å¯èƒ½ä¼šè¦æ±‚ç¨‹åºæä¾›å¯¼å‡ºå…¶ä»–ç±»å‹æ–‡ä»¶çš„åŠŸèƒ½ï¼Œ æˆ–è€…æå‡ºå…¶ä»–å¥‡æ€ªçš„è¦æ±‚ã€‚ è¿™æ ·ä½ å¾ˆå¯èƒ½ä¼šè¢«è¿«å†æ¬¡ä¿®æ”¹è¿™äº›é‡è¦ä½†è„†å¼±çš„ç±»ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>è®¿é—®è€…æ¨¡å¼å»ºè®®å°†æ–°è¡Œä¸ºæ”¾å…¥ä¸€ä¸ªåä¸º<em>è®¿é—®è€…</em>çš„ç‹¬ç«‹ç±»ä¸­ï¼Œ è€Œä¸æ˜¯è¯•å›¾å°†å…¶æ•´åˆåˆ°å·²æœ‰ç±»ä¸­ã€‚ ç°åœ¨ï¼Œ éœ€è¦æ‰§è¡Œæ“ä½œçš„åŸå§‹å¯¹è±¡å°†ä½œä¸ºå‚æ•°è¢«ä¼ é€’ç»™è®¿é—®è€…ä¸­çš„æ–¹æ³•ï¼Œ è®©æ–¹æ³•èƒ½è®¿é—®å¯¹è±¡æ‰€åŒ…å«çš„ä¸€åˆ‡å¿…è¦æ•°æ®ã€‚</p><p>å¦‚æœç°åœ¨è¯¥æ“ä½œèƒ½åœ¨ä¸åŒç±»çš„å¯¹è±¡ä¸Šæ‰§è¡Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ æ¯”å¦‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œ å„èŠ‚ç‚¹ç±»å¯¼å‡º XML æ–‡ä»¶çš„å®é™…å®ç°å¾ˆå¯èƒ½ä¼šç¨æœ‰ä¸åŒã€‚ å› æ­¤ï¼Œ è®¿é—®è€…ç±»å¯ä»¥å®šä¹‰ä¸€ç»„ ï¼ˆè€Œä¸æ˜¯ä¸€ä¸ªï¼‰ æ–¹æ³•ï¼Œ ä¸”æ¯ä¸ªæ–¹æ³•å¯æ¥æ”¶ä¸åŒç±»å‹çš„å‚æ•°ï¼Œ å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> ExportVisitor <span class="keyword">implements</span> Visitor <span class="keyword">is</span></span><br><span class="line">    method doForCity(City c) <span class="comment">&#123; ... &#125;</span></span><br><span class="line">    method doForIndustry(Industry f) <span class="comment">&#123; ... &#125;</span></span><br><span class="line">    method doForSightSeeing(SightSeeing ss) <span class="comment">&#123; ... &#125;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ä½†æˆ‘ä»¬ç©¶ç«Ÿåº”è¯¥å¦‚ä½•è°ƒç”¨è¿™äº›æ–¹æ³• ï¼ˆå°¤å…¶æ˜¯åœ¨å¤„ç†æ•´ä¸ªå›¾åƒæ–¹é¢ï¼‰ å‘¢ï¼Ÿ è¿™äº›æ–¹æ³•çš„ç­¾åå„ä¸ç›¸åŒï¼Œ å› æ­¤æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨å¤šæ€æœºåˆ¶ã€‚ ä¸ºäº†å¯ä»¥æŒ‘é€‰å‡ºèƒ½å¤Ÿå¤„ç†ç‰¹å®šå¯¹è±¡çš„è®¿é—®è€…æ–¹æ³•ï¼Œ æˆ‘ä»¬éœ€è¦å¯¹å®ƒçš„ç±»è¿›è¡Œæ£€æŸ¥ã€‚ è¿™æ˜¯ä¸æ˜¯å¬ä¸Šå»åƒä¸ªå™©æ¢¦å‘¢ï¼Ÿ</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">foreach (Node node <span class="keyword">in</span> graph)</span><br><span class="line">    <span class="keyword">if</span> (node instanceof City)</span><br><span class="line">        exportVisitor.doForCity((City) node)</span><br><span class="line">    <span class="keyword">if</span> (node instanceof Industry)</span><br><span class="line">        exportVisitor.doForIndustry((Industry) node)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šé—®ï¼Œ æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ä½¿ç”¨æ–¹æ³•é‡è½½å‘¢ï¼Ÿ å°±æ˜¯ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•åç§°ï¼Œ ä½†å®ƒä»¬çš„å‚æ•°ä¸åŒã€‚ ä¸å¹¸çš„æ˜¯ï¼Œ å³ä½¿æˆ‘ä»¬çš„ç¼–ç¨‹è¯­è¨€ ï¼ˆä¾‹å¦‚ Java å’Œ C#ï¼‰ æ”¯æŒé‡è½½ä¹Ÿä¸è¡Œã€‚ ç”±äºæˆ‘ä»¬æ— æ³•æå‰çŸ¥æ™“èŠ‚ç‚¹å¯¹è±¡æ‰€å±çš„ç±»ï¼Œ æ‰€ä»¥é‡è½½æœºåˆ¶æ— æ³•æ‰§è¡Œæ­£ç¡®çš„æ–¹æ³•ã€‚ æ–¹æ³•ä¼šå°† <code>èŠ‚ç‚¹</code>åŸºç±»ä½œä¸ºè¾“å…¥å‚æ•°çš„é»˜è®¤ç±»å‹ã€‚</p><p>ä½†æ˜¯ï¼Œ è®¿é—®è€…æ¨¡å¼å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å®ƒä½¿ç”¨äº†ä¸€ç§åä¸º<a href="https://refactoringguru.cn/design-patterns/visitor-double-dispatch">åŒåˆ†æ´¾</a>çš„æŠ€å·§ï¼Œ ä¸ä½¿ç”¨ç´¯èµ˜çš„æ¡ä»¶è¯­å¥ä¹Ÿå¯ä¸‹æ‰§è¡Œæ­£ç¡®çš„æ–¹æ³•ã€‚ ä¸å…¶è®©å®¢æˆ·ç«¯æ¥é€‰æ‹©è°ƒç”¨æ­£ç¡®ç‰ˆæœ¬çš„æ–¹æ³•ï¼Œ ä¸å¦‚å°†é€‰æ‹©æƒå§”æ´¾ç»™ä½œä¸ºå‚æ•°ä¼ é€’ç»™è®¿é—®è€…çš„å¯¹è±¡ã€‚ ç”±äºè¯¥å¯¹è±¡çŸ¥æ™“å…¶è‡ªèº«çš„ç±»ï¼Œ å› æ­¤èƒ½æ›´è‡ªç„¶åœ°åœ¨è®¿é—®è€…ä¸­é€‰å‡ºæ­£ç¡®çš„æ–¹æ³•ã€‚ å®ƒä»¬ä¼š â€œæ¥æ”¶â€ ä¸€ä¸ªè®¿é—®è€…å¹¶å‘Šè¯‰å…¶åº”æ‰§è¡Œçš„è®¿é—®è€…æ–¹æ³•ã€‚</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯ä»£ç </span></span><br><span class="line">foreach (Node node <span class="keyword">in</span> graph)</span><br><span class="line">    node.accept(exportVisitor)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸå¸‚</span></span><br><span class="line"><span class="keyword">class</span> City <span class="keyword">is</span></span><br><span class="line">    method accept(Visitor v) <span class="keyword">is</span></span><br><span class="line">        v.doForCity(this)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥ä¸šåŒº</span></span><br><span class="line"><span class="keyword">class</span> Industry <span class="keyword">is</span></span><br><span class="line">    method accept(Visitor v) <span class="keyword">is</span></span><br><span class="line">        v.doForIndustry(this)</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>æˆ‘æ‰¿è®¤æœ€ç»ˆè¿˜æ˜¯ä¿®æ”¹äº†èŠ‚ç‚¹ç±»ï¼Œ ä½†æ¯•ç«Ÿæ”¹åŠ¨å¾ˆå°ï¼Œ ä¸”ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨åç»­è¿›ä¸€æ­¥æ·»åŠ è¡Œä¸ºæ—¶æ— éœ€å†æ¬¡ä¿®æ”¹ä»£ç ã€‚</p><p>ç°åœ¨ï¼Œ å¦‚æœæˆ‘ä»¬æŠ½å–å‡ºæ‰€æœ‰è®¿é—®è€…çš„é€šç”¨æ¥å£ï¼Œ æ‰€æœ‰å·²æœ‰çš„èŠ‚ç‚¹éƒ½èƒ½ä¸æˆ‘ä»¬åœ¨ç¨‹åºä¸­å¼•å…¥çš„ä»»ä½•è®¿é—®è€…äº¤äº’ã€‚ å¦‚æœéœ€è¦å¼•å…¥ä¸èŠ‚ç‚¹ç›¸å…³çš„æŸä¸ªè¡Œä¸ºï¼Œ ä½ åªéœ€è¦å®ç°ä¸€ä¸ªæ–°çš„è®¿é—®è€…ç±»å³å¯ã€‚</p><h2 id="çœŸå®ä¸–ç•Œç±»æ¯”"><a href="#çœŸå®ä¸–ç•Œç±»æ¯”" class="headerlink" title="çœŸå®ä¸–ç•Œç±»æ¯”"></a>çœŸå®ä¸–ç•Œç±»æ¯”</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/visitor-comic-1.png" alt="ä¼˜ç§€çš„ä¿é™©ä»£ç†äººæ€»èƒ½ä¸ºä¸åŒç±»å‹çš„å›¢ä½“æä¾›ä¸åŒçš„ä¿å•ã€‚"></p><p>å‡å¦‚æœ‰è¿™æ ·ä¸€ä½éå¸¸å¸Œæœ›èµ¢å¾—æ–°å®¢æˆ·çš„èµ„æ·±ä¿é™©ä»£ç†äººã€‚ ä»–å¯ä»¥æ‹œè®¿è¡—åŒºä¸­çš„æ¯æ ‹æ¥¼ï¼Œ å°è¯•å‘æ¯ä¸ªè·¯äººæ¨é”€ä¿é™©ã€‚ æ‰€ä»¥ï¼Œ æ ¹æ®å¤§æ¥¼å†…ç»„ç»‡ç±»å‹çš„ä¸åŒï¼Œ ä»–å¯ä»¥æä¾›ä¸“é—¨çš„ä¿å•ï¼š</p><ul><li>å¦‚æœå»ºç­‘æ˜¯å±…æ°‘æ¥¼ï¼Œ ä»–ä¼šæ¨é”€åŒ»ç–—ä¿é™©ã€‚</li><li>å¦‚æœå»ºç­‘æ˜¯é“¶è¡Œï¼Œ ä»–ä¼šæ¨é”€å¤±çªƒä¿é™©ã€‚</li><li>å¦‚æœå»ºç­‘æ˜¯å’–å•¡å…ï¼Œ ä»–ä¼šæ¨é”€ç«ç¾å’Œæ´ªæ°´ä¿é™©ã€‚</li></ul><h2 id="è®¿é—®è€…æ¨¡å¼ç»“æ„"><a href="#è®¿é—®è€…æ¨¡å¼ç»“æ„" class="headerlink" title="è®¿é—®è€…æ¨¡å¼ç»“æ„"></a>è®¿é—®è€…æ¨¡å¼ç»“æ„</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/structure-zh-indexed-visitor.png" alt=""></p><ol><li><strong>è®¿é—®è€…</strong> ï¼ˆVisitorï¼‰ æ¥å£å£°æ˜äº†ä¸€ç³»åˆ—ä»¥å¯¹è±¡ç»“æ„çš„å…·ä½“å…ƒç´ ä¸ºå‚æ•°çš„è®¿é—®è€…æ–¹æ³•ã€‚ å¦‚æœç¼–ç¨‹è¯­è¨€æ”¯æŒé‡è½½ï¼Œ è¿™äº›æ–¹æ³•çš„åç§°å¯ä»¥æ˜¯ç›¸åŒçš„ï¼Œ ä½†æ˜¯å…¶å‚æ•°ä¸€å®šæ˜¯ä¸åŒçš„ã€‚</li><li><strong>å…·ä½“è®¿é—®è€…</strong> ï¼ˆConcrete Visitorï¼‰ ä¼šä¸ºä¸åŒçš„å…·ä½“å…ƒç´ ç±»å®ç°ç›¸åŒè¡Œä¸ºçš„å‡ ä¸ªä¸åŒç‰ˆæœ¬ã€‚</li><li><strong>å…ƒç´ </strong> ï¼ˆElementï¼‰ æ¥å£å£°æ˜äº†ä¸€ä¸ªæ–¹æ³•æ¥ â€œæ¥æ”¶â€ è®¿é—®è€…ã€‚ è¯¥æ–¹æ³•å¿…é¡»æœ‰ä¸€ä¸ªå‚æ•°è¢«å£°æ˜ä¸ºè®¿é—®è€…æ¥å£ç±»å‹ã€‚</li><li><strong>å…·ä½“å…ƒç´ </strong> ï¼ˆConcrete Elementï¼‰ å¿…é¡»å®ç°æ¥æ”¶æ–¹æ³•ã€‚ è¯¥æ–¹æ³•çš„ç›®çš„æ˜¯æ ¹æ®å½“å‰å…ƒç´ ç±»å°†å…¶è°ƒç”¨é‡å®šå‘åˆ°ç›¸åº”è®¿é—®è€…çš„æ–¹æ³•ã€‚ è¯·æ³¨æ„ï¼Œ å³ä½¿å…ƒç´ åŸºç±»å®ç°äº†è¯¥æ–¹æ³•ï¼Œ æ‰€æœ‰å­ç±»éƒ½å¿…é¡»å¯¹å…¶è¿›è¡Œé‡å†™å¹¶è°ƒç”¨è®¿é—®è€…å¯¹è±¡ä¸­çš„åˆé€‚æ–¹æ³•ã€‚</li><li><strong>å®¢æˆ·ç«¯</strong> ï¼ˆClientï¼‰ é€šå¸¸ä¼šä½œä¸ºé›†åˆæˆ–å…¶ä»–å¤æ‚å¯¹è±¡ ï¼ˆä¾‹å¦‚ä¸€ä¸ª<a href="https://refactoringguru.cn/design-patterns/composite">ç»„åˆ</a>æ ‘ï¼‰ çš„ä»£è¡¨ã€‚ å®¢æˆ·ç«¯é€šå¸¸ä¸çŸ¥æ™“æ‰€æœ‰çš„å…·ä½“å…ƒç´ ç±»ï¼Œ å› ä¸ºå®ƒä»¬ä¼šé€šè¿‡æŠ½è±¡æ¥å£ä¸é›†åˆä¸­çš„å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚</li></ol><h2 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h2><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ <strong>è®¿é—®è€…</strong>æ¨¡å¼ä¸ºå‡ ä½•å›¾åƒå±‚æ¬¡ç»“æ„æ·»åŠ äº†å¯¹äº XML æ–‡ä»¶å¯¼å‡ºåŠŸèƒ½çš„æ”¯æŒã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/example-visitor.png" alt="é€šè¿‡è®¿é—®è€…å¯¹è±¡å°†å„ç§ç±»å‹çš„å¯¹è±¡å¯¼å‡ºä¸º XML æ ¼å¼æ–‡ä»¶ã€‚"></p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ƒç´ æ¥å£å£°æ˜äº†ä¸€ä¸ª`acceptï¼ˆæ¥æ”¶ï¼‰`æ–¹æ³•ï¼Œå®ƒä¼šå°†è®¿é—®è€…åŸºç¡€æ¥å£ä½œä¸ºä¸€ä¸ªå‚</span></span><br><span class="line"><span class="comment">// æ•°ã€‚</span></span><br><span class="line"><span class="keyword">interface</span> Shape <span class="keyword">is</span></span><br><span class="line">    method move(x, y)</span><br><span class="line">    method draw()</span><br><span class="line">    method accept(v: Visitor)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯ä¸ªå…·ä½“å…ƒç´ ç±»éƒ½å¿…é¡»ä»¥ç‰¹å®šæ–¹å¼å®ç°`accept`æ–¹æ³•ï¼Œä½¿å…¶èƒ½è°ƒç”¨ç›¸åº”å…ƒç´ ç±»çš„</span></span><br><span class="line"><span class="comment">// è®¿é—®è€…æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">class</span> Dot <span class="keyword">implements</span> Shape <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„æˆ‘ä»¬æ­£åœ¨è°ƒç”¨çš„`visitDotï¼ˆè®¿é—®ç‚¹ï¼‰`æ–¹æ³•ä¸å½“å‰ç±»çš„åç§°ç›¸åŒ¹é…ã€‚</span></span><br><span class="line">    <span class="comment">// è¿™æ ·æˆ‘ä»¬èƒ½è®©è®¿é—®è€…çŸ¥æ™“ä¸å…¶äº¤äº’çš„å…ƒç´ ç±»ã€‚</span></span><br><span class="line">    method accept(v: Visitor) <span class="keyword">is</span></span><br><span class="line">        v.visitDot(this)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Circle <span class="keyword">implements</span> Shape <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    method accept(v: Visitor) <span class="keyword">is</span></span><br><span class="line">        v.visitCircle(this)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Rectangle <span class="keyword">implements</span> Shape <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    method accept(v: Visitor) <span class="keyword">is</span></span><br><span class="line">        v.visitRectangle(this)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> CompoundShape <span class="keyword">implements</span> Shape <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    method accept(v: Visitor) <span class="keyword">is</span></span><br><span class="line">        v.visitCompoundShape(this)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®è€…æ¥å£å£°æ˜äº†ä¸€ç»„ä¸å…ƒç´ ç±»å¯¹åº”çš„è®¿é—®æ–¹æ³•ã€‚è®¿é—®æ–¹æ³•çš„ç­¾åèƒ½è®©è®¿é—®è€…å‡†</span></span><br><span class="line"><span class="comment">// ç¡®è¾¨åˆ«å‡ºä¸å…¶äº¤äº’çš„å…ƒç´ æ‰€å±çš„ç±»ã€‚</span></span><br><span class="line"><span class="keyword">interface</span> Visitor <span class="keyword">is</span></span><br><span class="line">    method visitDot(d: Dot)</span><br><span class="line">    method visitCircle(c: Circle)</span><br><span class="line">    method visitRectangle(r: Rectangle)</span><br><span class="line">    method visitCompoundShape(cs: CompoundShape)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“è®¿é—®è€…å®ç°äº†åŒä¸€ç®—æ³•çš„å¤šä¸ªç‰ˆæœ¬ï¼Œè€Œä¸”è¯¥ç®—æ³•èƒ½ä¸æ‰€æœ‰å…·ä½“ç±»è¿›è¡Œäº¤äº’ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// è®¿é—®è€…æ¨¡å¼åœ¨å¤æ‚å¯¹è±¡ç»“æ„ï¼ˆä¾‹å¦‚ç»„åˆæ ‘ï¼‰ä¸Šä½¿ç”¨æ—¶èƒ½å‘æŒ¥æœ€å¤§ä½œç”¨ã€‚åœ¨è¿™ç§æƒ…</span></span><br><span class="line"><span class="comment">// å†µä¸‹ï¼Œå®ƒå¯ä»¥å­˜å‚¨ç®—æ³•çš„ä¸€äº›ä¸­é—´çŠ¶æ€ï¼Œå¹¶åŒæ—¶åœ¨ç»“æ„ä¸­çš„ä¸åŒå¯¹è±¡ä¸Šæ‰§è¡Œè®¿é—®</span></span><br><span class="line"><span class="comment">// è€…æ–¹æ³•ã€‚è¿™å¯èƒ½ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚</span></span><br><span class="line"><span class="keyword">class</span> XMLExportVisitor <span class="keyword">implements</span> Visitor <span class="keyword">is</span></span><br><span class="line">    method visitDot(d: Dot) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// å¯¼å‡ºç‚¹ï¼ˆdotï¼‰çš„ ID å’Œä¸­å¿ƒåæ ‡ã€‚</span></span><br><span class="line"></span><br><span class="line">    method visitCircle(c: Circle) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// å¯¼å‡ºåœ†ï¼ˆcircleï¼‰çš„ ID ã€ä¸­å¿ƒåæ ‡å’ŒåŠå¾„ã€‚</span></span><br><span class="line"></span><br><span class="line">    method visitRectangle(r: Rectangle) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// å¯¼å‡ºé•¿æ–¹å½¢ï¼ˆrectangleï¼‰çš„ ID ã€å·¦ä¸Šè§’åæ ‡ã€å®½å’Œé•¿ã€‚</span></span><br><span class="line"></span><br><span class="line">    method visitCompoundShape(cs: CompoundShape) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// å¯¼å‡ºå›¾å½¢ï¼ˆshapeï¼‰çš„ ID å’Œå…¶å­é¡¹ç›®çš„ ID åˆ—è¡¨ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯ä»£ç å¯åœ¨ä¸çŸ¥æ™“å…·ä½“ç±»çš„æƒ…å†µä¸‹åœ¨ä¸€ç»„å…ƒç´ ä¸Šè¿è¡Œè®¿é—®è€…æ“ä½œã€‚â€œæ¥æ”¶â€æ“</span></span><br><span class="line"><span class="comment">// ä½œä¼šå°†è°ƒç”¨å®šä½åˆ°è®¿é—®è€…å¯¹è±¡çš„ç›¸åº”æ“ä½œä¸Šã€‚</span></span><br><span class="line"><span class="keyword">class</span> Application <span class="keyword">is</span></span><br><span class="line">    field allShapes: <span class="keyword">array</span> <span class="keyword">of</span> Shapes</span><br><span class="line"></span><br><span class="line">    method <span class="keyword">export</span>() <span class="keyword">is</span></span><br><span class="line">        exportVisitor = new XMLExportVisitor()</span><br><span class="line"></span><br><span class="line">        foreach (shape <span class="keyword">in</span> allShapes) <span class="keyword">do</span></span><br><span class="line">            shape.accept(exportVisitor)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å¹¶ä¸ååˆ†ç†è§£ä¸ºä½•æœ¬ä¾‹ä¸­éœ€è¦ä½¿ç”¨ <code>accept</code>æ¥æ”¶æ–¹æ³•ï¼Œ æˆ‘çš„ä¸€ç¯‡æ–‡ç« <a href="https://refactoringguru.cn/design-patterns/visitor-double-dispatch">è®¿é—®è€…å’ŒåŒåˆ†æ´¾</a>è¯¦ç»†è§£é‡Šäº†è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="è®¿é—®è€…æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"><a href="#è®¿é—®è€…æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯" class="headerlink" title="è®¿é—®è€…æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"></a>è®¿é—®è€…æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯</h2><p><strong>å¦‚æœä½ éœ€è¦å¯¹ä¸€ä¸ªå¤æ‚å¯¹è±¡ç»“æ„ ï¼ˆä¾‹å¦‚å¯¹è±¡æ ‘ï¼‰ ä¸­çš„æ‰€æœ‰å…ƒç´ æ‰§è¡ŒæŸäº›æ“ä½œï¼Œ å¯ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ã€‚</strong></p><p>è®¿é—®è€…æ¨¡å¼é€šè¿‡åœ¨è®¿é—®è€…å¯¹è±¡ä¸­ä¸ºå¤šä¸ªç›®æ ‡ç±»æä¾›ç›¸åŒæ“ä½œçš„å˜ä½“ï¼Œ è®©ä½ èƒ½åœ¨å±äºä¸åŒç±»çš„ä¸€ç»„å¯¹è±¡ä¸Šæ‰§è¡ŒåŒä¸€æ“ä½œã€‚</p><p><strong>å¯ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥æ¸…ç†è¾…åŠ©è¡Œä¸ºçš„ä¸šåŠ¡é€»è¾‘ã€‚</strong></p><p>è¯¥æ¨¡å¼ä¼šå°†æ‰€æœ‰éä¸»è¦çš„è¡Œä¸ºæŠ½å–åˆ°ä¸€ç»„è®¿é—®è€…ç±»ä¸­ï¼Œ ä½¿å¾—ç¨‹åºçš„ä¸»è¦ç±»èƒ½æ›´ä¸“æ³¨äºä¸»è¦çš„å·¥ä½œã€‚</p><p><strong>å½“æŸä¸ªè¡Œä¸ºä»…åœ¨ç±»å±‚æ¬¡ç»“æ„ä¸­çš„ä¸€äº›ç±»ä¸­æœ‰æ„ä¹‰ï¼Œ è€Œåœ¨å…¶ä»–ç±»ä¸­æ²¡æœ‰æ„ä¹‰æ—¶ï¼Œ å¯ä½¿ç”¨è¯¥æ¨¡å¼ã€‚</strong></p><p>ä½ å¯å°†è¯¥è¡Œä¸ºæŠ½å–åˆ°å•ç‹¬çš„è®¿é—®è€…ç±»ä¸­ï¼Œ åªéœ€å®ç°æ¥æ”¶ç›¸å…³ç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•°çš„è®¿é—®è€…æ–¹æ³•å¹¶å°†å…¶ä»–æ–¹æ³•ç•™ç©ºå³å¯ã€‚</p><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><ol><li><p>åœ¨è®¿é—®è€…æ¥å£ä¸­å£°æ˜ä¸€ç»„ â€œè®¿é—®â€ æ–¹æ³•ï¼Œ åˆ†åˆ«å¯¹åº”ç¨‹åºä¸­çš„æ¯ä¸ªå…·ä½“å…ƒç´ ç±»ã€‚</p></li><li><p>å£°æ˜å…ƒç´ æ¥å£ã€‚ å¦‚æœç¨‹åºä¸­å·²æœ‰å…ƒç´ ç±»å±‚æ¬¡æ¥å£ï¼Œ å¯åœ¨å±‚æ¬¡ç»“æ„åŸºç±»ä¸­æ·»åŠ æŠ½è±¡çš„ â€œæ¥æ”¶â€ æ–¹æ³•ã€‚ è¯¥æ–¹æ³•å¿…é¡»æ¥å—è®¿é—®è€…å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</p></li><li><p>åœ¨æ‰€æœ‰å…·ä½“å…ƒç´ ç±»ä¸­å®ç°æ¥æ”¶æ–¹æ³•ã€‚ è¿™äº›æ–¹æ³•å¿…é¡»å°†è°ƒç”¨é‡å®šå‘åˆ°å½“å‰å…ƒç´ å¯¹åº”çš„è®¿é—®è€…å¯¹è±¡ä¸­çš„è®¿é—®è€…æ–¹æ³•ä¸Šã€‚</p></li><li><p>å…ƒç´ ç±»åªèƒ½é€šè¿‡è®¿é—®è€…æ¥å£ä¸è®¿é—®è€…è¿›è¡Œäº¤äº’ã€‚ ä¸è¿‡è®¿é—®è€…å¿…é¡»çŸ¥æ™“æ‰€æœ‰çš„å…·ä½“å…ƒç´ ç±»ï¼Œ å› ä¸ºè¿™äº›ç±»åœ¨è®¿é—®è€…æ–¹æ³•ä¸­éƒ½è¢«ä½œä¸ºå‚æ•°ç±»å‹å¼•ç”¨ã€‚</p></li><li><p>ä¸ºæ¯ä¸ªæ— æ³•åœ¨å…ƒç´ å±‚æ¬¡ç»“æ„ä¸­å®ç°çš„è¡Œä¸ºåˆ›å»ºä¸€ä¸ªå…·ä½“è®¿é—®è€…ç±»å¹¶å®ç°æ‰€æœ‰çš„è®¿é—®è€…æ–¹æ³•ã€‚</p><p>ä½ å¯èƒ½ä¼šé‡åˆ°è®¿é—®è€…éœ€è¦è®¿é—®å…ƒç´ ç±»çš„éƒ¨åˆ†ç§æœ‰æˆå‘˜å˜é‡çš„æƒ…å†µã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ ä½ è¦ä¹ˆå°†è¿™äº›å˜é‡æˆ–æ–¹æ³•è®¾ä¸ºå…¬æœ‰ï¼Œ è¿™å°†ç ´åå…ƒç´ çš„å°è£…ï¼› è¦ä¹ˆå°†è®¿é—®è€…ç±»åµŒå…¥åˆ°å…ƒç´ ç±»ä¸­ã€‚ åä¸€ç§æ–¹å¼åªæœ‰åœ¨æ”¯æŒåµŒå¥—ç±»çš„ç¼–ç¨‹è¯­è¨€ä¸­æ‰å¯èƒ½å®ç°ã€‚</p></li><li><p>å®¢æˆ·ç«¯å¿…é¡»åˆ›å»ºè®¿é—®è€…å¯¹è±¡å¹¶é€šè¿‡ â€œæ¥æ”¶â€ æ–¹æ³•å°†å…¶ä¼ é€’ç»™å…ƒç´ ã€‚</p></li></ol><h2 id="è®¿é—®è€…æ¨¡å¼ä¼˜ç¼ºç‚¹"><a href="#è®¿é—®è€…æ¨¡å¼ä¼˜ç¼ºç‚¹" class="headerlink" title="è®¿é—®è€…æ¨¡å¼ä¼˜ç¼ºç‚¹"></a>è®¿é—®è€…æ¨¡å¼ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹</p><ul><li><em>å¼€é—­åŸåˆ™</em>ã€‚ ä½ å¯ä»¥å¼•å…¥åœ¨ä¸åŒç±»å¯¹è±¡ä¸Šæ‰§è¡Œçš„æ–°è¡Œä¸ºï¼Œ ä¸”æ— éœ€å¯¹è¿™äº›ç±»åšå‡ºä¿®æ”¹ã€‚</li><li><em>å•ä¸€èŒè´£åŸåˆ™</em>ã€‚ å¯å°†åŒä¸€è¡Œä¸ºçš„ä¸åŒç‰ˆæœ¬ç§»åˆ°åŒä¸€ä¸ªç±»ä¸­ã€‚</li><li>è®¿é—®è€…å¯¹è±¡å¯ä»¥åœ¨ä¸å„ç§å¯¹è±¡äº¤äº’æ—¶æ”¶é›†ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ã€‚ å½“ä½ æƒ³è¦éå†ä¸€äº›å¤æ‚çš„å¯¹è±¡ç»“æ„ ï¼ˆä¾‹å¦‚å¯¹è±¡æ ‘ï¼‰ï¼Œ å¹¶åœ¨ç»“æ„ä¸­çš„æ¯ä¸ªå¯¹è±¡ä¸Šåº”ç”¨è®¿é—®è€…æ—¶ï¼Œ è¿™äº›ä¿¡æ¯å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>éƒ¨åˆ†å®¢æˆ·ç«¯å¯èƒ½ä¼šå—åˆ°ç®—æ³•æ¡†æ¶çš„é™åˆ¶ã€‚</li><li>é€šè¿‡å­ç±»æŠ‘åˆ¶é»˜è®¤æ­¥éª¤å®ç°å¯èƒ½ä¼šå¯¼è‡´è¿å_é‡Œæ°æ›¿æ¢åŸåˆ™_ã€‚</li><li>æ¨¡æ¿æ–¹æ³•ä¸­çš„æ­¥éª¤è¶Šå¤šï¼Œ å…¶ç»´æŠ¤å·¥ä½œå°±å¯èƒ½ä¼šè¶Šå›°éš¾ã€‚</li></ul><h2 id="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul><li>ä½ å¯ä»¥å°†<a href="https://refactoringguru.cn/design-patterns/visitor">è®¿é—®è€…æ¨¡å¼</a>è§†ä¸º<a href="https://refactoringguru.cn/design-patterns/command">å‘½ä»¤æ¨¡å¼</a>çš„åŠ å¼ºç‰ˆæœ¬ï¼Œ å…¶å¯¹è±¡å¯å¯¹ä¸åŒç±»çš„å¤šç§å¯¹è±¡æ‰§è¡Œæ“ä½œã€‚</li><li>ä½ å¯ä»¥ä½¿ç”¨<a href="https://refactoringguru.cn/design-patterns/visitor">è®¿é—®è€…</a>å¯¹æ•´ä¸ª<a href="https://refactoringguru.cn/design-patterns/composite">ç»„åˆæ¨¡å¼</a>æ ‘æ‰§è¡Œæ“ä½œã€‚</li><li>å¯ä»¥åŒæ—¶ä½¿ç”¨<a href="https://refactoringguru.cn/design-patterns/visitor">è®¿é—®è€…</a>å’Œ<a href="https://refactoringguru.cn/design-patterns/iterator">è¿­ä»£å™¨æ¨¡å¼</a>æ¥éå†å¤æ‚æ•°æ®ç»“æ„ï¼Œ å¹¶å¯¹å…¶ä¸­çš„å…ƒç´ æ‰§è¡Œæ‰€éœ€æ“ä½œï¼Œ å³ä½¿è¿™äº›å…ƒç´ æ‰€å±çš„ç±»å®Œå…¨ä¸åŒã€‚</li></ul><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p><strong>è®¿é—®è€…</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å…è®¸ä½ åœ¨ä¸ä¿®æ”¹å·²æœ‰ä»£ç çš„æƒ…å†µä¸‹å‘å·²æœ‰ç±»å±‚æ¬¡ç»“æ„ä¸­å¢åŠ æ–°çš„è¡Œä¸ºã€‚</p><div class="tabs" id="tags"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#tags-1">C#</button></li><li class="tab"><button type="button" data-href="#tags-2">C++</button></li><li class="tab"><button type="button" data-href="#tags-3">JAVA</button></li><li class="tab"><button type="button" data-href="#tags-4">PHP</button></li><li class="tab"><button type="button" data-href="#tags-5">Python</button></li><li class="tab"><button type="button" data-href="#tags-6">Ruby</button></li><li class="tab"><button type="button" data-href="#tags-7">Swift</button></li><li class="tab"><button type="button" data-href="#tags-8">TypeScrit</button></li><li class="tab"><button type="button" data-href="#tags-9">Golang</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="tags-1"><p><strong>åœ¨ C# ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è®¿é—®è€…ä¸æ˜¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œ å› ä¸ºå®ƒä¸ä»…å¤æ‚ï¼Œ åº”ç”¨èŒƒå›´ä¹Ÿæ¯”è¾ƒç‹­çª„ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è®¿é—®è€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>Program.cs:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.Visitor.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The Component interface declares an `accept` method that should take the</span></span><br><span class="line">    <span class="comment">// base visitor interface as an argument.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IComponent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Accept</span>(<span class="params">IVisitor visitor</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Each Concrete Component must implement the `Accept` method in such a way</span></span><br><span class="line">    <span class="comment">// that it calls the visitor&#x27;s method corresponding to the component&#x27;s</span></span><br><span class="line">    <span class="comment">// class.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreteComponentA</span> : <span class="title">IComponent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Note that we&#x27;re calling `VisitConcreteComponentA`, which matches the</span></span><br><span class="line">        <span class="comment">// current class name. This way we let the visitor know the class of the</span></span><br><span class="line">        <span class="comment">// component it works with.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Accept</span>(<span class="params">IVisitor visitor</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            visitor.VisitConcreteComponentA(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Concrete Components may have special methods that don&#x27;t exist in</span></span><br><span class="line">        <span class="comment">// their base class or interface. The Visitor is still able to use these</span></span><br><span class="line">        <span class="comment">// methods since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">ExclusiveMethodOfConcreteComponentA</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;A&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreteComponentB</span> : <span class="title">IComponent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Same here: VisitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Accept</span>(<span class="params">IVisitor visitor</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            visitor.VisitConcreteComponentB(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">SpecialMethodOfConcreteComponentB</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;B&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Visitor Interface declares a set of visiting methods that correspond</span></span><br><span class="line">    <span class="comment">// to component classes. The signature of a visiting method allows the</span></span><br><span class="line">    <span class="comment">// visitor to identify the exact class of the component that it&#x27;s dealing</span></span><br><span class="line">    <span class="comment">// with.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IVisitor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteComponentA</span>(<span class="params">ConcreteComponentA element</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteComponentB</span>(<span class="params">ConcreteComponentB element</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete Visitors implement several versions of the same algorithm, which</span></span><br><span class="line">    <span class="comment">// can work with all concrete component classes.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// You can experience the biggest benefit of the Visitor pattern when using</span></span><br><span class="line">    <span class="comment">// it with a complex object structure, such as a Composite tree. In this</span></span><br><span class="line">    <span class="comment">// case, it might be helpful to store some intermediate state of the</span></span><br><span class="line">    <span class="comment">// algorithm while executing visitor&#x27;s methods over various objects of the</span></span><br><span class="line">    <span class="comment">// structure.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteVisitor1</span> : <span class="title">IVisitor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentA</span>(<span class="params">ConcreteComponentA element</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(element.ExclusiveMethodOfConcreteComponentA() + <span class="string">&quot; + ConcreteVisitor1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentB</span>(<span class="params">ConcreteComponentB element</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(element.SpecialMethodOfConcreteComponentB() + <span class="string">&quot; + ConcreteVisitor1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteVisitor2</span> : <span class="title">IVisitor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentA</span>(<span class="params">ConcreteComponentA element</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(element.ExclusiveMethodOfConcreteComponentA() + <span class="string">&quot; + ConcreteVisitor2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentB</span>(<span class="params">ConcreteComponentB element</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(element.SpecialMethodOfConcreteComponentB() + <span class="string">&quot; + ConcreteVisitor2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Client</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The client code can run visitor operations over any set of elements</span></span><br><span class="line">        <span class="comment">// without figuring out their concrete classes. The accept operation</span></span><br><span class="line">        <span class="comment">// directs a call to the appropriate operation in the visitor object.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ClientCode</span>(<span class="params">List&lt;IComponent&gt; components, IVisitor visitor</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> component <span class="keyword">in</span> components)</span><br><span class="line">            &#123;</span><br><span class="line">                component.Accept(visitor);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            List&lt;IComponent&gt; components = <span class="keyword">new</span> List&lt;IComponent&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">new</span> ConcreteComponentA(),</span><br><span class="line">                <span class="keyword">new</span> ConcreteComponentB()</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;The client code works with all visitors via the base Visitor interface:&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> visitor1 = <span class="keyword">new</span> ConcreteVisitor1();</span><br><span class="line">            Client.ClientCode(components,visitor1);</span><br><span class="line"></span><br><span class="line">            Console.WriteLine();</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;It allows the same client code to work with different types of visitors:&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> visitor2 = <span class="keyword">new</span> ConcreteVisitor2();</span><br><span class="line">            Client.ClientCode(components, visitor2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-2"><p><strong>åœ¨ C++ ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è®¿é—®è€…ä¸æ˜¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œ å› ä¸ºå®ƒä¸ä»…å¤æ‚ï¼Œ åº”ç”¨èŒƒå›´ä¹Ÿæ¯”è¾ƒç‹­çª„ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è®¿é—®è€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.cc:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment"> * component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment"> * identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentA</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentB</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Visitor</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentA</span><span class="params">(<span class="keyword">const</span> ConcreteComponentA *element)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentB</span><span class="params">(<span class="keyword">const</span> ConcreteComponentB *element)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Component interface declares an `accept` method that should take the base</span></span><br><span class="line"><span class="comment"> * visitor interface as an argument.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~Component() &#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Accept</span><span class="params">(Visitor *visitor)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Each Concrete Component must implement the `Accept` method in such a way that</span></span><br><span class="line"><span class="comment"> * it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentA</span> :</span> <span class="keyword">public</span> Component &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line"><span class="comment">   * current class name. This way we let the visitor know the class of the</span></span><br><span class="line"><span class="comment">   * component it works with.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Accept</span><span class="params">(Visitor *visitor)</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    visitor-&gt;VisitConcreteComponentA(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Concrete Components may have special methods that don&#x27;t exist in their base</span></span><br><span class="line"><span class="comment">   * class or interface. The Visitor is still able to use these methods since</span></span><br><span class="line"><span class="comment">   * it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">ExclusiveMethodOfConcreteComponentA</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;A&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentB</span> :</span> <span class="keyword">public</span> Component &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Accept</span><span class="params">(Visitor *visitor)</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    visitor-&gt;VisitConcreteComponentB(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">SpecialMethodOfConcreteComponentB</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;B&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="comment"> * work with all concrete component classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment"> * with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment"> * might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment"> * executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor1</span> :</span> <span class="keyword">public</span> Visitor &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteComponentA</span><span class="params">(<span class="keyword">const</span> ConcreteComponentA *element)</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; element-&gt;ExclusiveMethodOfConcreteComponentA() &lt;&lt; <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteComponentB</span><span class="params">(<span class="keyword">const</span> ConcreteComponentB *element)</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; element-&gt;SpecialMethodOfConcreteComponentB() &lt;&lt; <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor2</span> :</span> <span class="keyword">public</span> Visitor &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteComponentA</span><span class="params">(<span class="keyword">const</span> ConcreteComponentA *element)</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; element-&gt;ExclusiveMethodOfConcreteComponentA() &lt;&lt; <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteComponentB</span><span class="params">(<span class="keyword">const</span> ConcreteComponentB *element)</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; element-&gt;SpecialMethodOfConcreteComponentB() &lt;&lt; <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment"> * figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment"> * the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClientCode</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="keyword">const</span> Component *, <span class="number">2</span>&gt; components, Visitor *visitor)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> Component *comp : components) &#123;</span><br><span class="line">    comp-&gt;Accept(visitor);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="keyword">const</span> Component *, 2&gt; components = &#123;<span class="keyword">new</span> ConcreteComponentA, <span class="keyword">new</span> ConcreteComponentB&#125;;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;The client code works with all visitors via the base Visitor interface:\n&quot;</span>;</span><br><span class="line">  ConcreteVisitor1 *visitor1 = <span class="keyword">new</span> ConcreteVisitor1;</span><br><span class="line">  ClientCode(components, visitor1);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;It allows the same client code to work with different types of visitors:\n&quot;</span>;</span><br><span class="line">  ConcreteVisitor2 *visitor2 = <span class="keyword">new</span> ConcreteVisitor2;</span><br><span class="line">  ClientCode(components, visitor2);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> Component *comp : components) &#123;</span><br><span class="line">    <span class="keyword">delete</span> comp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">delete</span> visitor1;</span><br><span class="line">  <span class="keyword">delete</span> visitor2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-3"><p><strong>åœ¨ Java ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è®¿é—®è€…ä¸æ˜¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œ å› ä¸ºå®ƒä¸ä»…å¤æ‚ï¼Œ åº”ç”¨èŒƒå›´ä¹Ÿæ¯”è¾ƒç‹­çª„ã€‚</p><p>è¿™é‡Œæ˜¯ Java ç¨‹åºåº“ä»£ç ä¸­è¯¥æ¨¡å¼çš„ä¸€äº›ç¤ºä¾‹ï¼š</p><ul><li><a href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/element/AnnotationValue.html"><code>javax.lang.model.element.AnnotationValue</code></a> å’Œ <a href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/element/AnnotationValueVisitor.html"><code>AnnotationÂ­ValueÂ­Visitor</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/element/Element.html"><code>javax.lang.model.element.Element</code></a> å’Œ <a href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/element/ElementVisitor.html"><code>ElementÂ­Visitor</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/type/TypeMirror.html"><code>javax.lang.model.type.TypeMirror</code></a> å’Œ <a href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/type/TypeVisitor.html"><code>TypeÂ­Visitor</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/FileVisitor.html"><code>java.nio.file.FileVisitor</code></a> å’Œ <a href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/SimpleFileVisitor.html"><code>SimpleÂ­FileÂ­Visitor</code></a></li><li><a href="http://docs.oracle.com/javaee/7/api/javax/faces/component/visit/VisitContext.html"><code>javax.faces.component.visit.VisitContext</code></a> å’Œ <a href="http://docs.oracle.com/javaee/7/api/javax/faces/component/visit/VisitCallback.html"><code>VisitÂ­Callback</code></a></li></ul><p><strong>å°†å½¢çŠ¶å¯¼å‡ºä¸º XML æ–‡ä»¶</strong></p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ æˆ‘ä»¬å¸Œæœ›å°†ä¸€ç³»åˆ—å‡ ä½•å½¢çŠ¶å¯¼å‡ºä¸º XML æ–‡ä»¶ã€‚ é‡ç‚¹åœ¨äºæˆ‘ä»¬ä¸å¸Œæœ›ç›´æ¥ä¿®æ”¹å½¢çŠ¶ä»£ç ï¼Œ æˆ–è€…è‡³å°‘èƒ½ç¡®ä¿æœ€å°ç¨‹åº¦çš„ä¿®æ”¹ã€‚</p><p>æœ€ç»ˆï¼Œ è®¿é—®è€…æ¨¡å¼å»ºç«‹äº†ä¸€ä¸ªæ¡†æ¶ï¼Œ å…è®¸æˆ‘ä»¬åœ¨ä¸ä¿®æ”¹å·²æœ‰ç±»çš„æƒ…å†µä¸‹å‘å½¢çŠ¶å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æ–°çš„è¡Œä¸ºã€‚</p><p><strong>shapes</strong></p><p><strong>shapes/Shape.java:</strong> é€šç”¨å½¢çŠ¶æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">accept</span><span class="params">(Visitor visitor)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>shapes/Dot.java:</strong> ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dot</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dot</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dot</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// move shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// draw shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visitDot(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>shapes/Circle.java:</strong> åœ†å½¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Dot</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(id, x, y);</span><br><span class="line">        <span class="keyword">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visitCircle(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRadius</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> radius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>shapes/Rectangle.java:</strong> çŸ©å½¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rectangle</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visitRectangle(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// move shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// draw shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>shapes/CompoundShape.java:</strong> ç»„åˆå½¢çŠ¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompoundShape</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Shape&gt; children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CompoundShape</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// move shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// draw shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visitCompoundGraphic(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Shape shape)</span> </span>&#123;</span><br><span class="line">        children.add(shape);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>visitor</strong></p><p><strong>visitor/Visitor.java:</strong> é€šç”¨è®¿é—®è€…æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.Circle;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.CompoundShape;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.Dot;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.Rectangle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">visitDot</span><span class="params">(Dot dot)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">visitCircle</span><span class="params">(Circle circle)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">visitRectangle</span><span class="params">(Rectangle rectangle)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">visitCompoundGraphic</span><span class="params">(CompoundShape cg)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>visitor/XMLExportVisitor.java:</strong> å…·ä½“è®¿é—®è€…ï¼Œ å°†æ‰€æœ‰å½¢çŠ¶å¯¼å‡ºä¸º XML æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XMLExportVisitor</span> <span class="keyword">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">export</span><span class="params">(Shape... args)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Shape shape : args) &#123;</span><br><span class="line">            sb.append(shape.accept(<span class="keyword">this</span>)).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">visitDot</span><span class="params">(Dot d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;dot&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;id&gt;&quot;</span> + d.getId() + <span class="string">&quot;&lt;/id&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;x&gt;&quot;</span> + d.getX() + <span class="string">&quot;&lt;/x&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;y&gt;&quot;</span> + d.getY() + <span class="string">&quot;&lt;/y&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/dot&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">visitCircle</span><span class="params">(Circle c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;circle&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;id&gt;&quot;</span> + c.getId() + <span class="string">&quot;&lt;/id&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;x&gt;&quot;</span> + c.getX() + <span class="string">&quot;&lt;/x&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;y&gt;&quot;</span> + c.getY() + <span class="string">&quot;&lt;/y&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;radius&gt;&quot;</span> + c.getRadius() + <span class="string">&quot;&lt;/radius&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/circle&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">visitRectangle</span><span class="params">(Rectangle r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;rectangle&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;id&gt;&quot;</span> + r.getId() + <span class="string">&quot;&lt;/id&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;x&gt;&quot;</span> + r.getX() + <span class="string">&quot;&lt;/x&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;y&gt;&quot;</span> + r.getY() + <span class="string">&quot;&lt;/y&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;width&gt;&quot;</span> + r.getWidth() + <span class="string">&quot;&lt;/width&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;height&gt;&quot;</span> + r.getHeight() + <span class="string">&quot;&lt;/height&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/rectangle&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">visitCompoundGraphic</span><span class="params">(CompoundShape cg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;compound_graphic&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;   &lt;id&gt;&quot;</span> + cg.getId() + <span class="string">&quot;&lt;/id&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                _visitCompoundGraphic(cg) +</span><br><span class="line">                <span class="string">&quot;&lt;/compound_graphic&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">_visitCompoundGraphic</span><span class="params">(CompoundShape cg)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (Shape shape : cg.children) &#123;</span><br><span class="line">            String obj = shape.accept(<span class="keyword">this</span>);</span><br><span class="line">            <span class="comment">// Proper indentation for sub-objects.</span></span><br><span class="line">            obj = <span class="string">&quot;    &quot;</span> + obj.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\n    &quot;</span>) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            sb.append(obj);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Demo.java:</strong> å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.*;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.XMLExportVisitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Dot dot = <span class="keyword">new</span> Dot(<span class="number">1</span>, <span class="number">10</span>, <span class="number">55</span>);</span><br><span class="line">        Circle circle = <span class="keyword">new</span> Circle(<span class="number">2</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">10</span>);</span><br><span class="line">        Rectangle rectangle = <span class="keyword">new</span> Rectangle(<span class="number">3</span>, <span class="number">10</span>, <span class="number">17</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        CompoundShape compoundShape = <span class="keyword">new</span> CompoundShape(<span class="number">4</span>);</span><br><span class="line">        compoundShape.add(dot);</span><br><span class="line">        compoundShape.add(circle);</span><br><span class="line">        compoundShape.add(rectangle);</span><br><span class="line"></span><br><span class="line">        CompoundShape c = <span class="keyword">new</span> CompoundShape(<span class="number">5</span>);</span><br><span class="line">        c.add(dot);</span><br><span class="line">        compoundShape.add(c);</span><br><span class="line"></span><br><span class="line">        export(circle, compoundShape);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">export</span><span class="params">(Shape... shapes)</span> </span>&#123;</span><br><span class="line">        XMLExportVisitor exportVisitor = <span class="keyword">new</span> XMLExportVisitor();</span><br><span class="line">        System.out.println(exportVisitor.export(shapes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>OutputDemo.png:</strong>  æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;circle&gt;</span><br><span class="line">    &lt;id&gt;2&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;x&gt;23&lt;&#x2F;x&gt;</span><br><span class="line">    &lt;y&gt;15&lt;&#x2F;y&gt;</span><br><span class="line">    &lt;radius&gt;10&lt;&#x2F;radius&gt;</span><br><span class="line">&lt;&#x2F;circle&gt;</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;compound_graphic&gt;</span><br><span class="line">   &lt;id&gt;4&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;dot&gt;</span><br><span class="line">        &lt;id&gt;1&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;x&gt;10&lt;&#x2F;x&gt;</span><br><span class="line">        &lt;y&gt;55&lt;&#x2F;y&gt;</span><br><span class="line">    &lt;&#x2F;dot&gt;</span><br><span class="line">    &lt;circle&gt;</span><br><span class="line">        &lt;id&gt;2&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;x&gt;23&lt;&#x2F;x&gt;</span><br><span class="line">        &lt;y&gt;15&lt;&#x2F;y&gt;</span><br><span class="line">        &lt;radius&gt;10&lt;&#x2F;radius&gt;</span><br><span class="line">    &lt;&#x2F;circle&gt;</span><br><span class="line">    &lt;rectangle&gt;</span><br><span class="line">        &lt;id&gt;3&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;x&gt;10&lt;&#x2F;x&gt;</span><br><span class="line">        &lt;y&gt;17&lt;&#x2F;y&gt;</span><br><span class="line">        &lt;width&gt;20&lt;&#x2F;width&gt;</span><br><span class="line">        &lt;height&gt;30&lt;&#x2F;height&gt;</span><br><span class="line">    &lt;&#x2F;rectangle&gt;</span><br><span class="line">    &lt;compound_graphic&gt;</span><br><span class="line">       &lt;id&gt;5&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;dot&gt;</span><br><span class="line">            &lt;id&gt;1&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;x&gt;10&lt;&#x2F;x&gt;</span><br><span class="line">            &lt;y&gt;55&lt;&#x2F;y&gt;</span><br><span class="line">        &lt;&#x2F;dot&gt;</span><br><span class="line">    &lt;&#x2F;compound_graphic&gt;</span><br><span class="line">&lt;&#x2F;compound_graphic&gt;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-4"><p><strong>åœ¨ PHP ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è®¿é—®è€…æ¨¡å¼åœ¨ PHP ä»£ç ä¸­ä¸å¤ªå¸¸ç”¨ï¼Œ å› ä¸ºå®ƒä¸ä»…å¤æ‚ï¼Œ åº”ç”¨èŒƒå›´ä¹Ÿæ¯”è¾ƒç‹­çª„ã€‚</p><div class="tabs" id="php"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#php-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#php-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="php-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è®¿é—®è€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ PHP åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>index.php:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru</span>\<span class="title">Visitor</span>\<span class="title">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Component interface declares an `accept` method that should take the base</span></span><br><span class="line"><span class="comment"> * visitor interface as an argument.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Component</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">accept</span>(<span class="params">Visitor $visitor</span>): <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Each Concrete Component must implement the `accept` method in such a way that</span></span><br><span class="line"><span class="comment"> * it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentA</span> <span class="keyword">implements</span> <span class="title">Component</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line"><span class="comment">     * current class name. This way we let the visitor know the class of the</span></span><br><span class="line"><span class="comment">     * component it works with.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">accept</span>(<span class="params">Visitor $visitor</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $visitor-&gt;visitConcreteComponentA(<span class="keyword">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Concrete Components may have special methods that don&#x27;t exist in their</span></span><br><span class="line"><span class="comment">     * base class or interface. The Visitor is still able to use these methods</span></span><br><span class="line"><span class="comment">     * since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exclusiveMethodOfConcreteComponentA</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentB</span> <span class="keyword">implements</span> <span class="title">Component</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">accept</span>(<span class="params">Visitor $visitor</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $visitor-&gt;visitConcreteComponentB(<span class="keyword">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">specialMethodOfConcreteComponentB</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;B&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment"> * component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment"> * identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentA</span>(<span class="params">ConcreteComponentA $element</span>): <span class="title">void</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentB</span>(<span class="params">ConcreteComponentB $element</span>): <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="comment"> * work with all concrete component classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment"> * with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment"> * might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment"> * executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor1</span> <span class="keyword">implements</span> <span class="title">Visitor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentA</span>(<span class="params">ConcreteComponentA $element</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $element-&gt;exclusiveMethodOfConcreteComponentA() . <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentB</span>(<span class="params">ConcreteComponentB $element</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $element-&gt;specialMethodOfConcreteComponentB() . <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor2</span> <span class="keyword">implements</span> <span class="title">Visitor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentA</span>(<span class="params">ConcreteComponentA $element</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $element-&gt;exclusiveMethodOfConcreteComponentA() . <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentB</span>(<span class="params">ConcreteComponentB $element</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $element-&gt;specialMethodOfConcreteComponentB() . <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment"> * figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment"> * the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clientCode</span>(<span class="params"><span class="keyword">array</span> $components, Visitor $visitor</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">foreach</span> ($components <span class="keyword">as</span> $component) &#123;</span><br><span class="line">        $component-&gt;accept($visitor);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$components = [</span><br><span class="line">    <span class="keyword">new</span> ConcreteComponentA(),</span><br><span class="line">    <span class="keyword">new</span> ConcreteComponentB(),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;The client code works with all visitors via the base Visitor interface:\n&quot;</span>;</span><br><span class="line">$visitor1 = <span class="keyword">new</span> ConcreteVisitor1();</span><br><span class="line">clientCode($components, $visitor1);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;It allows the same client code to work with different types of visitors:\n&quot;</span>;</span><br><span class="line">$visitor2 = <span class="keyword">new</span> ConcreteVisitor2();</span><br><span class="line">clientCode($components, $visitor2);</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="php-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ <strong>è®¿é—®è€…</strong>æ¨¡å¼åœ¨å·²æœ‰ç±»å±‚æ¬¡ç»“æ„ ï¼ˆ â€œå…¬å¸ &gt; éƒ¨é—¨ &gt; é›‡å‘˜â€ï¼‰ ä¸­æ·»åŠ äº†æŠ¥è¡¨åŠŸèƒ½</p><p>åœ¨å°†è®¿é—®è€…æ„æ¶æ·»åŠ åˆ°ç¨‹åºä¸­åï¼Œ ä½ å°±èƒ½å¤Ÿåœ¨æ— éœ€ä¿®æ”¹å·²æœ‰ç±»çš„å‰æä¸‹å°†å…¶ä»–ç±»ä¼¼è¡Œä¸ºè½»æ¾æ·»åŠ åˆ°ç¨‹åºä¸­äº†ã€‚</p><p><strong>index.php:</strong> çœŸå®ä¸–ç•Œç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">namespace RefactoringGuru\Visitor\RealWorld;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Component interface declares a method of accepting visitor objects.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * In this method, a Concrete Component must call a specific Visitor&#x27;s method</span></span><br><span class="line"><span class="comment"> * that has the same parameter type as that component.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">accept</span><span class="params">(Visitor $visitor)</span>: string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Company Concrete Component.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span> <span class="keyword">implements</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Department[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $departments;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">__construct</span><span class="params">(string $name, array $departments)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;name = $name;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;departments = $departments;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">getName</span><span class="params">()</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">getDepartments</span><span class="params">()</span>: array</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;departments;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">accept</span><span class="params">(Visitor $visitor)</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// See, the Company component must call the visitCompany method. The</span></span><br><span class="line">        <span class="comment">// same principle applies to all components.</span></span><br><span class="line">        <span class="keyword">return</span> $visitor-&gt;visitCompany($<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Department Concrete Component.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span> <span class="keyword">implements</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Employee[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $employees;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">__construct</span><span class="params">(string $name, array $employees)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;name = $name;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;employees = $employees;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">getName</span><span class="params">()</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">getEmployees</span><span class="params">()</span>: array</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;employees;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">getCost</span><span class="params">()</span>: <span class="keyword">int</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $cost = <span class="number">0</span>;</span><br><span class="line">        foreach ($<span class="keyword">this</span>-&gt;employees as $employee) &#123;</span><br><span class="line">            $cost += $employee-&gt;getSalary();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $cost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">accept</span><span class="params">(Visitor $visitor)</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $visitor-&gt;visitDepartment($<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Employee Concrete Component.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $position;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $salary;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">__construct</span><span class="params">(string $name, string $position, <span class="keyword">int</span> $salary)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;name = $name;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;position = $position;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;salary = $salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">getName</span><span class="params">()</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">getPosition</span><span class="params">()</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">getSalary</span><span class="params">()</span>: <span class="keyword">int</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">accept</span><span class="params">(Visitor $visitor)</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $visitor-&gt;visitEmployee($<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Visitor interface declares a set of visiting methods for each of the</span></span><br><span class="line"><span class="comment"> * Concrete Component classes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">visitCompany</span><span class="params">(Company $company)</span>: string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">visitDepartment</span><span class="params">(Department $department)</span>: string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">visitEmployee</span><span class="params">(Employee $employee)</span>: string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Concrete Visitor must provide implementations for every single class of</span></span><br><span class="line"><span class="comment"> * the Concrete Components.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SalaryReport</span> <span class="keyword">implements</span> <span class="title">Visitor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">visitCompany</span><span class="params">(Company $company)</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $output = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        $total = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        foreach ($company-&gt;getDepartments() as $department) &#123;</span><br><span class="line">            $total += $department-&gt;getCost();</span><br><span class="line">            $output .= <span class="string">&quot;\n--&quot;</span> . $<span class="keyword">this</span>-&gt;visitDepartment($department);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $output = $company-&gt;getName() .</span><br><span class="line">            <span class="string">&quot; (&quot;</span> . money_format(<span class="string">&quot;%i&quot;</span>, $total) . <span class="string">&quot;)\n&quot;</span> . $output;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">visitDepartment</span><span class="params">(Department $department)</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $output = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        foreach ($department-&gt;getEmployees() as $employee) &#123;</span><br><span class="line">            $output .= <span class="string">&quot;   &quot;</span> . $<span class="keyword">this</span>-&gt;visitEmployee($employee);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $output = $department-&gt;getName() .</span><br><span class="line">            <span class="string">&quot; (&quot;</span> . money_format(<span class="string">&quot;%i&quot;</span>, $department-&gt;getCost()) . <span class="string">&quot;)\n\n&quot;</span> .</span><br><span class="line">            $output;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">visitEmployee</span><span class="params">(Employee $employee)</span>: string</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> money_format(<span class="string">&quot;%#6n&quot;</span>, $employee-&gt;getSalary()) .</span><br><span class="line">            <span class="string">&quot; &quot;</span> . $employee-&gt;getName() .</span><br><span class="line">            <span class="string">&quot; (&quot;</span> . $employee-&gt;getPosition() . <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">$mobileDev = <span class="keyword">new</span> Department(<span class="string">&quot;Mobile Development&quot;</span>, [</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;Albert Falmore&quot;</span>, <span class="string">&quot;designer&quot;</span>, <span class="number">100000</span>),</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;Ali Halabay&quot;</span>, <span class="string">&quot;programmer&quot;</span>, <span class="number">100000</span>),</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;Sarah Konor&quot;</span>, <span class="string">&quot;programmer&quot;</span>, <span class="number">90000</span>),</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;Monica Ronaldino&quot;</span>, <span class="string">&quot;QA engineer&quot;</span>, <span class="number">31000</span>),</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;James Smith&quot;</span>, <span class="string">&quot;QA engineer&quot;</span>, <span class="number">30000</span>),</span><br><span class="line">]);</span><br><span class="line">$techSupport = <span class="keyword">new</span> Department(<span class="string">&quot;Tech Support&quot;</span>, [</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;Larry Ulbrecht&quot;</span>, <span class="string">&quot;supervisor&quot;</span>, <span class="number">70000</span>),</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;Elton Pale&quot;</span>, <span class="string">&quot;operator&quot;</span>, <span class="number">30000</span>),</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;Rajeet Kumar&quot;</span>, <span class="string">&quot;operator&quot;</span>, <span class="number">30000</span>),</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;John Burnovsky&quot;</span>, <span class="string">&quot;operator&quot;</span>, <span class="number">34000</span>),</span><br><span class="line">    <span class="keyword">new</span> Employee(<span class="string">&quot;Sergey Korolev&quot;</span>, <span class="string">&quot;operator&quot;</span>, <span class="number">35000</span>),</span><br><span class="line">]);</span><br><span class="line">$company = <span class="keyword">new</span> Company(<span class="string">&quot;SuperStarDevelopment&quot;</span>, [$mobileDev, $techSupport]);</span><br><span class="line"></span><br><span class="line">setlocale(LC_MONETARY, <span class="string">&#x27;en_US&#x27;</span>);</span><br><span class="line">$report = <span class="keyword">new</span> SalaryReport();</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;Client: I can print a report for a whole company:\n\n&quot;</span>;</span><br><span class="line">echo $company-&gt;accept($report);</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;\nClient: ...or just for a single department:\n\n&quot;</span>;</span><br><span class="line">echo $techSupport-&gt;accept($report);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $export = new JSONExport(); </span></span><br><span class="line"><span class="comment">// echo $company-&gt;accept($export);</span></span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Client: I can print a report for a whole company:</span><br><span class="line"></span><br><span class="line">SuperStarDevelopment (USD550,000.00)</span><br><span class="line"></span><br><span class="line">--Mobile Development (USD351,000.00)</span><br><span class="line"></span><br><span class="line">    $100,000.00 Albert Falmore (designer)</span><br><span class="line">    $100,000.00 Ali Halabay (programmer)</span><br><span class="line">    $ 90,000.00 Sarah Konor (programmer)</span><br><span class="line">    $ 31,000.00 Monica Ronaldino (QA engineer)</span><br><span class="line">    $ 30,000.00 James Smith (QA engineer)</span><br><span class="line"></span><br><span class="line">--Tech Support (USD199,000.00)</span><br><span class="line"></span><br><span class="line">    $ 70,000.00 Larry Ulbrecht (supervisor)</span><br><span class="line">    $ 30,000.00 Elton Pale (operator)</span><br><span class="line">    $ 30,000.00 Rajeet Kumar (operator)</span><br><span class="line">    $ 34,000.00 John Burnovsky (operator)</span><br><span class="line">    $ 35,000.00 Sergey Korolev (operator)</span><br><span class="line"></span><br><span class="line">Client: ...or just for a single department:</span><br><span class="line"></span><br><span class="line">Tech Support (USD199,000.00)</span><br><span class="line"></span><br><span class="line">    $ 70,000.00 Larry Ulbrecht (supervisor)</span><br><span class="line">    $ 30,000.00 Elton Pale (operator)</span><br><span class="line">    $ 30,000.00 Rajeet Kumar (operator)</span><br><span class="line">    $ 34,000.00 John Burnovsky (operator)</span><br><span class="line">    $ 35,000.00 Sergey Korolev (operator)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-5"><p><strong>åœ¨ Python ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è®¿é—®è€…ä¸æ˜¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œ å› ä¸ºå®ƒä¸ä»…å¤æ‚ï¼Œ åº”ç”¨èŒƒå›´ä¹Ÿæ¯”è¾ƒç‹­çª„ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è®¿é—®è€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.py:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Component interface declares an `accept` method that should take the</span></span><br><span class="line"><span class="string">    base visitor interface as an argument.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">accept</span>(<span class="params">self, visitor: Visitor</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentA</span>(<span class="params">Component</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Each Concrete Component must implement the `accept` method in such a way</span></span><br><span class="line"><span class="string">    that it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">accept</span>(<span class="params">self, visitor: Visitor</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line"><span class="string">        current class name. This way we let the visitor know the class of the</span></span><br><span class="line"><span class="string">        component it works with.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        visitor.visit_concrete_component_a(self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exclusive_method_of_concrete_component_a</span>(<span class="params">self</span>) -&gt; str:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Concrete Components may have special methods that don&#x27;t exist in their</span></span><br><span class="line"><span class="string">        base class or interface. The Visitor is still able to use these methods</span></span><br><span class="line"><span class="string">        since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentB</span>(<span class="params">Component</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">accept</span>(<span class="params">self, visitor: Visitor</span>):</span></span><br><span class="line">        visitor.visit_concrete_component_b(self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">special_method_of_concrete_component_b</span>(<span class="params">self</span>) -&gt; str:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;B&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Visitor</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="string">    component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="string">    identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_a</span>(<span class="params">self, element: ConcreteComponentA</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_b</span>(<span class="params">self, element: ConcreteComponentB</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="string">work with all concrete component classes.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You can experience the biggest benefit of the Visitor pattern when using it with</span></span><br><span class="line"><span class="string">a complex object structure, such as a Composite tree. In this case, it might be</span></span><br><span class="line"><span class="string">helpful to store some intermediate state of the algorithm while executing</span></span><br><span class="line"><span class="string">visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor1</span>(<span class="params">Visitor</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_a</span>(<span class="params">self, element</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">f&quot;<span class="subst">&#123;element.exclusive_method_of_concrete_component_a()&#125;</span> + ConcreteVisitor1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_b</span>(<span class="params">self, element</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">f&quot;<span class="subst">&#123;element.special_method_of_concrete_component_b()&#125;</span> + ConcreteVisitor1&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor2</span>(<span class="params">Visitor</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_a</span>(<span class="params">self, element</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">f&quot;<span class="subst">&#123;element.exclusive_method_of_concrete_component_a()&#125;</span> + ConcreteVisitor2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_b</span>(<span class="params">self, element</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">f&quot;<span class="subst">&#123;element.special_method_of_concrete_component_b()&#125;</span> + ConcreteVisitor2&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client_code</span>(<span class="params">components: List[Component], visitor: Visitor</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="string">    figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="string">    the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">for</span> component <span class="keyword">in</span> components:</span><br><span class="line">        component.accept(visitor)</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    components = [ConcreteComponentA(), ConcreteComponentB()]</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;The client code works with all visitors via the base Visitor interface:&quot;</span>)</span><br><span class="line">    visitor1 = ConcreteVisitor1()</span><br><span class="line">    client_code(components, visitor1)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;It allows the same client code to work with different types of visitors:&quot;</span>)</span><br><span class="line">    visitor2 = ConcreteVisitor2()</span><br><span class="line">    client_code(components, visitor2)</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-6"><p><strong>åœ¨ Ruby ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è®¿é—®è€…ä¸æ˜¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œ å› ä¸ºå®ƒä¸ä»…å¤æ‚ï¼Œ åº”ç”¨èŒƒå›´ä¹Ÿæ¯”è¾ƒç‹­çª„ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è®¿é—®è€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.rb:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The Component interface declares an `accept` method that should take the base</span></span><br><span class="line"><span class="comment"># visitor interface as an argument.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span></span></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Visitor] visitor</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">accept</span><span class="params">(_visitor)</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Each Concrete Component must implement the `accept` method in such a way that</span></span><br><span class="line"><span class="comment"># it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentA</span> &lt; Component</span></span><br><span class="line">  <span class="comment"># Note that we&#x27;re calling `visitConcreteComponentA`, which matches the current</span></span><br><span class="line">  <span class="comment"># class name. This way we let the visitor know the class of the component it</span></span><br><span class="line">  <span class="comment"># works with.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">accept</span><span class="params">(visitor)</span></span></span><br><span class="line">    visitor.visit_concrete_component_a(<span class="keyword">self</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Concrete Components may have special methods that don&#x27;t exist in their base</span></span><br><span class="line">  <span class="comment"># class or interface. The Visitor is still able to use these methods since</span></span><br><span class="line">  <span class="comment"># it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">exclusive_method_of_concrete_component_a</span></span></span><br><span class="line">    <span class="string">&#x27;A&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Same here: visit_concrete_component_b =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentB</span> &lt; Component</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Visitor] visitor</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">accept</span><span class="params">(visitor)</span></span></span><br><span class="line">    visitor.visit_concrete_component_b(<span class="keyword">self</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">special_method_of_concrete_component_b</span></span></span><br><span class="line">    <span class="string">&#x27;B&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment"># component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment"># identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Visitor</span></span></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [ConcreteComponentA] element</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_a</span><span class="params">(_element)</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [ConcreteComponentB] element</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_b</span><span class="params">(_element)</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="comment"># work with all concrete component classes.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment"># with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment"># might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment"># executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor1</span> &lt; Visitor</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_a</span><span class="params">(element)</span></span></span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;element.exclusive_method_of_concrete_component_a&#125;</span> + <span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_b</span><span class="params">(element)</span></span></span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;element.special_method_of_concrete_component_b&#125;</span> + <span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor2</span> &lt; Visitor</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_a</span><span class="params">(element)</span></span></span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;element.exclusive_method_of_concrete_component_a&#125;</span> + <span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_b</span><span class="params">(element)</span></span></span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;element.special_method_of_concrete_component_b&#125;</span> + <span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment"># figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment"># the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client_code</span><span class="params">(components, visitor)</span></span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  components.each <span class="keyword">do</span> <span class="params">|component|</span></span><br><span class="line">    component.accept(visitor)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">components = [ConcreteComponentA.new, ConcreteComponentB.new]</span><br><span class="line"></span><br><span class="line">puts <span class="string">&#x27;The client code works with all visitors via the base Visitor interface:&#x27;</span></span><br><span class="line">visitor1 = ConcreteVisitor1.new</span><br><span class="line">client_code(components, visitor1)</span><br><span class="line"></span><br><span class="line">puts <span class="string">&#x27;It allows the same client code to work with different types of visitors:&#x27;</span></span><br><span class="line">visitor2 = ConcreteVisitor2.new</span><br><span class="line">client_code(components, visitor2)</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-7"><p><strong>åœ¨ Swift ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è®¿é—®è€…ä¸æ˜¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œ å› ä¸ºå®ƒä¸ä»…å¤æ‚ï¼Œ åº”ç”¨èŒƒå›´ä¹Ÿæ¯”è¾ƒç‹­çª„ã€‚</p><div class="tabs" id="swift"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#swift-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#swift-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="swift-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è®¿é—®è€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ Swift åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>Example.swift:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Component interface declares an `accept` method that should take the</span></span><br><span class="line"><span class="comment">/// base visitor interface as an argument.</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(<span class="number">_</span> visitor: Visitor)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Each Concrete Component must implement the `accept` method in such a way</span></span><br><span class="line"><span class="comment">/// that it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentA</span>: <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line">    <span class="comment">/// current class name. This way we let the visitor know the class of the</span></span><br><span class="line">    <span class="comment">/// component it works with.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(<span class="number">_</span> visitor: Visitor)</span></span> &#123;</span><br><span class="line">        visitor.visitConcreteComponentA(element: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Concrete Components may have special methods that don&#x27;t exist in their</span></span><br><span class="line">    <span class="comment">/// base class or interface. The Visitor is still able to use these methods</span></span><br><span class="line">    <span class="comment">/// since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">exclusiveMethodOfConcreteComponentA</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentB</span>: <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(<span class="number">_</span> visitor: Visitor)</span></span> &#123;</span><br><span class="line">        visitor.visitConcreteComponentB(element: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">specialMethodOfConcreteComponentB</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;B&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment">/// component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment">/// identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">visitConcreteComponentA</span><span class="params">(element: ConcreteComponentA)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">visitConcreteComponentB</span><span class="params">(element: ConcreteComponentB)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Concrete Visitors implement several versions of the same algorithm, which</span></span><br><span class="line"><span class="comment">/// can work with all concrete component classes.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment">/// with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment">/// might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment">/// executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor1</span>: <span class="title">Visitor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">visitConcreteComponentA</span><span class="params">(element: ConcreteComponentA)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(element.exclusiveMethodOfConcreteComponentA() + <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">visitConcreteComponentB</span><span class="params">(element: ConcreteComponentB)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(element.specialMethodOfConcreteComponentB() + <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor2</span>: <span class="title">Visitor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">visitConcreteComponentA</span><span class="params">(element: ConcreteComponentA)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(element.exclusiveMethodOfConcreteComponentA() + <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">visitConcreteComponentB</span><span class="params">(element: ConcreteComponentB)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(element.specialMethodOfConcreteComponentB() + <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment">/// figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment">/// the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">clientCode</span><span class="params">(components: [Component], visitor: Visitor)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        components.forEach(&#123; $<span class="number">0</span>.accept(visitor) &#125;)</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all works together.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VisitorConceptual</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> components: [<span class="type">Component</span>] = [<span class="type">ConcreteComponentA</span>(), <span class="type">ConcreteComponentB</span>()]</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The client code works with all visitors via the base Visitor interface:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> visitor1 = <span class="type">ConcreteVisitor1</span>()</span><br><span class="line">        <span class="type">Client</span>.clientCode(components: components, visitor: visitor1)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nIt allows the same client code to work with different types of visitors:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> visitor2 = <span class="type">ConcreteVisitor2</span>()</span><br><span class="line">        <span class="type">Client</span>.clientCode(components: components, visitor: visitor2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line"></span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line"></span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line"></span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="swift-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p><strong>Example.swift:</strong> çœŸå®ä¸–ç•Œç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Notification</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(visitor: NotificationPolicy)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Email</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> emailOfSender: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Email&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SMS</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> phoneNumberOfSender: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;SMS&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Push</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> usernameOfSender: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Push&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Email</span>: <span class="title">Notification</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(visitor: NotificationPolicy)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.isTurnedOn(<span class="keyword">for</span>: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SMS</span>: <span class="title">Notification</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(visitor: NotificationPolicy)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.isTurnedOn(<span class="keyword">for</span>: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Push</span>: <span class="title">Notification</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(visitor: NotificationPolicy)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.isTurnedOn(<span class="keyword">for</span>: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">NotificationPolicy</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> email: Email)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> sms: SMS)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> push: Push)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NightPolicyVisitor</span>: <span class="title">NotificationPolicy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> email: Email)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> sms: SMS)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> push: Push)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Night Policy Visitor&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultPolicyVisitor</span>: <span class="title">NotificationPolicy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> email: Email)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> sms: SMS)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> push: Push)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Default Policy Visitor&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlackListVisitor</span>: <span class="title">NotificationPolicy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> bannedEmails = [<span class="type">String</span>]()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> bannedPhones = [<span class="type">String</span>]()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> bannedUsernames = [<span class="type">String</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(emails: [<span class="type">String</span>], phones: [<span class="type">String</span>], usernames: [<span class="type">String</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.bannedEmails = emails</span><br><span class="line">        <span class="keyword">self</span>.bannedPhones = phones</span><br><span class="line">        <span class="keyword">self</span>.bannedUsernames = usernames</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> email: Email)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bannedEmails.<span class="built_in">contains</span>(email.emailOfSender)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> sms: SMS)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bannedPhones.<span class="built_in">contains</span>(sms.phoneNumberOfSender)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isTurnedOn</span><span class="params">(<span class="keyword">for</span> push: Push)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bannedUsernames.<span class="built_in">contains</span>(push.usernameOfSender)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Black List Visitor&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VisitorRealWorld</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testVisitorRealWorld</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> email = <span class="type">Email</span>(emailOfSender: <span class="string">&quot;some@email.com&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> sms = <span class="type">SMS</span>(phoneNumberOfSender: <span class="string">&quot;+3806700000&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> push = <span class="type">Push</span>(usernameOfSender: <span class="string">&quot;Spammer&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> notifications: [<span class="type">Notification</span>] = [email, sms, push]</span><br><span class="line"></span><br><span class="line">        clientCode(handle: notifications, with: <span class="type">DefaultPolicyVisitor</span>())</span><br><span class="line"></span><br><span class="line">        clientCode(handle: notifications, with: <span class="type">NightPolicyVisitor</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">VisitorRealWorld</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Client code traverses notifications with visitors and checks whether a</span></span><br><span class="line">    <span class="comment">/// notification is in a blacklist and should be shown in accordance with a</span></span><br><span class="line">    <span class="comment">/// current SilencePolicy</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">clientCode</span><span class="params">(handle notifications: [Notification], with policy: NotificationPolicy)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> blackList = createBlackList()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nClient: Using \(policy.description) and \(blackList.description)&quot;</span>)</span><br><span class="line"></span><br><span class="line">        notifications.forEach &#123; item <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">guard</span> !item.accept(visitor: blackList) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\tWARNING: &quot;</span> + item.description + <span class="string">&quot; is in a black list&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> item.accept(visitor: policy) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\t&quot;</span> + item.description + <span class="string">&quot; notification will be shown&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\t&quot;</span> + item.description + <span class="string">&quot; notification will be silenced&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">createBlackList</span><span class="params">()</span></span> -&gt; <span class="type">BlackListVisitor</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">BlackListVisitor</span>(emails: [<span class="string">&quot;banned@email.com&quot;</span>],</span><br><span class="line">                                phones: [<span class="string">&quot;000000000&quot;</span>, <span class="string">&quot;1234325232&quot;</span>],</span><br><span class="line">                                usernames: [<span class="string">&quot;Spammer&quot;</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Client: Using Default Policy Visitor and Black List Visitor</span><br><span class="line">    Email notification will be shown</span><br><span class="line">    SMS notification will be shown</span><br><span class="line">    WARNING: Push is in a black list</span><br><span class="line"></span><br><span class="line">Client: Using Night Policy Visitor and Black List Visitor</span><br><span class="line">    Email notification will be silenced</span><br><span class="line">    SMS notification will be shown</span><br><span class="line">    WARNING: Push is in a black list</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-8"><p><strong>åœ¨ TypeScript ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è®¿é—®è€…ä¸æ˜¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œ å› ä¸ºå®ƒä¸ä»…å¤æ‚ï¼Œ åº”ç”¨èŒƒå›´ä¹Ÿæ¯”è¾ƒç‹­çª„ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è®¿é—®è€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>index.ts:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Component interface declares an `accept` method that should take the base</span></span><br><span class="line"><span class="comment"> * visitor interface as an argument.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> Component &#123;</span><br><span class="line">    accept(visitor: Visitor): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Each Concrete Component must implement the `accept` method in such a way that</span></span><br><span class="line"><span class="comment"> * it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentA</span> <span class="title">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line"><span class="comment">     * current class name. This way we let the visitor know the class of the</span></span><br><span class="line"><span class="comment">     * component it works with.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> accept(visitor: Visitor): <span class="built_in">void</span> &#123;</span><br><span class="line">        visitor.visitConcreteComponentA(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Concrete Components may have special methods that don&#x27;t exist in their</span></span><br><span class="line"><span class="comment">     * base class or interface. The Visitor is still able to use these methods</span></span><br><span class="line"><span class="comment">     * since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> exclusiveMethodOfConcreteComponentA(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentB</span> <span class="title">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> accept(visitor: Visitor): <span class="built_in">void</span> &#123;</span><br><span class="line">        visitor.visitConcreteComponentB(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> specialMethodOfConcreteComponentB(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment"> * component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment"> * identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> Visitor &#123;</span><br><span class="line">    visitConcreteComponentA(element: ConcreteComponentA): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    visitConcreteComponentB(element: ConcreteComponentB): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="comment"> * work with all concrete component classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment"> * with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment"> * might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment"> * executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor1</span> <span class="title">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> visitConcreteComponentA(element: ConcreteComponentA): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;element.exclusiveMethodOfConcreteComponentA()&#125;</span> + ConcreteVisitor1`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> visitConcreteComponentB(element: ConcreteComponentB): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;element.specialMethodOfConcreteComponentB()&#125;</span> + ConcreteVisitor1`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor2</span> <span class="title">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> visitConcreteComponentA(element: ConcreteComponentA): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;element.exclusiveMethodOfConcreteComponentA()&#125;</span> + ConcreteVisitor2`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> visitConcreteComponentB(element: ConcreteComponentB): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;element.specialMethodOfConcreteComponentB()&#125;</span> + ConcreteVisitor2`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment"> * figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment"> * the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clientCode</span>(<span class="params">components: Component[], visitor: Visitor</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> component <span class="keyword">of</span> components) &#123;</span><br><span class="line">        component.accept(visitor);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = [</span><br><span class="line">    <span class="keyword">new</span> ConcreteComponentA(),</span><br><span class="line">    <span class="keyword">new</span> ConcreteComponentB(),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;The client code works with all visitors via the base Visitor interface:&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> visitor1 = <span class="keyword">new</span> ConcreteVisitor1();</span><br><span class="line">clientCode(components, visitor1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;It allows the same client code to work with different types of visitors:&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> visitor2 = <span class="keyword">new</span> ConcreteVisitor2();</span><br><span class="line">clientCode(components, visitor2);</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-9"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>è®¿é—®è€…æ¨¡å¼å…è®¸ä½ åœ¨ç»“æ„ä½“ä¸­æ·»åŠ è¡Œä¸ºï¼Œ è€Œåˆä¸ä¼šå¯¹ç»“æ„ä½“é€ æˆå®é™…å˜æ›´ã€‚ å‡è®¾ä½ æ˜¯ä¸€ä¸ªä»£ç åº“çš„ç»´æŠ¤è€…ï¼Œ ä»£ç åº“ä¸­åŒ…å«ä¸åŒçš„å½¢çŠ¶ç»“æ„ä½“ï¼Œ å¦‚ï¼š</p><ul><li>æ–¹å½¢</li><li>åœ†å½¢</li><li>ä¸‰è§’å½¢</li></ul><p>ä¸Šè¿°æ¯ä¸ªå½¢çŠ¶ç»“æ„ä½“éƒ½å®ç°äº†é€šç”¨å½¢çŠ¶æ¥å£ã€‚</p><p>åœ¨å…¬å¸å‘˜å·¥å¼€å§‹ä½¿ç”¨ä½ ç»´æŠ¤çš„ä»£ç åº“æ—¶ï¼Œ ä½ å°±ä¼šè¢«å„ç§åŠŸèƒ½è¯·æ±‚ç»™æ·¹æ²¡ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä¸­æ¯”è¾ƒç®€å•çš„è¯·æ±‚ï¼š æœ‰ä¸ªå›¢é˜Ÿè¯·æ±‚ä½ åœ¨å½¢çŠ¶ç»“æ„ä½“ä¸­æ·»åŠ  <code>getÂ­Area</code>è·å–é¢ç§¯è¡Œä¸ºã€‚</p><p>è§£å†³è¿™ä¸€é—®é¢˜çš„åŠæ³•æœ‰å¾ˆå¤šã€‚</p><p>ç¬¬ä¸€ä¸ªé€‰é¡¹ä¾¿æ˜¯å°† <code>getÂ­Area</code>æ–¹æ³•ç›´æ¥æ·»åŠ è‡³å½¢çŠ¶æ¥å£ï¼Œ ç„¶ååœ¨å„ä¸ªå½¢çŠ¶ç»“æ„ä½“ä¸­è¿›è¡Œå®ç°ã€‚ è¿™ä¼¼ä¹æ˜¯æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œ ä½†å…¶ä»£ä»·ä¹Ÿæ¯”è¾ƒé«˜ã€‚ ä½œä¸ºä»£ç åº“çš„ç®¡ç†å‘˜ï¼Œ ç›¸ä¿¡ä½ ä¹Ÿä¸æƒ³åœ¨æ¯æ¬¡æœ‰äººè¦æ±‚æ·»åŠ å¦å¤–ä¸€ç§è¡Œä¸ºæ—¶å°±å»å†’ç€é£é™©æ”¹åŠ¨è‡ªå·±çš„å®è´ä»£ç ã€‚ ä¸è¿‡ï¼Œ ä½ ä¹Ÿä¸€å®šæƒ³è®©å…¶ä»–å›¢é˜Ÿçš„äººè¿˜æ˜¯ç”¨ä¸€ç”¨è‡ªå·±çš„ä»£ç åº“ã€‚</p><p>ç¬¬äºŒä¸ªé€‰é¡¹æ˜¯è¯·æ±‚åŠŸèƒ½çš„å›¢é˜Ÿè‡ªè¡Œå®ç°è¡Œä¸ºã€‚ ç„¶è€Œè¿™å¹¶ä¸æ€»æ˜¯å¯è¡Œï¼Œ å› ä¸ºè¡Œä¸ºå¯èƒ½ä¼šä¾èµ–äºç§æœ‰ä»£ç ã€‚</p><p>ç¬¬ä¸‰ä¸ªæ–¹æ³•å°±æ˜¯ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ é¦–å…ˆå®šä¹‰ä¸€ä¸ªå¦‚ä¸‹è®¿é—®è€…æ¥å£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> visitor <span class="keyword">interface</span> &#123;</span><br><span class="line">    visitForSquare(square)</span><br><span class="line">    visitForCircle(circle)</span><br><span class="line">    visitForTriangle(triangle)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>visitÂ­ForÂ­SquareÂ­(square)</code> ã€  <code>visitÂ­ForÂ­CircleÂ­(circle)</code>ä»¥åŠ <code>visitÂ­ForÂ­TriangleÂ­(triangle)</code>å‡½æ•°æ¥ä¸ºæ–¹å½¢ã€ åœ†å½¢ä»¥åŠä¸‰è§’å½¢æ·»åŠ ç›¸åº”çš„åŠŸèƒ½ã€‚</p><p>ä½ å¯èƒ½åœ¨æƒ³ï¼Œ ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸å†è®¿é—®è€…æ¥å£é‡Œé¢ä½¿ç”¨å•ä¸€çš„ <code>visitÂ­(shape)</code>æ–¹æ³•å‘¢ï¼Ÿ è¿™æ˜¯å› ä¸º Go è¯­è¨€ä¸æ”¯æŒæ–¹æ³•é‡è½½ï¼Œ æ‰€ä»¥ä½ æ— æ³•ä»¥ç›¸åŒåç§°ã€ ä¸åŒå‚æ•°çš„æ–¹å¼æ¥ä½¿ç”¨æ–¹æ³•ã€‚</p><p>å¥½äº†ï¼Œ ç¬¬äºŒé¡¹é‡è¦çš„å·¥ä½œæ˜¯å°† <code>accept</code>æ¥å—æ–¹æ³•æ·»åŠ è‡³å½¢çŠ¶æ¥å£ä¸­ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(v visitor)</span></span></span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å½¢çŠ¶ç»“æ„ä½“éƒ½éœ€è¦å®šä¹‰æ­¤æ–¹æ³•ï¼Œ ç±»ä¼¼äºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(obj *square)</span> <span class="title">accept</span><span class="params">(v visitor)</span></span>&#123;</span><br><span class="line">    v.visitForSquare(obj)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­‰ç­‰ï¼Œ æˆ‘åˆšæ‰æ˜¯ä¸æ˜¯æåˆ°è¿‡ï¼Œ æˆ‘ä»¬å¹¶ä¸æƒ³ä¿®æ”¹ç°æœ‰çš„å½¢çŠ¶ç»“æ„ä½“ï¼Ÿ å¾ˆä¸å¹¸ï¼Œ åœ¨ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ—¶ï¼Œ æˆ‘ä»¬å¿…é¡»è¦ä¿®æ”¹å½¢çŠ¶ç»“æ„ä½“ã€‚ ä½†è¿™æ ·çš„ä¿®æ”¹åªéœ€è¦è¿›è¡Œä¸€æ¬¡ã€‚</p><p>å¦‚æœæ·»åŠ ä»»ä½•å…¶ä»–è¡Œä¸ºï¼Œ æ¯”å¦‚ <code>getÂ­NumÂ­Sides</code>è·å–è¾¹æ•°å’Œ <code>getÂ­MiddleÂ­Coordinates</code>è·å–ä¸­ç‚¹åæ ‡ ï¼Œ æˆ‘ä»¬å°†ä½¿ç”¨ç›¸åŒçš„ <code>acceptÂ­(v visitor)</code>å‡½æ•°ï¼Œ è€Œæ— éœ€å¯¹å½¢çŠ¶ç»“æ„ä½“è¿›è¡Œè¿›ä¸€æ­¥çš„ä¿®æ”¹ã€‚</p><p>æœ€åï¼Œ å½¢çŠ¶ç»“æ„ä½“åªéœ€è¦ä¿®æ”¹ä¸€æ¬¡ï¼Œ å¹¶ä¸”æ‰€æœ‰æœªæ¥é’ˆå¯¹ä¸åŒè¡Œä¸ºçš„è¯·æ±‚éƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ accept å‡½æ•°æ¥è¿›è¡Œå¤„ç†ã€‚ å¦‚æœå›¢é˜Ÿæˆå‘˜è¯·æ±‚ <code>getÂ­Area</code>è¡Œä¸ºï¼Œ æˆ‘ä»¬åªéœ€ç®€å•åœ°å®šä¹‰è®¿é—®è€…æ¥å£çš„å…·ä½“å®ç°ï¼Œ å¹¶åœ¨å…¶ä¸­ç¼–å†™é¢ç§¯çš„è®¡ç®—é€»è¾‘å³å¯ã€‚</p><p><strong>shape.go:</strong> å…ƒä»¶</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> shape <span class="keyword">interface</span> &#123;</span><br><span class="line">    getType() <span class="keyword">string</span></span><br><span class="line">    accept(visitor)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>square.go:</strong> å…·ä½“å…ƒä»¶</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> square <span class="keyword">struct</span> &#123;</span><br><span class="line">    side <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *square)</span> <span class="title">accept</span><span class="params">(v visitor)</span></span> &#123;</span><br><span class="line">    v.visitForSquare(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *square)</span> <span class="title">getType</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Square&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>circle.go:</strong> å…·ä½“å…ƒä»¶</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> circle <span class="keyword">struct</span> &#123;</span><br><span class="line">    radius <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *circle)</span> <span class="title">accept</span><span class="params">(v visitor)</span></span> &#123;</span><br><span class="line">    v.visitForCircle(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *circle)</span> <span class="title">getType</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Circle&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>rectangle.go:</strong> å…·ä½“å…ƒä»¶</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">    l <span class="keyword">int</span></span><br><span class="line">    b <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *rectangle)</span> <span class="title">accept</span><span class="params">(v visitor)</span></span> &#123;</span><br><span class="line">    v.visitForrectangle(t)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *rectangle)</span> <span class="title">getType</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;rectangle&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>visitor.go:</strong> è®¿é—®è€…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> visitor <span class="keyword">interface</span> &#123;</span><br><span class="line">    visitForSquare(*square)</span><br><span class="line">    visitForCircle(*circle)</span><br><span class="line">    visitForrectangle(*rectangle)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>areaCalculator.go:</strong> å…·ä½“è®¿é—®è€…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> areaCalculator <span class="keyword">struct</span> &#123;</span><br><span class="line">    area <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *areaCalculator)</span> <span class="title">visitForSquare</span><span class="params">(s *square)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Calculate area for square.</span></span><br><span class="line">    <span class="comment">// Then assign in to the area instance variable.</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating area for square&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *areaCalculator)</span> <span class="title">visitForCircle</span><span class="params">(s *circle)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating area for circle&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *areaCalculator)</span> <span class="title">visitForrectangle</span><span class="params">(s *rectangle)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating area for rectangle&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>middleCoordinates.go:</strong> å…·ä½“è®¿é—®è€…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> middleCoordinates <span class="keyword">struct</span> &#123;</span><br><span class="line">    x <span class="keyword">int</span></span><br><span class="line">    y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *middleCoordinates)</span> <span class="title">visitForSquare</span><span class="params">(s *square)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Calculate middle point coordinates for square.</span></span><br><span class="line">    <span class="comment">// Then assign in to the x and y instance variable.</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating middle point coordinates for square&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *middleCoordinates)</span> <span class="title">visitForCircle</span><span class="params">(c *circle)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating middle point coordinates for circle&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *middleCoordinates)</span> <span class="title">visitForrectangle</span><span class="params">(t *rectangle)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating middle point coordinates for rectangle&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>main.go:</strong> å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    square := &amp;square&#123;side: <span class="number">2</span>&#125;</span><br><span class="line">    circle := &amp;circle&#123;radius: <span class="number">3</span>&#125;</span><br><span class="line">    rectangle := &amp;rectangle&#123;l: <span class="number">2</span>, b: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">    areaCalculator := &amp;areaCalculator&#123;&#125;</span><br><span class="line"></span><br><span class="line">    square.accept(areaCalculator)</span><br><span class="line">    circle.accept(areaCalculator)</span><br><span class="line">    rectangle.accept(areaCalculator)</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line">    middleCoordinates := &amp;middleCoordinates&#123;&#125;</span><br><span class="line">    square.accept(middleCoordinates)</span><br><span class="line">    circle.accept(middleCoordinates)</span><br><span class="line">    rectangle.accept(middleCoordinates)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Calculating area for square</span><br><span class="line">Calculating area for circle</span><br><span class="line">Calculating area for rectangle</span><br><span class="line"></span><br><span class="line">Calculating middle point coordinates for square</span><br><span class="line">Calculating middle point coordinates for circle</span><br><span class="line">Calculating middle point coordinates for rectangle</span><br></pre></td></tr></table></figure><p><em>æ ¹æ®ï¼š <a href="https://golangbyexample.com/visitor-design-pattern-go/">Golang By Example</a></em></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://refactoringguru.cn/design-patterns/visitor&quot;&gt;https://refactoringguru.cn/design-patterns/visitor&lt;/a&gt;&lt;/p&gt;
&lt;/bl
      
    
    </summary>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>è¡Œä¸ºæ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼</title>
    <link href="http://wangyangyangisme.github.io/posts/d2372188/"/>
    <id>http://wangyangyangisme.github.io/posts/d2372188/</id>
    <published>2021-05-04T13:10:54.000Z</published>
    <updated>2021-05-04T13:10:54.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://refactoringguru.cn/design-patterns/template-method">https://refactoringguru.cn/design-patterns/template-method</a></p></blockquote><h1 id="è¡Œä¸ºæ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#è¡Œä¸ºæ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="è¡Œä¸ºæ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>è¡Œä¸ºæ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h1><p><strong>äº¦ç§°ï¼š</strong> Template Method</p><h2 id="æ„å›¾"><a href="#æ„å›¾" class="headerlink" title="æ„å›¾"></a>æ„å›¾</h2><p><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å®ƒåœ¨è¶…ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„æ¡†æ¶ï¼Œ å…è®¸å­ç±»åœ¨ä¸ä¿®æ”¹ç»“æ„çš„æƒ…å†µä¸‹é‡å†™ç®—æ³•çš„ç‰¹å®šæ­¥éª¤ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/template-method.png" alt=""></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>å‡å¦‚ä½ æ­£åœ¨å¼€å‘ä¸€æ¬¾åˆ†æå…¬å¸æ–‡æ¡£çš„æ•°æ®æŒ–æ˜ç¨‹åºã€‚ ç”¨æˆ·éœ€è¦å‘ç¨‹åºè¾“å…¥å„ç§æ ¼å¼ ï¼ˆPDFã€ DOC æˆ– CSVï¼‰ çš„æ–‡æ¡£ï¼Œ ç¨‹åºåˆ™ä¼šè¯•å›¾ä»è¿™äº›æ–‡ä»¶ä¸­æŠ½å–æœ‰æ„ä¹‰çš„æ•°æ®ï¼Œ å¹¶ä»¥ç»Ÿä¸€çš„æ ¼å¼å°†å…¶è¿”å›ç»™ç”¨æˆ·ã€‚</p><p>è¯¥ç¨‹åºçš„é¦–ä¸ªç‰ˆæœ¬ä»…æ”¯æŒ DOC æ–‡ä»¶ã€‚ åœ¨æ¥ä¸‹æ¥çš„ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼Œ ç¨‹åºèƒ½å¤Ÿæ”¯æŒ CSV æ–‡ä»¶ã€‚ ä¸€ä¸ªæœˆåï¼Œ ä½  â€œæ•™ä¼šâ€ äº†ç¨‹åºä» PDF æ–‡ä»¶ä¸­æŠ½å–æ•°æ®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/problem-template-method.png" alt="æ•°æ®æŒ–æ˜ç±»ä¸­åŒ…å«è®¸å¤šé‡å¤ä»£ç ã€‚"></p><p>ä¸€æ®µæ—¶é—´åï¼Œ ä½ å‘ç°è¿™ä¸‰ä¸ªç±»ä¸­åŒ…å«è®¸å¤šç›¸ä¼¼ä»£ç ã€‚ å°½ç®¡è¿™äº›ç±»å¤„ç†ä¸åŒæ•°æ®æ ¼å¼çš„ä»£ç å®Œå…¨ä¸åŒï¼Œ ä½†æ•°æ®å¤„ç†å’Œåˆ†æçš„ä»£ç å´å‡ ä¹å®Œå…¨ä¸€æ ·ã€‚ å¦‚æœèƒ½åœ¨ä¿æŒç®—æ³•ç»“æ„å®Œæ•´çš„æƒ…å†µä¸‹å»é™¤é‡å¤ä»£ç ï¼Œ è¿™éš¾é“ä¸æ˜¯ä¸€ä»¶å¾ˆæ£’çš„äº‹æƒ…å—ï¼Ÿ</p><p>è¿˜æœ‰å¦ä¸€ä¸ªä¸ä½¿ç”¨è¿™äº›ç±»çš„å®¢æˆ·ç«¯ä»£ç ç›¸å…³çš„é—®é¢˜ï¼š å®¢æˆ·ç«¯ä»£ç ä¸­åŒ…å«è®¸å¤šæ¡ä»¶è¯­å¥ï¼Œ ä»¥æ ¹æ®ä¸åŒçš„å¤„ç†å¯¹è±¡ç±»å‹é€‰æ‹©åˆé€‚çš„å¤„ç†è¿‡ç¨‹ã€‚ å¦‚æœæ‰€æœ‰å¤„ç†æ•°æ®çš„ç±»éƒ½æ‹¥æœ‰ç›¸åŒçš„æ¥å£æˆ–åŸºç±»ï¼Œ é‚£ä¹ˆä½ å°±å¯ä»¥å»é™¤å®¢æˆ·ç«¯ä»£ç ä¸­çš„æ¡ä»¶è¯­å¥ï¼Œ è½¬è€Œä½¿ç”¨å¤šæ€æœºåˆ¶æ¥åœ¨å¤„ç†å¯¹è±¡ä¸Šè°ƒç”¨å‡½æ•°ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å»ºè®®å°†ç®—æ³•åˆ†è§£ä¸ºä¸€ç³»åˆ—æ­¥éª¤ï¼Œ ç„¶åå°†è¿™äº›æ­¥éª¤æ”¹å†™ä¸ºæ–¹æ³•ï¼Œ æœ€ååœ¨ â€œæ¨¡æ¿æ–¹æ³•â€ ä¸­ä¾æ¬¡è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚ æ­¥éª¤å¯ä»¥æ˜¯ <code>æŠ½è±¡</code>çš„ï¼Œ ä¹Ÿå¯ä»¥æœ‰ä¸€äº›é»˜è®¤çš„å®ç°ã€‚ ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ç®—æ³•ï¼Œ å®¢æˆ·ç«¯éœ€è¦è‡ªè¡Œæä¾›å­ç±»å¹¶å®ç°æ‰€æœ‰çš„æŠ½è±¡æ­¥éª¤ã€‚ å¦‚æœ‰å¿…è¦è¿˜éœ€é‡å†™ä¸€äº›æ­¥éª¤ ï¼ˆä½†è¿™ä¸€æ­¥ä¸­ä¸åŒ…æ‹¬æ¨¡æ¿æ–¹æ³•è‡ªèº«ï¼‰ã€‚</p><p>è®©æˆ‘ä»¬è€ƒè™‘å¦‚ä½•åœ¨æ•°æ®æŒ–æ˜åº”ç”¨ä¸­å®ç°ä¸Šè¿°æ–¹æ¡ˆã€‚ æˆ‘ä»¬å¯ä¸ºå›¾ä¸­çš„ä¸‰ä¸ªè§£æç®—æ³•åˆ›å»ºä¸€ä¸ªåŸºç±»ï¼Œ è¯¥ç±»å°†å®šä¹‰è°ƒç”¨äº†ä¸€ç³»åˆ—ä¸åŒæ–‡æ¡£å¤„ç†æ­¥éª¤çš„æ¨¡æ¿æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/solution-zh-template-method.png" alt="æ¨¡æ¿æ–¹æ³•å°†ç®—æ³•åˆ†è§£ä¸ºæ­¥éª¤ï¼Œ å¹¶å…è®¸å­ç±»é‡å†™è¿™äº›æ­¥éª¤ï¼Œ è€Œéé‡å†™å®é™…çš„æ¨¡æ¿æ–¹æ³•ã€‚"></p><p>é¦–å…ˆï¼Œ æˆ‘ä»¬å°†æ‰€æœ‰æ­¥éª¤å£°æ˜ä¸º <code>æŠ½è±¡</code>ç±»å‹ï¼Œ å¼ºåˆ¶è¦æ±‚å­ç±»è‡ªè¡Œå®ç°è¿™äº›æ–¹æ³•ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ å­ç±»ä¸­å·²æœ‰æ‰€æœ‰å¿…è¦çš„å®ç°ï¼Œ å› æ­¤æˆ‘ä»¬åªéœ€è°ƒæ•´è¿™äº›æ–¹æ³•çš„ç­¾åï¼Œ ä½¿ä¹‹ä¸è¶…ç±»çš„æ–¹æ³•åŒ¹é…å³å¯ã€‚</p><p>ç°åœ¨ï¼Œ è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å»é™¤é‡å¤ä»£ç ã€‚ å¯¹äºä¸åŒçš„æ•°æ®æ ¼å¼ï¼Œ æ‰“å¼€å’Œå…³é—­æ–‡ä»¶ä»¥åŠæŠ½å–å’Œè§£ææ•°æ®çš„ä»£ç éƒ½ä¸åŒï¼Œ å› æ­¤æ— éœ€ä¿®æ”¹è¿™äº›æ–¹æ³•ã€‚ ä½†åˆ†æåŸå§‹æ•°æ®å’Œç”ŸæˆæŠ¥å‘Šç­‰å…¶ä»–æ­¥éª¤çš„å®ç°æ–¹å¼éå¸¸ç›¸ä¼¼ï¼Œ å› æ­¤å¯å°†å…¶æå–åˆ°åŸºç±»ä¸­ï¼Œ ä»¥è®©å­ç±»å…±äº«è¿™äº›ä»£ç ã€‚</p><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œ æˆ‘ä»¬æœ‰ä¸¤ç§ç±»å‹çš„æ­¥éª¤ï¼š</p><ul><li><em>æŠ½è±¡æ­¥éª¤</em>å¿…é¡»ç”±å„ä¸ªå­ç±»æ¥å®ç°</li><li><em>å¯é€‰æ­¥éª¤</em>å·²æœ‰ä¸€äº›é»˜è®¤å®ç°ï¼Œ ä½†ä»å¯åœ¨éœ€è¦æ—¶è¿›è¡Œé‡å†™</li></ul><p>è¿˜æœ‰å¦ä¸€ç§åä¸º<em>é’©å­</em>çš„æ­¥éª¤ã€‚ <em>é’©å­</em>æ˜¯å†…å®¹ä¸ºç©ºçš„å¯é€‰æ­¥éª¤ã€‚ å³ä½¿ä¸é‡å†™é’©å­ï¼Œ æ¨¡æ¿æ–¹æ³•ä¹Ÿèƒ½å·¥ä½œã€‚ é’©å­é€šå¸¸æ”¾ç½®åœ¨ç®—æ³•é‡è¦æ­¥éª¤çš„å‰åï¼Œ ä¸ºå­ç±»æä¾›é¢å¤–çš„ç®—æ³•æ‰©å±•ç‚¹ã€‚</p><h2 id="çœŸå®ä¸–ç•Œç±»æ¯”"><a href="#çœŸå®ä¸–ç•Œç±»æ¯”" class="headerlink" title="çœŸå®ä¸–ç•Œç±»æ¯”"></a>çœŸå®ä¸–ç•Œç±»æ¯”</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/live-example-template-method.png" alt="å¯å¯¹å…¸å‹çš„å»ºç­‘æ–¹æ¡ˆè¿›è¡Œå¾®è°ƒä»¥æ›´å¥½åœ°æ»¡è¶³å®¢æˆ·éœ€æ±‚ã€‚"></p><p>æ¨¡æ¿æ–¹æ³•å¯ç”¨äºå»ºé€ å¤§é‡æˆ¿å±‹ã€‚ æ ‡å‡†æˆ¿å±‹å»ºé€ æ–¹æ¡ˆä¸­å¯æä¾›å‡ ä¸ªæ‰©å±•ç‚¹ï¼Œ å…è®¸æ½œåœ¨æˆ¿å±‹ä¸šä¸»è°ƒæ•´æˆå“æˆ¿å±‹çš„éƒ¨åˆ†ç»†èŠ‚ã€‚</p><p>æ¯ä¸ªå»ºé€ æ­¥éª¤ ï¼ˆä¾‹å¦‚æ‰“åœ°åŸºã€ å»ºé€ æ¡†æ¶ã€ å»ºé€ å¢™å£å’Œå®‰è£…æ°´ç”µç®¡çº¿ç­‰ï¼‰ éƒ½èƒ½è¿›è¡Œå¾®è°ƒï¼Œ è¿™ä½¿å¾—æˆå“æˆ¿å±‹ä¼šç•¥æœ‰ä¸åŒã€‚</p><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç»“æ„"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç»“æ„"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç»“æ„</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/structure-indexed-template-method.png" alt=""></p><ol><li><strong>æŠ½è±¡ç±»</strong> ï¼ˆAbstractÂ­Classï¼‰ ä¼šå£°æ˜ä½œä¸ºç®—æ³•æ­¥éª¤çš„æ–¹æ³•ï¼Œ ä»¥åŠä¾æ¬¡è°ƒç”¨å®ƒä»¬çš„å®é™…æ¨¡æ¿æ–¹æ³•ã€‚ ç®—æ³•æ­¥éª¤å¯ä»¥è¢«å£°æ˜ä¸º <code>æŠ½è±¡</code>ç±»å‹ï¼Œ ä¹Ÿå¯ä»¥æä¾›ä¸€äº›é»˜è®¤å®ç°ã€‚</li><li><strong>å…·ä½“ç±»</strong> ï¼ˆConcreteÂ­Classï¼‰ å¯ä»¥é‡å†™æ‰€æœ‰æ­¥éª¤ï¼Œ ä½†ä¸èƒ½é‡å†™æ¨¡æ¿æ–¹æ³•è‡ªèº«ã€‚</li></ol><h2 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h2><p>æœ¬ä¾‹ä¸­çš„<strong>æ¨¡æ¿æ–¹æ³•</strong>æ¨¡å¼ä¸ºä¸€æ¬¾ç®€å•ç­–ç•¥æ¸¸æˆä¸­äººå·¥æ™ºèƒ½çš„ä¸åŒåˆ†æ”¯æä¾› â€œæ¡†æ¶â€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/example-template-method.png" alt="ä¸€æ¬¾ç®€å•æ¸¸æˆçš„ AI ç±»ã€‚"></p><p>æ¸¸æˆä¸­æ‰€æœ‰çš„ç§æ—éƒ½æœ‰å‡ ä¹åŒç±»çš„å•ä½å’Œå»ºç­‘ã€‚ å› æ­¤ä½ å¯ä»¥åœ¨ä¸åŒçš„ç§æ—ä¸Šå¤ç”¨ç›¸åŒçš„ AI ç»“æ„ï¼Œ åŒæ—¶è¿˜éœ€è¦å…·å¤‡é‡å†™ä¸€äº›ç»†èŠ‚çš„èƒ½åŠ›ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ ä½ å¯ä»¥é‡å†™åŠå…½äººçš„ AI ä½¿å…¶æ›´å¯Œæ”»å‡»æ€§ï¼Œ ä¹Ÿå¯ä»¥è®©äººç±»ä¾§é‡é˜²å®ˆï¼Œ è¿˜å¯ä»¥ç¦æ­¢æ€ªç‰©å»ºé€ å»ºç­‘ã€‚ åœ¨æ¸¸æˆä¸­æ–°å¢ç§æ—éœ€è¦åˆ›å»ºæ–°çš„ AI å­ç±»ï¼Œ è¿˜éœ€è¦é‡å†™ AI åŸºç±»ä¸­æ‰€å£°æ˜çš„é»˜è®¤æ–¹æ³•ã€‚</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŠ½è±¡ç±»å®šä¹‰äº†ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œå…¶ä¸­é€šå¸¸ä¼šåŒ…å«æŸä¸ªç”±æŠ½è±¡åŸè¯­æ“ä½œè°ƒç”¨ç»„æˆçš„ç®—</span></span><br><span class="line"><span class="comment">// æ³•æ¡†æ¶ã€‚å…·ä½“å­ç±»ä¼šå®ç°è¿™äº›æ“ä½œï¼Œä½†æ˜¯ä¸ä¼šå¯¹æ¨¡æ¿æ–¹æ³•åšå‡ºä¿®æ”¹ã€‚</span></span><br><span class="line"><span class="keyword">class</span> GameAI <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// æ¨¡æ¿æ–¹æ³•å®šä¹‰äº†æŸä¸ªç®—æ³•çš„æ¡†æ¶ã€‚</span></span><br><span class="line">    method turn() <span class="keyword">is</span></span><br><span class="line">        collectResources()</span><br><span class="line">        buildStructures()</span><br><span class="line">        buildUnits()</span><br><span class="line">        attack()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸäº›æ­¥éª¤å¯åœ¨åŸºç±»ä¸­ç›´æ¥å®ç°ã€‚</span></span><br><span class="line">    method collectResources() <span class="keyword">is</span></span><br><span class="line">        foreach (s <span class="keyword">in</span> this.builtStructures) <span class="keyword">do</span></span><br><span class="line">            s.collect()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸäº›å¯å®šä¹‰ä¸ºæŠ½è±¡ç±»å‹ã€‚</span></span><br><span class="line">    <span class="keyword">abstract</span> method buildStructures()</span><br><span class="line">    <span class="keyword">abstract</span> method buildUnits()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªç±»å¯åŒ…å«å¤šä¸ªæ¨¡æ¿æ–¹æ³•ã€‚</span></span><br><span class="line">    method attack() <span class="keyword">is</span></span><br><span class="line">        enemy = closestEnemy()</span><br><span class="line">        <span class="keyword">if</span> (enemy == null)</span><br><span class="line">            sendScouts(map.center)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            sendWarriors(enemy.position)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> method sendScouts(position)</span><br><span class="line">    <span class="keyword">abstract</span> method sendWarriors(position)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“ç±»å¿…é¡»å®ç°åŸºç±»ä¸­çš„æ‰€æœ‰æŠ½è±¡æ“ä½œï¼Œä½†æ˜¯å®ƒä»¬ä¸èƒ½é‡å†™æ¨¡æ¿æ–¹æ³•è‡ªèº«ã€‚</span></span><br><span class="line"><span class="keyword">class</span> OrcsAI extends GameAI <span class="keyword">is</span></span><br><span class="line">    method buildStructures() <span class="keyword">is</span></span><br><span class="line">        <span class="keyword">if</span> (there are some resources) <span class="keyword">then</span></span><br><span class="line">            <span class="comment">// å»ºé€ å†œåœºï¼Œæ¥ç€æ˜¯è°·ä»“ï¼Œç„¶åæ˜¯è¦å¡ã€‚</span></span><br><span class="line"></span><br><span class="line">    method buildUnits() <span class="keyword">is</span></span><br><span class="line">        <span class="keyword">if</span> (there are plenty <span class="keyword">of</span> resources) <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> (there are no scouts)</span><br><span class="line">                <span class="comment">// å»ºé€ è‹¦å·¥ï¼Œå°†å…¶åŠ å…¥ä¾¦æŸ¥ç¼–ç»„ã€‚</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment">// å»ºé€ å…½æ—æ­¥å…µï¼Œå°†å…¶åŠ å…¥æˆ˜å£«ç¼–ç»„ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    method sendScouts(position) <span class="keyword">is</span></span><br><span class="line">        <span class="keyword">if</span> (scouts.length &gt; <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">            <span class="comment">// å°†ä¾¦æŸ¥ç¼–ç»„é€åˆ°æŒ‡å®šä½ç½®ã€‚</span></span><br><span class="line"></span><br><span class="line">    method sendWarriors(position) <span class="keyword">is</span></span><br><span class="line">        <span class="keyword">if</span> (warriors.length &gt; <span class="number">5</span>) <span class="keyword">then</span></span><br><span class="line">            <span class="comment">// å°†æˆ˜æ–—ç¼–ç»„é€åˆ°æŒ‡å®šä½ç½®ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»å¯ä»¥é‡å†™éƒ¨åˆ†é»˜è®¤çš„æ“ä½œã€‚</span></span><br><span class="line"><span class="keyword">class</span> MonstersAI extends GameAI <span class="keyword">is</span></span><br><span class="line">    method collectResources() <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// æ€ªç‰©ä¸ä¼šé‡‡é›†èµ„æºã€‚</span></span><br><span class="line"></span><br><span class="line">    method buildStructures() <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// æ€ªç‰©ä¸ä¼šå»ºé€ å»ºç­‘ã€‚</span></span><br><span class="line"></span><br><span class="line">    method buildUnits() <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// æ€ªç‰©ä¸ä¼šå»ºé€ å•ä½ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯</h2><p><strong>å½“ä½ åªå¸Œæœ›å®¢æˆ·ç«¯æ‰©å±•æŸä¸ªç‰¹å®šç®—æ³•æ­¥éª¤ï¼Œ è€Œä¸æ˜¯æ•´ä¸ªç®—æ³•æˆ–å…¶ç»“æ„æ—¶ï¼Œ å¯ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚</strong></p><p>æ¨¡æ¿æ–¹æ³•å°†æ•´ä¸ªç®—æ³•è½¬æ¢ä¸ºä¸€ç³»åˆ—ç‹¬ç«‹çš„æ­¥éª¤ï¼Œ ä»¥ä¾¿å­ç±»èƒ½å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼Œ åŒæ—¶è¿˜å¯è®©è¶…ç±»ä¸­æ‰€å®šä¹‰çš„ç»“æ„ä¿æŒå®Œæ•´ã€‚</p><p><strong>å½“å¤šä¸ªç±»çš„ç®—æ³•é™¤ä¸€äº›ç»†å¾®ä¸åŒä¹‹å¤–å‡ ä¹å®Œå…¨ä¸€æ ·æ—¶ï¼Œ ä½ å¯ä½¿ç”¨è¯¥æ¨¡å¼ã€‚ ä½†å…¶åæœå°±æ˜¯ï¼Œ åªè¦ç®—æ³•å‘ç”Ÿå˜åŒ–ï¼Œ ä½ å°±å¯èƒ½éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„ç±»ã€‚</strong></p><p>åœ¨å°†ç®—æ³•è½¬æ¢ä¸ºæ¨¡æ¿æ–¹æ³•æ—¶ï¼Œ ä½ å¯å°†ç›¸ä¼¼çš„å®ç°æ­¥éª¤æå–åˆ°è¶…ç±»ä¸­ä»¥å»é™¤é‡å¤ä»£ç ã€‚ å­ç±»é—´å„ä¸åŒçš„ä»£ç å¯ç»§ç»­ä¿ç•™åœ¨å­ç±»ä¸­ã€‚</p><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><ol><li>åˆ†æç›®æ ‡ç®—æ³•ï¼Œ ç¡®å®šèƒ½å¦å°†å…¶åˆ†è§£ä¸ºå¤šä¸ªæ­¥éª¤ã€‚ ä»æ‰€æœ‰å­ç±»çš„è§’åº¦å‡ºå‘ï¼Œ è€ƒè™‘å“ªäº›æ­¥éª¤èƒ½å¤Ÿé€šç”¨ï¼Œ å“ªäº›æ­¥éª¤å„ä¸ç›¸åŒã€‚</li><li>åˆ›å»ºæŠ½è±¡åŸºç±»å¹¶å£°æ˜ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•å’Œä»£è¡¨ç®—æ³•æ­¥éª¤çš„ä¸€ç³»åˆ—æŠ½è±¡æ–¹æ³•ã€‚ åœ¨æ¨¡æ¿æ–¹æ³•ä¸­æ ¹æ®ç®—æ³•ç»“æ„ä¾æ¬¡è°ƒç”¨ç›¸åº”æ­¥éª¤ã€‚ å¯ç”¨ <code>final</code>æœ€ç»ˆä¿®é¥°æ¨¡æ¿æ–¹æ³•ä»¥é˜²æ­¢å­ç±»å¯¹å…¶è¿›è¡Œé‡å†™ã€‚</li><li>è™½ç„¶å¯å°†æ‰€æœ‰æ­¥éª¤å…¨éƒ½è®¾ä¸ºæŠ½è±¡ç±»å‹ï¼Œ ä½†é»˜è®¤å®ç°å¯èƒ½ä¼šç»™éƒ¨åˆ†æ­¥éª¤å¸¦æ¥å¥½å¤„ï¼Œ å› ä¸ºå­ç±»æ— éœ€å®ç°é‚£äº›æ–¹æ³•ã€‚</li><li>å¯è€ƒè™‘åœ¨ç®—æ³•çš„å…³é”®æ­¥éª¤ä¹‹é—´æ·»åŠ é’©å­ã€‚</li><li>ä¸ºæ¯ä¸ªç®—æ³•å˜ä½“æ–°å»ºä¸€ä¸ªå…·ä½“å­ç±»ï¼Œ å®ƒ<em>å¿…é¡»</em>å®ç°æ‰€æœ‰çš„æŠ½è±¡æ­¥éª¤ï¼Œ ä¹Ÿ<em>å¯ä»¥</em>é‡å†™éƒ¨åˆ†å¯é€‰æ­¥éª¤ã€‚</li></ol><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹</p><ul><li>ä½ å¯ä»…å…è®¸å®¢æˆ·ç«¯é‡å†™ä¸€ä¸ªå¤§å‹ç®—æ³•ä¸­çš„ç‰¹å®šéƒ¨åˆ†ï¼Œ ä½¿å¾—ç®—æ³•å…¶ä»–éƒ¨åˆ†ä¿®æ”¹å¯¹å…¶æ‰€é€ æˆçš„å½±å“å‡å°ã€‚</li><li>ä½ å¯å°†é‡å¤ä»£ç æå–åˆ°ä¸€ä¸ªè¶…ç±»ä¸­ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>éƒ¨åˆ†å®¢æˆ·ç«¯å¯èƒ½ä¼šå—åˆ°ç®—æ³•æ¡†æ¶çš„é™åˆ¶ã€‚</li><li>é€šè¿‡å­ç±»æŠ‘åˆ¶é»˜è®¤æ­¥éª¤å®ç°å¯èƒ½ä¼šå¯¼è‡´è¿å_é‡Œæ°æ›¿æ¢åŸåˆ™_ã€‚</li><li>æ¨¡æ¿æ–¹æ³•ä¸­çš„æ­¥éª¤è¶Šå¤šï¼Œ å…¶ç»´æŠ¤å·¥ä½œå°±å¯èƒ½ä¼šè¶Šå›°éš¾ã€‚</li></ul><h2 id="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul><li><a href="https://refactoringguru.cn/design-patterns/factory-method">å·¥å‚æ–¹æ³•æ¨¡å¼</a>æ˜¯<a href="https://refactoringguru.cn/design-patterns/template-method">æ¨¡æ¿æ–¹æ³•æ¨¡å¼</a>çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ã€‚ åŒæ—¶ï¼Œ <em>å·¥å‚æ–¹æ³•</em>å¯ä»¥ä½œä¸ºä¸€ä¸ªå¤§å‹<em>æ¨¡æ¿æ–¹æ³•</em>ä¸­çš„ä¸€ä¸ªæ­¥éª¤ã€‚</li><li><a href="https://refactoringguru.cn/design-patterns/template-method">æ¨¡æ¿æ–¹æ³•</a>åŸºäºç»§æ‰¿æœºåˆ¶ï¼š å®ƒå…è®¸ä½ é€šè¿‡æ‰©å±•å­ç±»ä¸­çš„éƒ¨åˆ†å†…å®¹æ¥æ”¹å˜éƒ¨åˆ†ç®—æ³•ã€‚ <a href="https://refactoringguru.cn/design-patterns/strategy">ç­–ç•¥æ¨¡å¼</a>åŸºäºç»„åˆæœºåˆ¶ï¼š ä½ å¯ä»¥é€šè¿‡å¯¹ç›¸åº”è¡Œä¸ºæä¾›ä¸åŒçš„ç­–ç•¥æ¥æ”¹å˜å¯¹è±¡çš„éƒ¨åˆ†è¡Œä¸ºã€‚ <em>æ¨¡æ¿æ–¹æ³•</em>åœ¨ç±»å±‚æ¬¡ä¸Šè¿ä½œï¼Œ å› æ­¤å®ƒæ˜¯é™æ€çš„ã€‚ <em>ç­–ç•¥</em>åœ¨å¯¹è±¡å±‚æ¬¡ä¸Šè¿ä½œï¼Œ å› æ­¤å…è®¸åœ¨è¿è¡Œæ—¶åˆ‡æ¢è¡Œä¸ºã€‚</li></ul><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p><strong>æ¨¡ç‰ˆæ–¹æ³•</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å®ƒåœ¨åŸºç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„æ¡†æ¶ï¼Œ å…è®¸å­ç±»åœ¨ä¸ä¿®æ”¹ç»“æ„çš„æƒ…å†µä¸‹é‡å†™ç®—æ³•çš„ç‰¹å®šæ­¥éª¤ã€‚</p><div class="tabs" id="tags"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#tags-1">C#</button></li><li class="tab"><button type="button" data-href="#tags-2">C++</button></li><li class="tab"><button type="button" data-href="#tags-3">JAVA</button></li><li class="tab"><button type="button" data-href="#tags-4">PHP</button></li><li class="tab"><button type="button" data-href="#tags-5">Python</button></li><li class="tab"><button type="button" data-href="#tags-6">Ruby</button></li><li class="tab"><button type="button" data-href="#tags-7">Swift</button></li><li class="tab"><button type="button" data-href="#tags-8">TypeScrit</button></li><li class="tab"><button type="button" data-href="#tags-9">Golang</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="tags-1"><p><strong>åœ¨ C# ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼åœ¨ C# æ¡†æ¶ä¸­å¾ˆå¸¸è§ã€‚ å¼€å‘è€…é€šå¸¸ä½¿ç”¨å®ƒæ¥å‘æ¡†æ¶ç”¨æˆ·æä¾›é€šè¿‡ç»§æ‰¿å®ç°çš„ã€ å¯¹æ ‡å‡†åŠŸèƒ½è¿›è¡Œæ‰©å±•çš„ç®€å•æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•å¯ä»¥é€šè¿‡è¡Œä¸ºæ–¹æ³•æ¥è¯†åˆ«ï¼Œ è¯¥æ–¹æ³•å·²æœ‰ä¸€ä¸ªåœ¨åŸºç±»ä¸­å®šä¹‰çš„ â€œé»˜è®¤â€ è¡Œä¸ºã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>æ¨¡æ¿æ–¹æ³•</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>Program.cs:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.TemplateMethod.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The Abstract Class defines a template method that contains a skeleton of</span></span><br><span class="line">    <span class="comment">// some algorithm, composed of calls to (usually) abstract primitive</span></span><br><span class="line">    <span class="comment">// operations.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Concrete subclasses should implement these operations, but leave the</span></span><br><span class="line">    <span class="comment">// template method itself intact.</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">AbstractClass</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The template method defines the skeleton of an algorithm.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TemplateMethod</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.BaseOperation1();</span><br><span class="line">            <span class="keyword">this</span>.RequiredOperations1();</span><br><span class="line">            <span class="keyword">this</span>.BaseOperation2();</span><br><span class="line">            <span class="keyword">this</span>.Hook1();</span><br><span class="line">            <span class="keyword">this</span>.RequiredOperation2();</span><br><span class="line">            <span class="keyword">this</span>.BaseOperation3();</span><br><span class="line">            <span class="keyword">this</span>.Hook2();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// These operations already have implementations.</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">BaseOperation1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;AbstractClass says: I am doing the bulk of the work&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">BaseOperation2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;AbstractClass says: But I let subclasses override some operations&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">BaseOperation3</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;AbstractClass says: But I am doing the bulk of the work anyway&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// These operations have to be implemented in subclasses.</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">RequiredOperations1</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">RequiredOperation2</span>(<span class="params"></span>)</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// These are &quot;hooks.&quot; Subclasses may override them, but it&#x27;s not</span></span><br><span class="line">        <span class="comment">// mandatory since the hooks already have default (but empty)</span></span><br><span class="line">        <span class="comment">// implementation. Hooks provide additional extension points in some</span></span><br><span class="line">        <span class="comment">// crucial places of the algorithm.</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Hook1</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Hook2</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete classes have to implement all abstract operations of the base</span></span><br><span class="line">    <span class="comment">// class. They can also override some operations with a default</span></span><br><span class="line">    <span class="comment">// implementation.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteClass1</span> : <span class="title">AbstractClass</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RequiredOperations1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteClass1 says: Implemented Operation1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RequiredOperation2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteClass1 says: Implemented Operation2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Usually, concrete classes override only a fraction of base class&#x27;</span></span><br><span class="line">    <span class="comment">// operations.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteClass2</span> : <span class="title">AbstractClass</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RequiredOperations1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteClass2 says: Implemented Operation1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RequiredOperation2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteClass2 says: Implemented Operation2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Hook1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteClass2 says: Overridden Hook1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Client</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The client code calls the template method to execute the algorithm.</span></span><br><span class="line">        <span class="comment">// Client code does not have to know the concrete class of an object it</span></span><br><span class="line">        <span class="comment">// works with, as long as it works with objects through the interface of</span></span><br><span class="line">        <span class="comment">// their base class.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ClientCode</span>(<span class="params">AbstractClass abstractClass</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            abstractClass.TemplateMethod();</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Same client code can work with different subclasses:&quot;</span>);</span><br><span class="line"></span><br><span class="line">            Client.ClientCode(<span class="keyword">new</span> ConcreteClass1());</span><br><span class="line"></span><br><span class="line">            Console.Write(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Same client code can work with different subclasses:&quot;</span>);</span><br><span class="line">            Client.ClientCode(<span class="keyword">new</span> ConcreteClass2());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass1 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass1 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br><span class="line"></span><br><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass2 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass2 says: Overridden Hook1</span><br><span class="line">ConcreteClass2 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-2"><p><strong>åœ¨ C++ ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼åœ¨ C++ æ¡†æ¶ä¸­å¾ˆå¸¸è§ã€‚ å¼€å‘è€…é€šå¸¸ä½¿ç”¨å®ƒæ¥å‘æ¡†æ¶ç”¨æˆ·æä¾›é€šè¿‡ç»§æ‰¿å®ç°çš„ã€ å¯¹æ ‡å‡†åŠŸèƒ½è¿›è¡Œæ‰©å±•çš„ç®€å•æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•å¯ä»¥é€šè¿‡è¡Œä¸ºæ–¹æ³•æ¥è¯†åˆ«ï¼Œ è¯¥æ–¹æ³•å·²æœ‰ä¸€ä¸ªåœ¨åŸºç±»ä¸­å®šä¹‰çš„ â€œé»˜è®¤â€ è¡Œä¸ºã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>æ¨¡æ¿æ–¹æ³•</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.cc:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Abstract Class defines a template method that contains a skeleton of some</span></span><br><span class="line"><span class="comment"> * algorithm, composed of calls to (usually) abstract primitive operations.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Concrete subclasses should implement these operations, but leave the template</span></span><br><span class="line"><span class="comment"> * method itself intact.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractClass</span> &#123;</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The template method defines the skeleton of an algorithm.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">TemplateMethod</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;BaseOperation1();</span><br><span class="line">    <span class="keyword">this</span>-&gt;RequiredOperations1();</span><br><span class="line">    <span class="keyword">this</span>-&gt;BaseOperation2();</span><br><span class="line">    <span class="keyword">this</span>-&gt;Hook1();</span><br><span class="line">    <span class="keyword">this</span>-&gt;RequiredOperation2();</span><br><span class="line">    <span class="keyword">this</span>-&gt;BaseOperation3();</span><br><span class="line">    <span class="keyword">this</span>-&gt;Hook2();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * These operations already have implementations.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">protected</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">BaseOperation1</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;AbstractClass says: I am doing the bulk of the work\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">BaseOperation2</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;AbstractClass says: But I let subclasses override some operations\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">BaseOperation3</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;AbstractClass says: But I am doing the bulk of the work anyway\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * These operations have to be implemented in subclasses.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RequiredOperations1</span><span class="params">()</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RequiredOperation2</span><span class="params">()</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * These are &quot;hooks.&quot; Subclasses may override them, but it&#x27;s not mandatory</span></span><br><span class="line"><span class="comment">   * since the hooks already have default (but empty) implementation. Hooks</span></span><br><span class="line"><span class="comment">   * provide additional extension points in some crucial places of the</span></span><br><span class="line"><span class="comment">   * algorithm.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Hook1</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Hook2</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete classes have to implement all abstract operations of the base class.</span></span><br><span class="line"><span class="comment"> * They can also override some operations with a default implementation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass1</span> :</span> <span class="keyword">public</span> AbstractClass &#123;</span><br><span class="line"> <span class="keyword">protected</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">RequiredOperations1</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteClass1 says: Implemented Operation1\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">RequiredOperation2</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteClass1 says: Implemented Operation2\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Usually, concrete classes override only a fraction of base class&#x27; operations.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass2</span> :</span> <span class="keyword">public</span> AbstractClass &#123;</span><br><span class="line"> <span class="keyword">protected</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">RequiredOperations1</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteClass2 says: Implemented Operation1\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">RequiredOperation2</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteClass2 says: Implemented Operation2\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Hook1</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteClass2 says: Overridden Hook1\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code calls the template method to execute the algorithm. Client</span></span><br><span class="line"><span class="comment"> * code does not have to know the concrete class of an object it works with, as</span></span><br><span class="line"><span class="comment"> * long as it works with objects through the interface of their base class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClientCode</span><span class="params">(AbstractClass *class_)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  class_-&gt;TemplateMethod();</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Same client code can work with different subclasses:\n&quot;</span>;</span><br><span class="line">  ConcreteClass1 *concreteClass1 = <span class="keyword">new</span> ConcreteClass1;</span><br><span class="line">  ClientCode(concreteClass1);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Same client code can work with different subclasses:\n&quot;</span>;</span><br><span class="line">  ConcreteClass2 *concreteClass2 = <span class="keyword">new</span> ConcreteClass2;</span><br><span class="line">  ClientCode(concreteClass2);</span><br><span class="line">  <span class="keyword">delete</span> concreteClass1;</span><br><span class="line">  <span class="keyword">delete</span> concreteClass2;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass1 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass1 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br><span class="line"></span><br><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass2 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass2 says: Overridden Hook1</span><br><span class="line">ConcreteClass2 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-3"><p><strong>åœ¨ Java ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼åœ¨ Java æ¡†æ¶ä¸­å¾ˆå¸¸è§ã€‚ å¼€å‘è€…é€šå¸¸ä½¿ç”¨å®ƒæ¥å‘æ¡†æ¶ç”¨æˆ·æä¾›é€šè¿‡ç»§æ‰¿å®ç°çš„ã€ å¯¹æ ‡å‡†åŠŸèƒ½è¿›è¡Œæ‰©å±•çš„ç®€å•æ–¹å¼ã€‚</p><p>è¿™é‡Œæ˜¯ä¸€äº›æ ¸å¿ƒ Java ç¨‹åºåº“ä¸­æ¨¡ç‰ˆæ–¹æ³•çš„ç¤ºä¾‹ï¼š</p><ul><li><a href="http://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html"><code>java.io.InputStream</code></a>ã€ <a href="http://docs.oracle.com/javase/8/docs/api/java/io/OutputStream.html"><code>java.io.OutputStream</code></a>ã€ <a href="http://docs.oracle.com/javase/8/docs/api/java/io/Reader.html"><code>java.io.Reader</code></a> å’Œ <a href="http://docs.oracle.com/javase/8/docs/api/java/io/Writer.html"><code>java.io.Writer</code></a> çš„æ‰€æœ‰éæŠ½è±¡æ–¹æ³•ã€‚</li><li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/AbstractList.html"><code>java.util.AbstractList</code></a>ã€ <a href="http://docs.oracle.com/javase/8/docs/api/java/util/AbstractSet.html"><code>java.util.AbstractSet</code></a> å’Œ <a href="http://docs.oracle.com/javase/8/docs/api/java/util/AbstractMap.html"><code>java.util.AbstractMap</code></a> çš„æ‰€æœ‰éæŠ½è±¡æ–¹æ³•ã€‚</li><li><a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html"><code>javax.servlet.http.HttpServlet</code></a>ï¼Œ æ‰€æœ‰é»˜è®¤å‘é€ HTTP 405 â€œæ–¹æ³•ä¸å…è®¸â€ é”™è¯¯å“åº”çš„ <code>doÂ­XXX()</code>æ–¹æ³•ã€‚ ä½ å¯éšæ—¶å¯¹å…¶è¿›è¡Œé‡å†™ã€‚</li></ul><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•å¯ä»¥é€šè¿‡è¡Œä¸ºæ–¹æ³•æ¥è¯†åˆ«ï¼Œ è¯¥æ–¹æ³•å·²æœ‰ä¸€ä¸ªåœ¨åŸºç±»ä¸­å®šä¹‰çš„ â€œé»˜è®¤â€ è¡Œä¸ºã€‚</p><p><strong>é‡å†™ç®—æ³•çš„æ ‡å‡†æ­¥éª¤</strong></p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªå¯ä¸ç¤¾äº¤ç½‘ç»œåä½œçš„ç®—æ³•ã€‚ ä¸ç‰¹å®šç¤¾äº¤ç½‘ç»œç›¸åŒ¹é…çš„å­ç±»å°†æ ¹æ®ç¤¾äº¤ç½‘ç»œæ‰€æä¾›çš„ API æ¥å®ç°è¿™äº›æ­¥éª¤ã€‚</p><p><strong>networks</strong></p><p><strong>networks/Network.java:</strong> åŸºç¡€ç¤¾äº¤ç½‘ç»œç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.template_method.example.networks;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Base class of social network.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Network</span> </span>&#123;</span><br><span class="line">    String userName;</span><br><span class="line">    String password;</span><br><span class="line"></span><br><span class="line">    Network() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Publish the data to whatever network.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Authenticate before posting. Every network uses a different</span></span><br><span class="line">        <span class="comment">// authentication method.</span></span><br><span class="line">        <span class="keyword">if</span> (logIn(<span class="keyword">this</span>.userName, <span class="keyword">this</span>.password)) &#123;</span><br><span class="line">            <span class="comment">// Send the post data.</span></span><br><span class="line">            <span class="keyword">boolean</span> result =  sendData(message.getBytes());</span><br><span class="line">            logOut();</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">logIn</span><span class="params">(String userName, String password)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">sendData</span><span class="params">(<span class="keyword">byte</span>[] data)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">logOut</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>networks/Facebook.java:</strong> å…·ä½“ç¤¾äº¤ç½‘ç»œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.template_method.example.networks;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Class of social network</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Facebook</span> <span class="keyword">extends</span> <span class="title">Network</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Facebook</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">logIn</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\nChecking user&#x27;s parameters&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Name: &quot;</span> + <span class="keyword">this</span>.userName);</span><br><span class="line">        System.out.print(<span class="string">&quot;Password: &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.password.length(); i++) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        simulateNetworkLatency();</span><br><span class="line">        System.out.println(<span class="string">&quot;\n\nLogIn success on Facebook&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendData</span><span class="params">(<span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> messagePosted = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (messagePosted) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Message: &#x27;&quot;</span> + <span class="keyword">new</span> String(data) + <span class="string">&quot;&#x27; was posted on Facebook&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logOut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;User: &#x27;&quot;</span> + userName + <span class="string">&quot;&#x27; was logged out from Facebook&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">simulateNetworkLatency</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            System.out.println();</span><br><span class="line">            <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>networks/Twitter.java:</strong> å¦ä¸€ä¸ªç¤¾äº¤ç½‘ç»œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.template_method.example.networks;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Class of social network</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Twitter</span> <span class="keyword">extends</span> <span class="title">Network</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Twitter</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">logIn</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\nChecking user&#x27;s parameters&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Name: &quot;</span> + <span class="keyword">this</span>.userName);</span><br><span class="line">        System.out.print(<span class="string">&quot;Password: &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.password.length(); i++) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        simulateNetworkLatency();</span><br><span class="line">        System.out.println(<span class="string">&quot;\n\nLogIn success on Twitter&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendData</span><span class="params">(<span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> messagePosted = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (messagePosted) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Message: &#x27;&quot;</span> + <span class="keyword">new</span> String(data) + <span class="string">&quot;&#x27; was posted on Twitter&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logOut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;User: &#x27;&quot;</span> + userName + <span class="string">&quot;&#x27; was logged out from Twitter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">simulateNetworkLatency</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            System.out.println();</span><br><span class="line">            <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Demo.java:</strong> å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.template_method.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.template_method.example.networks.Facebook;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.template_method.example.networks.Network;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.template_method.example.networks.Twitter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demo class. Everything comes together here.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">        Network network = <span class="keyword">null</span>;</span><br><span class="line">        System.out.print(<span class="string">&quot;Input user name: &quot;</span>);</span><br><span class="line">        String userName = reader.readLine();</span><br><span class="line">        System.out.print(<span class="string">&quot;Input password: &quot;</span>);</span><br><span class="line">        String password = reader.readLine();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Enter the message.</span></span><br><span class="line">        System.out.print(<span class="string">&quot;Input message: &quot;</span>);</span><br><span class="line">        String message = reader.readLine();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\nChoose social network for posting message.\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;1 - Facebook\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;2 - Twitter&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> choice = Integer.parseInt(reader.readLine());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create proper network object and send the message.</span></span><br><span class="line">        <span class="keyword">if</span> (choice == <span class="number">1</span>) &#123;</span><br><span class="line">            network = <span class="keyword">new</span> Facebook(userName, password);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (choice == <span class="number">2</span>) &#123;</span><br><span class="line">            network = <span class="keyword">new</span> Twitter(userName, password);</span><br><span class="line">        &#125;</span><br><span class="line">        network.post(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>OutputDemo.png:</strong>  æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Input user name: Jhonatan</span><br><span class="line">Input password: qswe</span><br><span class="line">Input message: Hello, World!</span><br><span class="line"></span><br><span class="line">Choose social network for posting message.</span><br><span class="line">1 - Facebook</span><br><span class="line">2 - Twitter</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">Checking user&#39;s parameters</span><br><span class="line">Name: Jhonatan</span><br><span class="line">Password: ****</span><br><span class="line">..........</span><br><span class="line"></span><br><span class="line">LogIn success on Twitter</span><br><span class="line">Message: &#39;Hello, World!&#39; was posted on Twitter</span><br><span class="line">User: &#39;Jhonatan&#39; was logged out from Twitter</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-4"><p><strong>åœ¨ PHP ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼åœ¨ PHP æ¡†æ¶ä¸­å¾ˆå¸¸è§ã€‚ è¯¥æ¨¡å¼ç®€åŒ–äº†é€šè¿‡ç±»ç»§æ‰¿å¯¹é»˜è®¤æ¡†æ¶è¡Œä¸ºè¿›è¡Œæ‰©å±•æ—¶çš„å·¥ä½œã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•å¯ä»¥é€šè¿‡è¡Œä¸ºæ–¹æ³•æ¥è¯†åˆ«ï¼Œ è¯¥æ–¹æ³•å·²æœ‰ä¸€ä¸ªåœ¨åŸºç±»ä¸­å®šä¹‰çš„ â€œé»˜è®¤â€ è¡Œä¸ºã€‚</p><div class="tabs" id="php"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#php-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#php-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="php-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>æ¨¡ç‰ˆæ–¹æ³•</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ PHP åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>index.php:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru</span>\<span class="title">TemplateMethod</span>\<span class="title">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Abstract Class defines a template method that contains a skeleton of some</span></span><br><span class="line"><span class="comment"> * algorithm, composed of calls to (usually) abstract primitive operations.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Concrete subclasses should implement these operations, but leave the template</span></span><br><span class="line"><span class="comment"> * method itself intact.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The template method defines the skeleton of an algorithm.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">templateMethod</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;baseOperation1();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;requiredOperations1();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;baseOperation2();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hook1();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;requiredOperation2();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;baseOperation3();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hook2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * These operations already have implementations.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">baseOperation1</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;AbstractClass says: I am doing the bulk of the work\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">baseOperation2</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;AbstractClass says: But I let subclasses override some operations\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">baseOperation3</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;AbstractClass says: But I am doing the bulk of the work anyway\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * These operations have to be implemented in subclasses.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">requiredOperations1</span>(<span class="params"></span>): <span class="title">void</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">requiredOperation2</span>(<span class="params"></span>): <span class="title">void</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * These are &quot;hooks.&quot; Subclasses may override them, but it&#x27;s not mandatory</span></span><br><span class="line"><span class="comment">     * since the hooks already have default (but empty) implementation. Hooks</span></span><br><span class="line"><span class="comment">     * provide additional extension points in some crucial places of the</span></span><br><span class="line"><span class="comment">     * algorithm.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">hook1</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">hook2</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete classes have to implement all abstract operations of the base class.</span></span><br><span class="line"><span class="comment"> * They can also override some operations with a default implementation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass1</span> <span class="keyword">extends</span> <span class="title">AbstractClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">requiredOperations1</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteClass1 says: Implemented Operation1\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">requiredOperation2</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteClass1 says: Implemented Operation2\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Usually, concrete classes override only a fraction of base class&#x27; operations.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass2</span> <span class="keyword">extends</span> <span class="title">AbstractClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">requiredOperations1</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteClass2 says: Implemented Operation1\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">requiredOperation2</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteClass2 says: Implemented Operation2\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">hook1</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteClass2 says: Overridden Hook1\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code calls the template method to execute the algorithm. Client</span></span><br><span class="line"><span class="comment"> * code does not have to know the concrete class of an object it works with, as</span></span><br><span class="line"><span class="comment"> * long as it works with objects through the interface of their base class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clientCode</span>(<span class="params">AbstractClass $class</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    $class-&gt;templateMethod();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Same client code can work with different subclasses:\n&quot;</span>;</span><br><span class="line">clientCode(<span class="keyword">new</span> ConcreteClass1());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Same client code can work with different subclasses:\n&quot;</span>;</span><br><span class="line">clientCode(<span class="keyword">new</span> ConcreteClass2());</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing bulk of the work</span><br><span class="line">ConcreteClass1 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses to override some operations</span><br><span class="line">ConcreteClass1 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing bulk of the work anyway</span><br><span class="line"></span><br><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing bulk of the work</span><br><span class="line">ConcreteClass2 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses to override some operations</span><br><span class="line">ConcreteClass2 says: Overridden Hook1</span><br><span class="line">ConcreteClass2 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing bulk of the work anyway</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="php-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ <strong>æ¨¡ç‰ˆæ–¹æ³•</strong>æ¨¡å¼å®šä¹‰äº†åœ¨ç¤¾äº¤ç½‘ç»œä¸Šå‘å¸ƒæ¶ˆæ¯çš„ç®—æ³•æ¡†æ¶ã€‚ æ¯ä¸ªå­ç±»éƒ½ä»£è¡¨ä¸€ä¸ªä¸åŒçš„ç¤¾äº¤ç½‘ç»œï¼Œ å®ƒä»¬è™½ä»¥ä¸åŒæ–¹å¼å®ç°æ‰€æœ‰æ­¥éª¤ï¼Œ ä½†å´ä¼šå¤ç”¨åŸºæœ¬çš„ç®—æ³•ã€‚</p><p><strong>index.php:</strong> çœŸå®ä¸–ç•Œç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">namespace RefactoringGuru\TemplateMethod\RealWorld;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Abstract Class defines the template method and declares all its steps.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SocialNetwork</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">__construct</span><span class="params">(string $username, string $password)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;username = $username;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The actual template method calls abstract steps in a specific order. A</span></span><br><span class="line"><span class="comment">     * subclass may implement all of the steps, allowing this method to actually</span></span><br><span class="line"><span class="comment">     * post something to a social network.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">post</span><span class="params">(string $message)</span>: bool</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Authenticate before posting. Every network uses a different</span></span><br><span class="line">        <span class="comment">// authentication method.</span></span><br><span class="line">        <span class="keyword">if</span> ($<span class="keyword">this</span>-&gt;logIn($<span class="keyword">this</span>-&gt;username, $<span class="keyword">this</span>-&gt;password)) &#123;</span><br><span class="line">            <span class="comment">// Send the post data. All networks have different APIs.</span></span><br><span class="line">            $result = $<span class="keyword">this</span>-&gt;sendData($message);</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            $<span class="keyword">this</span>-&gt;logOut();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The steps are declared abstract to force the subclasses to implement them</span></span><br><span class="line"><span class="comment">     * all.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> function <span class="title">logIn</span><span class="params">(string $userName, string $password)</span>: bool</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> function <span class="title">sendData</span><span class="params">(string $message)</span>: bool</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> function <span class="title">logOut</span><span class="params">()</span>: <span class="keyword">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Class implements the Facebook API (all right, it pretends to).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Facebook</span> <span class="keyword">extends</span> <span class="title">SocialNetwork</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">logIn</span><span class="params">(string $userName, string $password)</span>: bool</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        echo <span class="string">&quot;\nChecking user&#x27;s credentials...\n&quot;</span>;</span><br><span class="line">        echo <span class="string">&quot;Name: &quot;</span> . $<span class="keyword">this</span>-&gt;username . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        echo <span class="string">&quot;Password: &quot;</span> . str_repeat(<span class="string">&quot;*&quot;</span>, strlen($<span class="keyword">this</span>-&gt;password)) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        simulateNetworkLatency();</span><br><span class="line"></span><br><span class="line">        echo <span class="string">&quot;\n\nFacebook: &#x27;&quot;</span> . $<span class="keyword">this</span>-&gt;username . <span class="string">&quot;&#x27; has logged in successfully.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">sendData</span><span class="params">(string $message)</span>: bool</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        echo <span class="string">&quot;Facebook: &#x27;&quot;</span> . $<span class="keyword">this</span>-&gt;username . <span class="string">&quot;&#x27; has posted &#x27;&quot;</span> . $message . <span class="string">&quot;&#x27;.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">logOut</span><span class="params">()</span>: <span class="keyword">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        echo <span class="string">&quot;Facebook: &#x27;&quot;</span> . $<span class="keyword">this</span>-&gt;username . <span class="string">&quot;&#x27; has been logged out.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Class implements the Twitter API.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Twitter</span> <span class="keyword">extends</span> <span class="title">SocialNetwork</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">logIn</span><span class="params">(string $userName, string $password)</span>: bool</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        echo <span class="string">&quot;\nChecking user&#x27;s credentials...\n&quot;</span>;</span><br><span class="line">        echo <span class="string">&quot;Name: &quot;</span> . $<span class="keyword">this</span>-&gt;username . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        echo <span class="string">&quot;Password: &quot;</span> . str_repeat(<span class="string">&quot;*&quot;</span>, strlen($<span class="keyword">this</span>-&gt;password)) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        simulateNetworkLatency();</span><br><span class="line"></span><br><span class="line">        echo <span class="string">&quot;\n\nTwitter: &#x27;&quot;</span> . $<span class="keyword">this</span>-&gt;username . <span class="string">&quot;&#x27; has logged in successfully.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">sendData</span><span class="params">(string $message)</span>: bool</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        echo <span class="string">&quot;Twitter: &#x27;&quot;</span> . $<span class="keyword">this</span>-&gt;username . <span class="string">&quot;&#x27; has posted &#x27;&quot;</span> . $message . <span class="string">&quot;&#x27;.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> function <span class="title">logOut</span><span class="params">()</span>: <span class="keyword">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        echo <span class="string">&quot;Twitter: &#x27;&quot;</span> . $<span class="keyword">this</span>-&gt;username . <span class="string">&quot;&#x27; has been logged out.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A little helper function that makes waiting times feel real.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">function <span class="title">simulateNetworkLatency</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ($i &lt; <span class="number">5</span>) &#123;</span><br><span class="line">        echo <span class="string">&quot;.&quot;</span>;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">echo <span class="string">&quot;Username: \n&quot;</span>;</span><br><span class="line">$username = readline();</span><br><span class="line">echo <span class="string">&quot;Password: \n&quot;</span>;</span><br><span class="line">$password = readline();</span><br><span class="line">echo <span class="string">&quot;Message: \n&quot;</span>;</span><br><span class="line">$message = readline();</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;\nChoose the social network to post the message:\n&quot;</span> .</span><br><span class="line">    <span class="string">&quot;1 - Facebook\n&quot;</span> .</span><br><span class="line">    <span class="string">&quot;2 - Twitter\n&quot;</span>;</span><br><span class="line">$choice = readline();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Now, let&#x27;s create a proper social network object and send the message.</span></span><br><span class="line"><span class="keyword">if</span> ($choice == <span class="number">1</span>) &#123;</span><br><span class="line">    $network = <span class="keyword">new</span> Facebook($username, $password);</span><br><span class="line">&#125; elseif ($choice == <span class="number">2</span>) &#123;</span><br><span class="line">    $network = <span class="keyword">new</span> Twitter($username, $password);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    die(<span class="string">&quot;Sorry, I&#x27;m not sure what you mean by that.\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$network-&gt;post($message);</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Username:</span><br><span class="line">&gt; neo</span><br><span class="line">Password:</span><br><span class="line">&gt; 123123</span><br><span class="line">Message:</span><br><span class="line">&gt; What is the Matrix?</span><br><span class="line"></span><br><span class="line">Choose the social network to post the message:</span><br><span class="line">1 - Facebook</span><br><span class="line">2 - Twitter</span><br><span class="line">&gt; 1</span><br><span class="line"></span><br><span class="line">Checking user&#39;s credentials...</span><br><span class="line">Name: neo</span><br><span class="line">Password: ******</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">Facebook: &#39;neo&#39; has logged in successfully.</span><br><span class="line">Facebook: &#39;neo&#39; has posted &#39;What is the Matrix?&#39;.</span><br><span class="line">Facebook: &#39;neo&#39; has been logged out.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-5"><p><strong>åœ¨ Python ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼åœ¨ Python æ¡†æ¶ä¸­å¾ˆå¸¸è§ã€‚ å¼€å‘è€…é€šå¸¸ä½¿ç”¨å®ƒæ¥å‘æ¡†æ¶ç”¨æˆ·æä¾›é€šè¿‡ç»§æ‰¿å®ç°çš„ã€ å¯¹æ ‡å‡†åŠŸèƒ½è¿›è¡Œæ‰©å±•çš„ç®€å•æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•å¯ä»¥é€šè¿‡è¡Œä¸ºæ–¹æ³•æ¥è¯†åˆ«ï¼Œ è¯¥æ–¹æ³•å·²æœ‰ä¸€ä¸ªåœ¨åŸºç±»ä¸­å®šä¹‰çš„ â€œé»˜è®¤â€ è¡Œä¸ºã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>æ¨¡æ¿æ–¹æ³•</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.py:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractClass</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Abstract Class defines a template method that contains a skeleton of</span></span><br><span class="line"><span class="string">    some algorithm, composed of calls to (usually) abstract primitive</span></span><br><span class="line"><span class="string">    operations.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Concrete subclasses should implement these operations, but leave the</span></span><br><span class="line"><span class="string">    template method itself intact.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">template_method</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The template method defines the skeleton of an algorithm.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        self.base_operation1()</span><br><span class="line">        self.required_operations1()</span><br><span class="line">        self.base_operation2()</span><br><span class="line">        self.hook1()</span><br><span class="line">        self.required_operations2()</span><br><span class="line">        self.base_operation3()</span><br><span class="line">        self.hook2()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># These operations already have implementations.</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">base_operation1</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;AbstractClass says: I am doing the bulk of the work&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">base_operation2</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;AbstractClass says: But I let subclasses override some operations&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">base_operation3</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;AbstractClass says: But I am doing the bulk of the work anyway&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># These operations have to be implemented in subclasses.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">required_operations1</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">required_operations2</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># These are &quot;hooks.&quot; Subclasses may override them, but it&#x27;s not mandatory</span></span><br><span class="line">    <span class="comment"># since the hooks already have default (but empty) implementation. Hooks</span></span><br><span class="line">    <span class="comment"># provide additional extension points in some crucial places of the</span></span><br><span class="line">    <span class="comment"># algorithm.</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hook1</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hook2</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass1</span>(<span class="params">AbstractClass</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete classes have to implement all abstract operations of the base</span></span><br><span class="line"><span class="string">    class. They can also override some operations with a default implementation.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">required_operations1</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;ConcreteClass1 says: Implemented Operation1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">required_operations2</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;ConcreteClass1 says: Implemented Operation2&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass2</span>(<span class="params">AbstractClass</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Usually, concrete classes override only a fraction of base class&#x27;</span></span><br><span class="line"><span class="string">    operations.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">required_operations1</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;ConcreteClass2 says: Implemented Operation1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">required_operations2</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;ConcreteClass2 says: Implemented Operation2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hook1</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;ConcreteClass2 says: Overridden Hook1&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client_code</span>(<span class="params">abstract_class: AbstractClass</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code calls the template method to execute the algorithm. Client</span></span><br><span class="line"><span class="string">    code does not have to know the concrete class of an object it works with, as</span></span><br><span class="line"><span class="string">    long as it works with objects through the interface of their base class.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    abstract_class.template_method()</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    print(<span class="string">&quot;Same client code can work with different subclasses:&quot;</span>)</span><br><span class="line">    client_code(ConcreteClass1())</span><br><span class="line">    print(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;Same client code can work with different subclasses:&quot;</span>)</span><br><span class="line">    client_code(ConcreteClass2())</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass1 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass1 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br><span class="line"></span><br><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass2 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass2 says: Overridden Hook1</span><br><span class="line">ConcreteClass2 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-6"><p><strong>åœ¨ Ruby ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼åœ¨ Ruby æ¡†æ¶ä¸­å¾ˆå¸¸è§ã€‚ å¼€å‘è€…é€šå¸¸ä½¿ç”¨å®ƒæ¥å‘æ¡†æ¶ç”¨æˆ·æä¾›é€šè¿‡ç»§æ‰¿å®ç°çš„ã€ å¯¹æ ‡å‡†åŠŸèƒ½è¿›è¡Œæ‰©å±•çš„ç®€å•æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•å¯ä»¥é€šè¿‡è¡Œä¸ºæ–¹æ³•æ¥è¯†åˆ«ï¼Œ è¯¥æ–¹æ³•å·²æœ‰ä¸€ä¸ªåœ¨åŸºç±»ä¸­å®šä¹‰çš„ â€œé»˜è®¤â€ è¡Œä¸ºã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>æ¨¡æ¿æ–¹æ³•</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.rb:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The Abstract Class defines a template method that contains a skeleton of some</span></span><br><span class="line"><span class="comment"># algorithm, composed of calls to (usually) abstract primitive operations.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Concrete subclasses should implement these operations, but leave the template</span></span><br><span class="line"><span class="comment"># method itself intact.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractClass</span></span></span><br><span class="line">  <span class="comment"># The template method defines the skeleton of an algorithm.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">template_method</span></span></span><br><span class="line">    base_operation1</span><br><span class="line">    required_operations1</span><br><span class="line">    base_operation2</span><br><span class="line">    hook1</span><br><span class="line">    required_operations2</span><br><span class="line">    base_operation3</span><br><span class="line">    hook2</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># These operations already have implementations.</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">base_operation1</span></span></span><br><span class="line">    puts <span class="string">&#x27;AbstractClass says: I am doing the bulk of the work&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">base_operation2</span></span></span><br><span class="line">    puts <span class="string">&#x27;AbstractClass says: But I let subclasses override some operations&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">base_operation3</span></span></span><br><span class="line">    puts <span class="string">&#x27;AbstractClass says: But I am doing the bulk of the work anyway&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># These operations have to be implemented in subclasses.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">required_operations1</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">required_operations2</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># These are &quot;hooks.&quot; Subclasses may override them, but it&#x27;s not mandatory</span></span><br><span class="line">  <span class="comment"># since the hooks already have default (but empty) implementation. Hooks</span></span><br><span class="line">  <span class="comment"># provide additional extension points in some crucial places of the algorithm.</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hook1</span>;</span> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hook2</span>;</span> <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concrete classes have to implement all abstract operations of the base class.</span></span><br><span class="line"><span class="comment"># They can also override some operations with a default implementation.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass1</span> &lt; AbstractClass</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">required_operations1</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteClass1 says: Implemented Operation1&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">required_operations2</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteClass1 says: Implemented Operation2&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Usually, concrete classes override only a fraction of base class&#x27; operations.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass2</span> &lt; AbstractClass</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">required_operations1</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteClass2 says: Implemented Operation1&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">required_operations2</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteClass2 says: Implemented Operation2&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hook1</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteClass2 says: Overridden Hook1&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code calls the template method to execute the algorithm. Client</span></span><br><span class="line"><span class="comment"># code does not have to know the concrete class of an object it works with, as</span></span><br><span class="line"><span class="comment"># long as it works with objects through the interface of their base class.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client_code</span><span class="params">(abstract_class)</span></span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  abstract_class.template_method</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">&#x27;Same client code can work with different subclasses:&#x27;</span></span><br><span class="line">client_code(ConcreteClass1.new)</span><br><span class="line">puts <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">&#x27;Same client code can work with different subclasses:&#x27;</span></span><br><span class="line">client_code(ConcreteClass2.new)</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass1 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass1 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br><span class="line"></span><br><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass2 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass2 says: Overridden Hook1</span><br><span class="line">ConcreteClass2 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-7"><p><strong>åœ¨ Swift ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼åœ¨ Swift æ¡†æ¶ä¸­å¾ˆå¸¸è§ã€‚ å¼€å‘è€…é€šå¸¸ä½¿ç”¨å®ƒæ¥å‘æ¡†æ¶ç”¨æˆ·æä¾›é€šè¿‡ç»§æ‰¿å®ç°çš„ã€ å¯¹æ ‡å‡†åŠŸèƒ½è¿›è¡Œæ‰©å±•çš„ç®€å•æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•å¯ä»¥é€šè¿‡è¡Œä¸ºæ–¹æ³•æ¥è¯†åˆ«ï¼Œ è¯¥æ–¹æ³•å·²æœ‰ä¸€ä¸ªåœ¨åŸºç±»ä¸­å®šä¹‰çš„ â€œé»˜è®¤â€ è¡Œä¸ºã€‚</p><div class="tabs" id="swift"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#swift-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#swift-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="swift-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>æ¨¡ç‰ˆæ–¹æ³•</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ Swift åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>Example.swift:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Abstract Protocol and its extension defines a template method that</span></span><br><span class="line"><span class="comment">/// contains a skeleton of some algorithm, composed of calls to (usually)</span></span><br><span class="line"><span class="comment">/// abstract primitive operations.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Concrete subclasses should implement these operations, but leave the</span></span><br><span class="line"><span class="comment">/// template method itself intact.</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">AbstractProtocol</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The template method defines the skeleton of an algorithm.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">templateMethod</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// These operations already have implementations.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">baseOperation1</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">baseOperation2</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">baseOperation3</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// These operations have to be implemented in subclasses.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requiredOperations1</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requiredOperation2</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// These are &quot;hooks.&quot; Subclasses may override them, but it&#x27;s not mandatory</span></span><br><span class="line">    <span class="comment">/// since the hooks already have default (but empty) implementation. Hooks</span></span><br><span class="line">    <span class="comment">/// provide additional extension points in some crucial places of the</span></span><br><span class="line">    <span class="comment">/// algorithm.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hook1</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hook2</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AbstractProtocol</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">templateMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">        baseOperation1()</span><br><span class="line">        requiredOperations1()</span><br><span class="line">        baseOperation2()</span><br><span class="line">        hook1()</span><br><span class="line">        requiredOperation2()</span><br><span class="line">        baseOperation3()</span><br><span class="line">        hook2()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// These operations already have implementations.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">baseOperation1</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;AbstractProtocol says: I am doing the bulk of the work\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">baseOperation2</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;AbstractProtocol says: But I let subclasses override some operations\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">baseOperation3</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;AbstractProtocol says: But I am doing the bulk of the work anyway\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hook1</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hook2</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Concrete classes have to implement all abstract operations of the base</span></span><br><span class="line"><span class="comment">/// class. They can also override some operations with a default implementation.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass1</span>: <span class="title">AbstractProtocol</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requiredOperations1</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteClass1 says: Implemented Operation1\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requiredOperation2</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteClass1 says: Implemented Operation2\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hook2</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteClass1 says: Overridden Hook2\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Usually, concrete classes override only a fraction of base class&#x27;</span></span><br><span class="line"><span class="comment">/// operations.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass2</span>: <span class="title">AbstractProtocol</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requiredOperations1</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteClass2 says: Implemented Operation1\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requiredOperation2</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteClass2 says: Implemented Operation2\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hook1</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteClass2 says: Overridden Hook1\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The client code calls the template method to execute the algorithm. Client</span></span><br><span class="line"><span class="comment">/// code does not have to know the concrete class of an object it works with, as</span></span><br><span class="line"><span class="comment">/// long as it works with objects through the interface of their base class.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">clientCode</span><span class="params">(use object: AbstractProtocol)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        object.templateMethod()</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all works together.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TemplateMethodConceptual</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Same client code can work with different subclasses:\n&quot;</span>)</span><br><span class="line">        <span class="type">Client</span>.clientCode(use: <span class="type">ConcreteClass1</span>())</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nSame client code can work with different subclasses:\n&quot;</span>)</span><br><span class="line">        <span class="type">Client</span>.clientCode(use: <span class="type">ConcreteClass2</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Same client code can work with different subclasses:</span><br><span class="line"></span><br><span class="line">AbstractProtocol says: I am doing the bulk of the work</span><br><span class="line"></span><br><span class="line">ConcreteClass1 says: Implemented Operation1</span><br><span class="line"></span><br><span class="line">AbstractProtocol says: But I let subclasses override some operations</span><br><span class="line"></span><br><span class="line">ConcreteClass1 says: Implemented Operation2</span><br><span class="line"></span><br><span class="line">AbstractProtocol says: But I am doing the bulk of the work anyway</span><br><span class="line"></span><br><span class="line">ConcreteClass1 says: Overridden Hook2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Same client code can work with different subclasses:</span><br><span class="line"></span><br><span class="line">AbstractProtocol says: I am doing the bulk of the work</span><br><span class="line"></span><br><span class="line">ConcreteClass2 says: Implemented Operation1</span><br><span class="line"></span><br><span class="line">AbstractProtocol says: But I let subclasses override some operations</span><br><span class="line"></span><br><span class="line">ConcreteClass2 says: Overridden Hook1</span><br><span class="line"></span><br><span class="line">ConcreteClass2 says: Implemented Operation2</span><br><span class="line"></span><br><span class="line">AbstractProtocol says: But I am doing the bulk of the work anyway</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="swift-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p><strong>Example.swift:</strong> çœŸå®ä¸–ç•Œç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"><span class="keyword">import</span> Photos</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TemplateMethodRealWorld</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// A good example of Template Method is a life cycle of UIViewController</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testTemplateMethodReal</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> accessors = [<span class="type">CameraAccessor</span>(), <span class="type">MicrophoneAccessor</span>(), <span class="type">PhotoLibraryAccessor</span>()]</span><br><span class="line"></span><br><span class="line">        accessors.forEach &#123; item <span class="keyword">in</span></span><br><span class="line">            item.requestAccessIfNeeded(&#123; status <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> message = status ? <span class="string">&quot;You have access to &quot;</span> : <span class="string">&quot;You do not have access to &quot;</span></span><br><span class="line">                <span class="built_in">print</span>(message + item.description + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PermissionAccessor</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Completion</span> = (<span class="type">Bool</span>) -&gt; ()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestAccessIfNeeded</span><span class="params">(<span class="number">_</span> completion: @escaping Completion)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> !hasAccess() <span class="keyword">else</span> &#123; completion(<span class="literal">true</span>); <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">        willReceiveAccess()</span><br><span class="line"></span><br><span class="line">        requestAccess &#123; status <span class="keyword">in</span></span><br><span class="line">            status ? <span class="keyword">self</span>.didReceiveAccess() : <span class="keyword">self</span>.didRejectAccess()</span><br><span class="line"></span><br><span class="line">            completion(status)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestAccess</span><span class="params">(<span class="number">_</span> completion: @escaping Completion)</span></span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">&quot;Should be overridden&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hasAccess</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">&quot;Should be overridden&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;PermissionAccessor&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Hooks</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">willReceiveAccess</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">didReceiveAccess</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">didRejectAccess</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CameraAccessor</span>: <span class="title">PermissionAccessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">requestAccess</span><span class="params">(<span class="number">_</span> completion: @escaping Completion)</span></span> &#123;</span><br><span class="line">        <span class="type">AVCaptureDevice</span>.requestAccess(<span class="keyword">for</span>: .video) &#123; status <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> completion(status)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hasAccess</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AVCaptureDevice</span>.authorizationStatus(<span class="keyword">for</span>: .video) == .authorized</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Camera&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MicrophoneAccessor</span>: <span class="title">PermissionAccessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">requestAccess</span><span class="params">(<span class="number">_</span> completion: @escaping Completion)</span></span> &#123;</span><br><span class="line">        <span class="type">AVAudioSession</span>.sharedInstance().requestRecordPermission &#123; status <span class="keyword">in</span></span><br><span class="line">            completion(status)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hasAccess</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AVAudioSession</span>.sharedInstance().recordPermission == .granted</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Microphone&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhotoLibraryAccessor</span>: <span class="title">PermissionAccessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">requestAccess</span><span class="params">(<span class="number">_</span> completion: @escaping Completion)</span></span> &#123;</span><br><span class="line">        <span class="type">PHPhotoLibrary</span>.requestAuthorization &#123; status <span class="keyword">in</span></span><br><span class="line">            completion(status == .authorized)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hasAccess</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">PHPhotoLibrary</span>.authorizationStatus() == .authorized</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;PhotoLibrary&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveAccess</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/// We want to track how many people give access to the PhotoLibrary.</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;PhotoLibrary Accessor: Receive access. Updating analytics...&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didRejectAccess</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/// ... and also we want to track how many people rejected access.</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;PhotoLibrary Accessor: Rejected with access. Updating analytics...&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">You have access to Camera</span><br><span class="line"></span><br><span class="line">You have access to Microphone</span><br><span class="line"></span><br><span class="line">PhotoLibrary Accessor: Rejected with access. Updating analytics...</span><br><span class="line">You do not have access to PhotoLibrary</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-8"><p><strong>åœ¨ TypeScript ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼åœ¨ TypeScript æ¡†æ¶ä¸­å¾ˆå¸¸è§ã€‚ å¼€å‘è€…é€šå¸¸ä½¿ç”¨å®ƒæ¥å‘æ¡†æ¶ç”¨æˆ·æä¾›é€šè¿‡ç»§æ‰¿å®ç°çš„ã€ å¯¹æ ‡å‡†åŠŸèƒ½è¿›è¡Œæ‰©å±•çš„ç®€å•æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> æ¨¡ç‰ˆæ–¹æ³•å¯ä»¥é€šè¿‡è¡Œä¸ºæ–¹æ³•æ¥è¯†åˆ«ï¼Œ è¯¥æ–¹æ³•å·²æœ‰ä¸€ä¸ªåœ¨åŸºç±»ä¸­å®šä¹‰çš„ â€œé»˜è®¤â€ è¡Œä¸ºã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>æ¨¡ç‰ˆæ–¹æ³•</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>index.ts:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Abstract Class defines a template method that contains a skeleton of some</span></span><br><span class="line"><span class="comment"> * algorithm, composed of calls to (usually) abstract primitive operations.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Concrete subclasses should implement these operations, but leave the template</span></span><br><span class="line"><span class="comment"> * method itself intact.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The template method defines the skeleton of an algorithm.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> templateMethod(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.baseOperation1();</span><br><span class="line">        <span class="built_in">this</span>.requiredOperations1();</span><br><span class="line">        <span class="built_in">this</span>.baseOperation2();</span><br><span class="line">        <span class="built_in">this</span>.hook1();</span><br><span class="line">        <span class="built_in">this</span>.requiredOperation2();</span><br><span class="line">        <span class="built_in">this</span>.baseOperation3();</span><br><span class="line">        <span class="built_in">this</span>.hook2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * These operations already have implementations.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> baseOperation1(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;AbstractClass says: I am doing the bulk of the work&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> baseOperation2(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;AbstractClass says: But I let subclasses override some operations&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> baseOperation3(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;AbstractClass says: But I am doing the bulk of the work anyway&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * These operations have to be implemented in subclasses.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> requiredOperations1(): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> requiredOperation2(): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * These are &quot;hooks.&quot; Subclasses may override them, but it&#x27;s not mandatory</span></span><br><span class="line"><span class="comment">     * since the hooks already have default (but empty) implementation. Hooks</span></span><br><span class="line"><span class="comment">     * provide additional extension points in some crucial places of the</span></span><br><span class="line"><span class="comment">     * algorithm.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> hook1(): <span class="built_in">void</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> hook2(): <span class="built_in">void</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete classes have to implement all abstract operations of the base class.</span></span><br><span class="line"><span class="comment"> * They can also override some operations with a default implementation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass1</span> <span class="keyword">extends</span> <span class="title">AbstractClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> requiredOperations1(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteClass1 says: Implemented Operation1&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> requiredOperation2(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteClass1 says: Implemented Operation2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Usually, concrete classes override only a fraction of base class&#x27; operations.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass2</span> <span class="keyword">extends</span> <span class="title">AbstractClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> requiredOperations1(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteClass2 says: Implemented Operation1&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> requiredOperation2(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteClass2 says: Implemented Operation2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> hook1(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteClass2 says: Overridden Hook1&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code calls the template method to execute the algorithm. Client</span></span><br><span class="line"><span class="comment"> * code does not have to know the concrete class of an object it works with, as</span></span><br><span class="line"><span class="comment"> * long as it works with objects through the interface of their base class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clientCode</span>(<span class="params">abstractClass: AbstractClass</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    abstractClass.templateMethod();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Same client code can work with different subclasses:&#x27;</span>);</span><br><span class="line">clientCode(<span class="keyword">new</span> ConcreteClass1());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Same client code can work with different subclasses:&#x27;</span>);</span><br><span class="line">clientCode(<span class="keyword">new</span> ConcreteClass2());</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass1 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass1 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br><span class="line"></span><br><span class="line">Same client code can work with different subclasses:</span><br><span class="line">AbstractClass says: I am doing the bulk of the work</span><br><span class="line">ConcreteClass2 says: Implemented Operation1</span><br><span class="line">AbstractClass says: But I let subclasses override some operations</span><br><span class="line">ConcreteClass2 says: Overridden Hook1</span><br><span class="line">ConcreteClass2 says: Implemented Operation2</span><br><span class="line">AbstractClass says: But I am doing the bulk of the work anyway</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-9"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>è®©æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸ªä¸€æ¬¡æ€§å¯†ç åŠŸèƒ½ ï¼ˆOTPï¼‰ çš„ä¾‹å­ã€‚ å°† OTP ä¼ é€’ç»™ç”¨æˆ·çš„æ–¹å¼å¤šç§å¤šæ · ï¼ˆçŸ­ä¿¡ã€ é‚®ä»¶ç­‰ï¼‰ã€‚ ä½†æ— è®ºæ˜¯çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶ï¼Œ æ•´ä¸ª OTP æµç¨‹éƒ½æ˜¯ç›¸åŒçš„ï¼š</p><ol><li>ç”Ÿæˆéšæœºçš„ n ä½æ•°å­—ã€‚</li><li>åœ¨ç¼“å­˜ä¸­ä¿å­˜è¿™ç»„æ•°å­—ä»¥ä¾¿è¿›è¡Œåç»­éªŒè¯ã€‚</li><li>å‡†å¤‡å†…å®¹ã€‚</li><li>å‘é€é€šçŸ¥ã€‚</li><li>å‘å¸ƒã€‚</li></ol><p>åç»­å¼•å…¥çš„ä»»ä½•æ–° OTP ç±»å‹éƒ½å¾ˆæœ‰å¯èƒ½éœ€è¦è¿›è¡Œç›¸åŒçš„ä¸Šè¿°æ­¥éª¤ã€‚</p><p>å› æ­¤ï¼Œ æˆ‘ä»¬ä¼šæœ‰è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯ï¼Œ å…¶ä¸­æŸä¸ªç‰¹å®šæ“ä½œçš„æ­¥éª¤æ˜¯ç›¸åŒçš„ï¼Œ ä½†å®ç°æ–¹å¼å´å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ è¿™æ­£æ˜¯é€‚åˆè€ƒè™‘ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æƒ…å†µã€‚</p><p>é¦–å…ˆï¼Œ æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç”±å›ºå®šæ•°é‡çš„æ–¹æ³•ç»„æˆçš„åŸºç¡€æ¨¡æ¿ç®—æ³•ã€‚ è¿™å°±æ˜¯æˆ‘ä»¬çš„æ¨¡æ¿æ–¹æ³•ã€‚ ç„¶åæˆ‘ä»¬å°†å®ç°æ¯ä¸€ä¸ªæ­¥éª¤æ–¹æ³•ï¼Œ ä½†ä¸ä¼šæ”¹å˜æ¨¡æ¿æ–¹æ³•ã€‚</p><p><strong>otp.go:</strong> æ¨¡æ¿æ–¹æ³•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> iOtp <span class="keyword">interface</span> &#123;</span><br><span class="line">    genRandomOTP(<span class="keyword">int</span>) <span class="keyword">string</span></span><br><span class="line">    saveOTPCache(<span class="keyword">string</span>)</span><br><span class="line">    getMessage(<span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">    sendNotification(<span class="keyword">string</span>) error</span><br><span class="line">    publishMetric()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// type otp struct &#123;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// func (o *otp) genAndSendOTP(iOtp iOtp, otpLength int) error &#123;</span></span><br><span class="line"><span class="comment">//  otp := iOtp.genRandomOTP(otpLength)</span></span><br><span class="line"><span class="comment">//  iOtp.saveOTPCache(otp)</span></span><br><span class="line"><span class="comment">//  message := iOtp.getMessage(otp)</span></span><br><span class="line"><span class="comment">//  err := iOtp.sendNotification(message)</span></span><br><span class="line"><span class="comment">//  if err != nil &#123;</span></span><br><span class="line"><span class="comment">//      return err</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//  iOtp.publishMetric()</span></span><br><span class="line"><span class="comment">//  return nil</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> otp <span class="keyword">struct</span> &#123;</span><br><span class="line">    iOtp iOtp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *otp)</span> <span class="title">genAndSendOTP</span><span class="params">(otpLength <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    otp := o.iOtp.genRandomOTP(otpLength)</span><br><span class="line">    o.iOtp.saveOTPCache(otp)</span><br><span class="line">    message := o.iOtp.getMessage(otp)</span><br><span class="line">    err := o.iOtp.sendNotification(message)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    o.iOtp.publishMetric()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>sms.go:</strong> å…·ä½“å®æ–½</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> sms <span class="keyword">struct</span> &#123;</span><br><span class="line">    otp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *sms)</span> <span class="title">genRandomOTP</span><span class="params">(<span class="built_in">len</span> <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    randomOTP := <span class="string">&quot;1234&quot;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;SMS: generating random otp %s\n&quot;</span>, randomOTP)</span><br><span class="line">    <span class="keyword">return</span> randomOTP</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *sms)</span> <span class="title">saveOTPCache</span><span class="params">(otp <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;SMS: saving otp: %s to cache\n&quot;</span>, otp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *sms)</span> <span class="title">getMessage</span><span class="params">(otp <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;SMS OTP for login is &quot;</span> + otp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *sms)</span> <span class="title">sendNotification</span><span class="params">(message <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;SMS: sending sms: %s\n&quot;</span>, message)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *sms)</span> <span class="title">publishMetric</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;SMS: publishing metrics\n&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>email.go:</strong> å…·ä½“å®æ–½</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> email <span class="keyword">struct</span> &#123;</span><br><span class="line">    otp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *email)</span> <span class="title">genRandomOTP</span><span class="params">(<span class="built_in">len</span> <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    randomOTP := <span class="string">&quot;1234&quot;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;EMAIL: generating random otp %s\n&quot;</span>, randomOTP)</span><br><span class="line">    <span class="keyword">return</span> randomOTP</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *email)</span> <span class="title">saveOTPCache</span><span class="params">(otp <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;EMAIL: saving otp: %s to cache\n&quot;</span>, otp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *email)</span> <span class="title">getMessage</span><span class="params">(otp <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;EMAIL OTP for login is &quot;</span> + otp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *email)</span> <span class="title">sendNotification</span><span class="params">(message <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;EMAIL: sending email: %s\n&quot;</span>, message)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *email)</span> <span class="title">publishMetric</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;EMAIL: publishing metrics\n&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>main.go:</strong> å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// otp := otp&#123;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// smsOTP := &amp;sms&#123;</span></span><br><span class="line">    <span class="comment">//  otp: otp,</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// smsOTP.genAndSendOTP(smsOTP, 4)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// emailOTP := &amp;email&#123;</span></span><br><span class="line">    <span class="comment">//  otp: otp,</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// emailOTP.genAndSendOTP(emailOTP, 4)</span></span><br><span class="line">    <span class="comment">// fmt.Scanln()</span></span><br><span class="line">    smsOTP := &amp;sms&#123;&#125;</span><br><span class="line">    o := otp&#123;</span><br><span class="line">        iOtp: smsOTP,</span><br><span class="line">    &#125;</span><br><span class="line">    o.genAndSendOTP(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    emailOTP := &amp;email&#123;&#125;</span><br><span class="line">    o = otp&#123;</span><br><span class="line">        iOtp: emailOTP,</span><br><span class="line">    &#125;</span><br><span class="line">    o.genAndSendOTP(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SMS: generating random otp 1234</span><br><span class="line">SMS: saving otp: 1234 to cache</span><br><span class="line">SMS: sending sms: SMS OTP for login is 1234</span><br><span class="line">SMS: publishing metrics</span><br><span class="line"></span><br><span class="line">EMAIL: generating random otp 1234</span><br><span class="line">EMAIL: saving otp: 1234 to cache</span><br><span class="line">EMAIL: sending email: EMAIL OTP for login is 1234</span><br><span class="line">EMAIL: publishing metrics</span><br></pre></td></tr></table></figure><p><em>æ ¹æ®ï¼š <a href="https://golangbyexample.com/template-method-design-pattern-golang/">Golang By Example</a></em></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://refactoringguru.cn/design-patterns/template-method&quot;&gt;https://refactoringguru.cn/design-patterns/template-met
      
    
    </summary>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>è¡Œä¸ºæ¨¡å¼-ç­–ç•¥æ¨¡å¼</title>
    <link href="http://wangyangyangisme.github.io/posts/6dffd2a3/"/>
    <id>http://wangyangyangisme.github.io/posts/6dffd2a3/</id>
    <published>2021-05-04T12:50:43.000Z</published>
    <updated>2021-05-04T12:50:43.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://refactoringguru.cn/design-patterns/strategy">https://refactoringguru.cn/design-patterns/strategy</a></p></blockquote><h1 id="è¡Œä¸ºæ¨¡å¼-ç­–ç•¥æ¨¡å¼"><a href="#è¡Œä¸ºæ¨¡å¼-ç­–ç•¥æ¨¡å¼" class="headerlink" title="è¡Œä¸ºæ¨¡å¼-ç­–ç•¥æ¨¡å¼"></a>è¡Œä¸ºæ¨¡å¼-ç­–ç•¥æ¨¡å¼</h1><p><strong>äº¦ç§°ï¼š</strong> Strategy</p><h2 id="æ„å›¾"><a href="#æ„å›¾" class="headerlink" title="æ„å›¾"></a>æ„å›¾</h2><p><strong>ç­–ç•¥æ¨¡å¼</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å®ƒèƒ½è®©ä½ å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œ å¹¶å°†æ¯ç§ç®—æ³•åˆ†åˆ«æ”¾å…¥ç‹¬ç«‹çš„ç±»ä¸­ï¼Œ ä»¥ä½¿ç®—æ³•çš„å¯¹è±¡èƒ½å¤Ÿç›¸äº’æ›¿æ¢ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/strategy.png" alt=""></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>ä¸€å¤©ï¼Œ ä½ æ‰“ç®—ä¸ºæ¸¸å®¢ä»¬åˆ›å»ºä¸€æ¬¾å¯¼æ¸¸ç¨‹åºã€‚ è¯¥ç¨‹åºçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯æä¾›ç¾è§‚çš„åœ°å›¾ï¼Œ ä»¥å¸®åŠ©ç”¨æˆ·åœ¨ä»»ä½•åŸå¸‚ä¸­å¿«é€Ÿå®šä½ã€‚</p><p>ç”¨æˆ·æœŸå¾…çš„ç¨‹åºæ–°åŠŸèƒ½æ˜¯è‡ªåŠ¨è·¯çº¿è§„åˆ’ï¼š ä»–ä»¬å¸Œæœ›è¾“å…¥åœ°å€åå°±èƒ½åœ¨åœ°å›¾ä¸Šçœ‹åˆ°å‰å¾€ç›®çš„åœ°çš„æœ€å¿«è·¯çº¿ã€‚</p><p>ç¨‹åºçš„é¦–ä¸ªç‰ˆæœ¬åªèƒ½è§„åˆ’å…¬è·¯è·¯çº¿ã€‚ é©¾è½¦æ—…è¡Œçš„äººä»¬å¯¹æ­¤éå¸¸æ»¡æ„ã€‚ ä½†å¾ˆæ˜¾ç„¶ï¼Œ å¹¶éæ‰€æœ‰äººéƒ½ä¼šåœ¨åº¦å‡æ—¶å¼€è½¦ã€‚ å› æ­¤ä½ åœ¨ä¸‹æ¬¡æ›´æ–°æ—¶æ·»åŠ äº†è§„åˆ’æ­¥è¡Œè·¯çº¿çš„åŠŸèƒ½ã€‚ æ­¤åï¼Œ ä½ åˆæ·»åŠ äº†è§„åˆ’å…¬å…±äº¤é€šè·¯çº¿çš„åŠŸèƒ½ã€‚</p><p>è€Œè¿™åªæ˜¯ä¸ªå¼€å§‹ã€‚ ä¸ä¹…åï¼Œ ä½ åˆè¦ä¸ºéª‘è¡Œè€…è§„åˆ’è·¯çº¿ã€‚ åˆè¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œ ä½ åˆè¦ä¸ºæ¸¸è§ˆåŸå¸‚ä¸­çš„æ‰€æœ‰æ™¯ç‚¹è§„åˆ’è·¯çº¿ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/problem-strategy.png" alt="å¯¼æ¸¸ä»£ç å°†å˜å¾—éå¸¸è‡ƒè‚¿ã€‚"></p><p>å°½ç®¡ä»å•†ä¸šè§’åº¦æ¥çœ‹ï¼Œ è¿™æ¬¾åº”ç”¨éå¸¸æˆåŠŸï¼Œ ä½†å…¶æŠ€æœ¯éƒ¨åˆ†å´è®©ä½ éå¸¸å¤´ç–¼ï¼š æ¯æ¬¡æ·»åŠ æ–°çš„è·¯çº¿è§„åˆ’ç®—æ³•åï¼Œ å¯¼æ¸¸åº”ç”¨ä¸­ä¸»è¦ç±»çš„ä½“ç§¯å°±ä¼šå¢åŠ ä¸€å€ã€‚ ç»ˆäºåœ¨æŸä¸ªæ—¶å€™ï¼Œ ä½ è§‰å¾—è‡ªå·±æ²¡æ³•ç»§ç»­ç»´æŠ¤è¿™å †ä»£ç äº†ã€‚</p><p>æ— è®ºæ˜¯ä¿®å¤ç®€å•ç¼ºé™·è¿˜æ˜¯å¾®è°ƒè¡—é“æƒé‡ï¼Œ å¯¹æŸä¸ªç®—æ³•è¿›è¡Œä»»ä½•ä¿®æ”¹éƒ½ä¼šå½±å“æ•´ä¸ªç±»ï¼Œ ä»è€Œå¢åŠ åœ¨å·²æœ‰æ­£å¸¸è¿è¡Œä»£ç ä¸­å¼•å…¥é”™è¯¯çš„é£é™©ã€‚</p><p>æ­¤å¤–ï¼Œ å›¢é˜Ÿåˆä½œå°†å˜å¾—ä½æ•ˆã€‚ å¦‚æœä½ åœ¨åº”ç”¨æˆåŠŸå‘å¸ƒåæ‹›å‹Ÿäº†å›¢é˜Ÿæˆå‘˜ï¼Œ ä»–ä»¬ä¼šæŠ±æ€¨åœ¨åˆå¹¶å†²çªçš„å·¥ä½œä¸ŠèŠ±è´¹äº†å¤ªå¤šæ—¶é—´ã€‚ åœ¨å®ç°æ–°åŠŸèƒ½çš„è¿‡ç¨‹ä¸­ï¼Œ ä½ çš„å›¢é˜Ÿéœ€è¦ä¿®æ”¹åŒä¸€ä¸ªå·¨å¤§çš„ç±»ï¼Œ è¿™æ ·ä»–ä»¬æ‰€ç¼–å†™çš„ä»£ç ç›¸äº’ä¹‹é—´å°±å¯èƒ½ä¼šå‡ºç°å†²çªã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ç­–ç•¥æ¨¡å¼å»ºè®®æ‰¾å‡ºè´Ÿè´£ç”¨è®¸å¤šä¸åŒæ–¹å¼å®Œæˆç‰¹å®šä»»åŠ¡çš„ç±»ï¼Œ ç„¶åå°†å…¶ä¸­çš„ç®—æ³•æŠ½å–åˆ°ä¸€ç»„è¢«ç§°ä¸º<em>ç­–ç•¥</em>çš„ç‹¬ç«‹ç±»ä¸­ã€‚</p><p>åä¸º<em>ä¸Šä¸‹æ–‡</em>çš„åŸå§‹ç±»å¿…é¡»åŒ…å«ä¸€ä¸ªæˆå‘˜å˜é‡æ¥å­˜å‚¨å¯¹äºæ¯ç§ç­–ç•¥çš„å¼•ç”¨ã€‚ ä¸Šä¸‹æ–‡å¹¶ä¸æ‰§è¡Œä»»åŠ¡ï¼Œ è€Œæ˜¯å°†å·¥ä½œå§”æ´¾ç»™å·²è¿æ¥çš„ç­–ç•¥å¯¹è±¡ã€‚</p><p>ä¸Šä¸‹æ–‡ä¸è´Ÿè´£é€‰æ‹©ç¬¦åˆä»»åŠ¡éœ€è¦çš„ç®—æ³•â€”â€”å®¢æˆ·ç«¯ä¼šå°†æ‰€éœ€ç­–ç•¥ä¼ é€’ç»™ä¸Šä¸‹æ–‡ã€‚ å®é™…ä¸Šï¼Œ ä¸Šä¸‹æ–‡å¹¶ä¸ååˆ†äº†è§£ç­–ç•¥ï¼Œ å®ƒä¼šé€šè¿‡åŒæ ·çš„é€šç”¨æ¥å£ä¸æ‰€æœ‰ç­–ç•¥è¿›è¡Œäº¤äº’ï¼Œ è€Œè¯¥æ¥å£åªéœ€æš´éœ²ä¸€ä¸ªæ–¹æ³•æ¥è§¦å‘æ‰€é€‰ç­–ç•¥ä¸­å°è£…çš„ç®—æ³•å³å¯ã€‚</p><p>å› æ­¤ï¼Œ ä¸Šä¸‹æ–‡å¯ç‹¬ç«‹äºå…·ä½“ç­–ç•¥ã€‚ è¿™æ ·ä½ å°±å¯åœ¨ä¸ä¿®æ”¹ä¸Šä¸‹æ–‡ä»£ç æˆ–å…¶ä»–ç­–ç•¥çš„æƒ…å†µä¸‹æ·»åŠ æ–°ç®—æ³•æˆ–ä¿®æ”¹å·²æœ‰ç®—æ³•äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/solution-strategy.png" alt="è·¯çº¿è§„åˆ’ç­–ç•¥ã€‚"></p><p>åœ¨å¯¼æ¸¸åº”ç”¨ä¸­ï¼Œ æ¯ä¸ªè·¯çº¿è§„åˆ’ç®—æ³•éƒ½å¯è¢«æŠ½å–åˆ°åªæœ‰ä¸€ä¸ª <code>buildÂ­Route</code>ç”Ÿæˆè·¯çº¿æ–¹æ³•çš„ç‹¬ç«‹ç±»ä¸­ã€‚ è¯¥æ–¹æ³•æ¥æ”¶èµ·ç‚¹å’Œç»ˆç‚¹ä½œä¸ºå‚æ•°ï¼Œ å¹¶è¿”å›è·¯çº¿ä¸­é€”ç‚¹çš„é›†åˆã€‚</p><p>å³ä½¿ä¼ é€’ç»™æ¯ä¸ªè·¯å¾„è§„åˆ’ç±»çš„å‚æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œ å…¶æ‰€åˆ›å»ºçš„è·¯çº¿ä¹Ÿå¯èƒ½å®Œå…¨ä¸åŒã€‚ ä¸»è¦å¯¼æ¸¸ç±»çš„ä¸»è¦å·¥ä½œæ˜¯åœ¨åœ°å›¾ä¸Šæ¸²æŸ“ä¸€ç³»åˆ—ä¸­é€”ç‚¹ï¼Œ ä¸ä¼šåœ¨æ„å¦‚ä½•é€‰æ‹©ç®—æ³•ã€‚ è¯¥ç±»ä¸­è¿˜æœ‰ä¸€ä¸ªç”¨äºåˆ‡æ¢å½“å‰è·¯å¾„è§„åˆ’ç­–ç•¥çš„æ–¹æ³•ï¼Œ å› æ­¤å®¢æˆ·ç«¯ ï¼ˆä¾‹å¦‚ç”¨æˆ·ç•Œé¢ä¸­çš„æŒ‰é’®ï¼‰ å¯ç”¨å…¶ä»–ç­–ç•¥æ›¿æ¢å½“å‰é€‰æ‹©çš„è·¯å¾„è§„åˆ’è¡Œä¸ºã€‚</p><h2 id="çœŸå®ä¸–ç•Œç±»æ¯”"><a href="#çœŸå®ä¸–ç•Œç±»æ¯”" class="headerlink" title="çœŸå®ä¸–ç•Œç±»æ¯”"></a>çœŸå®ä¸–ç•Œç±»æ¯”</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/strategy-comic-1-zh.png" alt="å„ç§å‰å¾€æœºåœºçš„å‡ºè¡Œç­–ç•¥"></p><p>å‡å¦‚ä½ éœ€è¦å‰å¾€æœºåœºã€‚ ä½ å¯ä»¥é€‰æ‹©ä¹˜åå…¬å…±æ±½è½¦ã€ é¢„çº¦å‡ºç§Ÿè½¦æˆ–éª‘è‡ªè¡Œè½¦ã€‚ è¿™äº›å°±æ˜¯ä½ çš„å‡ºè¡Œç­–ç•¥ã€‚ ä½ å¯ä»¥æ ¹æ®é¢„ç®—æˆ–æ—¶é—´ç­‰å› ç´ æ¥é€‰æ‹©å…¶ä¸­ä¸€ç§ç­–ç•¥ã€‚</p><h2 id="ç­–ç•¥æ¨¡å¼ç»“æ„"><a href="#ç­–ç•¥æ¨¡å¼ç»“æ„" class="headerlink" title="ç­–ç•¥æ¨¡å¼ç»“æ„"></a>ç­–ç•¥æ¨¡å¼ç»“æ„</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/structure-indexed-strategy.png" alt=""></p><ol><li><strong>ä¸Šä¸‹æ–‡</strong> ï¼ˆContextï¼‰ ç»´æŠ¤æŒ‡å‘å…·ä½“ç­–ç•¥çš„å¼•ç”¨ï¼Œ ä¸”ä»…é€šè¿‡ç­–ç•¥æ¥å£ä¸è¯¥å¯¹è±¡è¿›è¡Œäº¤æµã€‚</li><li><strong>ç­–ç•¥</strong> ï¼ˆStrategyï¼‰ æ¥å£æ˜¯æ‰€æœ‰å…·ä½“ç­–ç•¥çš„é€šç”¨æ¥å£ï¼Œ å®ƒå£°æ˜äº†ä¸€ä¸ªä¸Šä¸‹æ–‡ç”¨äºæ‰§è¡Œç­–ç•¥çš„æ–¹æ³•ã€‚</li><li><strong>å…·ä½“ç­–ç•¥</strong> ï¼ˆConcrete Strategiesï¼‰ å®ç°äº†ä¸Šä¸‹æ–‡æ‰€ç”¨ç®—æ³•çš„å„ç§ä¸åŒå˜ä½“ã€‚</li><li>å½“ä¸Šä¸‹æ–‡éœ€è¦è¿è¡Œç®—æ³•æ—¶ï¼Œ å®ƒä¼šåœ¨å…¶å·²è¿æ¥çš„ç­–ç•¥å¯¹è±¡ä¸Šè°ƒç”¨æ‰§è¡Œæ–¹æ³•ã€‚ ä¸Šä¸‹æ–‡ä¸æ¸…æ¥šå…¶æ‰€æ¶‰åŠçš„ç­–ç•¥ç±»å‹ä¸ç®—æ³•çš„æ‰§è¡Œæ–¹å¼ã€‚</li><li><strong>å®¢æˆ·ç«¯</strong> ï¼ˆClientï¼‰ ä¼šåˆ›å»ºä¸€ä¸ªç‰¹å®šç­–ç•¥å¯¹è±¡å¹¶å°†å…¶ä¼ é€’ç»™ä¸Šä¸‹æ–‡ã€‚ ä¸Šä¸‹æ–‡åˆ™ä¼šæä¾›ä¸€ä¸ªè®¾ç½®å™¨ä»¥ä¾¿å®¢æˆ·ç«¯åœ¨è¿è¡Œæ—¶æ›¿æ¢ç›¸å…³è”çš„ç­–ç•¥ã€‚</li></ol><h2 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h2><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ ä¸Šä¸‹æ–‡ä½¿ç”¨äº†å¤šä¸ª<strong>ç­–ç•¥</strong>æ¥æ‰§è¡Œä¸åŒçš„è®¡ç®—æ“ä½œã€‚</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç­–ç•¥æ¥å£å£°æ˜äº†æŸä¸ªç®—æ³•å„ä¸ªä¸åŒç‰ˆæœ¬é—´æ‰€å…±æœ‰çš„æ“ä½œã€‚ä¸Šä¸‹æ–‡ä¼šä½¿ç”¨è¯¥æ¥å£æ¥</span></span><br><span class="line"><span class="comment">// è°ƒç”¨æœ‰å…·ä½“ç­–ç•¥å®šä¹‰çš„ç®—æ³•ã€‚</span></span><br><span class="line"><span class="keyword">interface</span> Strategy <span class="keyword">is</span></span><br><span class="line">    method execute(a, b)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“ç­–ç•¥ä¼šåœ¨éµå¾ªç­–ç•¥åŸºç¡€æ¥å£çš„æƒ…å†µä¸‹å®ç°ç®—æ³•ã€‚è¯¥æ¥å£å®ç°äº†å®ƒä»¬åœ¨ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">// ä¸­çš„äº’æ¢æ€§ã€‚</span></span><br><span class="line"><span class="keyword">class</span> ConcreteStrategyAdd <span class="keyword">implements</span> Strategy <span class="keyword">is</span></span><br><span class="line">    method execute(a, b) <span class="keyword">is</span></span><br><span class="line">        return a + b</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ConcreteStrategySubtract <span class="keyword">implements</span> Strategy <span class="keyword">is</span></span><br><span class="line">    method execute(a, b) <span class="keyword">is</span></span><br><span class="line">        return a - b</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ConcreteStrategyMultiply <span class="keyword">implements</span> Strategy <span class="keyword">is</span></span><br><span class="line">    method execute(a, b) <span class="keyword">is</span></span><br><span class="line">        return a * b</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šä¸‹æ–‡å®šä¹‰äº†å®¢æˆ·ç«¯å…³æ³¨çš„æ¥å£ã€‚</span></span><br><span class="line"><span class="keyword">class</span> Context <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// ä¸Šä¸‹æ–‡ä¼šç»´æŠ¤æŒ‡å‘æŸä¸ªç­–ç•¥å¯¹è±¡çš„å¼•ç”¨ã€‚ä¸Šä¸‹æ–‡ä¸çŸ¥æ™“ç­–ç•¥çš„å…·ä½“ç±»ã€‚ä¸Šä¸‹</span></span><br><span class="line">    <span class="comment">// æ–‡å¿…é¡»é€šè¿‡ç­–ç•¥æ¥å£æ¥ä¸æ‰€æœ‰ç­–ç•¥è¿›è¡Œäº¤äº’ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> strategy: Strategy</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šä¸‹æ–‡é€šå¸¸ä¼šé€šè¿‡æ„é€ å‡½æ•°æ¥æ¥æ”¶ç­–ç•¥å¯¹è±¡ï¼ŒåŒæ—¶è¿˜æä¾›è®¾ç½®å™¨ä»¥ä¾¿åœ¨è¿è¡Œ</span></span><br><span class="line">    <span class="comment">// æ—¶åˆ‡æ¢ç­–ç•¥ã€‚</span></span><br><span class="line">    method setStrategy(Strategy strategy) <span class="keyword">is</span></span><br><span class="line">        this.strategy = strategy</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šä¸‹æ–‡ä¼šå°†ä¸€äº›å·¥ä½œå§”æ´¾ç»™ç­–ç•¥å¯¹è±¡ï¼Œè€Œä¸æ˜¯è‡ªè¡Œå®ç°ä¸åŒç‰ˆæœ¬çš„ç®—æ³•ã€‚</span></span><br><span class="line">    method executeStrategy(int a, int b) <span class="keyword">is</span></span><br><span class="line">        return strategy.execute(a, b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯ä»£ç ä¼šé€‰æ‹©å…·ä½“ç­–ç•¥å¹¶å°†å…¶ä¼ é€’ç»™ä¸Šä¸‹æ–‡ã€‚å®¢æˆ·ç«¯å¿…é¡»çŸ¥æ™“ç­–ç•¥ä¹‹é—´çš„å·®</span></span><br><span class="line"><span class="comment">// å¼‚ï¼Œæ‰èƒ½åšå‡ºæ­£ç¡®çš„é€‰æ‹©ã€‚</span></span><br><span class="line"><span class="keyword">class</span> ExampleApplication <span class="keyword">is</span></span><br><span class="line">    method main() <span class="keyword">is</span></span><br><span class="line"></span><br><span class="line">        åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">        è¯»å–ç¬¬ä¸€ä¸ªæ•°ã€‚</span><br><span class="line">        è¯»å–æœ€åä¸€ä¸ªæ•°ã€‚</span><br><span class="line">        ä»ç”¨æˆ·è¾“å…¥ä¸­è¯»å–æœŸæœ›è¿›è¡Œçš„è¡Œä¸ºã€‚</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (action == addition) <span class="keyword">then</span></span><br><span class="line">            context.setStrategy(new ConcreteStrategyAdd())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (action == subtraction) <span class="keyword">then</span></span><br><span class="line">            context.setStrategy(new ConcreteStrategySubtract())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (action == multiplication) <span class="keyword">then</span></span><br><span class="line">            context.setStrategy(new ConcreteStrategyMultiply())</span><br><span class="line"></span><br><span class="line">        result = context.executeStrategy(First number, Second number)</span><br><span class="line"></span><br><span class="line">        æ‰“å°ç»“æœã€‚</span><br></pre></td></tr></table></figure><h2 id="ç­–ç•¥æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"><a href="#ç­–ç•¥æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯" class="headerlink" title="ç­–ç•¥æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"></a>ç­–ç•¥æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯</h2><p><strong>å½“ä½ æƒ³ä½¿ç”¨å¯¹è±¡ä¸­å„ç§ä¸åŒçš„ç®—æ³•å˜ä½“ï¼Œ å¹¶å¸Œæœ›èƒ½åœ¨è¿è¡Œæ—¶åˆ‡æ¢ç®—æ³•æ—¶ï¼Œ å¯ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚</strong></p><p>ç­–ç•¥æ¨¡å¼è®©ä½ èƒ½å¤Ÿå°†å¯¹è±¡å…³è”è‡³å¯ä»¥ä¸åŒæ–¹å¼æ‰§è¡Œç‰¹å®šå­ä»»åŠ¡çš„ä¸åŒå­å¯¹è±¡ï¼Œ ä»è€Œä»¥é—´æ¥æ–¹å¼åœ¨è¿è¡Œæ—¶æ›´æ”¹å¯¹è±¡è¡Œä¸ºã€‚</p><p><strong>å½“ä½ æœ‰è®¸å¤šä»…åœ¨æ‰§è¡ŒæŸäº›è¡Œä¸ºæ—¶ç•¥æœ‰ä¸åŒçš„ç›¸ä¼¼ç±»æ—¶ï¼Œ å¯ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚</strong></p><p>ç­–ç•¥æ¨¡å¼è®©ä½ èƒ½å°†ä¸åŒè¡Œä¸ºæŠ½å–åˆ°ä¸€ä¸ªç‹¬ç«‹ç±»å±‚æ¬¡ç»“æ„ä¸­ï¼Œ å¹¶å°†åŸå§‹ç±»ç»„åˆæˆåŒä¸€ä¸ªï¼Œ ä»è€Œå‡å°‘é‡å¤ä»£ç ã€‚</p><p><strong>å¦‚æœç®—æ³•åœ¨ä¸Šä¸‹æ–‡çš„é€»è¾‘ä¸­ä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œ ä½¿ç”¨è¯¥æ¨¡å¼èƒ½å°†ç±»çš„ä¸šåŠ¡é€»è¾‘ä¸å…¶ç®—æ³•å®ç°ç»†èŠ‚éš”ç¦»å¼€æ¥ã€‚</strong></p><p>ç­–ç•¥æ¨¡å¼è®©ä½ èƒ½å°†å„ç§ç®—æ³•çš„ä»£ç ã€ å†…éƒ¨æ•°æ®å’Œä¾èµ–å…³ç³»ä¸å…¶ä»–ä»£ç éš”ç¦»å¼€æ¥ã€‚ ä¸åŒå®¢æˆ·ç«¯å¯é€šè¿‡ä¸€ä¸ªç®€å•æ¥å£æ‰§è¡Œç®—æ³•ï¼Œ å¹¶èƒ½åœ¨è¿è¡Œæ—¶è¿›è¡Œåˆ‡æ¢ã€‚</p><p><strong>å½“ç±»ä¸­ä½¿ç”¨äº†å¤æ‚æ¡ä»¶è¿ç®—ç¬¦ä»¥åœ¨åŒä¸€ç®—æ³•çš„ä¸åŒå˜ä½“ä¸­åˆ‡æ¢æ—¶ï¼Œ å¯ä½¿ç”¨è¯¥æ¨¡å¼ã€‚</strong></p><p>ç­–ç•¥æ¨¡å¼å°†æ‰€æœ‰ç»§æ‰¿è‡ªåŒæ ·æ¥å£çš„ç®—æ³•æŠ½å–åˆ°ç‹¬ç«‹ç±»ä¸­ï¼Œ å› æ­¤ä¸å†éœ€è¦æ¡ä»¶è¯­å¥ã€‚ åŸå§‹å¯¹è±¡å¹¶ä¸å®ç°æ‰€æœ‰ç®—æ³•çš„å˜ä½“ï¼Œ è€Œæ˜¯å°†æ‰§è¡Œå·¥ä½œå§”æ´¾ç»™å…¶ä¸­çš„ä¸€ä¸ªç‹¬ç«‹ç®—æ³•å¯¹è±¡ã€‚</p><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><ol><li>ä»ä¸Šä¸‹æ–‡ç±»ä¸­æ‰¾å‡ºä¿®æ”¹é¢‘ç‡è¾ƒé«˜çš„ç®—æ³• ï¼ˆä¹Ÿå¯èƒ½æ˜¯ç”¨äºåœ¨è¿è¡Œæ—¶é€‰æ‹©æŸä¸ªç®—æ³•å˜ä½“çš„å¤æ‚æ¡ä»¶è¿ç®—ç¬¦ï¼‰ã€‚</li><li>å£°æ˜è¯¥ç®—æ³•æ‰€æœ‰å˜ä½“çš„é€šç”¨ç­–ç•¥æ¥å£ã€‚</li><li>å°†ç®—æ³•é€ä¸€æŠ½å–åˆ°å„è‡ªçš„ç±»ä¸­ï¼Œ å®ƒä»¬éƒ½å¿…é¡»å®ç°ç­–ç•¥æ¥å£ã€‚</li><li>åœ¨ä¸Šä¸‹æ–‡ç±»ä¸­æ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡ç”¨äºä¿å­˜å¯¹äºç­–ç•¥å¯¹è±¡çš„å¼•ç”¨ã€‚ ç„¶åæä¾›è®¾ç½®å™¨ä»¥ä¿®æ”¹è¯¥æˆå‘˜å˜é‡ã€‚ ä¸Šä¸‹æ–‡ä»…å¯é€šè¿‡ç­–ç•¥æ¥å£åŒç­–ç•¥å¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œ å¦‚æœ‰éœ€è¦è¿˜å¯å®šä¹‰ä¸€ä¸ªæ¥å£æ¥è®©ç­–ç•¥è®¿é—®å…¶æ•°æ®ã€‚</li><li>å®¢æˆ·ç«¯å¿…é¡»å°†ä¸Šä¸‹æ–‡ç±»ä¸ç›¸åº”ç­–ç•¥è¿›è¡Œå…³è”ï¼Œ ä½¿ä¸Šä¸‹æ–‡å¯ä»¥é¢„æœŸçš„æ–¹å¼å®Œæˆå…¶ä¸»è¦å·¥ä½œã€‚</li></ol><h2 id="ç­–ç•¥æ¨¡å¼ä¼˜ç¼ºç‚¹"><a href="#ç­–ç•¥æ¨¡å¼ä¼˜ç¼ºç‚¹" class="headerlink" title="ç­–ç•¥æ¨¡å¼ä¼˜ç¼ºç‚¹"></a>ç­–ç•¥æ¨¡å¼ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹</p><ul><li>ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶åˆ‡æ¢å¯¹è±¡å†…çš„ç®—æ³•ã€‚</li><li>ä½ å¯ä»¥å°†ç®—æ³•çš„å®ç°å’Œä½¿ç”¨ç®—æ³•çš„ä»£ç éš”ç¦»å¼€æ¥ã€‚</li><li>ä½ å¯ä»¥ä½¿ç”¨ç»„åˆæ¥ä»£æ›¿ç»§æ‰¿ã€‚</li><li><em>å¼€é—­åŸåˆ™</em>ã€‚ ä½ æ— éœ€å¯¹ä¸Šä¸‹æ–‡è¿›è¡Œä¿®æ”¹å°±èƒ½å¤Ÿå¼•å…¥æ–°çš„ç­–ç•¥ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>å¦‚æœä½ çš„ç®—æ³•æå°‘å‘ç”Ÿæ”¹å˜ï¼Œ é‚£ä¹ˆæ²¡æœ‰ä»»ä½•ç†ç”±å¼•å…¥æ–°çš„ç±»å’Œæ¥å£ã€‚ ä½¿ç”¨è¯¥æ¨¡å¼åªä¼šè®©ç¨‹åºè¿‡äºå¤æ‚ã€‚</li><li>å®¢æˆ·ç«¯å¿…é¡»çŸ¥æ™“ç­–ç•¥é—´çš„ä¸åŒâ€”â€”å®ƒéœ€è¦é€‰æ‹©åˆé€‚çš„ç­–ç•¥ã€‚</li><li>è®¸å¤šç°ä»£ç¼–ç¨‹è¯­è¨€æ”¯æŒå‡½æ•°ç±»å‹åŠŸèƒ½ï¼Œ å…è®¸ä½ åœ¨ä¸€ç»„åŒ¿åå‡½æ•°ä¸­å®ç°ä¸åŒç‰ˆæœ¬çš„ç®—æ³•ã€‚ è¿™æ ·ï¼Œ ä½ ä½¿ç”¨è¿™äº›å‡½æ•°çš„æ–¹å¼å°±å’Œä½¿ç”¨ç­–ç•¥å¯¹è±¡æ—¶å®Œå…¨ç›¸åŒï¼Œ æ— éœ€å€ŸåŠ©é¢å¤–çš„ç±»å’Œæ¥å£æ¥ä¿æŒä»£ç ç®€æ´ã€‚</li></ul><h2 id="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul><li><a href="https://refactoringguru.cn/design-patterns/bridge">æ¡¥æ¥æ¨¡å¼</a>ã€ <a href="https://refactoringguru.cn/design-patterns/state">çŠ¶æ€æ¨¡å¼</a>å’Œ<a href="https://refactoringguru.cn/design-patterns/strategy">ç­–ç•¥æ¨¡å¼</a> ï¼ˆåœ¨æŸç§ç¨‹åº¦ä¸ŠåŒ…æ‹¬<a href="https://refactoringguru.cn/design-patterns/adapter">é€‚é…å™¨æ¨¡å¼</a>ï¼‰ æ¨¡å¼çš„æ¥å£éå¸¸ç›¸ä¼¼ã€‚ å®é™…ä¸Šï¼Œ å®ƒä»¬éƒ½åŸºäº<a href="https://refactoringguru.cn/design-patterns/composite">ç»„åˆæ¨¡å¼</a>â€”â€”å³å°†å·¥ä½œå§”æ´¾ç»™å…¶ä»–å¯¹è±¡ï¼Œ ä¸è¿‡ä¹Ÿå„è‡ªè§£å†³äº†ä¸åŒçš„é—®é¢˜ã€‚ æ¨¡å¼å¹¶ä¸åªæ˜¯ä»¥ç‰¹å®šæ–¹å¼ç»„ç»‡ä»£ç çš„é…æ–¹ï¼Œ ä½ è¿˜å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥å’Œå…¶ä»–å¼€å‘è€…è®¨è®ºæ¨¡å¼æ‰€è§£å†³çš„é—®é¢˜ã€‚</li><li><a href="https://refactoringguru.cn/design-patterns/command">å‘½ä»¤æ¨¡å¼</a>å’Œ<a href="https://refactoringguru.cn/design-patterns/strategy">ç­–ç•¥</a>çœ‹ä¸Šå»å¾ˆåƒï¼Œ å› ä¸ºä¸¤è€…éƒ½èƒ½é€šè¿‡æŸäº›è¡Œä¸ºæ¥å‚æ•°åŒ–å¯¹è±¡ã€‚ ä½†æ˜¯ï¼Œ å®ƒä»¬çš„æ„å›¾æœ‰éå¸¸å¤§çš„ä¸åŒã€‚<ul><li>ä½ å¯ä»¥ä½¿ç”¨<em>å‘½ä»¤</em>æ¥å°†ä»»ä½•æ“ä½œè½¬æ¢ä¸ºå¯¹è±¡ã€‚ æ“ä½œçš„å‚æ•°å°†æˆä¸ºå¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚ ä½ å¯ä»¥é€šè¿‡è½¬æ¢æ¥å»¶è¿Ÿæ“ä½œçš„æ‰§è¡Œã€ å°†æ“ä½œæ”¾å…¥é˜Ÿåˆ—ã€ ä¿å­˜å†å²å‘½ä»¤æˆ–è€…å‘è¿œç¨‹æœåŠ¡å‘é€å‘½ä»¤ç­‰ã€‚</li><li>å¦ä¸€æ–¹é¢ï¼Œ <em>ç­–ç•¥</em>é€šå¸¸å¯ç”¨äºæè¿°å®ŒæˆæŸä»¶äº‹çš„ä¸åŒæ–¹å¼ï¼Œ è®©ä½ èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç±»ä¸­åˆ‡æ¢ç®—æ³•ã€‚</li></ul></li><li><a href="https://refactoringguru.cn/design-patterns/decorator">è£…é¥°æ¨¡å¼</a>å¯è®©ä½ æ›´æ”¹å¯¹è±¡çš„å¤–è¡¨ï¼Œ <a href="https://refactoringguru.cn/design-patterns/strategy">ç­–ç•¥</a>åˆ™è®©ä½ èƒ½å¤Ÿæ”¹å˜å…¶æœ¬è´¨ã€‚</li><li><a href="https://refactoringguru.cn/design-patterns/template-method">æ¨¡æ¿æ–¹æ³•æ¨¡å¼</a>åŸºäºç»§æ‰¿æœºåˆ¶ï¼š å®ƒå…è®¸ä½ é€šè¿‡æ‰©å±•å­ç±»ä¸­çš„éƒ¨åˆ†å†…å®¹æ¥æ”¹å˜éƒ¨åˆ†ç®—æ³•ã€‚ <a href="https://refactoringguru.cn/design-patterns/strategy">ç­–ç•¥</a>åŸºäºç»„åˆæœºåˆ¶ï¼š ä½ å¯ä»¥é€šè¿‡å¯¹ç›¸åº”è¡Œä¸ºæä¾›ä¸åŒçš„ç­–ç•¥æ¥æ”¹å˜å¯¹è±¡çš„éƒ¨åˆ†è¡Œä¸ºã€‚ <em>æ¨¡æ¿æ–¹æ³•</em>åœ¨ç±»å±‚æ¬¡ä¸Šè¿ä½œï¼Œ å› æ­¤å®ƒæ˜¯é™æ€çš„ã€‚ <em>ç­–ç•¥</em>åœ¨å¯¹è±¡å±‚æ¬¡ä¸Šè¿ä½œï¼Œ å› æ­¤å…è®¸åœ¨è¿è¡Œæ—¶åˆ‡æ¢è¡Œä¸ºã€‚</li><li><a href="https://refactoringguru.cn/design-patterns/state">çŠ¶æ€</a>å¯è¢«è§†ä¸º<a href="https://refactoringguru.cn/design-patterns/strategy">ç­–ç•¥</a>çš„æ‰©å±•ã€‚ ä¸¤è€…éƒ½åŸºäºç»„åˆæœºåˆ¶ï¼š å®ƒä»¬éƒ½é€šè¿‡å°†éƒ¨åˆ†å·¥ä½œå§”æ´¾ç»™ â€œå¸®æ‰‹â€ å¯¹è±¡æ¥æ”¹å˜å…¶åœ¨ä¸åŒæƒ…æ™¯ä¸‹çš„è¡Œä¸ºã€‚ <em>ç­–ç•¥</em>ä½¿å¾—è¿™äº›å¯¹è±¡ç›¸äº’ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œ å®ƒä»¬ä¸çŸ¥é“å…¶ä»–å¯¹è±¡çš„å­˜åœ¨ã€‚ ä½†<em>çŠ¶æ€</em>æ¨¡å¼æ²¡æœ‰é™åˆ¶å…·ä½“çŠ¶æ€ä¹‹é—´çš„ä¾èµ–ï¼Œ ä¸”å…è®¸å®ƒä»¬è‡ªè¡Œæ”¹å˜åœ¨ä¸åŒæƒ…æ™¯ä¸‹çš„çŠ¶æ€ã€‚</li></ul><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p><strong>ç­–ç•¥</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å®ƒå°†ä¸€ç»„è¡Œä¸ºè½¬æ¢ä¸ºå¯¹è±¡ï¼Œ å¹¶ä½¿å…¶åœ¨åŸå§‹ä¸Šä¸‹æ–‡å¯¹è±¡å†…éƒ¨èƒ½å¤Ÿç›¸äº’æ›¿æ¢ã€‚</p><p>åŸå§‹å¯¹è±¡è¢«ç§°ä¸ºä¸Šä¸‹æ–‡ï¼Œ å®ƒåŒ…å«æŒ‡å‘ç­–ç•¥å¯¹è±¡çš„å¼•ç”¨å¹¶å°†æ‰§è¡Œè¡Œä¸ºçš„ä»»åŠ¡åˆ†æ´¾ç»™ç­–ç•¥å¯¹è±¡ã€‚ ä¸ºäº†æ”¹å˜ä¸Šä¸‹æ–‡å®Œæˆå…¶å·¥ä½œçš„æ–¹å¼ï¼Œ å…¶ä»–å¯¹è±¡å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå¯¹è±¡æ¥æ›¿æ¢å½“å‰é“¾æ¥çš„ç­–ç•¥å¯¹è±¡ã€‚</p><div class="tabs" id="tags"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#tags-1">C#</button></li><li class="tab"><button type="button" data-href="#tags-2">C++</button></li><li class="tab"><button type="button" data-href="#tags-3">JAVA</button></li><li class="tab"><button type="button" data-href="#tags-4">PHP</button></li><li class="tab"><button type="button" data-href="#tags-5">Python</button></li><li class="tab"><button type="button" data-href="#tags-6">Ruby</button></li><li class="tab"><button type="button" data-href="#tags-7">Swift</button></li><li class="tab"><button type="button" data-href="#tags-8">TypeScrit</button></li><li class="tab"><button type="button" data-href="#tags-9">Golang</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="tags-1"><p><strong>åœ¨ C# ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> ç­–ç•¥æ¨¡å¼åœ¨ C# ä»£ç ä¸­å¾ˆå¸¸è§ã€‚ å®ƒç»å¸¸åœ¨å„ç§æ¡†æ¶ä¸­ä½¿ç”¨ï¼Œ èƒ½åœ¨ä¸æ‰©å±•ç±»çš„æƒ…å†µä¸‹å‘ç”¨æˆ·æä¾›æ”¹å˜å…¶è¡Œä¸ºçš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡å…è®¸åµŒå¥—å¯¹è±¡å®Œæˆå®é™…å·¥ä½œçš„æ–¹æ³•ä»¥åŠå…è®¸å°†è¯¥å¯¹è±¡æ›¿æ¢ä¸ºä¸åŒå¯¹è±¡çš„è®¾ç½®å™¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>ç­–ç•¥</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>Program.cs:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.Strategy.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The Context defines the interface of interest to clients.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Context</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The Context maintains a reference to one of the Strategy objects. The</span></span><br><span class="line">        <span class="comment">// Context does not know the concrete class of a strategy. It should</span></span><br><span class="line">        <span class="comment">// work with all strategies via the Strategy interface.</span></span><br><span class="line">        <span class="keyword">private</span> IStrategy _strategy;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Context</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Usually, the Context accepts a strategy through the constructor, but</span></span><br><span class="line">        <span class="comment">// also provides a setter to change it at runtime.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Context</span>(<span class="params">IStrategy strategy</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>._strategy = strategy;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Usually, the Context allows replacing a Strategy object at runtime.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetStrategy</span>(<span class="params">IStrategy strategy</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>._strategy = strategy;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The Context delegates some work to the Strategy object instead of</span></span><br><span class="line">        <span class="comment">// implementing multiple versions of the algorithm on its own.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoSomeBusinessLogic</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Context: Sorting data using the strategy (not sure how it&#x27;ll do it)&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> result = <span class="keyword">this</span>._strategy.DoAlgorithm(<span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">string</span> resultStr = <span class="built_in">string</span>.Empty;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> element <span class="keyword">in</span> result <span class="keyword">as</span> List&lt;<span class="built_in">string</span>&gt;)</span><br><span class="line">            &#123;</span><br><span class="line">                resultStr += element + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(resultStr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Strategy interface declares operations common to all supported</span></span><br><span class="line">    <span class="comment">// versions of some algorithm.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The Context uses this interface to call the algorithm defined by Concrete</span></span><br><span class="line">    <span class="comment">// Strategies.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IStrategy</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="built_in">object</span> <span class="title">DoAlgorithm</span>(<span class="params"><span class="built_in">object</span> data</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete Strategies implement the algorithm while following the base</span></span><br><span class="line">    <span class="comment">// Strategy interface. The interface makes them interchangeable in the</span></span><br><span class="line">    <span class="comment">// Context.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteStrategyA</span> : <span class="title">IStrategy</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">DoAlgorithm</span>(<span class="params"><span class="built_in">object</span> data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> list = data <span class="keyword">as</span> List&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">            list.Sort();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteStrategyB</span> : <span class="title">IStrategy</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">DoAlgorithm</span>(<span class="params"><span class="built_in">object</span> data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> list = data <span class="keyword">as</span> List&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">            list.Sort();</span><br><span class="line">            list.Reverse();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// The client code picks a concrete strategy and passes it to the</span></span><br><span class="line">            <span class="comment">// context. The client should be aware of the differences between</span></span><br><span class="line">            <span class="comment">// strategies in order to make the right choice.</span></span><br><span class="line">            <span class="keyword">var</span> context = <span class="keyword">new</span> Context();</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Client: Strategy is set to normal sorting.&quot;</span>);</span><br><span class="line">            context.SetStrategy(<span class="keyword">new</span> ConcreteStrategyA());</span><br><span class="line">            context.DoSomeBusinessLogic();</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine();</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Client: Strategy is set to reverse sorting.&quot;</span>);</span><br><span class="line">            context.SetStrategy(<span class="keyword">new</span> ConcreteStrategyB());</span><br><span class="line">            context.DoSomeBusinessLogic();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Client: Strategy is set to normal sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">a,b,c,d,e</span><br><span class="line"></span><br><span class="line">Client: Strategy is set to reverse sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">e,d,c,b,a</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-2"><p><strong>åœ¨ C++ ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> ç­–ç•¥æ¨¡å¼åœ¨ C++ ä»£ç ä¸­å¾ˆå¸¸è§ã€‚ å®ƒç»å¸¸åœ¨å„ç§æ¡†æ¶ä¸­ä½¿ç”¨ï¼Œ èƒ½åœ¨ä¸æ‰©å±•ç±»çš„æƒ…å†µä¸‹å‘ç”¨æˆ·æä¾›æ”¹å˜å…¶è¡Œä¸ºçš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡å…è®¸åµŒå¥—å¯¹è±¡å®Œæˆå®é™…å·¥ä½œçš„æ–¹æ³•ä»¥åŠå…è®¸å°†è¯¥å¯¹è±¡æ›¿æ¢ä¸ºä¸åŒå¯¹è±¡çš„è®¾ç½®å™¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>ç­–ç•¥</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.cc:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Strategy interface declares operations common to all supported versions</span></span><br><span class="line"><span class="comment"> * of some algorithm.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The Context uses this interface to call the algorithm defined by Concrete</span></span><br><span class="line"><span class="comment"> * Strategies.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Strategy</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~Strategy() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">DoAlgorithm</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; &amp;data)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Context defines the interface of interest to clients.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @var Strategy The Context maintains a reference to one of the Strategy</span></span><br><span class="line"><span class="comment">     * objects. The Context does not know the concrete class of a strategy. It</span></span><br><span class="line"><span class="comment">     * should work with all strategies via the Strategy interface.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Strategy *strategy_;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the Context accepts a strategy through the constructor, but also</span></span><br><span class="line"><span class="comment">     * provides a setter to change it at runtime.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Context(Strategy *strategy = <span class="literal">nullptr</span>) : strategy_(strategy)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Context()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>-&gt;strategy_;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the Context allows replacing a Strategy object at runtime.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_strategy</span><span class="params">(Strategy *strategy)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>-&gt;strategy_;</span><br><span class="line">        <span class="keyword">this</span>-&gt;strategy_ = strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Context delegates some work to the Strategy object instead of</span></span><br><span class="line"><span class="comment">     * implementing +multiple versions of the algorithm on its own.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DoSomeBusinessLogic</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Context: Sorting data using the strategy (not sure how it&#x27;ll do it)\n&quot;</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> result = <span class="keyword">this</span>-&gt;strategy_-&gt;DoAlgorithm(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;d&quot;</span>&#125;);</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; result &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Strategies implement the algorithm while following the base Strategy</span></span><br><span class="line"><span class="comment"> * interface. The interface makes them interchangeable in the Context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyA</span> :</span> <span class="keyword">public</span> Strategy</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">DoAlgorithm</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; &amp;data)</span> <span class="keyword">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> result;</span><br><span class="line">        <span class="built_in">std</span>::for_each(<span class="built_in">std</span>::begin(data), <span class="built_in">std</span>::end(data), [&amp;result](<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;letter) &#123;</span><br><span class="line">            result += letter;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">std</span>::sort(<span class="built_in">std</span>::begin(result), <span class="built_in">std</span>::end(result));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyB</span> :</span> <span class="keyword">public</span> Strategy</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">DoAlgorithm</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; &amp;data)</span> <span class="keyword">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> result;</span><br><span class="line">        <span class="built_in">std</span>::for_each(<span class="built_in">std</span>::begin(data), <span class="built_in">std</span>::end(data), [&amp;result](<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;letter) &#123;</span><br><span class="line">            result += letter;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">std</span>::sort(<span class="built_in">std</span>::begin(result), <span class="built_in">std</span>::end(result));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.size() / <span class="number">2</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">std</span>::swap(result[i], result[result.size() - i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code picks a concrete strategy and passes it to the context. The</span></span><br><span class="line"><span class="comment"> * client should be aware of the differences between strategies in order to make</span></span><br><span class="line"><span class="comment"> * the right choice.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClientCode</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Context *context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStrategyA);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Client: Strategy is set to normal sorting.\n&quot;</span>;</span><br><span class="line">    context-&gt;DoSomeBusinessLogic();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Client: Strategy is set to reverse sorting.\n&quot;</span>;</span><br><span class="line">    context-&gt;set_strategy(<span class="keyword">new</span> ConcreteStrategyB);</span><br><span class="line">    context-&gt;DoSomeBusinessLogic();</span><br><span class="line">    <span class="keyword">delete</span> context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ClientCode();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Client: Strategy is set to normal sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">abcde</span><br><span class="line"></span><br><span class="line">Client: Strategy is set to reverse sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">edcba</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-3"><p><strong>åœ¨ Java ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> ç­–ç•¥æ¨¡å¼åœ¨ Java ä»£ç ä¸­å¾ˆå¸¸è§ã€‚ å®ƒç»å¸¸åœ¨å„ç§æ¡†æ¶ä¸­ä½¿ç”¨ï¼Œ èƒ½åœ¨ä¸æ‰©å±•ç±»çš„æƒ…å†µä¸‹å‘ç”¨æˆ·æä¾›æ”¹å˜å…¶è¡Œä¸ºçš„æ–¹å¼ã€‚</p><p>Java 8 å¼€å§‹æ”¯æŒ lambda æ–¹æ³•ï¼Œ å®ƒå¯ä½œä¸ºä¸€ç§æ›¿ä»£ç­–ç•¥æ¨¡å¼çš„ç®€å•æ–¹å¼ã€‚</p><p>è¿™é‡Œæœ‰ä¸€äº›æ ¸å¿ƒ Java ç¨‹åºåº“ä¸­ç­–ç•¥æ¨¡å¼çš„ç¤ºä¾‹ï¼š</p><ul><li>å¯¹ <a href="http://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html#compare-T-T-"><code>java.util.Comparator#compare()</code></a> çš„è°ƒç”¨æ¥è‡ª <code>Collections#sort()</code>.</li><li><a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html"><code>javax.servlet.http.HttpServlet</code></a>ï¼š  <code>serviceÂ­()</code>æ–¹æ³•ï¼Œ è¿˜æœ‰æ‰€æœ‰æ¥å— <code>HttpÂ­ServletÂ­Request</code>å’Œ <code>HttpÂ­ServletÂ­Response</code>å¯¹è±¡ä½œä¸ºå‚æ•°çš„ <code>doÂ­XXX()</code>æ–¹æ³•ã€‚</li><li><a href="http://docs.oracle.com/javaee/7/api/javax/servlet/Filter.html#doFilter-javax.servlet.ServletRequest-javax.servlet.ServletResponse-javax.servlet.FilterChain-"><code>javax.servlet.Filter#doFilter()</code></a></li></ul><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡å…è®¸åµŒå¥—å¯¹è±¡å®Œæˆå®é™…å·¥ä½œçš„æ–¹æ³•ä»¥åŠå…è®¸å°†è¯¥å¯¹è±¡æ›¿æ¢ä¸ºä¸åŒå¯¹è±¡çš„è®¾ç½®å™¨æ¥è¯†åˆ«ã€‚</p><p><strong>ç”µå­å•†åŠ¡åº”ç”¨ä¸­çš„æ”¯ä»˜æ–¹æ³•</strong></p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ ç­–ç•¥æ¨¡å¼è¢«ç”¨äºåœ¨ç”µå­å•†åŠ¡åº”ç”¨ä¸­å®ç°å„ç§æ”¯ä»˜æ–¹æ³•ã€‚ å®¢æˆ·é€‰ä¸­å¸Œæœ›è´­ä¹°çš„å•†å“åéœ€è¦é€‰æ‹©ä¸€ç§æ”¯ä»˜æ–¹å¼ï¼š Paypal æˆ–è€…ä¿¡ç”¨å¡ã€‚</p><p>å…·ä½“ç­–ç•¥ä¸ä»…ä¼šå®Œæˆå®é™…çš„æ”¯ä»˜å·¥ä½œï¼Œ è¿˜ä¼šæ”¹å˜æ”¯ä»˜è¡¨å•çš„è¡Œä¸ºï¼Œ å¹¶åœ¨è¡¨å•ä¸­æä¾›ç›¸åº”çš„å­—æ®µæ¥è®°å½•æ”¯ä»˜ä¿¡æ¯ã€‚</p><p><strong>strategies</strong></p><p><strong>strategies/PayStrategy.java:</strong> é€šç”¨çš„æ”¯ä»˜æ–¹æ³•æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.strategy.example.strategies;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Common interface for all strategies.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PayStrategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">pay</span><span class="params">(<span class="keyword">int</span> paymentAmount)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">collectPaymentDetails</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>strategies/PayByPayPal.java:</strong> ä½¿ç”¨ PayPal æ”¯ä»˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.strategy.example.strategies;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete strategy. Implements PayPal payment method.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayByPayPal</span> <span class="keyword">implements</span> <span class="title">PayStrategy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, String&gt; DATA_BASE = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BufferedReader READER = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> signedIn;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        DATA_BASE.put(<span class="string">&quot;amanda1985&quot;</span>, <span class="string">&quot;amanda@ya.com&quot;</span>);</span><br><span class="line">        DATA_BASE.put(<span class="string">&quot;qwerty&quot;</span>, <span class="string">&quot;john@amazon.eu&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Collect customer&#x27;s data.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">collectPaymentDetails</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!signedIn) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;Enter the user&#x27;s email: &quot;</span>);</span><br><span class="line">                email = READER.readLine();</span><br><span class="line">                System.out.print(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">                password = READER.readLine();</span><br><span class="line">                <span class="keyword">if</span> (verify()) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Data verification has been successful.&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Wrong email or password!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setSignedIn(email.equals(DATA_BASE.get(password)));</span><br><span class="line">        <span class="keyword">return</span> signedIn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Save customer data for future shopping attempts.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">pay</span><span class="params">(<span class="keyword">int</span> paymentAmount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (signedIn) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Paying &quot;</span> + paymentAmount + <span class="string">&quot; using PayPal.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setSignedIn</span><span class="params">(<span class="keyword">boolean</span> signedIn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.signedIn = signedIn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>strategies/PayByCreditCard.java:</strong> ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.strategy.example.strategies;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete strategy. Implements credit card payment method.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayByCreditCard</span> <span class="keyword">implements</span> <span class="title">PayStrategy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BufferedReader READER = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">    <span class="keyword">private</span> CreditCard card;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Collect credit card data.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">collectPaymentDetails</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;Enter the card number: &quot;</span>);</span><br><span class="line">            String number = READER.readLine();</span><br><span class="line">            System.out.print(<span class="string">&quot;Enter the card expiration date &#x27;mm/yy&#x27;: &quot;</span>);</span><br><span class="line">            String date = READER.readLine();</span><br><span class="line">            System.out.print(<span class="string">&quot;Enter the CVV code: &quot;</span>);</span><br><span class="line">            String cvv = READER.readLine();</span><br><span class="line">            card = <span class="keyword">new</span> CreditCard(number, date, cvv);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Validate credit card number...</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * After card validation we can charge customer&#x27;s credit card.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">pay</span><span class="params">(<span class="keyword">int</span> paymentAmount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cardIsPresent()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Paying &quot;</span> + paymentAmount + <span class="string">&quot; using Credit Card.&quot;</span>);</span><br><span class="line">            card.setAmount(card.getAmount() - paymentAmount);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">cardIsPresent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> card != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>strategies/CreditCard.java:</strong> ä¿¡ç”¨å¡ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.strategy.example.strategies;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Dummy credit card class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreditCard</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> amount;</span><br><span class="line">    <span class="keyword">private</span> String number;</span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="keyword">private</span> String cvv;</span><br><span class="line"></span><br><span class="line">    CreditCard(String number, String date, String cvv) &#123;</span><br><span class="line">        <span class="keyword">this</span>.amount = <span class="number">100_000</span>;</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.cvv = cvv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAmount</span><span class="params">(<span class="keyword">int</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.amount = amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>order/Order.java:</strong> è®¢å•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.strategy.example.order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.strategy.example.strategies.PayStrategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Order class. Doesn&#x27;t know the concrete payment method (strategy) user has</span></span><br><span class="line"><span class="comment"> * picked. It uses common strategy interface to delegate collecting payment data</span></span><br><span class="line"><span class="comment"> * to strategy object. It can be used to save order to database.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> totalCost = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isClosed = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processOrder</span><span class="params">(PayStrategy strategy)</span> </span>&#123;</span><br><span class="line">        strategy.collectPaymentDetails();</span><br><span class="line">        <span class="comment">// Here we could collect and store payment data from the strategy.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalCost</span><span class="params">(<span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalCost += cost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalCost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> totalCost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isClosed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isClosed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setClosed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        isClosed = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Demo.java:</strong> å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.strategy.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.strategy.example.order.Order;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.strategy.example.strategies.PayByCreditCard;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.strategy.example.strategies.PayByPayPal;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.strategy.example.strategies.PayStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * World first console e-commerce application.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, Integer&gt; priceOnProducts = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Order order = <span class="keyword">new</span> Order();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PayStrategy strategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        priceOnProducts.put(<span class="number">1</span>, <span class="number">2200</span>);</span><br><span class="line">        priceOnProducts.put(<span class="number">2</span>, <span class="number">1850</span>);</span><br><span class="line">        priceOnProducts.put(<span class="number">3</span>, <span class="number">1100</span>);</span><br><span class="line">        priceOnProducts.put(<span class="number">4</span>, <span class="number">890</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!order.isClosed()) &#123;</span><br><span class="line">            <span class="keyword">int</span> cost;</span><br><span class="line"></span><br><span class="line">            String continueChoice;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;Please, select a product:&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;1 - Mother board&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;2 - CPU&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;3 - HDD&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;4 - Memory&quot;</span> + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="keyword">int</span> choice = Integer.parseInt(reader.readLine());</span><br><span class="line">                cost = priceOnProducts.get(choice);</span><br><span class="line">                System.out.print(<span class="string">&quot;Count: &quot;</span>);</span><br><span class="line">                <span class="keyword">int</span> count = Integer.parseInt(reader.readLine());</span><br><span class="line">                order.setTotalCost(cost * count);</span><br><span class="line">                System.out.print(<span class="string">&quot;Do you wish to continue selecting products? Y/N: &quot;</span>);</span><br><span class="line">                continueChoice = reader.readLine();</span><br><span class="line">            &#125; <span class="keyword">while</span> (continueChoice.equalsIgnoreCase(<span class="string">&quot;Y&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (strategy == <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Please, select a payment method:&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;1 - PalPay&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;2 - Credit Card&quot;</span>);</span><br><span class="line">                String paymentMethod = reader.readLine();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Client creates different strategies based on input from user,</span></span><br><span class="line">                <span class="comment">// application configuration, etc.</span></span><br><span class="line">                <span class="keyword">if</span> (paymentMethod.equals(<span class="string">&quot;1&quot;</span>)) &#123;</span><br><span class="line">                    strategy = <span class="keyword">new</span> PayByPayPal();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    strategy = <span class="keyword">new</span> PayByCreditCard();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Order object delegates gathering payment data to strategy object,</span></span><br><span class="line">            <span class="comment">// since only strategies know what data they need to process a</span></span><br><span class="line">            <span class="comment">// payment.</span></span><br><span class="line">            order.processOrder(strategy);</span><br><span class="line"></span><br><span class="line">            System.out.print(<span class="string">&quot;Pay &quot;</span> + order.getTotalCost() + <span class="string">&quot; units or Continue shopping? P/C: &quot;</span>);</span><br><span class="line">            String proceed = reader.readLine();</span><br><span class="line">            <span class="keyword">if</span> (proceed.equalsIgnoreCase(<span class="string">&quot;P&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">// Finally, strategy handles the payment.</span></span><br><span class="line">                <span class="keyword">if</span> (strategy.pay(order.getTotalCost())) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Payment has been successful.&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;FAIL! Please, check your data.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                order.setClosed();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>OutputDemo.png:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Please, select a product:</span><br><span class="line">1 - Mother board</span><br><span class="line">2 - CPU</span><br><span class="line">3 - HDD</span><br><span class="line">4 - Memory</span><br><span class="line">1</span><br><span class="line">Count: 2</span><br><span class="line">Do you wish to continue selecting products? Y&#x2F;N: y</span><br><span class="line">Please, select a product:</span><br><span class="line">1 - Mother board</span><br><span class="line">2 - CPU</span><br><span class="line">3 - HDD</span><br><span class="line">4 - Memory</span><br><span class="line">2</span><br><span class="line">Count: 1</span><br><span class="line">Do you wish to continue selecting products? Y&#x2F;N: n</span><br><span class="line">Please, select a payment method:</span><br><span class="line">1 - PalPay</span><br><span class="line">2 - Credit Card</span><br><span class="line">1</span><br><span class="line">Enter the user&#39;s email: user@example.com</span><br><span class="line">Enter the password: qwerty</span><br><span class="line">Wrong email or password!</span><br><span class="line">Enter user email: amanda@ya.com</span><br><span class="line">Enter password: amanda1985</span><br><span class="line">Data verification has been successful.</span><br><span class="line">Pay 6250 units or Continue shopping?  P&#x2F;C: p</span><br><span class="line">Paying 6250 using PayPal.</span><br><span class="line">Payment has been successful.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-4"><p><strong>åœ¨ PHP ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> PHP ä»£ç ä¸­ç»å¸¸ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œ ç‰¹åˆ«æ˜¯å¿…é¡»åœ¨è¿è¡Œæ—¶åˆ‡æ¢ç®—æ³•çš„æƒ…å½¢ä¸­ã€‚ ä½†æ˜¯ï¼Œ PHP ä» 2009 å¹´å¼€å§‹æ”¯æŒåŒ¿åå‡½æ•°ï¼Œ ä»¥å…¶ä¸ºä»£è¡¨çš„å¼ºå¤§ç«äº‰å¯¹æ‰‹æŒ‘æˆ˜ç€æ¨¡å¼çš„ä½¿ç”¨ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡å…è®¸åµŒå¥—å¯¹è±¡å®Œæˆå®é™…å·¥ä½œçš„æ–¹æ³•ä»¥åŠå…è®¸å°†è¯¥å¯¹è±¡æ›¿æ¢ä¸ºä¸åŒå¯¹è±¡çš„è®¾ç½®å™¨æ¥è¯†åˆ«ã€‚</p><div class="tabs" id="php"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#php-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#php-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="php-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>ç­–ç•¥</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ PHP åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>index.php:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru</span>\<span class="title">Strategy</span>\<span class="title">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Context defines the interface of interest to clients.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Strategy The Context maintains a reference to one of the Strategy</span></span><br><span class="line"><span class="comment">     * objects. The Context does not know the concrete class of a strategy. It</span></span><br><span class="line"><span class="comment">     * should work with all strategies via the Strategy interface.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $strategy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the Context accepts a strategy through the constructor, but also</span></span><br><span class="line"><span class="comment">     * provides a setter to change it at runtime.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Strategy $strategy</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;strategy = $strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the Context allows replacing a Strategy object at runtime.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setStrategy</span>(<span class="params">Strategy $strategy</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;strategy = $strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Context delegates some work to the Strategy object instead of</span></span><br><span class="line"><span class="comment">     * implementing multiple versions of the algorithm on its own.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomeBusinessLogic</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Context: Sorting data using the strategy (not sure how it&#x27;ll do it)\n&quot;</span>;</span><br><span class="line">        $result = <span class="keyword">$this</span>-&gt;strategy-&gt;doAlgorithm([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> implode(<span class="string">&quot;,&quot;</span>, $result) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Strategy interface declares operations common to all supported versions</span></span><br><span class="line"><span class="comment"> * of some algorithm.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The Context uses this interface to call the algorithm defined by Concrete</span></span><br><span class="line"><span class="comment"> * Strategies.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Strategy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doAlgorithm</span>(<span class="params"><span class="keyword">array</span> $data</span>): <span class="title">array</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Strategies implement the algorithm while following the base Strategy</span></span><br><span class="line"><span class="comment"> * interface. The interface makes them interchangeable in the Context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyA</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doAlgorithm</span>(<span class="params"><span class="keyword">array</span> $data</span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        sort($data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyB</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doAlgorithm</span>(<span class="params"><span class="keyword">array</span> $data</span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        rsort($data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code picks a concrete strategy and passes it to the context. The</span></span><br><span class="line"><span class="comment"> * client should be aware of the differences between strategies in order to make</span></span><br><span class="line"><span class="comment"> * the right choice.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStrategyA());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Client: Strategy is set to normal sorting.\n&quot;</span>;</span><br><span class="line">$context-&gt;doSomeBusinessLogic();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Client: Strategy is set to reverse sorting.\n&quot;</span>;</span><br><span class="line">$context-&gt;setStrategy(<span class="keyword">new</span> ConcreteStrategyB());</span><br><span class="line">$context-&gt;doSomeBusinessLogic();</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Client: Strategy is set to normal sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">a,b,c,d,e</span><br><span class="line"></span><br><span class="line">Client: Strategy is set to reverse sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">e,d,c,b,a</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="php-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ <strong>ç­–ç•¥</strong>æ¨¡å¼è¢«ç”¨äºè¡¨ç¤ºç”µå­å•†åŠ¡åº”ç”¨ä¸­çš„æ”¯ä»˜æ–¹å¼ã€‚</p><p>æ¯ç§æ”¯ä»˜æ–¹å¼éƒ½å¯ä»¥å±•ç¤ºç‰¹å®šçš„æ”¯ä»˜è¡¨å•ä»¥æ”¶é›†ç›¸åº”çš„ç”¨æˆ·æ”¯ä»˜ä¿¡æ¯ï¼Œ å¹¶èƒ½å°†å…¶å‘é€ç»™æ”¯ä»˜å¤„ç†å…¬å¸ã€‚ ç„¶åï¼Œ æ”¯ä»˜å¤„ç†å…¬å¸ä¼šå°†ç”¨æˆ·é‡å®šå‘å›æˆ‘ä»¬çš„ç½‘ç«™ï¼Œ ç„¶åæ”¯ä»˜æ–¹æ³•ä¼šéªŒè¯è¿”å›å‚æ•°å¹¶å¸®åŠ©ç¡®å®šè®¢å•æ˜¯å¦å·²å®Œæˆã€‚</p><p><strong>index.php:</strong> çœŸå®ä¸–ç•Œç¤ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru</span>\<span class="title">Strategy</span>\<span class="title">RealWorld</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This is the router and controller of our application. Upon receiving a</span></span><br><span class="line"><span class="comment"> * request, this class decides what behavior should be executed. When the app</span></span><br><span class="line"><span class="comment"> * receives a payment request, the OrderController class also decides which</span></span><br><span class="line"><span class="comment"> * payment method it should use to process the request. Thus, the class acts as</span></span><br><span class="line"><span class="comment"> * the Context and the Client at the same time.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handle POST requests.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params"><span class="keyword">string</span> $url, <span class="keyword">array</span> $data</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Controller: POST request to <span class="subst">$url</span> with &quot;</span> . json_encode($data) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        $path = parse_url($url, PHP_URL_PATH);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;#^/orders?$#&#x27;</span>, $path, $matches)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;postNewOrder($data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Controller: 404 page\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handle GET requests.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="keyword">string</span> $url</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Controller: GET request to <span class="subst">$url</span>\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        $path = parse_url($url, PHP_URL_PATH);</span><br><span class="line">        $query = parse_url($url, PHP_URL_QUERY);</span><br><span class="line">        parse_str($query, $data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;#^/orders?$#&#x27;</span>, $path, $matches)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;getAllOrders();</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (preg_match(<span class="string">&#x27;#^/order/([0-9]+?)/payment/([a-z]+?)(/return)?$#&#x27;</span>, $path, $matches)) &#123;</span><br><span class="line">            $order = Order::get($matches[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// The payment method (strategy) is selected according to the value</span></span><br><span class="line">            <span class="comment">// passed along with the request.</span></span><br><span class="line">            $paymentMethod = PaymentFactory::getPaymentMethod($matches[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">isset</span>($matches[<span class="number">3</span>])) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;getPayment($paymentMethod, $order, $data);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;getPaymentReturn($paymentMethod, $order, $data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Controller: 404 page\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * POST /order &#123;data&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">postNewOrder</span>(<span class="params"><span class="keyword">array</span> $data</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $order = <span class="keyword">new</span> Order($data);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Controller: Created the order #<span class="subst">&#123;$order-&gt;id&#125;</span>.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * GET /orders</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllOrders</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Controller: Here&#x27;s all orders:\n&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (Order::get() <span class="keyword">as</span> $order) &#123;</span><br><span class="line">            <span class="keyword">echo</span> json_encode($order, JSON_PRETTY_PRINT) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * GET /order/123/payment/XX</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPayment</span>(<span class="params">PaymentMethod $method, Order $order, <span class="keyword">array</span> $data</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// The actual work is delegated to the payment method object.</span></span><br><span class="line">        $form = $method-&gt;getPaymentForm($order);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Controller: here&#x27;s the payment form:\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> $form . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * GET /order/123/payment/XXX/return?key=AJHKSJHJ3423&amp;success=true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPaymentReturn</span>(<span class="params">PaymentMethod $method, Order $order, <span class="keyword">array</span> $data</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Another type of work delegated to the payment method.</span></span><br><span class="line">            <span class="keyword">if</span> ($method-&gt;validateReturn($order, $data)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Controller: Thanks for your order!\n&quot;</span>;</span><br><span class="line">                $order-&gt;complete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> $e) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Controller: got an exception (&quot;</span> . $e-&gt;getMessage() . <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A simplified representation of the Order class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * For the sake of simplicity, we&#x27;ll store all created orders here...</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> $orders = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ...and access them from here.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $orderId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="keyword">int</span> $orderId = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($orderId === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">static</span>::$orders;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">static</span>::$orders[$orderId];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Order constructor assigns the values of the order&#x27;s fields. To keep</span></span><br><span class="line"><span class="comment">     * things simple, there is no validation whatsoever.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $attributes</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> $attributes</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id = count(<span class="built_in">static</span>::$orders);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;status = <span class="string">&quot;new&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($attributes <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;&#123;$key&#125; = $value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">static</span>::$orders[<span class="keyword">$this</span>-&gt;id] = <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The method to call when an order gets paid.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">complete</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;status = <span class="string">&quot;completed&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Order: #<span class="subst">&#123;$this-&gt;id&#125;</span> is now <span class="subst">&#123;$this-&gt;status&#125;</span>.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This class helps to produce a proper strategy object for handling a payment.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaymentFactory</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get a payment method by its ID.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> PaymentMethod</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getPaymentMethod</span>(<span class="params"><span class="keyword">string</span> $id</span>): <span class="title">PaymentMethod</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> ($id) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;cc&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> CreditCardPayment();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;paypal&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> PayPalPayment();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">Exception</span>(<span class="string">&quot;Unknown Payment Method&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Strategy interface describes how a client can use various Concrete</span></span><br><span class="line"><span class="comment"> * Strategies.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note that in most examples you can find on the Web, strategies tend to do</span></span><br><span class="line"><span class="comment"> * some tiny thing within one method. However, in reality, your strategies can</span></span><br><span class="line"><span class="comment"> * be much more robust (by having several methods, for example).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PaymentMethod</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPaymentForm</span>(<span class="params">Order $order</span>): <span class="title">string</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">validateReturn</span>(<span class="params">Order $order, <span class="keyword">array</span> $data</span>): <span class="title">bool</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Strategy provides a payment form and validates returns for</span></span><br><span class="line"><span class="comment"> * credit card payments.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreditCardPayment</span> <span class="keyword">implements</span> <span class="title">PaymentMethod</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="keyword">private</span> $store_secret_key = <span class="string">&quot;swordfish&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPaymentForm</span>(<span class="params">Order $order</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $returnURL = <span class="string">&quot;https://our-website.com/&quot;</span> .</span><br><span class="line">            <span class="string">&quot;order/<span class="subst">&#123;$order-&gt;id&#125;</span>/payment/cc/return&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &lt;&lt;&lt;FORM</span><br><span class="line">&lt;form action=<span class="string">&quot;https://my-credit-card-processor.com/charge&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> id=<span class="string">&quot;email&quot;</span> value=<span class="string">&quot;<span class="subst">&#123;$order-&gt;email&#125;</span>&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> id=<span class="string">&quot;total&quot;</span> value=<span class="string">&quot;<span class="subst">&#123;$order-&gt;total&#125;</span>&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> id=<span class="string">&quot;returnURL&quot;</span> value=<span class="string">&quot;<span class="subst">$returnURL</span>&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;cardholder-name&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;credit-card&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;expiration-date&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;ccv-number&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Pay&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">FORM;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">validateReturn</span>(<span class="params">Order $order, <span class="keyword">array</span> $data</span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;CreditCardPayment: ...validating... &quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($data[<span class="string">&#x27;key&#x27;</span>] != md5($order-&gt;id . <span class="built_in">static</span>::$store_secret_key)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">Exception</span>(<span class="string">&quot;Payment key is wrong.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>($data[<span class="string">&#x27;success&#x27;</span>]) || !$data[<span class="string">&#x27;success&#x27;</span>] || $data[<span class="string">&#x27;success&#x27;</span>] == <span class="string">&#x27;false&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">Exception</span>(<span class="string">&quot;Payment failed.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (floatval($data[<span class="string">&#x27;total&#x27;</span>]) &lt; $order-&gt;total) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">Exception</span>(<span class="string">&quot;Payment amount is wrong.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Done!\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Strategy provides a payment form and validates returns for</span></span><br><span class="line"><span class="comment"> * PayPal payments.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayPalPayment</span> <span class="keyword">implements</span> <span class="title">PaymentMethod</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPaymentForm</span>(<span class="params">Order $order</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $returnURL = <span class="string">&quot;https://our-website.com/&quot;</span> .</span><br><span class="line">            <span class="string">&quot;order/<span class="subst">&#123;$order-&gt;id&#125;</span>/payment/paypal/return&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &lt;&lt;&lt;FORM</span><br><span class="line">&lt;form action=<span class="string">&quot;https://paypal.com/payment&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> id=<span class="string">&quot;email&quot;</span> value=<span class="string">&quot;<span class="subst">&#123;$order-&gt;email&#125;</span>&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> id=<span class="string">&quot;total&quot;</span> value=<span class="string">&quot;<span class="subst">&#123;$order-&gt;total&#125;</span>&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> id=<span class="string">&quot;returnURL&quot;</span> value=<span class="string">&quot;<span class="subst">$returnURL</span>&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Pay on PayPal&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">FORM;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">validateReturn</span>(<span class="params">Order $order, <span class="keyword">array</span> $data</span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;PayPalPayment: ...validating... &quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Done!\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">$controller = <span class="keyword">new</span> OrderController();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Client: Let&#x27;s create some orders\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">$controller-&gt;post(<span class="string">&quot;/orders&quot;</span>, [</span><br><span class="line">    <span class="string">&quot;email&quot;</span> =&gt; <span class="string">&quot;me@example.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;product&quot;</span> =&gt; <span class="string">&quot;ABC Cat food (XL)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;total&quot;</span> =&gt; <span class="number">9.95</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$controller-&gt;post(<span class="string">&quot;/orders&quot;</span>, [</span><br><span class="line">    <span class="string">&quot;email&quot;</span> =&gt; <span class="string">&quot;me@example.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;product&quot;</span> =&gt; <span class="string">&quot;XYZ Cat litter (XXL)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;total&quot;</span> =&gt; <span class="number">19.95</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\nClient: List my orders, please\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">$controller-&gt;get(<span class="string">&quot;/orders&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\nClient: I&#x27;d like to pay for the second, show me the payment form\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">$controller-&gt;get(<span class="string">&quot;/order/1/payment/paypal&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\nClient: ...pushes the Pay button...\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\nClient: Oh, I&#x27;m redirected to the PayPal.\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\nClient: ...pays on the PayPal...\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\nClient: Alright, I&#x27;m back with you, guys.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">$controller-&gt;get(<span class="string">&quot;/order/1/payment/paypal/return&quot;</span> .</span><br><span class="line">    <span class="string">&quot;?key=c55a3964833a4b0fa4469ea94a057152&amp;success=true&amp;total=19.95&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Client: Let&#39;s create some orders</span><br><span class="line">Controller: POST request to &#x2F;orders with &#123;&quot;email&quot;:&quot;me@example.com&quot;,&quot;product&quot;:&quot;ABC Cat food (XL)&quot;,&quot;total&quot;:9.95&#125;</span><br><span class="line">Controller: Created the order #0.</span><br><span class="line">Controller: POST request to &#x2F;orders with &#123;&quot;email&quot;:&quot;me@example.com&quot;,&quot;product&quot;:&quot;XYZ Cat litter (XXL)&quot;,&quot;total&quot;:19.95&#125;</span><br><span class="line">Controller: Created the order #1.</span><br><span class="line"></span><br><span class="line">Client: List my orders, please</span><br><span class="line">Controller: GET request to &#x2F;orders</span><br><span class="line">Controller: Here&#39;s all orders:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: 0,</span><br><span class="line">    &quot;status&quot;: &quot;new&quot;,</span><br><span class="line">    &quot;email&quot;: &quot;me@example.com&quot;,</span><br><span class="line">    &quot;product&quot;: &quot;ABC Cat food (XL)&quot;,</span><br><span class="line">    &quot;total&quot;: 9.95</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;status&quot;: &quot;new&quot;,</span><br><span class="line">    &quot;email&quot;: &quot;me@example.com&quot;,</span><br><span class="line">    &quot;product&quot;: &quot;XYZ Cat litter (XXL)&quot;,</span><br><span class="line">    &quot;total&quot;: 19.95</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Client: I&#39;d like to pay for the second, show me the payment form</span><br><span class="line">Controller: GET request to &#x2F;order&#x2F;1&#x2F;payment&#x2F;paypal</span><br><span class="line">Controller: here&#39;s the payment form:</span><br><span class="line">&lt;form action&#x3D;&quot;https:&#x2F;&#x2F;paypal.com&#x2F;payment&quot; method&#x3D;&quot;POST&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; id&#x3D;&quot;email&quot; value&#x3D;&quot;me@example.com&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; id&#x3D;&quot;total&quot; value&#x3D;&quot;19.95&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; id&#x3D;&quot;returnURL&quot; value&#x3D;&quot;https:&#x2F;&#x2F;our-website.com&#x2F;order&#x2F;1&#x2F;payment&#x2F;paypal&#x2F;return&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Pay on PayPal&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">Client: ...pushes the Pay button...</span><br><span class="line"></span><br><span class="line">Client: Oh, I&#39;m redirected to the PayPal.</span><br><span class="line"></span><br><span class="line">Client: ...pays on the PayPal...</span><br><span class="line"></span><br><span class="line">Client: Alright, I&#39;m back with you, guys.</span><br><span class="line">Controller: GET request to &#x2F;order&#x2F;1&#x2F;payment&#x2F;paypal&#x2F;return?key&#x3D;c55a3964833a4b0fa4469ea94a057152&amp;success&#x3D;true&amp;total&#x3D;19.95</span><br><span class="line">PayPalPayment: ...validating... Done!</span><br><span class="line">Controller: Thanks for your order!</span><br><span class="line">Order: #1 is now completed.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-5"><p><strong>åœ¨ Python ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> ç­–ç•¥æ¨¡å¼åœ¨ Python ä»£ç ä¸­å¾ˆå¸¸è§ã€‚ å®ƒç»å¸¸åœ¨å„ç§æ¡†æ¶ä¸­ä½¿ç”¨ï¼Œ èƒ½åœ¨ä¸æ‰©å±•ç±»çš„æƒ…å†µä¸‹å‘ç”¨æˆ·æä¾›æ”¹å˜å…¶è¡Œä¸ºçš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡å…è®¸åµŒå¥—å¯¹è±¡å®Œæˆå®é™…å·¥ä½œçš„æ–¹æ³•ä»¥åŠå…è®¸å°†è¯¥å¯¹è±¡æ›¿æ¢ä¸ºä¸åŒå¯¹è±¡çš„è®¾ç½®å™¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>ç­–ç•¥</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.py:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Context defines the interface of interest to clients.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, strategy: Strategy</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Usually, the Context accepts a strategy through the constructor, but</span></span><br><span class="line"><span class="string">        also provides a setter to change it at runtime.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        self._strategy = strategy</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">strategy</span>(<span class="params">self</span>) -&gt; Strategy:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The Context maintains a reference to one of the Strategy objects. The</span></span><br><span class="line"><span class="string">        Context does not know the concrete class of a strategy. It should work</span></span><br><span class="line"><span class="string">        with all strategies via the Strategy interface.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._strategy</span><br><span class="line"></span><br><span class="line"><span class="meta">    @strategy.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">strategy</span>(<span class="params">self, strategy: Strategy</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Usually, the Context allows replacing a Strategy object at runtime.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        self._strategy = strategy</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_some_business_logic</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The Context delegates some work to the Strategy object instead of</span></span><br><span class="line"><span class="string">        implementing multiple versions of the algorithm on its own.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;Context: Sorting data using the strategy (not sure how it&#x27;ll do it)&quot;</span>)</span><br><span class="line">        result = self._strategy.do_algorithm([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>])</span><br><span class="line">        print(<span class="string">&quot;,&quot;</span>.join(result))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Strategy</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Strategy interface declares operations common to all supported versions</span></span><br><span class="line"><span class="string">    of some algorithm.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The Context uses this interface to call the algorithm defined by Concrete</span></span><br><span class="line"><span class="string">    Strategies.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_algorithm</span>(<span class="params">self, data: List</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Strategies implement the algorithm while following the base Strategy</span></span><br><span class="line"><span class="string">interface. The interface makes them interchangeable in the Context.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyA</span>(<span class="params">Strategy</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_algorithm</span>(<span class="params">self, data: List</span>) -&gt; List:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sorted</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyB</span>(<span class="params">Strategy</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_algorithm</span>(<span class="params">self, data: List</span>) -&gt; List:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">reversed</span>(<span class="built_in">sorted</span>(data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># The client code picks a concrete strategy and passes it to the context.</span></span><br><span class="line">    <span class="comment"># The client should be aware of the differences between strategies in order</span></span><br><span class="line">    <span class="comment"># to make the right choice.</span></span><br><span class="line"></span><br><span class="line">    context = Context(ConcreteStrategyA())</span><br><span class="line">    print(<span class="string">&quot;Client: Strategy is set to normal sorting.&quot;</span>)</span><br><span class="line">    context.do_some_business_logic()</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;Client: Strategy is set to reverse sorting.&quot;</span>)</span><br><span class="line">    context.strategy = ConcreteStrategyB()</span><br><span class="line">    context.do_some_business_logic()</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Client: Strategy is set to normal sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">a,b,c,d,e</span><br><span class="line"></span><br><span class="line">Client: Strategy is set to reverse sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">e,d,c,b,a</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-6"><p><strong>åœ¨ Ruby ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> ç­–ç•¥æ¨¡å¼åœ¨ Ruby ä»£ç ä¸­å¾ˆå¸¸è§ã€‚ å®ƒç»å¸¸åœ¨å„ç§æ¡†æ¶ä¸­ä½¿ç”¨ï¼Œ èƒ½åœ¨ä¸æ‰©å±•ç±»çš„æƒ…å†µä¸‹å‘ç”¨æˆ·æä¾›æ”¹å˜å…¶è¡Œä¸ºçš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡å…è®¸åµŒå¥—å¯¹è±¡å®Œæˆå®é™…å·¥ä½œçš„æ–¹æ³•ä»¥åŠå…è®¸å°†è¯¥å¯¹è±¡æ›¿æ¢ä¸ºä¸åŒå¯¹è±¡çš„è®¾ç½®å™¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>ç­–ç•¥</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.rb:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The Context defines the interface of interest to clients.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span></span></span><br><span class="line">  <span class="comment"># The Context maintains a reference to one of the Strategy objects. The</span></span><br><span class="line">  <span class="comment"># Context does not know the concrete class of a strategy. It should work with</span></span><br><span class="line">  <span class="comment"># all strategies via the Strategy interface.</span></span><br><span class="line">  <span class="keyword">attr_writer</span> <span class="symbol">:strategy</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Usually, the Context accepts a strategy through the constructor, but also</span></span><br><span class="line">  <span class="comment"># provides a setter to change it at runtime.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(strategy)</span></span></span><br><span class="line">    @strategy = strategy</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Usually, the Context allows replacing a Strategy object at runtime.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">strategy=</span><span class="params">(strategy)</span></span></span><br><span class="line">    @strategy = strategy</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The Context delegates some work to the Strategy object instead of</span></span><br><span class="line">  <span class="comment"># implementing multiple versions of the algorithm on its own.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">do_some_business_logic</span></span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">    puts <span class="string">&#x27;Context: Sorting data using the strategy (not sure how it\&#x27;ll do it)&#x27;</span></span><br><span class="line">    result = @strategy.do_algorithm(<span class="string">%w[a b c d e]</span>)</span><br><span class="line">    print result.join(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Strategy interface declares operations common to all supported versions of</span></span><br><span class="line"><span class="comment"># some algorithm.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The Context uses this interface to call the algorithm defined by Concrete</span></span><br><span class="line"><span class="comment"># Strategies.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Strategy</span></span></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Array] data</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">do_algorithm</span><span class="params">(_data)</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concrete Strategies implement the algorithm while following the base Strategy</span></span><br><span class="line"><span class="comment"># interface. The interface makes them interchangeable in the Context.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyA</span> &lt; Strategy</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Array] data</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@return</span> [Array]</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">do_algorithm</span><span class="params">(data)</span></span></span><br><span class="line">    data.sort</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyB</span> &lt; Strategy</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Array] data</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@return</span> [Array]</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">do_algorithm</span><span class="params">(data)</span></span></span><br><span class="line">    data.sort.reverse</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code picks a concrete strategy and passes it to the context. The</span></span><br><span class="line"><span class="comment"># client should be aware of the differences between strategies in order to make</span></span><br><span class="line"><span class="comment"># the right choice.</span></span><br><span class="line"></span><br><span class="line">context = Context.new(ConcreteStrategyA.new)</span><br><span class="line">puts <span class="string">&#x27;Client: Strategy is set to normal sorting.&#x27;</span></span><br><span class="line">context.do_some_business_logic</span><br><span class="line">puts <span class="string">&quot;\n\n&quot;</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">&#x27;Client: Strategy is set to reverse sorting.&#x27;</span></span><br><span class="line">context.strategy = ConcreteStrategyB.new</span><br><span class="line">context.do_some_business_logic</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Client: Strategy is set to normal sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">a,b,c,d,e</span><br><span class="line"></span><br><span class="line">Client: Strategy is set to reverse sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">e,d,c,b,a</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-7"><p><strong>åœ¨ Swift ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> ç­–ç•¥æ¨¡å¼åœ¨ Swift ä»£ç ä¸­å¾ˆå¸¸è§ã€‚ å®ƒç»å¸¸åœ¨å„ç§æ¡†æ¶ä¸­ä½¿ç”¨ï¼Œ èƒ½åœ¨ä¸æ‰©å±•ç±»çš„æƒ…å†µä¸‹å‘ç”¨æˆ·æä¾›æ”¹å˜å…¶è¡Œä¸ºçš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡å…è®¸åµŒå¥—å¯¹è±¡å®Œæˆå®é™…å·¥ä½œçš„æ–¹æ³•ä»¥åŠå…è®¸å°†è¯¥å¯¹è±¡æ›¿æ¢ä¸ºä¸åŒå¯¹è±¡çš„è®¾ç½®å™¨æ¥è¯†åˆ«ã€‚</p><div class="tabs" id="swift"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#swift-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#swift-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="swift-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>ç­–ç•¥</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ Swift åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>Example.swift:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Context defines the interface of interest to clients.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The Context maintains a reference to one of the Strategy objects. The</span></span><br><span class="line">    <span class="comment">/// Context does not know the concrete class of a strategy. It should work</span></span><br><span class="line">    <span class="comment">/// with all strategies via the Strategy interface.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> strategy: <span class="type">Strategy</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Usually, the Context accepts a strategy through the constructor, but</span></span><br><span class="line">    <span class="comment">/// also provides a setter to change it at runtime.</span></span><br><span class="line">    <span class="keyword">init</span>(strategy: <span class="type">Strategy</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.strategy = strategy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Usually, the Context allows replacing a Strategy object at runtime.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(strategy: Strategy)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.strategy = strategy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The Context delegates some work to the Strategy object instead of</span></span><br><span class="line">    <span class="comment">/// implementing multiple versions of the algorithm on its own.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">doSomeBusinessLogic</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Context: Sorting data using the strategy (not sure how it&#x27;ll do it)\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> result = strategy.doAlgorithm([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>])</span><br><span class="line">        <span class="built_in">print</span>(result.joined(separator: <span class="string">&quot;,&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Strategy interface declares operations common to all supported versions</span></span><br><span class="line"><span class="comment">/// of some algorithm.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// The Context uses this interface to call the algorithm defined by Concrete</span></span><br><span class="line"><span class="comment">/// Strategies.</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">doAlgorithm</span>&lt;T: Comparable&gt;<span class="params">(<span class="number">_</span> data: [T])</span></span> -&gt; [<span class="type">T</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Concrete Strategies implement the algorithm while following the base</span></span><br><span class="line"><span class="comment">/// Strategy interface. The interface makes them interchangeable in the Context.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyA</span>: <span class="title">Strategy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">doAlgorithm</span>&lt;T: Comparable&gt;<span class="params">(<span class="number">_</span> data: [T])</span></span> -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> data.sorted()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyB</span>: <span class="title">Strategy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">doAlgorithm</span>&lt;T: Comparable&gt;<span class="params">(<span class="number">_</span> data: [T])</span></span> -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> data.sorted(by: &gt;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all works together.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrategyConceptual</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// The client code picks a concrete strategy and passes it to the</span></span><br><span class="line">        <span class="comment">/// context. The client should be aware of the differences between</span></span><br><span class="line">        <span class="comment">/// strategies in order to make the right choice.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">Context</span>(strategy: <span class="type">ConcreteStrategyA</span>())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Client: Strategy is set to normal sorting.\n&quot;</span>)</span><br><span class="line">        context.doSomeBusinessLogic()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nClient: Strategy is set to reverse sorting.\n&quot;</span>)</span><br><span class="line">        context.update(strategy: <span class="type">ConcreteStrategyB</span>())</span><br><span class="line">        context.doSomeBusinessLogic()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Client: Strategy is set to normal sorting.</span><br><span class="line"></span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line"></span><br><span class="line">a,b,c,d,e</span><br><span class="line"></span><br><span class="line">Client: Strategy is set to reverse sorting.</span><br><span class="line"></span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line"></span><br><span class="line">e,d,c,b,a</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="swift-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p><strong>Example.swift:</strong> çœŸå®ä¸–ç•Œç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrategyRealWorld</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// This example shows a simple implementation of a list controller that is</span></span><br><span class="line">    <span class="comment">/// able to display models from different data sources:</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// (MemoryStorage, CoreDataStorage, RealmStorage)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> controller = <span class="type">ListController</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> memoryStorage = <span class="type">MemoryStorage</span>&lt;<span class="type">User</span>&gt;()</span><br><span class="line">        memoryStorage.add(usersFromNetwork())</span><br><span class="line"></span><br><span class="line">        clientCode(use: controller, with: memoryStorage)</span><br><span class="line"></span><br><span class="line">        clientCode(use: controller, with: <span class="type">CoreDataStorage</span>())</span><br><span class="line"></span><br><span class="line">        clientCode(use: controller, with: <span class="type">RealmStorage</span>())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">clientCode</span><span class="params">(use controller: ListController, with dataSource: DataSource)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        controller.update(dataSource: dataSource)</span><br><span class="line">        controller.displayModels()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">usersFromNetwork</span><span class="params">()</span></span> -&gt; [<span class="type">User</span>] &#123;</span><br><span class="line">        <span class="keyword">let</span> firstUser = <span class="type">User</span>(id: <span class="number">1</span>, username: <span class="string">&quot;username1&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> secondUser = <span class="type">User</span>(id: <span class="number">2</span>, username: <span class="string">&quot;username2&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> [firstUser, secondUser]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> dataSource: <span class="type">DataSource?</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(dataSource: DataSource)</span></span> &#123;</span><br><span class="line">        <span class="comment">/// ... resest current states ...</span></span><br><span class="line">        <span class="keyword">self</span>.dataSource = dataSource</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">displayModels</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> dataSource = dataSource <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="keyword">let</span> models = dataSource.loadModels() <span class="keyword">as</span> [<span class="type">User</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Bind models to cells of a list view...</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nListController: Displaying models...&quot;</span>)</span><br><span class="line">        models.forEach(&#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">DataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadModels</span>&lt;T: DomainModel&gt;<span class="params">()</span></span> -&gt; [<span class="type">T</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MemoryStorage</span>&lt;<span class="title">Model</span>&gt;: <span class="title">DataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> items = [<span class="type">Model</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(<span class="number">_</span> items: [Model])</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.items.append(contentsOf: items)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadModels</span>&lt;T: DomainModel&gt;<span class="params">()</span></span> -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="type">T</span>.<span class="keyword">self</span> == <span class="type">User</span>.<span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</span><br><span class="line">        <span class="keyword">return</span> items <span class="keyword">as</span>! [<span class="type">T</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoreDataStorage</span>: <span class="title">DataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadModels</span>&lt;T: DomainModel&gt;<span class="params">()</span></span> -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="type">T</span>.<span class="keyword">self</span> == <span class="type">User</span>.<span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> firstUser = <span class="type">User</span>(id: <span class="number">3</span>, username: <span class="string">&quot;username3&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> secondUser = <span class="type">User</span>(id: <span class="number">4</span>, username: <span class="string">&quot;username4&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [firstUser, secondUser] <span class="keyword">as</span>! [<span class="type">T</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RealmStorage</span>: <span class="title">DataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadModels</span>&lt;T: DomainModel&gt;<span class="params">()</span></span> -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="type">T</span>.<span class="keyword">self</span> == <span class="type">User</span>.<span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> firstUser = <span class="type">User</span>(id: <span class="number">5</span>, username: <span class="string">&quot;username5&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> secondUser = <span class="type">User</span>(id: <span class="number">6</span>, username: <span class="string">&quot;username6&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [firstUser, secondUser] <span class="keyword">as</span>! [<span class="type">T</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">DomainModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span>: <span class="title">DomainModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> username: <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ListController: Displaying models...</span><br><span class="line">User(id: 1, username: &quot;username1&quot;)</span><br><span class="line">User(id: 2, username: &quot;username2&quot;)</span><br><span class="line"></span><br><span class="line">ListController: Displaying models...</span><br><span class="line">User(id: 3, username: &quot;username3&quot;)</span><br><span class="line">User(id: 4, username: &quot;username4&quot;)</span><br><span class="line"></span><br><span class="line">ListController: Displaying models...</span><br><span class="line">User(id: 5, username: &quot;username5&quot;)</span><br><span class="line">User(id: 6, username: &quot;username6&quot;)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-8"><p><strong>åœ¨ TypeScript ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> ç­–ç•¥æ¨¡å¼åœ¨ TypeScript ä»£ç ä¸­å¾ˆå¸¸è§ã€‚ å®ƒç»å¸¸åœ¨å„ç§æ¡†æ¶ä¸­ä½¿ç”¨ï¼Œ èƒ½åœ¨ä¸æ‰©å±•ç±»çš„æƒ…å†µä¸‹å‘ç”¨æˆ·æä¾›æ”¹å˜å…¶è¡Œä¸ºçš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡å…è®¸åµŒå¥—å¯¹è±¡å®Œæˆå®é™…å·¥ä½œçš„æ–¹æ³•ä»¥åŠå…è®¸å°†è¯¥å¯¹è±¡æ›¿æ¢ä¸ºä¸åŒå¯¹è±¡çš„è®¾ç½®å™¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>ç­–ç•¥</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>index.ts:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Context defines the interface of interest to clients.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type <span class="type">&#123;Strategy&#125;</span> </span>The Context maintains a reference to one of the Strategy</span></span><br><span class="line"><span class="comment">     * objects. The Context does not know the concrete class of a strategy. It</span></span><br><span class="line"><span class="comment">     * should work with all strategies via the Strategy interface.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> strategy: Strategy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the Context accepts a strategy through the constructor, but also</span></span><br><span class="line"><span class="comment">     * provides a setter to change it at runtime.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">strategy: Strategy</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the Context allows replacing a Strategy object at runtime.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">setStrategy</span>(<span class="params">strategy: Strategy</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Context delegates some work to the Strategy object instead of</span></span><br><span class="line"><span class="comment">     * implementing multiple versions of the algorithm on its own.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> doSomeBusinessLogic(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Context: Sorting data using the strategy (not sure how it\&#x27;ll do it)&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> result = <span class="built_in">this</span>.strategy.doAlgorithm([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>]);</span><br><span class="line">        <span class="built_in">console</span>.log(result.join(<span class="string">&#x27;,&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Strategy interface declares operations common to all supported versions</span></span><br><span class="line"><span class="comment"> * of some algorithm.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The Context uses this interface to call the algorithm defined by Concrete</span></span><br><span class="line"><span class="comment"> * Strategies.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> Strategy &#123;</span><br><span class="line">    doAlgorithm(data: <span class="built_in">string</span>[]): <span class="built_in">string</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Strategies implement the algorithm while following the base Strategy</span></span><br><span class="line"><span class="comment"> * interface. The interface makes them interchangeable in the Context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyA</span> <span class="title">implements</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> doAlgorithm(data: <span class="built_in">string</span>[]): <span class="built_in">string</span>[] &#123;</span><br><span class="line">        <span class="keyword">return</span> data.sort();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyB</span> <span class="title">implements</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> doAlgorithm(data: <span class="built_in">string</span>[]): <span class="built_in">string</span>[] &#123;</span><br><span class="line">        <span class="keyword">return</span> data.reverse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code picks a concrete strategy and passes it to the context. The</span></span><br><span class="line"><span class="comment"> * client should be aware of the differences between strategies in order to make</span></span><br><span class="line"><span class="comment"> * the right choice.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStrategyA());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Client: Strategy is set to normal sorting.&#x27;</span>);</span><br><span class="line">context.doSomeBusinessLogic();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Client: Strategy is set to reverse sorting.&#x27;</span>);</span><br><span class="line">context.setStrategy(<span class="keyword">new</span> ConcreteStrategyB());</span><br><span class="line">context.doSomeBusinessLogic();</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Client: Strategy is set to normal sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">a,b,c,d,e</span><br><span class="line"></span><br><span class="line">Client: Strategy is set to reverse sorting.</span><br><span class="line">Context: Sorting data using the strategy (not sure how it&#39;ll do it)</span><br><span class="line">e,d,c,b,a</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-9"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æ€è€ƒä¸€ä¸‹æ„å»ºå†…å­˜ç¼“å­˜çš„æƒ…å½¢ã€‚ ç”±äºå¤„åœ¨å†…å­˜ä¸­ï¼Œ æ•…å…¶å¤§å°ä¼šå­˜åœ¨é™åˆ¶ã€‚ åœ¨è¾¾åˆ°å…¶ä¸Šé™åï¼Œ ä¸€äº›æ¡ç›®å°±å¿…é¡»è¢«ç§»é™¤ä»¥ç•™å‡ºç©ºé—´ã€‚ æ­¤ç±»æ“ä½œå¯é€šè¿‡å¤šç§ç®—æ³•è¿›è¡Œå®ç°ã€‚ ä¸€äº›æµè¡Œçš„ç®—æ³•æœ‰ï¼š</p><ul><li>æœ€å°‘æœ€è¿‘ä½¿ç”¨ ï¼ˆLRUï¼‰ï¼š ç§»é™¤æœ€è¿‘ä½¿ç”¨æœ€å°‘çš„ä¸€æ¡æ¡ç›®ã€‚</li><li>å…ˆè¿›å…ˆå‡º ï¼ˆFIFOï¼‰ï¼š ç§»é™¤æœ€æ—©åˆ›å»ºçš„æ¡ç›®ã€‚</li><li>æœ€å°‘ä½¿ç”¨ ï¼ˆLFUï¼‰ï¼š ç§»é™¤ä½¿ç”¨é¢‘ç‡æœ€ä½ä¸€æ¡æ¡ç›®ã€‚</li></ul><p>é—®é¢˜åœ¨äºå¦‚ä½•å°†æˆ‘ä»¬çš„ç¼“å­˜ç±»ä¸è¿™äº›ç®—æ³•è§£è€¦ï¼Œ ä»¥ä¾¿åœ¨è¿è¡Œæ—¶æ›´æ”¹ç®—æ³•ã€‚ æ­¤å¤–ï¼Œ åœ¨æ·»åŠ æ–°ç®—æ³•æ—¶ï¼Œ ç¼“å­˜ç±»ä¸åº”æ”¹å˜ã€‚</p><p>è¿™å°±æ˜¯ç­–ç•¥æ¨¡å¼å‘æŒ¥ä½œç”¨çš„åœºæ™¯ã€‚ å¯åˆ›å»ºä¸€ç³»åˆ—çš„ç®—æ³•ï¼Œ æ¯ä¸ªç®—æ³•éƒ½æœ‰è‡ªå·±çš„ç±»ã€‚ è¿™äº›ç±»ä¸­çš„æ¯ä¸€ä¸ªéƒ½éµå¾ªç›¸åŒçš„æ¥å£ï¼Œ è¿™ä½¿å¾—ç³»åˆ—ç®—æ³•ä¹‹é—´å¯ä»¥äº’æ¢ã€‚ å‡è®¾é€šç”¨æ¥å£åç§°ä¸º <code>evictionÂ­Algo</code>ç§»é™¤ç®—æ³• ã€‚</p><p>ç°åœ¨ï¼Œ æˆ‘ä»¬çš„ä¸»è¦ç¼“å­˜ç±»å°†åµŒå…¥è‡³ <code>evictionÂ­Algo</code>æ¥å£ä¸­ã€‚ ç¼“å­˜ç±»ä¼šå°†å…¨éƒ¨ç±»å‹çš„ç§»é™¤ç®—æ³•å§”æ´¾ç»™ <code>evictionÂ­Algo</code>æ¥å£ï¼Œ è€Œä¸æ˜¯è‡ªè¡Œå®ç°ã€‚ é‰´äº <code>evictionÂ­Algo</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œ æˆ‘ä»¬å¯åœ¨è¿è¡Œæ—¶å°†ç®—æ³•æ›´æ”¹ä¸º LRUã€ FIFO æˆ–è€… LFUï¼Œ è€Œä¸éœ€è¦å¯¹ç¼“å­˜ç±»åšå‡ºä»»ä½•æ›´æ”¹ã€‚</p><p><strong>evictionAlgo.go:</strong> ç­–ç•¥æ¥å£</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> evictionAlgo <span class="keyword">interface</span> &#123;</span><br><span class="line">    evict(c *cache)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>fifo.go:</strong> å…·ä½“ç­–ç•¥</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> fifo <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *fifo)</span> <span class="title">evict</span><span class="params">(c *cache)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Evicting by fifo strtegy&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>lru.go:</strong> å…·ä½“ç­–ç•¥</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> lru <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *lru)</span> <span class="title">evict</span><span class="params">(c *cache)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Evicting by lru strtegy&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>lfu.go:</strong> å…·ä½“ç­–ç•¥</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> lfu <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *lfu)</span> <span class="title">evict</span><span class="params">(c *cache)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Evicting by lfu strtegy&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>cache.go:</strong> èƒŒæ™¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> cache <span class="keyword">struct</span> &#123;</span><br><span class="line">    storage      <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line">    evictionAlgo evictionAlgo</span><br><span class="line">    capacity     <span class="keyword">int</span></span><br><span class="line">    maxCapacity  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initCache</span><span class="params">(e evictionAlgo)</span> *<span class="title">cache</span></span> &#123;</span><br><span class="line">    storage := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">    <span class="keyword">return</span> &amp;cache&#123;</span><br><span class="line">        storage:      storage,</span><br><span class="line">        evictionAlgo: e,</span><br><span class="line">        capacity:     <span class="number">0</span>,</span><br><span class="line">        maxCapacity:  <span class="number">2</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cache)</span> <span class="title">setEvictionAlgo</span><span class="params">(e evictionAlgo)</span></span> &#123;</span><br><span class="line">    c.evictionAlgo = e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cache)</span> <span class="title">add</span><span class="params">(key, value <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> c.capacity == c.maxCapacity &#123;</span><br><span class="line">        c.evict()</span><br><span class="line">    &#125;</span><br><span class="line">    c.capacity++</span><br><span class="line">    c.storage[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cache)</span> <span class="title">get</span><span class="params">(key <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="built_in">delete</span>(c.storage, key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cache)</span> <span class="title">evict</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c.evictionAlgo.evict(c)</span><br><span class="line">    c.capacity--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>main.go:</strong> å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    lfu := &amp;lfu&#123;&#125;</span><br><span class="line">    cache := initCache(lfu)</span><br><span class="line"></span><br><span class="line">    cache.add(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    cache.add(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    cache.add(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line"></span><br><span class="line">    lru := &amp;lru&#123;&#125;</span><br><span class="line">    cache.setEvictionAlgo(lru)</span><br><span class="line"></span><br><span class="line">    cache.add(<span class="string">&quot;d&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line"></span><br><span class="line">    fifo := &amp;fifo&#123;&#125;</span><br><span class="line">    cache.setEvictionAlgo(fifo)</span><br><span class="line"></span><br><span class="line">    cache.add(<span class="string">&quot;e&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Evicting by lfu strtegy</span><br><span class="line">Evicting by lru strtegy</span><br><span class="line">Evicting by fifo strtegy</span><br></pre></td></tr></table></figure><p><em>æ ¹æ®ï¼š <a href="https://golangbyexample.com/strategy-design-pattern-golang/">Golang By Example</a></em></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://refactoringguru.cn/design-patterns/strategy&quot;&gt;https://refactoringguru.cn/design-patterns/strategy&lt;/a&gt;&lt;/p&gt;
&lt;/
      
    
    </summary>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>è¡Œä¸ºæ¨¡å¼-çŠ¶æ€æ¨¡å¼</title>
    <link href="http://wangyangyangisme.github.io/posts/95d77da4/"/>
    <id>http://wangyangyangisme.github.io/posts/95d77da4/</id>
    <published>2021-05-04T12:24:54.000Z</published>
    <updated>2021-05-04T12:24:54.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://refactoringguru.cn/design-patterns/state">https://refactoringguru.cn/design-patterns/state</a></p></blockquote><h1 id="è¡Œä¸ºæ¨¡å¼-çŠ¶æ€æ¨¡å¼"><a href="#è¡Œä¸ºæ¨¡å¼-çŠ¶æ€æ¨¡å¼" class="headerlink" title="è¡Œä¸ºæ¨¡å¼-çŠ¶æ€æ¨¡å¼"></a>è¡Œä¸ºæ¨¡å¼-çŠ¶æ€æ¨¡å¼</h1><p><strong>äº¦ç§°ï¼š</strong> State</p><h2 id="æ„å›¾"><a href="#æ„å›¾" class="headerlink" title="æ„å›¾"></a>æ„å›¾</h2><p><strong>çŠ¶æ€æ¨¡å¼</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ è®©ä½ èƒ½åœ¨ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å˜åŒ–æ—¶æ”¹å˜å…¶è¡Œä¸ºï¼Œ ä½¿å…¶çœ‹ä¸Šå»å°±åƒæ”¹å˜äº†è‡ªèº«æ‰€å±çš„ç±»ä¸€æ ·ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/state-zh.png" alt=""></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>çŠ¶æ€æ¨¡å¼ä¸<a href="https://en.wikipedia.org/wiki/Finite-state_machine">æœ‰é™çŠ¶æ€æœº</a>çš„æ¦‚å¿µç´§å¯†ç›¸å…³ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/problem1-state.png" alt="æœ‰é™çŠ¶æ€æœºã€‚"></p><p>å…¶ä¸»è¦æ€æƒ³æ˜¯ç¨‹åºåœ¨ä»»æ„æ—¶åˆ»ä»…å¯å¤„äºå‡ ç§<em>æœ‰é™</em>çš„<em>çŠ¶æ€</em>ä¸­ã€‚ åœ¨ä»»ä½•ä¸€ä¸ªç‰¹å®šçŠ¶æ€ä¸­ï¼Œ ç¨‹åºçš„è¡Œä¸ºéƒ½ä¸ç›¸åŒï¼Œ ä¸”å¯ç¬é—´ä»ä¸€ä¸ªçŠ¶æ€åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçŠ¶æ€ã€‚ ä¸è¿‡ï¼Œ æ ¹æ®å½“å‰çŠ¶æ€ï¼Œ ç¨‹åºå¯èƒ½ä¼šåˆ‡æ¢åˆ°å¦å¤–ä¸€ç§çŠ¶æ€ï¼Œ ä¹Ÿå¯èƒ½ä¼šä¿æŒå½“å‰çŠ¶æ€ä¸å˜ã€‚ è¿™äº›æ•°é‡æœ‰é™ä¸”é¢„å…ˆå®šä¹‰çš„çŠ¶æ€åˆ‡æ¢è§„åˆ™è¢«ç§°ä¸º<em>è½¬ç§»</em>ã€‚</p><p>ä½ è¿˜å¯å°†è¯¥æ–¹æ³•åº”ç”¨åœ¨å¯¹è±¡ä¸Šã€‚ å‡å¦‚ä½ æœ‰ä¸€ä¸ª <code>æ–‡æ¡£</code>Documentç±»ã€‚ æ–‡æ¡£å¯èƒ½ä¼šå¤„äº <code>è‰ç¨¿</code>Draft ã€  <code>å®¡é˜…ä¸­</code>Moderationå’Œ <code>å·²å‘å¸ƒ</code>Publishedä¸‰ç§çŠ¶æ€ä¸­çš„ä¸€ç§ã€‚ æ–‡æ¡£çš„ <code>publish</code>å‘å¸ƒæ–¹æ³•åœ¨ä¸åŒçŠ¶æ€ä¸‹çš„è¡Œä¸ºç•¥æœ‰ä¸åŒï¼š</p><ul><li>å¤„äº <code>è‰ç¨¿</code>çŠ¶æ€æ—¶ï¼Œ å®ƒä¼šå°†æ–‡æ¡£è½¬ç§»åˆ°å®¡é˜…ä¸­çŠ¶æ€ã€‚</li><li>å¤„äº <code>å®¡é˜…ä¸­</code>çŠ¶æ€æ—¶ï¼Œ å¦‚æœå½“å‰ç”¨æˆ·æ˜¯ç®¡ç†å‘˜ï¼Œ å®ƒä¼šå…¬å¼€å‘å¸ƒæ–‡æ¡£ã€‚</li><li>å¤„äº <code>å·²å‘å¸ƒ</code>çŠ¶æ€æ—¶ï¼Œ å®ƒä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/problem2-zh-state.png" alt="æ–‡æ¡£å¯¹è±¡çš„å…¨éƒ¨çŠ¶æ€å’Œè½¬ç§»ã€‚"></p><p>çŠ¶æ€æœºé€šå¸¸ç”±ä¼—å¤šæ¡ä»¶è¿ç®—ç¬¦ ï¼ˆ <code>if</code>æˆ– <code>switch</code> ï¼‰ å®ç°ï¼Œ å¯æ ¹æ®å¯¹è±¡çš„å½“å‰çŠ¶æ€é€‰æ‹©ç›¸åº”çš„è¡Œä¸ºã€‚  â€œçŠ¶æ€â€ é€šå¸¸åªæ˜¯å¯¹è±¡ä¸­çš„ä¸€ç»„æˆå‘˜å˜é‡å€¼ã€‚ å³ä½¿ä½ ä¹‹å‰ä»æœªå¬è¯´è¿‡æœ‰é™çŠ¶æ€æœºï¼Œ ä½ ä¹Ÿå¾ˆå¯èƒ½å·²ç»å®ç°è¿‡çŠ¶æ€æ¨¡å¼ã€‚ ä¸‹é¢çš„ä»£ç åº”è¯¥èƒ½å¸®åŠ©ä½ å›å¿†èµ·æ¥ã€‚</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Document <span class="keyword">is</span></span><br><span class="line">    field state: <span class="keyword">string</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    method publish() <span class="keyword">is</span></span><br><span class="line">        switch (state)</span><br><span class="line">            &quot;draft&quot;:</span><br><span class="line">                state = &quot;moderation&quot;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &quot;moderation&quot;:</span><br><span class="line">                <span class="keyword">if</span> (currentUser.role == <span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">                    state = &quot;published&quot;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &quot;published&quot;:</span><br><span class="line">                <span class="comment">// ä»€ä¹ˆä¹Ÿä¸åšã€‚</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬é€æ­¥åœ¨ <code>æ–‡æ¡£</code>ç±»ä¸­æ·»åŠ æ›´å¤šçŠ¶æ€å’Œä¾èµ–äºçŠ¶æ€çš„è¡Œä¸ºåï¼Œ åŸºäºæ¡ä»¶è¯­å¥çš„çŠ¶æ€æœºå°±ä¼šæš´éœ²å…¶æœ€å¤§çš„å¼±ç‚¹ã€‚ ä¸ºäº†èƒ½æ ¹æ®å½“å‰çŠ¶æ€é€‰æ‹©å®Œæˆç›¸åº”è¡Œä¸ºçš„æ–¹æ³•ï¼Œ ç»å¤§éƒ¨åˆ†æ–¹æ³•ä¸­ä¼šåŒ…å«å¤æ‚çš„æ¡ä»¶è¯­å¥ã€‚ ä¿®æ”¹å…¶è½¬æ¢é€»è¾‘å¯èƒ½ä¼šæ¶‰åŠåˆ°ä¿®æ”¹æ‰€æœ‰æ–¹æ³•ä¸­çš„çŠ¶æ€æ¡ä»¶è¯­å¥ï¼Œ å¯¼è‡´ä»£ç çš„ç»´æŠ¤å·¥ä½œéå¸¸è‰°éš¾ã€‚</p><p>è¿™ä¸ªé—®é¢˜ä¼šéšç€é¡¹ç›®è¿›è¡Œå˜å¾—è¶Šå‘ä¸¥é‡ã€‚ æˆ‘ä»¬å¾ˆéš¾åœ¨è®¾è®¡é˜¶æ®µé¢„æµ‹åˆ°æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€å’Œè½¬æ¢ã€‚ éšç€æ—¶é—´æ¨ç§»ï¼Œ æœ€åˆä»…åŒ…å«æœ‰é™æ¡ä»¶è¯­å¥çš„ç®€æ´çŠ¶æ€æœºå¯èƒ½ä¼šå˜æˆè‡ƒè‚¿çš„ä¸€å›¢ä¹±éº»ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>çŠ¶æ€æ¨¡å¼å»ºè®®ä¸ºå¯¹è±¡çš„æ‰€æœ‰å¯èƒ½çŠ¶æ€æ–°å»ºä¸€ä¸ªç±»ï¼Œ ç„¶åå°†æ‰€æœ‰çŠ¶æ€çš„å¯¹åº”è¡Œä¸ºæŠ½å–åˆ°è¿™äº›ç±»ä¸­ã€‚</p><p>åŸå§‹å¯¹è±¡è¢«ç§°ä¸º<em>ä¸Šä¸‹æ–‡</em> ï¼ˆcontextï¼‰ï¼Œ å®ƒå¹¶ä¸ä¼šè‡ªè¡Œå®ç°æ‰€æœ‰è¡Œä¸ºï¼Œ è€Œæ˜¯ä¼šä¿å­˜ä¸€ä¸ªæŒ‡å‘è¡¨ç¤ºå½“å‰çŠ¶æ€çš„çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨ï¼Œ ä¸”å°†æ‰€æœ‰ä¸çŠ¶æ€ç›¸å…³çš„å·¥ä½œå§”æ´¾ç»™è¯¥å¯¹è±¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/solution-zh-state.png" alt="æ–‡æ¡£å°†å·¥ä½œå§”æ´¾ç»™ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ã€‚"></p><p>å¦‚éœ€å°†ä¸Šä¸‹æ–‡è½¬æ¢ä¸ºå¦å¤–ä¸€ç§çŠ¶æ€ï¼Œ åˆ™éœ€å°†å½“å‰æ´»åŠ¨çš„çŠ¶æ€å¯¹è±¡æ›¿æ¢ä¸ºå¦å¤–ä¸€ä¸ªä»£è¡¨æ–°çŠ¶æ€çš„å¯¹è±¡ã€‚ é‡‡ç”¨è¿™ç§æ–¹å¼æ˜¯æœ‰å‰æçš„ï¼š æ‰€æœ‰çŠ¶æ€ç±»éƒ½å¿…é¡»éµå¾ªåŒæ ·çš„æ¥å£ï¼Œ è€Œä¸”ä¸Šä¸‹æ–‡å¿…é¡»ä»…é€šè¿‡æ¥å£ä¸è¿™äº›å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚</p><p>è¿™ä¸ªç»“æ„å¯èƒ½çœ‹ä¸Šå»ä¸<a href="https://refactoringguru.cn/design-patterns/strategy">ç­–ç•¥</a>æ¨¡å¼ç›¸ä¼¼ï¼Œ ä½†æœ‰ä¸€ä¸ªå…³é”®æ€§çš„ä¸åŒâ€”â€”åœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼Œ ç‰¹å®šçŠ¶æ€çŸ¥é“å…¶ä»–æ‰€æœ‰çŠ¶æ€çš„å­˜åœ¨ï¼Œ ä¸”èƒ½è§¦å‘ä»ä¸€ä¸ªçŠ¶æ€åˆ°å¦ä¸€ä¸ªçŠ¶æ€çš„è½¬æ¢ï¼› ç­–ç•¥åˆ™å‡ ä¹å®Œå…¨ä¸çŸ¥é“å…¶ä»–ç­–ç•¥çš„å­˜åœ¨ã€‚</p><h2 id="çœŸå®ä¸–ç•Œç±»æ¯”"><a href="#çœŸå®ä¸–ç•Œç±»æ¯”" class="headerlink" title="çœŸå®ä¸–ç•Œç±»æ¯”"></a>çœŸå®ä¸–ç•Œç±»æ¯”</h2><p>æ™ºèƒ½æ‰‹æœºçš„æŒ‰é”®å’Œå¼€å…³ä¼šæ ¹æ®è®¾å¤‡å½“å‰çŠ¶æ€å®Œæˆä¸åŒè¡Œä¸ºï¼š</p><ul><li>å½“æ‰‹æœºå¤„äºè§£é”çŠ¶æ€æ—¶ï¼Œ æŒ‰ä¸‹æŒ‰é”®å°†æ‰§è¡Œå„ç§åŠŸèƒ½ã€‚</li><li>å½“æ‰‹æœºå¤„äºé”å®šçŠ¶æ€æ—¶ï¼Œ æŒ‰ä¸‹ä»»ä½•æŒ‰é”®éƒ½å°†è§£é”å±å¹•ã€‚</li><li>å½“æ‰‹æœºç”µé‡ä¸è¶³æ—¶ï¼Œ æŒ‰ä¸‹ä»»ä½•æŒ‰é”®éƒ½å°†æ˜¾ç¤ºå……ç”µé¡µé¢ã€‚</li></ul><h2 id="çŠ¶æ€æ¨¡å¼ç»“æ„"><a href="#çŠ¶æ€æ¨¡å¼ç»“æ„" class="headerlink" title="çŠ¶æ€æ¨¡å¼ç»“æ„"></a>çŠ¶æ€æ¨¡å¼ç»“æ„</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/structure-zh-indexed-state.png" alt=""></p><ol><li><p><strong>ä¸Šä¸‹æ–‡</strong> ï¼ˆContextï¼‰ ä¿å­˜äº†å¯¹äºä¸€ä¸ªå…·ä½“çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨ï¼Œ å¹¶ä¼šå°†æ‰€æœ‰ä¸è¯¥çŠ¶æ€ç›¸å…³çš„å·¥ä½œå§”æ´¾ç»™å®ƒã€‚ ä¸Šä¸‹æ–‡é€šè¿‡çŠ¶æ€æ¥å£ä¸çŠ¶æ€å¯¹è±¡äº¤äº’ï¼Œ ä¸”ä¼šæä¾›ä¸€ä¸ªè®¾ç½®å™¨ç”¨äºä¼ é€’æ–°çš„çŠ¶æ€å¯¹è±¡ã€‚</p></li><li><p><strong>çŠ¶æ€</strong> ï¼ˆStateï¼‰ æ¥å£ä¼šå£°æ˜ç‰¹å®šäºçŠ¶æ€çš„æ–¹æ³•ã€‚ è¿™äº›æ–¹æ³•åº”èƒ½è¢«å…¶ä»–æ‰€æœ‰å…·ä½“çŠ¶æ€æ‰€ç†è§£ï¼Œ å› ä¸ºä½ ä¸å¸Œæœ›æŸäº›çŠ¶æ€æ‰€æ‹¥æœ‰çš„æ–¹æ³•æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚</p></li><li><p><strong>å…·ä½“çŠ¶æ€</strong> ï¼ˆConcrete Statesï¼‰ ä¼šè‡ªè¡Œå®ç°ç‰¹å®šäºçŠ¶æ€çš„æ–¹æ³•ã€‚ ä¸ºäº†é¿å…å¤šä¸ªçŠ¶æ€ä¸­åŒ…å«ç›¸ä¼¼ä»£ç ï¼Œ ä½ å¯ä»¥æä¾›ä¸€ä¸ªå°è£…æœ‰éƒ¨åˆ†é€šç”¨è¡Œä¸ºçš„ä¸­é—´æŠ½è±¡ç±»ã€‚</p><p>çŠ¶æ€å¯¹è±¡å¯å­˜å‚¨å¯¹äºä¸Šä¸‹æ–‡å¯¹è±¡çš„åå‘å¼•ç”¨ã€‚ çŠ¶æ€å¯ä»¥é€šè¿‡è¯¥å¼•ç”¨ä»ä¸Šä¸‹æ–‡å¤„è·å–æ‰€éœ€ä¿¡æ¯ï¼Œ å¹¶ä¸”èƒ½è§¦å‘çŠ¶æ€è½¬ç§»ã€‚</p></li><li><p>ä¸Šä¸‹æ–‡å’Œå…·ä½“çŠ¶æ€éƒ½å¯ä»¥è®¾ç½®ä¸Šä¸‹æ–‡çš„ä¸‹ä¸ªçŠ¶æ€ï¼Œ å¹¶å¯é€šè¿‡æ›¿æ¢è¿æ¥åˆ°ä¸Šä¸‹æ–‡çš„çŠ¶æ€å¯¹è±¡æ¥å®Œæˆå®é™…çš„çŠ¶æ€è½¬æ¢ã€‚</p></li></ol><h2 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h2><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ <strong>çŠ¶æ€</strong>æ¨¡å¼å°†æ ¹æ®å½“å‰å›æ”¾çŠ¶æ€ï¼Œ è®©åª’ä½“æ’­æ”¾å™¨ä¸­çš„ç›¸åŒæ§ä»¶å®Œæˆä¸åŒçš„è¡Œä¸ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/example-state.png" alt="ä½¿ç”¨çŠ¶æ€å¯¹è±¡æ›´æ”¹å¯¹è±¡è¡Œä¸ºçš„ç¤ºä¾‹ã€‚"></p><p>æ’­æ”¾å™¨çš„ä¸»è¦å¯¹è±¡æ€»æ˜¯ä¼šè¿æ¥åˆ°ä¸€ä¸ªè´Ÿè´£æ’­æ”¾å™¨ç»å¤§éƒ¨åˆ†å·¥ä½œçš„çŠ¶æ€å¯¹è±¡ä¸­ã€‚ éƒ¨åˆ†æ“ä½œä¼šæ›´æ¢æ’­æ”¾å™¨å½“å‰çš„çŠ¶æ€å¯¹è±¡ï¼Œ ä»¥æ­¤æ”¹å˜æ’­æ”¾å™¨å¯¹äºç”¨æˆ·äº’åŠ¨æ‰€ä½œå‡ºçš„ååº”ã€‚</p><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éŸ³é¢‘æ’­æ”¾å™¨ï¼ˆAudioÂ­Playerï¼‰ç±»å³ä¸ºä¸Šä¸‹æ–‡ã€‚å®ƒè¿˜ä¼šç»´æŠ¤æŒ‡å‘çŠ¶æ€ç±»å®ä¾‹çš„å¼•ç”¨ï¼Œ</span></span><br><span class="line"><span class="comment">// è¯¥çŠ¶æ€ç±»åˆ™ç”¨äºè¡¨ç¤ºéŸ³é¢‘æ’­æ”¾å™¨å½“å‰çš„çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="keyword">class</span> AudioPlayer <span class="keyword">is</span></span><br><span class="line">    field state: State</span><br><span class="line">    field UI, volume, playlist, currentSong</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">AudioPlayer</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">state</span> = <span class="title">new</span> <span class="title">ReadyState</span><span class="params">(this)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="comment">// ä¸Šä¸‹æ–‡ä¼šå°†å¤„ç†ç”¨æˆ·è¾“å…¥çš„å·¥ä½œå§”æ´¾ç»™çŠ¶æ€å¯¹è±¡ã€‚ç”±äºæ¯ä¸ªçŠ¶æ€éƒ½ä»¥ä¸</span></span></span><br><span class="line"><span class="function">        <span class="comment">// åŒçš„æ–¹å¼å¤„ç†è¾“å…¥ï¼Œå…¶ç»“æœè‡ªç„¶å°†ä¾èµ–äºå½“å‰æ‰€å¤„çš„çŠ¶æ€ã€‚</span></span></span><br><span class="line"><span class="function">        <span class="title">UI</span> = <span class="title">new</span> <span class="title">UserInterface</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">UI</span>.<span class="title">lockButton</span>.<span class="title">onClick</span><span class="params">(this.clickLock)</span></span></span><br><span class="line"><span class="function">        <span class="title">UI</span>.<span class="title">playButton</span>.<span class="title">onClick</span><span class="params">(this.clickPlay)</span></span></span><br><span class="line"><span class="function">        <span class="title">UI</span>.<span class="title">nextButton</span>.<span class="title">onClick</span><span class="params">(this.clickNext)</span></span></span><br><span class="line"><span class="function">        <span class="title">UI</span>.<span class="title">prevButton</span>.<span class="title">onClick</span><span class="params">(this.clickPrevious)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// å…¶ä»–å¯¹è±¡å¿…é¡»èƒ½åˆ‡æ¢éŸ³é¢‘æ’­æ”¾å™¨å½“å‰æ‰€å¤„çš„çŠ¶æ€ã€‚</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">changeState</span><span class="params">(state: State)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">state</span> = <span class="title">state</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// UI æ–¹æ³•ä¼šå°†æ‰§è¡Œå·¥ä½œå§”æ´¾ç»™å½“å‰çŠ¶æ€ã€‚</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickLock</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">state</span>.<span class="title">clickLock</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickPlay</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">state</span>.<span class="title">clickPlay</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickNext</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">state</span>.<span class="title">clickNext</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickPrevious</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">state</span>.<span class="title">clickPrevious</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// çŠ¶æ€å¯è°ƒç”¨ä¸Šä¸‹æ–‡çš„ä¸€äº›æœåŠ¡æ–¹æ³•ã€‚</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">startPlayback</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// ...</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">stopPlayback</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// ...</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">nextSong</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// ...</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">previousSong</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// ...</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">fastForward</span><span class="params">(time)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// ...</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">rewind</span><span class="params">(time)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// ...</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// æ‰€æœ‰å…·ä½“çŠ¶æ€ç±»éƒ½å¿…é¡»å®ç°çŠ¶æ€åŸºç±»å£°æ˜çš„æ–¹æ³•ï¼Œå¹¶æä¾›åå‘å¼•ç”¨æŒ‡å‘ä¸çŠ¶æ€ç›¸</span></span></span><br><span class="line"><span class="function"><span class="comment">// å…³çš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚çŠ¶æ€å¯ä½¿ç”¨åå‘å¼•ç”¨å°†ä¸Šä¸‹æ–‡è½¬æ¢ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ã€‚</span></span></span><br><span class="line"><span class="function"><span class="title">abstract</span> <span class="title">class</span> <span class="title">State</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">protected</span> <span class="title">field</span> <span class="title">player</span>:</span> AudioPlayer</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šä¸‹æ–‡å°†è‡ªèº«ä¼ é€’ç»™çŠ¶æ€æ„é€ å‡½æ•°ã€‚è¿™å¯å¸®åŠ©çŠ¶æ€åœ¨éœ€è¦æ—¶è·å–ä¸€äº›æœ‰ç”¨çš„</span></span><br><span class="line">    <span class="comment">// ä¸Šä¸‹æ–‡æ•°æ®ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">State</span><span class="params">(player)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">player</span> = <span class="title">player</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">abstract</span> <span class="title">method</span> <span class="title">clickLock</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="title">abstract</span> <span class="title">method</span> <span class="title">clickPlay</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="title">abstract</span> <span class="title">method</span> <span class="title">clickNext</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="title">abstract</span> <span class="title">method</span> <span class="title">clickPrevious</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// å…·ä½“çŠ¶æ€ä¼šå®ç°ä¸ä¸Šä¸‹æ–‡çŠ¶æ€ç›¸å…³çš„å¤šç§è¡Œä¸ºã€‚</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">LockedState</span> <span class="title">extends</span> <span class="title">State</span> <span class="title">is</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// å½“ä½ è§£é”ä¸€ä¸ªé”å®šçš„æ’­æ”¾å™¨æ—¶ï¼Œå®ƒå¯èƒ½å¤„äºä¸¤ç§çŠ¶æ€ä¹‹ä¸€ã€‚</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickLock</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(player.playing)</span></span></span><br><span class="line"><span class="function">            <span class="title">player</span>.<span class="title">changeState</span><span class="params">(new PlayingState(player)</span>)</span></span><br><span class="line"><span class="function">        <span class="title">else</span></span></span><br><span class="line"><span class="function">            <span class="title">player</span>.<span class="title">changeState</span><span class="params">(new ReadyState(player)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickPlay</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// å·²é”å®šï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickNext</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// å·²é”å®šï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickPrevious</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// å·²é”å®šï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// å®ƒä»¬è¿˜å¯åœ¨ä¸Šä¸‹æ–‡ä¸­è§¦å‘çŠ¶æ€è½¬æ¢ã€‚</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">ReadyState</span> <span class="title">extends</span> <span class="title">State</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickLock</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">player</span>.<span class="title">changeState</span><span class="params">(new LockedState(player)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickPlay</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">player</span>.<span class="title">startPlayback</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">player</span>.<span class="title">changeState</span><span class="params">(new PlayingState(player)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickNext</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">player</span>.<span class="title">nextSong</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickPrevious</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">player</span>.<span class="title">previousSong</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">PlayingState</span> <span class="title">extends</span> <span class="title">State</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickLock</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">player</span>.<span class="title">changeState</span><span class="params">(new LockedState(player)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickPlay</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">player</span>.<span class="title">stopPlayback</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">player</span>.<span class="title">changeState</span><span class="params">(new ReadyState(player)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickNext</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(event.doubleclick)</span></span></span><br><span class="line"><span class="function">            <span class="title">player</span>.<span class="title">nextSong</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">else</span></span></span><br><span class="line"><span class="function">            <span class="title">player</span>.<span class="title">fastForward</span><span class="params">(5)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clickPrevious</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(event.doubleclick)</span></span></span><br><span class="line"><span class="function">            <span class="title">player</span>.<span class="title">previous</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">else</span></span></span><br><span class="line"><span class="function">            <span class="title">player</span>.<span class="title">rewind</span><span class="params">(5)</span></span></span><br></pre></td></tr></table></figure><h2 id="çŠ¶æ€æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"><a href="#çŠ¶æ€æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯" class="headerlink" title="çŠ¶æ€æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"></a>çŠ¶æ€æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯</h2><p><strong>å¦‚æœå¯¹è±¡éœ€è¦æ ¹æ®è‡ªèº«å½“å‰çŠ¶æ€è¿›è¡Œä¸åŒè¡Œä¸ºï¼Œ åŒæ—¶çŠ¶æ€çš„æ•°é‡éå¸¸å¤šä¸”ä¸çŠ¶æ€ç›¸å…³çš„ä»£ç ä¼šé¢‘ç¹å˜æ›´çš„è¯ï¼Œ å¯ä½¿ç”¨çŠ¶æ€æ¨¡å¼ã€‚</strong></p><p>æ¨¡å¼å»ºè®®ä½ å°†æ‰€æœ‰ç‰¹å®šäºçŠ¶æ€çš„ä»£ç æŠ½å–åˆ°ä¸€ç»„ç‹¬ç«‹çš„ç±»ä¸­ã€‚ è¿™æ ·ä¸€æ¥ï¼Œ ä½ å¯ä»¥åœ¨ç‹¬ç«‹äºå…¶ä»–çŠ¶æ€çš„æƒ…å†µä¸‹æ·»åŠ æ–°çŠ¶æ€æˆ–ä¿®æ”¹å·²æœ‰çŠ¶æ€ï¼Œ ä»è€Œå‡å°‘ç»´æŠ¤æˆæœ¬ã€‚</p><p><strong>å¦‚æœæŸä¸ªç±»éœ€è¦æ ¹æ®æˆå‘˜å˜é‡çš„å½“å‰å€¼æ”¹å˜è‡ªèº«è¡Œä¸ºï¼Œ ä»è€Œéœ€è¦ä½¿ç”¨å¤§é‡çš„æ¡ä»¶è¯­å¥æ—¶ï¼Œ å¯ä½¿ç”¨è¯¥æ¨¡å¼ã€‚</strong></p><p>çŠ¶æ€æ¨¡å¼ä¼šå°†è¿™äº›æ¡ä»¶è¯­å¥çš„åˆ†æ”¯æŠ½å–åˆ°ç›¸åº”çŠ¶æ€ç±»çš„æ–¹æ³•ä¸­ã€‚ åŒæ—¶ï¼Œ ä½ è¿˜å¯ä»¥æ¸…é™¤ä¸»è¦ç±»ä¸­ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„ä¸´æ—¶æˆå‘˜å˜é‡å’Œå¸®æ‰‹æ–¹æ³•ä»£ç ã€‚</p><p><strong>å½“ç›¸ä¼¼çŠ¶æ€å’ŒåŸºäºæ¡ä»¶çš„çŠ¶æ€æœºè½¬æ¢ä¸­å­˜åœ¨è®¸å¤šé‡å¤ä»£ç æ—¶ï¼Œ å¯ä½¿ç”¨çŠ¶æ€æ¨¡å¼ã€‚</strong></p><p>çŠ¶æ€æ¨¡å¼è®©ä½ èƒ½å¤Ÿç”ŸæˆçŠ¶æ€ç±»å±‚æ¬¡ç»“æ„ï¼Œ é€šè¿‡å°†å…¬ç”¨ä»£ç æŠ½å–åˆ°æŠ½è±¡åŸºç±»ä¸­æ¥å‡å°‘é‡å¤ã€‚</p><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><ol><li><p>ç¡®å®šå“ªäº›ç±»æ˜¯ä¸Šä¸‹æ–‡ã€‚ å®ƒå¯èƒ½æ˜¯åŒ…å«ä¾èµ–äºçŠ¶æ€çš„ä»£ç çš„å·²æœ‰ç±»ï¼› å¦‚æœç‰¹å®šäºçŠ¶æ€çš„ä»£ç åˆ†æ•£åœ¨å¤šä¸ªç±»ä¸­ï¼Œ é‚£ä¹ˆå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªæ–°çš„ç±»ã€‚</p></li><li><p>å£°æ˜çŠ¶æ€æ¥å£ã€‚ è™½ç„¶ä½ å¯èƒ½ä¼šéœ€è¦å®Œå…¨å¤åˆ¶ä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼Œ ä½†æœ€å¥½æ˜¯ä»…æŠŠå…³æ³¨ç‚¹æ”¾åœ¨é‚£äº›å¯èƒ½åŒ…å«ç‰¹å®šäºçŠ¶æ€çš„è¡Œä¸ºçš„æ–¹æ³•ä¸Šã€‚</p></li><li><p>ä¸ºæ¯ä¸ªå®é™…çŠ¶æ€åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºçŠ¶æ€æ¥å£çš„ç±»ã€‚ ç„¶åæ£€æŸ¥ä¸Šä¸‹æ–‡ä¸­çš„æ–¹æ³•å¹¶å°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„æ‰€æœ‰ä»£ç æŠ½å–åˆ°æ–°å»ºçš„ç±»ä¸­ã€‚</p><p>åœ¨å°†ä»£ç ç§»åŠ¨åˆ°çŠ¶æ€ç±»çš„è¿‡ç¨‹ä¸­ï¼Œ ä½ å¯èƒ½ä¼šå‘ç°å®ƒä¾èµ–äºä¸Šä¸‹æ–‡ä¸­çš„ä¸€äº›ç§æœ‰æˆå‘˜ã€‚ ä½ å¯ä»¥é‡‡ç”¨ä»¥ä¸‹å‡ ç§å˜é€šæ–¹å¼ï¼š</p><ul><li>å°†è¿™äº›æˆå‘˜å˜é‡æˆ–æ–¹æ³•è®¾ä¸ºå…¬æœ‰ã€‚</li><li>å°†éœ€è¦æŠ½å–çš„ä¸Šä¸‹æ–‡è¡Œä¸ºæ›´æ”¹ä¸ºä¸Šä¸‹æ–‡ä¸­çš„å…¬æœ‰æ–¹æ³•ï¼Œ ç„¶ååœ¨çŠ¶æ€ç±»ä¸­è°ƒç”¨ã€‚ è¿™ç§æ–¹å¼ç®€é™‹å´ä¾¿æ·ï¼Œ ä½ å¯ä»¥ç¨åå†å¯¹å…¶è¿›è¡Œä¿®è¡¥ã€‚</li><li>å°†çŠ¶æ€ç±»åµŒå¥—åœ¨ä¸Šä¸‹æ–‡ç±»ä¸­ã€‚ è¿™ç§æ–¹å¼éœ€è¦ä½ æ‰€ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€æ”¯æŒåµŒå¥—ç±»ã€‚</li></ul></li><li><p>åœ¨ä¸Šä¸‹æ–‡ç±»ä¸­æ·»åŠ ä¸€ä¸ªçŠ¶æ€æ¥å£ç±»å‹çš„å¼•ç”¨æˆå‘˜å˜é‡ï¼Œ ä»¥åŠä¸€ä¸ªç”¨äºä¿®æ”¹è¯¥æˆå‘˜å˜é‡å€¼çš„å…¬æœ‰è®¾ç½®å™¨ã€‚</p></li><li><p>å†æ¬¡æ£€æŸ¥ä¸Šä¸‹æ–‡ä¸­çš„æ–¹æ³•ï¼Œ å°†ç©ºçš„æ¡ä»¶è¯­å¥æ›¿æ¢ä¸ºç›¸åº”çš„çŠ¶æ€å¯¹è±¡æ–¹æ³•ã€‚</p></li><li><p>ä¸ºåˆ‡æ¢ä¸Šä¸‹æ–‡çŠ¶æ€ï¼Œ ä½ éœ€è¦åˆ›å»ºæŸä¸ªçŠ¶æ€ç±»å®ä¾‹å¹¶å°†å…¶ä¼ é€’ç»™ä¸Šä¸‹æ–‡ã€‚ ä½ å¯ä»¥åœ¨ä¸Šä¸‹æ–‡ã€ å„ç§çŠ¶æ€æˆ–å®¢æˆ·ç«¯ä¸­å®Œæˆè¿™é¡¹å·¥ä½œã€‚ æ— è®ºåœ¨ä½•å¤„å®Œæˆè¿™é¡¹å·¥ä½œï¼Œ è¯¥ç±»éƒ½å°†ä¾èµ–äºå…¶æ‰€å®ä¾‹åŒ–çš„å…·ä½“ç±»ã€‚</p></li></ol><h2 id="çŠ¶æ€æ¨¡å¼ä¼˜ç¼ºç‚¹"><a href="#çŠ¶æ€æ¨¡å¼ä¼˜ç¼ºç‚¹" class="headerlink" title="çŠ¶æ€æ¨¡å¼ä¼˜ç¼ºç‚¹"></a>çŠ¶æ€æ¨¡å¼ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹</p><ul><li>s<em>å•ä¸€èŒè´£åŸåˆ™</em>ã€‚ å°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„ä»£ç æ”¾åœ¨å•ç‹¬çš„ç±»ä¸­ã€‚</li><li><em>å¼€é—­åŸåˆ™</em>ã€‚ æ— éœ€ä¿®æ”¹å·²æœ‰çŠ¶æ€ç±»å’Œä¸Šä¸‹æ–‡å°±èƒ½å¼•å…¥æ–°çŠ¶æ€ã€‚</li><li>é€šè¿‡æ¶ˆé™¤è‡ƒè‚¿çš„çŠ¶æ€æœºæ¡ä»¶è¯­å¥ç®€åŒ–ä¸Šä¸‹æ–‡ä»£ç ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>å¦‚æœçŠ¶æ€æœºåªæœ‰å¾ˆå°‘çš„å‡ ä¸ªçŠ¶æ€ï¼Œ æˆ–è€…å¾ˆå°‘å‘ç”Ÿæ”¹å˜ï¼Œ é‚£ä¹ˆåº”ç”¨è¯¥æ¨¡å¼å¯èƒ½ä¼šæ˜¾å¾—å°é¢˜å¤§ä½œã€‚</li></ul><h2 id="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul><li><a href="https://refactoringguru.cn/design-patterns/bridge">æ¡¥æ¥æ¨¡å¼</a>ã€ <a href="https://refactoringguru.cn/design-patterns/state">çŠ¶æ€æ¨¡å¼</a>å’Œ<a href="https://refactoringguru.cn/design-patterns/strategy">ç­–ç•¥æ¨¡å¼</a> ï¼ˆåœ¨æŸç§ç¨‹åº¦ä¸ŠåŒ…æ‹¬<a href="https://refactoringguru.cn/design-patterns/adapter">é€‚é…å™¨æ¨¡å¼</a>ï¼‰ æ¨¡å¼çš„æ¥å£éå¸¸ç›¸ä¼¼ã€‚ å®é™…ä¸Šï¼Œ å®ƒä»¬éƒ½åŸºäº<a href="https://refactoringguru.cn/design-patterns/composite">ç»„åˆæ¨¡å¼</a>â€”â€”å³å°†å·¥ä½œå§”æ´¾ç»™å…¶ä»–å¯¹è±¡ï¼Œ ä¸è¿‡ä¹Ÿå„è‡ªè§£å†³äº†ä¸åŒçš„é—®é¢˜ã€‚ æ¨¡å¼å¹¶ä¸åªæ˜¯ä»¥ç‰¹å®šæ–¹å¼ç»„ç»‡ä»£ç çš„é…æ–¹ï¼Œ ä½ è¿˜å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥å’Œå…¶ä»–å¼€å‘è€…è®¨è®ºæ¨¡å¼æ‰€è§£å†³çš„é—®é¢˜ã€‚</li><li><a href="https://refactoringguru.cn/design-patterns/state">çŠ¶æ€</a>å¯è¢«è§†ä¸º<a href="https://refactoringguru.cn/design-patterns/strategy">ç­–ç•¥</a>çš„æ‰©å±•ã€‚ ä¸¤è€…éƒ½åŸºäºç»„åˆæœºåˆ¶ï¼š å®ƒä»¬éƒ½é€šè¿‡å°†éƒ¨åˆ†å·¥ä½œå§”æ´¾ç»™ â€œå¸®æ‰‹â€ å¯¹è±¡æ¥æ”¹å˜å…¶åœ¨ä¸åŒæƒ…æ™¯ä¸‹çš„è¡Œä¸ºã€‚ <em>ç­–ç•¥</em>ä½¿å¾—è¿™äº›å¯¹è±¡ç›¸äº’ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œ å®ƒä»¬ä¸çŸ¥é“å…¶ä»–å¯¹è±¡çš„å­˜åœ¨ã€‚ ä½†<em>çŠ¶æ€</em>æ¨¡å¼æ²¡æœ‰é™åˆ¶å…·ä½“çŠ¶æ€ä¹‹é—´çš„ä¾èµ–ï¼Œ ä¸”å…è®¸å®ƒä»¬è‡ªè¡Œæ”¹å˜åœ¨ä¸åŒæƒ…æ™¯ä¸‹çš„çŠ¶æ€ã€‚</li></ul><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p><strong>çŠ¶æ€</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ è®©ä½ èƒ½åœ¨ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å˜åŒ–æ—¶æ”¹å˜å…¶è¡Œä¸ºã€‚</p><p>è¯¥æ¨¡å¼å°†ä¸çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºæŠ½å–åˆ°ç‹¬ç«‹çš„çŠ¶æ€ç±»ä¸­ï¼Œ è®©åŸå¯¹è±¡å°†å·¥ä½œå§”æ´¾ç»™è¿™äº›ç±»çš„å®ä¾‹ï¼Œ è€Œä¸æ˜¯è‡ªè¡Œè¿›è¡Œå¤„ç†ã€‚</p><div class="tabs" id="tags"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#tags-1">C#</button></li><li class="tab"><button type="button" data-href="#tags-2">C++</button></li><li class="tab"><button type="button" data-href="#tags-3">JAVA</button></li><li class="tab"><button type="button" data-href="#tags-4">PHP</button></li><li class="tab"><button type="button" data-href="#tags-5">Python</button></li><li class="tab"><button type="button" data-href="#tags-6">Ruby</button></li><li class="tab"><button type="button" data-href="#tags-7">Swift</button></li><li class="tab"><button type="button" data-href="#tags-8">TypeScrit</button></li><li class="tab"><button type="button" data-href="#tags-9">Golang</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="tags-1"><p><strong>åœ¨ C# ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> åœ¨ C# è¯­è¨€ä¸­ï¼Œ çŠ¶æ€æ¨¡å¼é€šå¸¸è¢«ç”¨äºå°†åŸºäº <code>switch</code>è¯­å¥çš„å¤§å‹çŠ¶æ€æœºè½¬æ¢ä¸ºå¯¹è±¡ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> çŠ¶æ€æ¨¡å¼å¯é€šè¿‡å—å¤–éƒ¨æ§åˆ¶ä¸”èƒ½æ ¹æ®å¯¹è±¡çŠ¶æ€æ”¹å˜è¡Œä¸ºçš„æ–¹æ³•æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>çŠ¶æ€</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>Program.cs:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.State.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The Context defines the interface of interest to clients. It also</span></span><br><span class="line">    <span class="comment">// maintains a reference to an instance of a State subclass, which</span></span><br><span class="line">    <span class="comment">// represents the current state of the Context.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Context</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// A reference to the current state of the Context.</span></span><br><span class="line">        <span class="keyword">private</span> State _state = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Context</span>(<span class="params">State state</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.TransitionTo(state);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The Context allows changing the State object at runtime.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TransitionTo</span>(<span class="params">State state</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;Context: Transition to <span class="subst">&#123;state.GetType().Name&#125;</span>.&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>._state = state;</span><br><span class="line">            <span class="keyword">this</span>._state.SetContext(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The Context delegates part of its behavior to the current State</span></span><br><span class="line">        <span class="comment">// object.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>._state.Handle1();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>._state.Handle2();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// The base State class declares methods that all Concrete State should</span></span><br><span class="line">    <span class="comment">// implement and also provides a backreference to the Context object,</span></span><br><span class="line">    <span class="comment">// associated with the State. This backreference can be used by States to</span></span><br><span class="line">    <span class="comment">// transition the Context to another State.</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">State</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">protected</span> Context _context;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetContext</span>(<span class="params">Context context</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>._context = context;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Handle1</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Handle2</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete States implement various behaviors, associated with a state of</span></span><br><span class="line">    <span class="comment">// the Context.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteStateA</span> : <span class="title">State</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Handle1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteStateA handles request1.&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteStateA wants to change the state of the context.&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>._context.TransitionTo(<span class="keyword">new</span> ConcreteStateB());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Handle2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteStateA handles request2.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteStateB</span> : <span class="title">State</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Handle1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.Write(<span class="string">&quot;ConcreteStateB handles request1.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Handle2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteStateB handles request2.&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ConcreteStateB wants to change the state of the context.&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>._context.TransitionTo(<span class="keyword">new</span> ConcreteStateA());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// The client code.</span></span><br><span class="line">            <span class="keyword">var</span> context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStateA());</span><br><span class="line">            context.Request1();</span><br><span class="line">            context.Request2();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Context: Transition to ConcreteStateA.</span><br><span class="line">ConcreteStateA handles request1.</span><br><span class="line">ConcreteStateA wants to change the state of the context.</span><br><span class="line">Context: Transition to ConcreteStateB.</span><br><span class="line">ConcreteStateB handles request2.</span><br><span class="line">ConcreteStateB wants to change the state of the context.</span><br><span class="line">Context: Transition to ConcreteStateA.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-2"><p><strong>åœ¨ C++ ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> åœ¨ C++ è¯­è¨€ä¸­ï¼Œ çŠ¶æ€æ¨¡å¼é€šå¸¸è¢«ç”¨äºå°†åŸºäº <code>switch</code>è¯­å¥çš„å¤§å‹çŠ¶æ€æœºè½¬æ¢ä¸ºå¯¹è±¡ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> çŠ¶æ€æ¨¡å¼å¯é€šè¿‡å—å¤–éƒ¨æ§åˆ¶ä¸”èƒ½æ ¹æ®å¯¹è±¡çŠ¶æ€æ”¹å˜è¡Œä¸ºçš„æ–¹æ³•æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>çŠ¶æ€</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.cc:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The base State class declares methods that all Concrete State should</span></span><br><span class="line"><span class="comment"> * implement and also provides a backreference to the Context object, associated</span></span><br><span class="line"><span class="comment"> * with the State. This backreference can be used by States to transition the</span></span><br><span class="line"><span class="comment"> * Context to another State.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span> &#123;</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @var Context</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">protected</span>:</span><br><span class="line">  Context *context_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~State() &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">set_context</span><span class="params">(Context *context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;context_ = context;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Handle1</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Handle2</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Context defines the interface of interest to clients. It also maintains a</span></span><br><span class="line"><span class="comment"> * reference to an instance of a State subclass, which represents the current</span></span><br><span class="line"><span class="comment"> * state of the Context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span> &#123;</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @var State A reference to the current state of the Context.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  State *state_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  Context(State *state) : state_(<span class="literal">nullptr</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;TransitionTo(state);</span><br><span class="line">  &#125;</span><br><span class="line">  ~Context() &#123;</span><br><span class="line">    <span class="keyword">delete</span> state_;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The Context allows changing the State object at runtime.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">TransitionTo</span><span class="params">(State *state)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Context: Transition to &quot;</span> &lt;&lt; <span class="keyword">typeid</span>(*state).name() &lt;&lt; <span class="string">&quot;.\n&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;state_ != <span class="literal">nullptr</span>)</span><br><span class="line">      <span class="keyword">delete</span> <span class="keyword">this</span>-&gt;state_;</span><br><span class="line">    <span class="keyword">this</span>-&gt;state_ = state;</span><br><span class="line">    <span class="keyword">this</span>-&gt;state_-&gt;set_context(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The Context delegates part of its behavior to the current State object.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Request1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;state_-&gt;Handle1();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Request2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;state_-&gt;Handle2();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete States implement various behaviors, associated with a state of the</span></span><br><span class="line"><span class="comment"> * Context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateA</span> :</span> <span class="keyword">public</span> State &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Handle1</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Handle2</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteStateA handles request2.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateB</span> :</span> <span class="keyword">public</span> State &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Handle1</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteStateB handles request1.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Handle2</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteStateB handles request2.\n&quot;</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteStateB wants to change the state of the context.\n&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;context_-&gt;TransitionTo(<span class="keyword">new</span> ConcreteStateA);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ConcreteStateA::Handle1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteStateA handles request1.\n&quot;</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ConcreteStateA wants to change the state of the context.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;context_-&gt;TransitionTo(<span class="keyword">new</span> ConcreteStateB);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClientCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Context *context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStateA);</span><br><span class="line">  context-&gt;Request1();</span><br><span class="line">  context-&gt;Request2();</span><br><span class="line">  <span class="keyword">delete</span> context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ClientCode();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Context: Transition to 14ConcreteStateA.</span><br><span class="line">ConcreteStateA handles request1.</span><br><span class="line">ConcreteStateA wants to change the state of the context.</span><br><span class="line">Context: Transition to 14ConcreteStateB.</span><br><span class="line">ConcreteStateB handles request2.</span><br><span class="line">ConcreteStateB wants to change the state of the context.</span><br><span class="line">Context: Transition to 14ConcreteStateA.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-3"><p><strong>åœ¨ Java ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> åœ¨ Java è¯­è¨€ä¸­ï¼Œ çŠ¶æ€æ¨¡å¼é€šå¸¸è¢«ç”¨äºå°†åŸºäº <code>switch</code>è¯­å¥çš„å¤§å‹çŠ¶æ€æœºè½¬æ¢ä¸ºå¯¹è±¡ã€‚</p><p>è¿™é‡Œæ˜¯æ ¸å¿ƒ Java ç¨‹åºåº“ä¸­ä¸€äº›çŠ¶æ€æ¨¡å¼çš„ç¤ºä¾‹ï¼š</p><ul><li><a href="http://docs.oracle.com/javaee/7/api/javax/faces/lifecycle/Lifecycle.html#execute-javax.faces.context.FacesContext-"><code>javax.faces.lifecycle.LifeCycle#execute()</code></a> ï¼ˆç”±<a href="http://docs.oracle.com/javaee/7/api/javax/faces/webapp/FacesServlet.html"> <code>FacesÂ­Servlet</code></a>æ§åˆ¶ï¼š è¡Œä¸ºä¾èµ–äºå½“å‰ JSF ç”Ÿå‘½å‘¨æœŸçš„é˜¶æ®µ ï¼ˆçŠ¶æ€ï¼‰ï¼‰</li></ul><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> çŠ¶æ€æ¨¡å¼å¯é€šè¿‡å—å¤–éƒ¨æ§åˆ¶ä¸”èƒ½æ ¹æ®å¯¹è±¡çŠ¶æ€æ”¹å˜è¡Œä¸ºçš„æ–¹æ³•æ¥è¯†åˆ«ã€‚</p><p><strong>åª’ä½“æ’­æ”¾å™¨çš„æ¥å£</strong></p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ çŠ¶æ€æ¨¡å¼å…è®¸åª’ä½“æ’­æ”¾å™¨æ ¹æ®å½“å‰çš„å›æ”¾çŠ¶æ€è¿›è¡Œä¸åŒçš„æ§åˆ¶è¡Œä¸ºã€‚ æ’­æ”¾å™¨ä¸»ç±»åŒ…å«ä¸€ä¸ªæŒ‡å‘çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨ï¼Œ å®ƒå°†å®Œæˆæ’­æ”¾å™¨çš„ç»å¤§éƒ¨åˆ†å·¥ä½œã€‚ æŸäº›è¡Œä¸ºå¯èƒ½ä¼šç”¨ä¸€ä¸ªçŠ¶æ€å¯¹è±¡æ›¿æ¢å¦ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ï¼Œ æ”¹å˜æ’­æ”¾å™¨å¯¹ç”¨æˆ·äº¤äº’çš„å›åº”æ–¹å¼ã€‚</p><p><strong>states</strong></p><p><strong>states/State.java:</strong> é€šç”¨çŠ¶æ€æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.state.example.states;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.state.example.ui.Player;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Common interface for all states.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    Player player;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Context passes itself through the state constructor. This may help a</span></span><br><span class="line"><span class="comment">     * state to fetch some useful context data if needed.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    State(Player player) &#123;</span><br><span class="line">        <span class="keyword">this</span>.player = player;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">onLock</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">onPlay</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">onNext</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">onPrevious</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>states/LockedState.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.state.example.states;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.state.example.ui.Player;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete states provide the special implementation for all interface methods.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockedState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    LockedState(Player player) &#123;</span><br><span class="line">        <span class="keyword">super</span>(player);</span><br><span class="line">        player.setPlaying(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (player.isPlaying()) &#123;</span><br><span class="line">            player.changeState(<span class="keyword">new</span> ReadyState(player));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Stop playing&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Locked...&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onPlay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        player.changeState(<span class="keyword">new</span> ReadyState(player));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Ready&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Locked...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onPrevious</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Locked...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>states/ReadyState.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.state.example.states;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.state.example.ui.Player;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * They can also trigger state transitions in the context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadyState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReadyState</span><span class="params">(Player player)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(player);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        player.changeState(<span class="keyword">new</span> LockedState(player));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Locked...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onPlay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String action = player.startPlayback();</span><br><span class="line">        player.changeState(<span class="keyword">new</span> PlayingState(player));</span><br><span class="line">        <span class="keyword">return</span> action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Locked...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onPrevious</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Locked...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>states/PlayingState.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.state.example.states;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.state.example.ui.Player;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlayingState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    PlayingState(Player player) &#123;</span><br><span class="line">        <span class="keyword">super</span>(player);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        player.changeState(<span class="keyword">new</span> LockedState(player));</span><br><span class="line">        player.setCurrentTrackAfterStop();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Stop playing&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onPlay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        player.changeState(<span class="keyword">new</span> ReadyState(player));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Paused...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> player.nextTrack();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onPrevious</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> player.previousTrack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ui</strong></p><p><strong>ui/Player.java:</strong> æ’­æ”¾å™¨çš„ä¸»è¦ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.state.example.ui;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.state.example.states.ReadyState;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.state.example.states.State;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> State state;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> playing = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; playlist = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentTrack = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Player</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = <span class="keyword">new</span> ReadyState(<span class="keyword">this</span>);</span><br><span class="line">        setPlaying(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; i++) &#123;</span><br><span class="line">            playlist.add(<span class="string">&quot;Track &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeState</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPlaying</span><span class="params">(<span class="keyword">boolean</span> playing)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.playing = playing;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPlaying</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> playing;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">startPlayback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Playing &quot;</span> + playlist.get(currentTrack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">nextTrack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        currentTrack++;</span><br><span class="line">        <span class="keyword">if</span> (currentTrack &gt; playlist.size() - <span class="number">1</span>) &#123;</span><br><span class="line">            currentTrack = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Playing &quot;</span> + playlist.get(currentTrack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">previousTrack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        currentTrack--;</span><br><span class="line">        <span class="keyword">if</span> (currentTrack &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            currentTrack = playlist.size() - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Playing &quot;</span> + playlist.get(currentTrack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentTrackAfterStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.currentTrack = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ui/UI.java:</strong> æ’­æ”¾å™¨çš„ GUI</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.state.example.ui;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UI</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Player player;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JTextField textField = <span class="keyword">new</span> JTextField();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UI</span><span class="params">(Player player)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.player = player;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JFrame frame = <span class="keyword">new</span> JFrame(<span class="string">&quot;Test player&quot;</span>);</span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        JPanel context = <span class="keyword">new</span> JPanel();</span><br><span class="line">        context.setLayout(<span class="keyword">new</span> BoxLayout(context, BoxLayout.Y_AXIS));</span><br><span class="line">        frame.getContentPane().add(context);</span><br><span class="line">        JPanel buttons = <span class="keyword">new</span> JPanel(<span class="keyword">new</span> FlowLayout(FlowLayout.CENTER));</span><br><span class="line">        context.add(textField);</span><br><span class="line">        context.add(buttons);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Context delegates handling user&#x27;s input to a state object. Naturally,</span></span><br><span class="line">        <span class="comment">// the outcome will depend on what state is currently active, since all</span></span><br><span class="line">        <span class="comment">// states can handle the input differently.</span></span><br><span class="line">        JButton play = <span class="keyword">new</span> JButton(<span class="string">&quot;Play&quot;</span>);</span><br><span class="line">        play.addActionListener(e -&gt; textField.setText(player.getState().onPlay()));</span><br><span class="line">        JButton stop = <span class="keyword">new</span> JButton(<span class="string">&quot;Stop&quot;</span>);</span><br><span class="line">        stop.addActionListener(e -&gt; textField.setText(player.getState().onLock()));</span><br><span class="line">        JButton next = <span class="keyword">new</span> JButton(<span class="string">&quot;Next&quot;</span>);</span><br><span class="line">        next.addActionListener(e -&gt; textField.setText(player.getState().onNext()));</span><br><span class="line">        JButton prev = <span class="keyword">new</span> JButton(<span class="string">&quot;Prev&quot;</span>);</span><br><span class="line">        prev.addActionListener(e -&gt; textField.setText(player.getState().onPrevious()));</span><br><span class="line">        frame.setVisible(<span class="keyword">true</span>);</span><br><span class="line">        frame.setSize(<span class="number">300</span>, <span class="number">100</span>);</span><br><span class="line">        buttons.add(play);</span><br><span class="line">        buttons.add(stop);</span><br><span class="line">        buttons.add(next);</span><br><span class="line">        buttons.add(prev);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Demo.java:</strong> åˆå§‹åŒ–ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.state.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.state.example.ui.Player;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.state.example.ui.UI;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demo class. Everything comes together here.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Player player = <span class="keyword">new</span> Player();</span><br><span class="line">        UI ui = <span class="keyword">new</span> UI(player);</span><br><span class="line">        ui.init();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>OutputDemo.png:</strong>  å±å¹•æˆªå›¾</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/OutputDemo-state.png" alt=""></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-4"><p><strong>åœ¨ PHP ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> åœ¨ PHP è¯­è¨€ä¸­ï¼Œ çŠ¶æ€æ¨¡å¼æœ‰æ—¶ä¼šè¢«ç”¨äºå°†åŸºäº <code>switch</code>è¯­å¥çš„å¤§å‹çŠ¶æ€æœºè½¬æ¢ä¸ºå¯¹è±¡ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> çŠ¶æ€æ¨¡å¼å¯é€šè¿‡å—å¤–éƒ¨æ§åˆ¶ä¸”èƒ½æ ¹æ®å¯¹è±¡çŠ¶æ€æ”¹å˜è¡Œä¸ºçš„æ–¹æ³•æ¥è¯†åˆ«ã€‚</p><div class="tabs" id="php"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#php-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#php-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="php-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>çŠ¶æ€</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ PHP åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>index.php:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru</span>\<span class="title">State</span>\<span class="title">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Context defines the interface of interest to clients. It also maintains a</span></span><br><span class="line"><span class="comment"> * reference to an instance of a State subclass, which represents the current</span></span><br><span class="line"><span class="comment"> * state of the Context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> State A reference to the current state of the Context.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">State $state</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;transitionTo($state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Context allows changing the State object at runtime.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">transitionTo</span>(<span class="params">State $state</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Context: Transition to &quot;</span> . get_class($state) . <span class="string">&quot;.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state = $state;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state-&gt;setContext(<span class="keyword">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Context delegates part of its behavior to the current State object.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">request1</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state-&gt;handle1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">request2</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state-&gt;handle2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The base State class declares methods that all Concrete State should</span></span><br><span class="line"><span class="comment"> * implement and also provides a backreference to the Context object, associated</span></span><br><span class="line"><span class="comment"> * with the State. This backreference can be used by States to transition the</span></span><br><span class="line"><span class="comment"> * Context to another State.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">State</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> $context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setContext</span>(<span class="params">Context $context</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;context = $context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle1</span>(<span class="params"></span>): <span class="title">void</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle2</span>(<span class="params"></span>): <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete States implement various behaviors, associated with a state of the</span></span><br><span class="line"><span class="comment"> * Context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateA</span> <span class="keyword">extends</span> <span class="title">State</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle1</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteStateA handles request1.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteStateA wants to change the state of the context.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;context-&gt;transitionTo(<span class="keyword">new</span> ConcreteStateB());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle2</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteStateA handles request2.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateB</span> <span class="keyword">extends</span> <span class="title">State</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle1</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteStateB handles request1.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle2</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteStateB handles request2.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ConcreteStateB wants to change the state of the context.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;context-&gt;transitionTo(<span class="keyword">new</span> ConcreteStateA());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStateA());</span><br><span class="line">$context-&gt;request1();</span><br><span class="line">$context-&gt;request2();</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Context: Transition to RefactoringGuru\State\Conceptual\ConcreteStateA.</span><br><span class="line">ConcreteStateA handles request1.</span><br><span class="line">ConcreteStateA wants to change the state of the context.</span><br><span class="line">Context: Transition to RefactoringGuru\State\Conceptual\ConcreteStateB.</span><br><span class="line">ConcreteStateB handles request2.</span><br><span class="line">ConcreteStateB wants to change the state of the context.</span><br><span class="line">Context: Transition to RefactoringGuru\State\Conceptual\ConcreteStateA.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="php-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p>å°½ç®¡çŠ¶æ€æœºå’ŒçŠ¶æ€æ¨¡å¼è‡ªèº«åœ¨å¼€å‘è€…ä¸­éå¸¸æµè¡Œï¼Œ ä½†æ˜¯æˆ‘å´æƒ³ä¸åˆ°ä»»ä½• PHP ä¸­çš„å®é™…åº”ç”¨æ¥ä½œä¸ºè¯¥æ¨¡å¼åœ¨çœŸå®ä¸–ç•Œçš„ç¤ºä¾‹ã€‚</p><p>ä½†æ˜¯ï¼Œ å¦‚æœä½ æ›¾åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿‡è¯¥æ¨¡å¼ï¼Œ æ¬¢è¿é€šè¿‡<a href="https://refactoring.userecho.com/">è®ºå›</a>æˆ–é‚®ä»¶<a href="mailto:support@refactoring.guru">support@refactoring.guru</a>åˆ†äº«ä½ çš„ç»éªŒã€‚ è°¢è°¢ï¼</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-5"><p><strong>åœ¨ Python ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> åœ¨ Python è¯­è¨€ä¸­ï¼Œ çŠ¶æ€æ¨¡å¼é€šå¸¸è¢«ç”¨äºå°†åŸºäº <code>switch</code>è¯­å¥çš„å¤§å‹çŠ¶æ€æœºè½¬æ¢ä¸ºå¯¹è±¡ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> çŠ¶æ€æ¨¡å¼å¯é€šè¿‡å—å¤–éƒ¨æ§åˆ¶ä¸”èƒ½æ ¹æ®å¯¹è±¡çŠ¶æ€æ”¹å˜è¡Œä¸ºçš„æ–¹æ³•æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>çŠ¶æ€</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.py:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Context defines the interface of interest to clients. It also maintains</span></span><br><span class="line"><span class="string">    a reference to an instance of a State subclass, which represents the current</span></span><br><span class="line"><span class="string">    state of the Context.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _state = <span class="literal">None</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    A reference to the current state of the Context.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, state: State</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.transition_to(state)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transition_to</span>(<span class="params">self, state: State</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The Context allows changing the State object at runtime.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">f&quot;Context: Transition to <span class="subst">&#123;<span class="built_in">type</span>(state).__name__&#125;</span>&quot;</span>)</span><br><span class="line">        self._state = state</span><br><span class="line">        self._state.context = self</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Context delegates part of its behavior to the current State object.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request1</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._state.handle1()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request2</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._state.handle2()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The base State class declares methods that all Concrete State should</span></span><br><span class="line"><span class="string">    implement and also provides a backreference to the Context object,</span></span><br><span class="line"><span class="string">    associated with the State. This backreference can be used by States to</span></span><br><span class="line"><span class="string">    transition the Context to another State.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">context</span>(<span class="params">self</span>) -&gt; Context:</span></span><br><span class="line">        <span class="keyword">return</span> self._context</span><br><span class="line"></span><br><span class="line"><span class="meta">    @context.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">context</span>(<span class="params">self, context: Context</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self._context = context</span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle1</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle2</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete States implement various behaviors, associated with a state of the</span></span><br><span class="line"><span class="string">Context.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateA</span>(<span class="params">State</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle1</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;ConcreteStateA handles request1.&quot;</span>)</span><br><span class="line">        print(<span class="string">&quot;ConcreteStateA wants to change the state of the context.&quot;</span>)</span><br><span class="line">        self.context.transition_to(ConcreteStateB())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle2</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;ConcreteStateA handles request2.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateB</span>(<span class="params">State</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle1</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;ConcreteStateB handles request1.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle2</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;ConcreteStateB handles request2.&quot;</span>)</span><br><span class="line">        print(<span class="string">&quot;ConcreteStateB wants to change the state of the context.&quot;</span>)</span><br><span class="line">        self.context.transition_to(ConcreteStateA())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># The client code.</span></span><br><span class="line"></span><br><span class="line">    context = Context(ConcreteStateA())</span><br><span class="line">    context.request1()</span><br><span class="line">    context.request2()</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Context: Transition to ConcreteStateA</span><br><span class="line">ConcreteStateA handles request1.</span><br><span class="line">ConcreteStateA wants to change the state of the context.</span><br><span class="line">Context: Transition to ConcreteStateB</span><br><span class="line">ConcreteStateB handles request2.</span><br><span class="line">ConcreteStateB wants to change the state of the context.</span><br><span class="line">Context: Transition to ConcreteStateA</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-6"><p><strong>åœ¨ Ruby ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> åœ¨ Ruby è¯­è¨€ä¸­ï¼Œ çŠ¶æ€æ¨¡å¼é€šå¸¸è¢«ç”¨äºå°†åŸºäº <code>switch</code>è¯­å¥çš„å¤§å‹çŠ¶æ€æœºè½¬æ¢ä¸ºå¯¹è±¡ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> çŠ¶æ€æ¨¡å¼å¯é€šè¿‡å—å¤–éƒ¨æ§åˆ¶ä¸”èƒ½æ ¹æ®å¯¹è±¡çŠ¶æ€æ”¹å˜è¡Œä¸ºçš„æ–¹æ³•æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>çŠ¶æ€</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.rb:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The Context defines the interface of interest to clients. It also maintains a</span></span><br><span class="line"><span class="comment"># reference to an instance of a State subclass, which represents the current</span></span><br><span class="line"><span class="comment"># state of the Context.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span></span></span><br><span class="line">  <span class="comment"># A reference to the current state of the Context.</span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:state</span></span><br><span class="line">  private <span class="symbol">:state</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [State] state</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(state)</span></span></span><br><span class="line">    transition_to(state)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The Context allows changing the State object at runtime.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">transition_to</span><span class="params">(state)</span></span></span><br><span class="line">    puts <span class="string">&quot;Context: Transition to <span class="subst">#&#123;state.<span class="keyword">class</span>&#125;</span>&quot;</span></span><br><span class="line">    @state = state</span><br><span class="line">    @state.context = <span class="keyword">self</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The Context delegates part of its behavior to the current State object.</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">request1</span></span></span><br><span class="line">    @state.handle1</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">request2</span></span></span><br><span class="line">    @state.handle2</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The base State class declares methods that all Concrete State should implement</span></span><br><span class="line"><span class="comment"># and also provides a backreference to the Context object, associated with the</span></span><br><span class="line"><span class="comment"># State. This backreference can be used by States to transition the Context to</span></span><br><span class="line"><span class="comment"># another State.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span></span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:context</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle1</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle2</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concrete States implement various behaviors, associated with a state of the</span></span><br><span class="line"><span class="comment"># Context.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateA</span> &lt; State</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle1</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteStateA handles request1.&#x27;</span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteStateA wants to change the state of the context.&#x27;</span></span><br><span class="line">    @context.transition_to(ConcreteStateB.new)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle2</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteStateA handles request2.&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateB</span> &lt; State</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle1</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteStateB handles request1.&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle2</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteStateB handles request2.&#x27;</span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteStateB wants to change the state of the context.&#x27;</span></span><br><span class="line">    @context.transition_to(ConcreteStateA.new)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code.</span></span><br><span class="line"></span><br><span class="line">context = Context.new(ConcreteStateA.new)</span><br><span class="line">context.request1</span><br><span class="line">context.request2</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Context: Transition to ConcreteStateA</span><br><span class="line">ConcreteStateA handles request1.</span><br><span class="line">ConcreteStateA wants to change the state of the context.</span><br><span class="line">Context: Transition to ConcreteStateB</span><br><span class="line">ConcreteStateB handles request2.</span><br><span class="line">ConcreteStateB wants to change the state of the context.</span><br><span class="line">Context: Transition to ConcreteStateA</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-7"><p><strong>åœ¨ Swift ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> åœ¨ Swift è¯­è¨€ä¸­ï¼Œ çŠ¶æ€æ¨¡å¼é€šå¸¸è¢«ç”¨äºå°†åŸºäº <code>switch</code>è¯­å¥çš„å¤§å‹çŠ¶æ€æœºè½¬æ¢ä¸ºå¯¹è±¡ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> çŠ¶æ€æ¨¡å¼å¯é€šè¿‡å—å¤–éƒ¨æ§åˆ¶ä¸”èƒ½æ ¹æ®å¯¹è±¡çŠ¶æ€æ”¹å˜è¡Œä¸ºçš„æ–¹æ³•æ¥è¯†åˆ«ã€‚</p><div class="tabs" id="swift"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#swift-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#swift-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="swift-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>çŠ¶æ€</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ Swift åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>Example.swift:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Context defines the interface of interest to clients. It also maintains</span></span><br><span class="line"><span class="comment">/// a reference to an instance of a State subclass, which represents the current</span></span><br><span class="line"><span class="comment">/// state of the Context.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// A reference to the current state of the Context.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> state: <span class="type">State</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> state: <span class="type">State</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.state = state</span><br><span class="line">        transitionTo(state: state)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The Context allows changing the State object at runtime.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">transitionTo</span><span class="params">(state: State)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Context: Transition to &quot;</span> + <span class="type">String</span>(describing: state))</span><br><span class="line">        <span class="keyword">self</span>.state = state</span><br><span class="line">        <span class="keyword">self</span>.state.update(context: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The Context delegates part of its behavior to the current State object.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">request1</span><span class="params">()</span></span> &#123;</span><br><span class="line">        state.handle1()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">request2</span><span class="params">()</span></span> &#123;</span><br><span class="line">        state.handle2()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The base State class declares methods that all Concrete State should</span></span><br><span class="line"><span class="comment">/// implement and also provides a backreference to the Context object,</span></span><br><span class="line"><span class="comment">/// associated with the State. This backreference can be used by States to</span></span><br><span class="line"><span class="comment">/// transition the Context to another State.</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">State</span>: <span class="title">class</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(context: Context)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handle1</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handle2</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseState</span>: <span class="title">State</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>(<span class="keyword">set</span>) <span class="keyword">weak</span> <span class="keyword">var</span> context: <span class="type">Context?</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(context: Context)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.context = context</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handle1</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handle2</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Concrete States implement various behaviors, associated with a state of the</span></span><br><span class="line"><span class="comment">/// Context.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateA</span>: <span class="title">BaseState</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">handle1</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateA handles request1.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateA wants to change the state of the context.\n&quot;</span>)</span><br><span class="line">        context?.transitionTo(state: <span class="type">ConcreteStateB</span>())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">handle2</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateA handles request2.\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateB</span>: <span class="title">BaseState</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">handle1</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateB handles request1.\n&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">handle2</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateB handles request2.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateB wants to change the state of the context.\n&quot;</span>)</span><br><span class="line">        context?.transitionTo(state: <span class="type">ConcreteStateA</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all works together.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StateConceptual</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">Context</span>(<span class="type">ConcreteStateA</span>())</span><br><span class="line">        context.request1()</span><br><span class="line">        context.request2()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Context: Transition to StateConceptual.ConcreteStateA</span><br><span class="line">ConcreteStateA handles request1.</span><br><span class="line">ConcreteStateA wants to change the state of the context.</span><br><span class="line"></span><br><span class="line">Context: Transition to StateConceptual.ConcreteStateB</span><br><span class="line">ConcreteStateB handles request2.</span><br><span class="line">ConcreteStateB wants to change the state of the context.</span><br><span class="line"></span><br><span class="line">Context: Transition to StateConceptual.ConcreteStateA</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="swift-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p><strong>Example.swift:</strong> çœŸå®ä¸–ç•Œç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StateRealWorld</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Client: I&#x27;m starting working with a location tracker&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> tracker = <span class="type">LocationTracker</span>()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">        tracker.startTracking()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">        tracker.pauseTracking(<span class="keyword">for</span>: <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">        tracker.makeCheckIn()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">        tracker.findMyChildren()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">        tracker.stopTracking()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocationTracker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Location tracking is enabled by default</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> trackingState: <span class="type">TrackingState</span> = <span class="type">EnabledTrackingState</span>(tracker: <span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startTracking</span><span class="params">()</span></span> &#123;</span><br><span class="line">        trackingState.startTracking()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopTracking</span><span class="params">()</span></span> &#123;</span><br><span class="line">        trackingState.stopTracking()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pauseTracking</span><span class="params">(<span class="keyword">for</span> time: TimeInterval)</span></span> &#123;</span><br><span class="line">        trackingState.pauseTracking(<span class="keyword">for</span>: time)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeCheckIn</span><span class="params">()</span></span> &#123;</span><br><span class="line">        trackingState.makeCheckIn()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">findMyChildren</span><span class="params">()</span></span> &#123;</span><br><span class="line">        trackingState.findMyChildren()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(state: TrackingState)</span></span> &#123;</span><br><span class="line">        trackingState = state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TrackingState</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startTracking</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopTracking</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pauseTracking</span><span class="params">(<span class="keyword">for</span> time: TimeInterval)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeCheckIn</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">findMyChildren</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EnabledTrackingState</span>: <span class="title">TrackingState</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">weak</span> <span class="keyword">var</span> tracker: <span class="type">LocationTracker?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(tracker: <span class="type">LocationTracker?</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.tracker = tracker</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startTracking</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: startTracking is invoked&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: tracking location....1&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: tracking location....2&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: tracking location....3&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopTracking</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: Received &#x27;stop tracking&#x27;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: Changing state to &#x27;disabled&#x27;...&quot;</span>)</span><br><span class="line">        tracker?.update(state: <span class="type">DisabledTrackingState</span>(tracker: tracker))</span><br><span class="line">        tracker?.stopTracking()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pauseTracking</span><span class="params">(<span class="keyword">for</span> time: TimeInterval)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: Received &#x27;pause tracking&#x27; for \(time) seconds&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: Changing state to &#x27;disabled&#x27;...&quot;</span>)</span><br><span class="line">        tracker?.update(state: <span class="type">DisabledTrackingState</span>(tracker: tracker))</span><br><span class="line">        tracker?.pauseTracking(<span class="keyword">for</span>: time)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeCheckIn</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: performing check-in at the current location&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">findMyChildren</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;EnabledTrackingState: searching for children...&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DisabledTrackingState</span>: <span class="title">TrackingState</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">weak</span> <span class="keyword">var</span> tracker: <span class="type">LocationTracker?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(tracker: <span class="type">LocationTracker?</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.tracker = tracker</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startTracking</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Received &#x27;start tracking&#x27;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Changing state to &#x27;enabled&#x27;...&quot;</span>)</span><br><span class="line">        tracker?.update(state: <span class="type">EnabledTrackingState</span>(tracker: tracker))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pauseTracking</span><span class="params">(<span class="keyword">for</span> time: TimeInterval)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Pause tracking for \(time) seconds&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>...<span class="type">Int</span>(time) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: pause...\(i)&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Time is over&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Returing to &#x27;enabled state&#x27;...\n&quot;</span>)</span><br><span class="line">        <span class="keyword">self</span>.tracker?.update(state: <span class="type">EnabledTrackingState</span>(tracker: <span class="keyword">self</span>.tracker))</span><br><span class="line">        <span class="keyword">self</span>.tracker?.startTracking()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopTracking</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Received &#x27;stop tracking&#x27;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Do nothing...&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeCheckIn</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Received &#x27;make check-in&#x27;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Changing state to &#x27;enabled&#x27;...&quot;</span>)</span><br><span class="line">        tracker?.update(state: <span class="type">EnabledTrackingState</span>(tracker: tracker))</span><br><span class="line">        tracker?.makeCheckIn()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">findMyChildren</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Received &#x27;find my children&#x27;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DisabledTrackingState: Changing state to &#x27;enabled&#x27;...&quot;</span>)</span><br><span class="line">        tracker?.update(state: <span class="type">EnabledTrackingState</span>(tracker: tracker))</span><br><span class="line">        tracker?.findMyChildren()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Client: I&#39;m starting working with a location tracker</span><br><span class="line"></span><br><span class="line">EnabledTrackingState: startTracking is invoked</span><br><span class="line">EnabledTrackingState: tracking location....1</span><br><span class="line">EnabledTrackingState: tracking location....2</span><br><span class="line">EnabledTrackingState: tracking location....3</span><br><span class="line"></span><br><span class="line">EnabledTrackingState: Received &#39;pause tracking&#39; for 2.0 seconds</span><br><span class="line">EnabledTrackingState: Changing state to &#39;disabled&#39;...</span><br><span class="line">DisabledTrackingState: Pause tracking for 2.0 seconds</span><br><span class="line">DisabledTrackingState: pause...0</span><br><span class="line">DisabledTrackingState: pause...1</span><br><span class="line">DisabledTrackingState: pause...2</span><br><span class="line">DisabledTrackingState: Time is over</span><br><span class="line">DisabledTrackingState: Returing to &#39;enabled state&#39;...</span><br><span class="line"></span><br><span class="line">EnabledTrackingState: startTracking is invoked</span><br><span class="line">EnabledTrackingState: tracking location....1</span><br><span class="line">EnabledTrackingState: tracking location....2</span><br><span class="line">EnabledTrackingState: tracking location....3</span><br><span class="line"></span><br><span class="line">EnabledTrackingState: performing check-in at the current location</span><br><span class="line"></span><br><span class="line">EnabledTrackingState: searching for children...</span><br><span class="line"></span><br><span class="line">EnabledTrackingState: Received &#39;stop tracking&#39;</span><br><span class="line">EnabledTrackingState: Changing state to &#39;disabled&#39;...</span><br><span class="line">DisabledTrackingState: Received &#39;stop tracking&#39;</span><br><span class="line">DisabledTrackingState: Do nothing...</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-8"><p><strong>åœ¨ TypeScript ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜†â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> åœ¨ TypeScript è¯­è¨€ä¸­ï¼Œ çŠ¶æ€æ¨¡å¼é€šå¸¸è¢«ç”¨äºå°†åŸºäº <code>switch</code>è¯­å¥çš„å¤§å‹çŠ¶æ€æœºè½¬æ¢ä¸ºå¯¹è±¡ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> çŠ¶æ€æ¨¡å¼å¯é€šè¿‡å—å¤–éƒ¨æ§åˆ¶ä¸”èƒ½æ ¹æ®å¯¹è±¡çŠ¶æ€æ”¹å˜è¡Œä¸ºçš„æ–¹æ³•æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>çŠ¶æ€</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>index.ts:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Context defines the interface of interest to clients. It also maintains a</span></span><br><span class="line"><span class="comment"> * reference to an instance of a State subclass, which represents the current</span></span><br><span class="line"><span class="comment"> * state of the Context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type <span class="type">&#123;State&#125;</span> </span>A reference to the current state of the Context.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> state: State;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">state: State</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.transitionTo(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Context allows changing the State object at runtime.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> transitionTo(state: State): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`Context: Transition to <span class="subst">$&#123;(&lt;<span class="built_in">any</span>&gt;state).constructor.name&#125;</span>.`</span>);</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">        <span class="built_in">this</span>.state.setContext(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Context delegates part of its behavior to the current State object.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> request1(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state.handle1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> request2(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state.handle2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The base State class declares methods that all Concrete State should</span></span><br><span class="line"><span class="comment"> * implement and also provides a backreference to the Context object, associated</span></span><br><span class="line"><span class="comment"> * with the State. This backreference can be used by States to transition the</span></span><br><span class="line"><span class="comment"> * Context to another State.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> context: Context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">setContext</span>(<span class="params">context: Context</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> handle1(): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> handle2(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete States implement various behaviors, associated with a state of the</span></span><br><span class="line"><span class="comment"> * Context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateA</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> handle1(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteStateA handles request1.&#x27;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteStateA wants to change the state of the context.&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.context.transitionTo(<span class="keyword">new</span> ConcreteStateB());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> handle2(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteStateA handles request2.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateB</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> handle1(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteStateB handles request1.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> handle2(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteStateB handles request2.&#x27;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteStateB wants to change the state of the context.&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.context.transitionTo(<span class="keyword">new</span> ConcreteStateA());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStateA());</span><br><span class="line">context.request1();</span><br><span class="line">context.request2();</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Context: Transition to ConcreteStateA.</span><br><span class="line">ConcreteStateA handles request1.</span><br><span class="line">ConcreteStateA wants to change the state of the context.</span><br><span class="line">Context: Transition to ConcreteStateB.</span><br><span class="line">ConcreteStateB handles request2.</span><br><span class="line">ConcreteStateB wants to change the state of the context.</span><br><span class="line">Context: Transition to ConcreteStateA.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-9"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>è®©æˆ‘ä»¬åœ¨ä¸€å°è‡ªåŠ¨å”®è´§æœºä¸Šä½¿ç”¨çŠ¶æ€è®¾è®¡æ¨¡å¼ã€‚ ä¸ºç®€å•èµ·è§ï¼Œ è®©æˆ‘ä»¬å‡è®¾è‡ªåŠ¨å”®è´§æœºä»…ä¼šé”€å”®ä¸€ç§ç±»å‹çš„å•†å“ã€‚ åŒæ—¶ï¼Œ ä¾ç„¶ä¸ºäº†ç®€å•èµ·è§ï¼Œ æˆ‘ä»¬å‡è®¾è‡ªåŠ¨å”®è´§æœºå¯å¤„äº 4 ç§ä¸åŒçš„çŠ¶æ€ä¸­ï¼š</p><ul><li>æœ‰å•†å“ ï¼ˆhasÂ­Itemï¼‰</li><li>æ— å•†å“ ï¼ˆnoÂ­Itemï¼‰</li><li>å•†å“å·²è¯·æ±‚ ï¼ˆitemÂ­Requestedï¼‰</li><li>æ”¶åˆ°çº¸å¸ ï¼ˆhasÂ­Moneyï¼‰</li></ul><p>åŒæ—¶ï¼Œ è‡ªåŠ¨å”®è´§æœºä¹Ÿä¼šæœ‰ä¸åŒçš„æ“ä½œã€‚ å†ä¸€æ¬¡çš„ï¼Œ ä¸ºäº†ç®€å•èµ·è§ï¼Œ æˆ‘ä»¬å‡è®¾å…¶åªä¼šæ‰§è¡Œ 4 ç§æ“ä½œï¼š</p><ul><li>é€‰æ‹©å•†å“</li><li>æ·»åŠ å•†å“</li><li>æ’å…¥çº¸å¸</li><li>æä¾›å•†å“</li></ul><p>å½“å¯¹è±¡å¯ä»¥å¤„äºè®¸å¤šä¸åŒçš„çŠ¶æ€ä¸­æ—¶åº”ä½¿ç”¨çŠ¶æ€è®¾è®¡æ¨¡å¼ï¼Œ åŒæ—¶æ ¹æ®ä¼ å…¥è¯·æ±‚çš„ä¸åŒï¼Œ å¯¹è±¡éœ€è¦å˜æ›´å…¶å½“å‰çŠ¶æ€ã€‚</p><p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ è‡ªåŠ¨å”®è´§æœºå¯ä»¥æœ‰å¤šç§ä¸åŒçš„çŠ¶æ€ï¼Œ åŒæ—¶ä¼šåœ¨è¿™äº›çŠ¶æ€ä¹‹é—´æŒç»­ä¸æ–­åœ°äº’ç›¸è½¬æ¢ã€‚ æˆ‘ä»¬å‡è®¾è‡ªåŠ¨å”®è´§æœºå¤„äº <code>å•†å“å·²è¯·æ±‚</code>çŠ¶æ€ä¸­ã€‚ åœ¨ â€œæ’å…¥çº¸å¸â€ çš„æ“ä½œå‘ç”Ÿåï¼Œ æœºå™¨å°†è‡ªåŠ¨è½¬æ¢è‡³ <code>æ”¶åˆ°çº¸å¸</code>çŠ¶æ€ã€‚</p><p>æ ¹æ®å…¶å½“å‰çŠ¶æ€ï¼Œ æœºå™¨å¯å°±ç›¸åŒè¯·æ±‚é‡‡å–ä¸åŒçš„è¡Œä¸ºã€‚ ä¾‹å¦‚ï¼Œ å¦‚æœç”¨æˆ·æƒ³è¦è´­ä¹°ä¸€ä»¶å•†å“ï¼Œ æœºå™¨å°†åœ¨ <code>æœ‰å•†å“</code>çŠ¶æ€æ—¶ç»§ç»­æ“ä½œï¼Œ è€Œåœ¨ <code>æ— å•†å“</code>çŠ¶æ€æ—¶æ‹’ç»æ“ä½œã€‚</p><p>è‡ªåŠ¨å”®è´§æœºçš„ä»£ç ä¸ä¼šè¢«è¿™ä¸€é€»è¾‘æ±¡æŸ“ï¼› æ‰€æœ‰ä¾èµ–äºçŠ¶æ€çš„ä»£ç éƒ½å­˜åœ¨äºå„è‡ªçš„çŠ¶æ€å®ç°ä¸­ã€‚</p><p><strong>vendingMachine.go:</strong> èƒŒæ™¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> vendingMachine <span class="keyword">struct</span> &#123;</span><br><span class="line">    hasItem       state</span><br><span class="line">    itemRequested state</span><br><span class="line">    hasMoney      state</span><br><span class="line">    noItem        state</span><br><span class="line"></span><br><span class="line">    currentState state</span><br><span class="line"></span><br><span class="line">    itemCount <span class="keyword">int</span></span><br><span class="line">    itemPrice <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newVendingMachine</span><span class="params">(itemCount, itemPrice <span class="keyword">int</span>)</span> *<span class="title">vendingMachine</span></span> &#123;</span><br><span class="line">    v := &amp;vendingMachine&#123;</span><br><span class="line">        itemCount: itemCount,</span><br><span class="line">        itemPrice: itemPrice,</span><br><span class="line">    &#125;</span><br><span class="line">    hasItemState := &amp;hasItemState&#123;</span><br><span class="line">        vendingMachine: v,</span><br><span class="line">    &#125;</span><br><span class="line">    itemRequestedState := &amp;itemRequestedState&#123;</span><br><span class="line">        vendingMachine: v,</span><br><span class="line">    &#125;</span><br><span class="line">    hasMoneyState := &amp;hasMoneyState&#123;</span><br><span class="line">        vendingMachine: v,</span><br><span class="line">    &#125;</span><br><span class="line">    noItemState := &amp;noItemState&#123;</span><br><span class="line">        vendingMachine: v,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v.setState(hasItemState)</span><br><span class="line">    v.hasItem = hasItemState</span><br><span class="line">    v.itemRequested = itemRequestedState</span><br><span class="line">    v.hasMoney = hasMoneyState</span><br><span class="line">    v.noItem = noItemState</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *vendingMachine)</span> <span class="title">requestItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v.currentState.requestItem()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *vendingMachine)</span> <span class="title">addItem</span><span class="params">(count <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v.currentState.addItem(count)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *vendingMachine)</span> <span class="title">insertMoney</span><span class="params">(money <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v.currentState.insertMoney(money)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *vendingMachine)</span> <span class="title">dispenseItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v.currentState.dispenseItem()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *vendingMachine)</span> <span class="title">setState</span><span class="params">(s state)</span></span> &#123;</span><br><span class="line">    v.currentState = s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *vendingMachine)</span> <span class="title">incrementItemCount</span><span class="params">(count <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Adding %d items\n&quot;</span>, count)</span><br><span class="line">    v.itemCount = v.itemCount + count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <strong>state.go:</strong> çŠ¶æ€æ¥å£</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> state <span class="keyword">interface</span> &#123;</span><br><span class="line">    addItem(<span class="keyword">int</span>) error</span><br><span class="line">    requestItem() error</span><br><span class="line">    insertMoney(money <span class="keyword">int</span>) error</span><br><span class="line">    dispenseItem() error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>noItemState.go:</strong> å…·ä½“çŠ¶æ€</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> noItemState <span class="keyword">struct</span> &#123;</span><br><span class="line">    vendingMachine *vendingMachine</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *noItemState)</span> <span class="title">requestItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Item out of stock&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *noItemState)</span> <span class="title">addItem</span><span class="params">(count <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    i.vendingMachine.incrementItemCount(count)</span><br><span class="line">    i.vendingMachine.setState(i.vendingMachine.hasItem)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *noItemState)</span> <span class="title">insertMoney</span><span class="params">(money <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Item out of stock&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *noItemState)</span> <span class="title">dispenseItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Item out of stock&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>hasItemState.go:</strong> å…·ä½“çŠ¶æ€</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> hasItemState <span class="keyword">struct</span> &#123;</span><br><span class="line">    vendingMachine *vendingMachine</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *hasItemState)</span> <span class="title">requestItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> i.vendingMachine.itemCount == <span class="number">0</span> &#123;</span><br><span class="line">        i.vendingMachine.setState(i.vendingMachine.noItem)</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;No item present&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Item requestd\n&quot;</span>)</span><br><span class="line">    i.vendingMachine.setState(i.vendingMachine.itemRequested)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *hasItemState)</span> <span class="title">addItem</span><span class="params">(count <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d items added\n&quot;</span>, count)</span><br><span class="line">    i.vendingMachine.incrementItemCount(count)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *hasItemState)</span> <span class="title">insertMoney</span><span class="params">(money <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Please select item first&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *hasItemState)</span> <span class="title">dispenseItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Please select item first&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>itemRequestedState.go:</strong> å…·ä½“çŠ¶æ€</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> itemRequestedState <span class="keyword">struct</span> &#123;</span><br><span class="line">    vendingMachine *vendingMachine</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *itemRequestedState)</span> <span class="title">requestItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Item already requested&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *itemRequestedState)</span> <span class="title">addItem</span><span class="params">(count <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Item Dispense in progress&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *itemRequestedState)</span> <span class="title">insertMoney</span><span class="params">(money <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> money &lt; i.vendingMachine.itemPrice &#123;</span><br><span class="line">        fmt.Errorf(<span class="string">&quot;Inserted money is less. Please insert %d&quot;</span>, i.vendingMachine.itemPrice)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Money entered is ok&quot;</span>)</span><br><span class="line">    i.vendingMachine.setState(i.vendingMachine.hasMoney)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *itemRequestedState)</span> <span class="title">dispenseItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Please insert money first&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>hasMoneyState.go:</strong> å…·ä½“çŠ¶æ€</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> hasMoneyState <span class="keyword">struct</span> &#123;</span><br><span class="line">    vendingMachine *vendingMachine</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *hasMoneyState)</span> <span class="title">requestItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Item dispense in progress&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *hasMoneyState)</span> <span class="title">addItem</span><span class="params">(count <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Item dispense in progress&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *hasMoneyState)</span> <span class="title">insertMoney</span><span class="params">(money <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Item out of stock&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *hasMoneyState)</span> <span class="title">dispenseItem</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Dispensing Item&quot;</span>)</span><br><span class="line">    i.vendingMachine.itemCount = i.vendingMachine.itemCount - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i.vendingMachine.itemCount == <span class="number">0</span> &#123;</span><br><span class="line">        i.vendingMachine.setState(i.vendingMachine.noItem)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        i.vendingMachine.setState(i.vendingMachine.hasItem)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>main.go:</strong> å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    vendingMachine := newVendingMachine(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    err := vendingMachine.requestItem()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err = vendingMachine.insertMoney(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err = vendingMachine.dispenseItem()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    err = vendingMachine.addItem(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    err = vendingMachine.requestItem()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err = vendingMachine.insertMoney(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err = vendingMachine.dispenseItem()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Item requestd</span><br><span class="line">Money entered is ok</span><br><span class="line">Dispensing Item</span><br><span class="line"></span><br><span class="line">Adding 2 items</span><br><span class="line"></span><br><span class="line">Item requestd</span><br><span class="line">Money entered is ok</span><br><span class="line">Dispensing Item</span><br></pre></td></tr></table></figure><p><em>æ ¹æ®ï¼š <a href="https://golangbyexample.com/state-design-pattern-go/">Golang By Example</a></em></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://refactoringguru.cn/design-patterns/state&quot;&gt;https://refactoringguru.cn/design-patterns/state&lt;/a&gt;&lt;/p&gt;
&lt;/blockq
      
    
    </summary>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
  <entry>
    <title>è¡Œä¸ºæ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼</title>
    <link href="http://wangyangyangisme.github.io/posts/1b971bb/"/>
    <id>http://wangyangyangisme.github.io/posts/1b971bb/</id>
    <published>2021-05-04T12:00:56.000Z</published>
    <updated>2021-05-04T12:00:56.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://refactoringguru.cn/design-patterns/observer">https://refactoringguru.cn/design-patterns/observer</a></p></blockquote><h1 id="è¡Œä¸ºæ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è¡Œä¸ºæ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è¡Œä¸ºæ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼"></a>è¡Œä¸ºæ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼</h1><p><strong>äº¦ç§°ï¼š</strong> äº‹ä»¶è®¢é˜…è€…ã€ç›‘å¬è€…ã€Event-Subscriberã€Listenerã€Observer</p><h2 id="æ„å›¾"><a href="#æ„å›¾" class="headerlink" title="æ„å›¾"></a>æ„å›¾</h2><p><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å…è®¸ä½ å®šä¹‰ä¸€ç§è®¢é˜…æœºåˆ¶ï¼Œ å¯åœ¨å¯¹è±¡äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥å¤šä¸ª â€œè§‚å¯Ÿâ€ è¯¥å¯¹è±¡çš„å…¶ä»–å¯¹è±¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/observer.png" alt=""></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>å‡å¦‚ä½ æœ‰ä¸¤ç§ç±»å‹çš„å¯¹è±¡ï¼š  <code>é¡¾å®¢</code>å’Œ <code>å•†åº—</code> ã€‚ é¡¾å®¢å¯¹æŸä¸ªç‰¹å®šå“ç‰Œçš„äº§å“éå¸¸æ„Ÿå…´è¶£ ï¼ˆä¾‹å¦‚æœ€æ–°å‹å·çš„ iPhone æ‰‹æœºï¼‰ï¼Œ è€Œè¯¥äº§å“å¾ˆå¿«å°†ä¼šåœ¨å•†åº—é‡Œå‡ºå”®ã€‚</p><p>é¡¾å®¢å¯ä»¥æ¯å¤©æ¥å•†åº—çœ‹çœ‹äº§å“æ˜¯å¦åˆ°è´§ã€‚ ä½†å¦‚æœå•†å“å°šæœªåˆ°è´§æ—¶ï¼Œ ç»å¤§å¤šæ•°æ¥åˆ°å•†åº—çš„é¡¾å®¢éƒ½ä¼šç©ºæ‰‹è€Œå½’ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/observer-comic-1-zh.png" alt="å‰å¾€å•†åº—å’Œå‘é€åƒåœ¾é‚®ä»¶"></p><p>å¦ä¸€æ–¹é¢ï¼Œ æ¯æ¬¡æ–°äº§å“åˆ°è´§æ—¶ï¼Œ å•†åº—å¯ä»¥å‘æ‰€æœ‰é¡¾å®¢å‘é€é‚®ä»¶ ï¼ˆå¯èƒ½ä¼šè¢«è§†ä¸ºåƒåœ¾é‚®ä»¶ï¼‰ã€‚ è¿™æ ·ï¼Œ éƒ¨åˆ†é¡¾å®¢å°±æ— éœ€åå¤å‰å¾€å•†åº—äº†ï¼Œ ä½†ä¹Ÿå¯èƒ½ä¼šæƒ¹æ¼å¯¹æ–°äº§å“æ²¡æœ‰å…´è¶£çš„å…¶ä»–é¡¾å®¢ã€‚</p><p>æˆ‘ä»¬ä¼¼ä¹é‡åˆ°äº†ä¸€ä¸ªçŸ›ç›¾ï¼š è¦ä¹ˆè®©é¡¾å®¢æµªè´¹æ—¶é—´æ£€æŸ¥äº§å“æ˜¯å¦åˆ°è´§ï¼Œ è¦ä¹ˆè®©å•†åº—æµªè´¹èµ„æºå»é€šçŸ¥æ²¡æœ‰éœ€æ±‚çš„é¡¾å®¢ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æ‹¥æœ‰ä¸€äº›å€¼å¾—å…³æ³¨çš„çŠ¶æ€çš„å¯¹è±¡é€šå¸¸è¢«ç§°ä¸º<em>ç›®æ ‡<em>ï¼Œ ç”±äºå®ƒè¦å°†è‡ªèº«çš„çŠ¶æ€æ”¹å˜é€šçŸ¥ç»™å…¶ä»–å¯¹è±¡ï¼Œ æˆ‘ä»¬ä¹Ÿå°†å…¶ç§°ä¸º</em>å‘å¸ƒè€…</em> ï¼ˆpublisherï¼‰ã€‚ æ‰€æœ‰å¸Œæœ›å…³æ³¨å‘å¸ƒè€…çŠ¶æ€å˜åŒ–çš„å…¶ä»–å¯¹è±¡è¢«ç§°ä¸º<em>è®¢é˜…è€…</em> ï¼ˆsubscribersï¼‰ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼å»ºè®®ä½ ä¸ºå‘å¸ƒè€…ç±»æ·»åŠ è®¢é˜…æœºåˆ¶ï¼Œ è®©æ¯ä¸ªå¯¹è±¡éƒ½èƒ½è®¢é˜…æˆ–å–æ¶ˆè®¢é˜…å‘å¸ƒè€…äº‹ä»¶æµã€‚ ä¸è¦å®³æ€•ï¼ è¿™å¹¶ä¸åƒå¬ä¸Šå»é‚£ä¹ˆå¤æ‚ã€‚ å®é™…ä¸Šï¼Œ è¯¥æœºåˆ¶åŒ…æ‹¬ 1ï¼‰ ä¸€ä¸ªç”¨äºå­˜å‚¨è®¢é˜…è€…å¯¹è±¡å¼•ç”¨çš„åˆ—è¡¨æˆå‘˜å˜é‡ï¼› 2ï¼‰ å‡ ä¸ªç”¨äºæ·»åŠ æˆ–åˆ é™¤è¯¥åˆ—è¡¨ä¸­è®¢é˜…è€…çš„å…¬æœ‰æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/solution1-zh-observer.png" alt="è®¢é˜…æœºåˆ¶å…è®¸å¯¹è±¡è®¢é˜…äº‹ä»¶é€šçŸ¥ã€‚"></p><p>ç°åœ¨ï¼Œ æ— è®ºä½•æ—¶å‘ç”Ÿäº†é‡è¦çš„å‘å¸ƒè€…äº‹ä»¶ï¼Œ å®ƒéƒ½è¦éå†è®¢é˜…è€…å¹¶è°ƒç”¨å…¶å¯¹è±¡çš„ç‰¹å®šé€šçŸ¥æ–¹æ³•ã€‚</p><p>å®é™…åº”ç”¨ä¸­å¯èƒ½ä¼šæœ‰åå‡ ä¸ªä¸åŒçš„è®¢é˜…è€…ç±»è·Ÿè¸ªç€åŒä¸€ä¸ªå‘å¸ƒè€…ç±»çš„äº‹ä»¶ï¼Œ ä½ ä¸ä¼šå¸Œæœ›å‘å¸ƒè€…ä¸æ‰€æœ‰è¿™äº›ç±»ç›¸è€¦åˆçš„ã€‚ æ­¤å¤–å¦‚æœä»–äººä¼šä½¿ç”¨å‘å¸ƒè€…ç±»ï¼Œ é‚£ä¹ˆä½ ç”šè‡³å¯èƒ½ä¼šå¯¹å…¶ä¸­çš„ä¸€äº›ç±»ä¸€æ— æ‰€çŸ¥ã€‚</p><p>å› æ­¤ï¼Œ æ‰€æœ‰è®¢é˜…è€…éƒ½å¿…é¡»å®ç°åŒæ ·çš„æ¥å£ï¼Œ å‘å¸ƒè€…ä»…é€šè¿‡è¯¥æ¥å£ä¸è®¢é˜…è€…äº¤äº’ã€‚ æ¥å£ä¸­å¿…é¡»å£°æ˜é€šçŸ¥æ–¹æ³•åŠå…¶å‚æ•°ï¼Œ è¿™æ ·å‘å¸ƒè€…åœ¨å‘å‡ºé€šçŸ¥æ—¶è¿˜èƒ½ä¼ é€’ä¸€äº›ä¸Šä¸‹æ–‡æ•°æ®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/solution2-zh-observer.png" alt="å‘å¸ƒè€…è°ƒç”¨è®¢é˜…è€…å¯¹è±¡ä¸­çš„ç‰¹å®šé€šçŸ¥æ–¹æ³•æ¥é€šçŸ¥è®¢é˜…è€…ã€‚"></p><p>å¦‚æœä½ çš„åº”ç”¨ä¸­æœ‰å¤šä¸ªä¸åŒç±»å‹çš„å‘å¸ƒè€…ï¼Œ ä¸”å¸Œæœ›è®¢é˜…è€…å¯å…¼å®¹æ‰€æœ‰å‘å¸ƒè€…ï¼Œ é‚£ä¹ˆä½ ç”šè‡³å¯ä»¥è¿›ä¸€æ­¥è®©æ‰€æœ‰è®¢é˜…è€…éµå¾ªåŒæ ·çš„æ¥å£ã€‚ è¯¥æ¥å£ä»…éœ€æè¿°å‡ ä¸ªè®¢é˜…æ–¹æ³•å³å¯ã€‚ è¿™æ ·è®¢é˜…è€…å°±èƒ½åœ¨ä¸ä¸å…·ä½“å‘å¸ƒè€…ç±»è€¦åˆçš„æƒ…å†µä¸‹é€šè¿‡æ¥å£è§‚å¯Ÿå‘å¸ƒè€…çš„çŠ¶æ€ã€‚</p><h2 id="çœŸå®ä¸–ç•Œç±»æ¯”"><a href="#çœŸå®ä¸–ç•Œç±»æ¯”" class="headerlink" title="çœŸå®ä¸–ç•Œç±»æ¯”"></a>çœŸå®ä¸–ç•Œç±»æ¯”</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/observer-comic-2-zh.png" alt="æ‚å¿—å’ŒæŠ¥çº¸è®¢é˜…ã€‚"></p><p>å¦‚æœä½ è®¢é˜…äº†ä¸€ä»½æ‚å¿—æˆ–æŠ¥çº¸ï¼Œ é‚£å°±ä¸éœ€è¦å†å»æŠ¥æ‘ŠæŸ¥è¯¢æ–°å‡ºç‰ˆçš„åˆŠç‰©äº†ã€‚ å‡ºç‰ˆç¤¾ ï¼ˆå³åº”ç”¨ä¸­çš„ â€œå‘å¸ƒè€…â€ï¼‰ ä¼šåœ¨åˆŠç‰©å‡ºç‰ˆå ï¼ˆç”šè‡³æå‰ï¼‰ ç›´æ¥å°†æœ€æ–°ä¸€æœŸå¯„é€è‡³ä½ çš„é‚®ç®±ä¸­ã€‚</p><p>å‡ºç‰ˆç¤¾è´Ÿè´£ç»´æŠ¤è®¢é˜…è€…åˆ—è¡¨ï¼Œ äº†è§£è®¢é˜…è€…å¯¹å“ªäº›åˆŠç‰©æ„Ÿå…´è¶£ã€‚ å½“è®¢é˜…è€…å¸Œæœ›å‡ºç‰ˆç¤¾åœæ­¢å¯„é€æ–°ä¸€æœŸçš„æ‚å¿—æ—¶ï¼Œ ä»–ä»¬å¯éšæ—¶ä»è¯¥åˆ—è¡¨ä¸­é€€å‡ºã€‚</p><h2 id="è§‚å¯Ÿè€…æ¨¡å¼ç»“æ„"><a href="#è§‚å¯Ÿè€…æ¨¡å¼ç»“æ„" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼ç»“æ„"></a>è§‚å¯Ÿè€…æ¨¡å¼ç»“æ„</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/structure-indexed-observer.png" alt=""></p><ol><li><strong>å‘å¸ƒè€…</strong> ï¼ˆPublisherï¼‰ ä¼šå‘å…¶ä»–å¯¹è±¡å‘é€å€¼å¾—å…³æ³¨çš„äº‹ä»¶ã€‚ äº‹ä»¶ä¼šåœ¨å‘å¸ƒè€…è‡ªèº«çŠ¶æ€æ”¹å˜æˆ–æ‰§è¡Œç‰¹å®šè¡Œä¸ºåå‘ç”Ÿã€‚ å‘å¸ƒè€…ä¸­åŒ…å«ä¸€ä¸ªå…è®¸æ–°è®¢é˜…è€…åŠ å…¥å’Œå½“å‰è®¢é˜…è€…ç¦»å¼€åˆ—è¡¨çš„è®¢é˜…æ„æ¶ã€‚</li><li>å½“æ–°äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ å‘é€è€…ä¼šéå†è®¢é˜…åˆ—è¡¨å¹¶è°ƒç”¨æ¯ä¸ªè®¢é˜…è€…å¯¹è±¡çš„é€šçŸ¥æ–¹æ³•ã€‚ è¯¥æ–¹æ³•æ˜¯åœ¨è®¢é˜…è€…æ¥å£ä¸­å£°æ˜çš„ã€‚</li><li><strong>è®¢é˜…è€…</strong> ï¼ˆSubscriberï¼‰ æ¥å£å£°æ˜äº†é€šçŸ¥æ¥å£ã€‚ åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ è¯¥æ¥å£ä»…åŒ…å«ä¸€ä¸ª <code>update</code>æ›´æ–°æ–¹æ³•ã€‚ è¯¥æ–¹æ³•å¯ä»¥æ‹¥æœ‰å¤šä¸ªå‚æ•°ï¼Œ ä½¿å‘å¸ƒè€…èƒ½åœ¨æ›´æ–°æ—¶ä¼ é€’äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚</li><li><strong>å…·ä½“è®¢é˜…è€…</strong> ï¼ˆConcrete Subscribersï¼‰ å¯ä»¥æ‰§è¡Œä¸€äº›æ“ä½œæ¥å›åº”å‘å¸ƒè€…çš„é€šçŸ¥ã€‚ æ‰€æœ‰å…·ä½“è®¢é˜…è€…ç±»éƒ½å®ç°äº†åŒæ ·çš„æ¥å£ï¼Œ å› æ­¤å‘å¸ƒè€…ä¸éœ€è¦ä¸å…·ä½“ç±»ç›¸è€¦åˆã€‚</li><li>è®¢é˜…è€…é€šå¸¸éœ€è¦ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥æ­£ç¡®åœ°å¤„ç†æ›´æ–°ã€‚ å› æ­¤ï¼Œ å‘å¸ƒè€…é€šå¸¸ä¼šå°†ä¸€äº›ä¸Šä¸‹æ–‡æ•°æ®ä½œä¸ºé€šçŸ¥æ–¹æ³•çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚ å‘å¸ƒè€…ä¹Ÿå¯å°†è‡ªèº«ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œ ä½¿è®¢é˜…è€…ç›´æ¥è·å–æ‰€éœ€çš„æ•°æ®ã€‚</li><li><strong>å®¢æˆ·ç«¯</strong> ï¼ˆClientï¼‰ ä¼šåˆ†åˆ«åˆ›å»ºå‘å¸ƒè€…å’Œè®¢é˜…è€…å¯¹è±¡ï¼Œ ç„¶åä¸ºè®¢é˜…è€…æ³¨å†Œå‘å¸ƒè€…æ›´æ–°ã€‚</li></ol><h2 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h2><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ <strong>è§‚å¯Ÿè€…</strong>æ¨¡å¼å…è®¸æ–‡æœ¬ç¼–è¾‘å™¨å¯¹è±¡å°†è‡ªèº«çš„çŠ¶æ€æ”¹å˜é€šçŸ¥ç»™å…¶ä»–æœåŠ¡å¯¹è±¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/pattern/example-observer.png" alt="å°†å¯¹è±¡ä¸­å‘ç”Ÿçš„äº‹ä»¶é€šçŸ¥ç»™å…¶ä»–å¯¹è±¡ã€‚"></p><p>è®¢é˜…è€…åˆ—è¡¨æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼š å¯¹è±¡å¯åœ¨è¿è¡Œæ—¶æ ¹æ®ç¨‹åºéœ€è¦å¼€å§‹æˆ–åœæ­¢ç›‘å¬é€šçŸ¥ã€‚</p><p>åœ¨æœ¬å®ç°ä¸­ï¼Œ ç¼–è¾‘å™¨ç±»è‡ªèº«å¹¶ä¸ç»´æŠ¤è®¢é˜…åˆ—è¡¨ã€‚ å®ƒå°†å·¥ä½œå§”æ´¾ç»™ä¸“é—¨ä»äº‹æ­¤å·¥ä½œçš„ä¸€ä¸ªç‰¹æ®Šå¸®æ‰‹å¯¹è±¡ã€‚ ä½ è¿˜å¯å°†è¯¥å¯¹è±¡å‡çº§ä¸ºä¸­å¿ƒåŒ–çš„äº‹ä»¶åˆ†å‘å™¨ï¼Œ å…è®¸ä»»ä½•å¯¹è±¡æˆä¸ºå‘å¸ƒè€…ã€‚</p><p>åªè¦å‘å¸ƒè€…é€šè¿‡åŒæ ·çš„æ¥å£ä¸æ‰€æœ‰è®¢é˜…è€…è¿›è¡Œäº¤äº’ï¼Œ é‚£ä¹ˆåœ¨ç¨‹åºä¸­æ–°å¢è®¢é˜…è€…æ—¶å°±æ— éœ€ä¿®æ”¹å·²æœ‰å‘å¸ƒè€…ç±»çš„ä»£ç ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘å¸ƒè€…åŸºç±»åŒ…å«è®¢é˜…ç®¡ç†ä»£ç å’Œé€šçŸ¥æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">class</span> EventManager <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">private</span> field listeners: hash map <span class="keyword">of</span> event types <span class="keyword">and</span> listeners</span><br><span class="line"></span><br><span class="line">    method subscribe(eventType, listener) <span class="keyword">is</span></span><br><span class="line">        listeners.add(eventType, listener)</span><br><span class="line"></span><br><span class="line">    method unsubscribe(eventType, listener) <span class="keyword">is</span></span><br><span class="line">        listeners.remove(eventType, listener)</span><br><span class="line"></span><br><span class="line">    method notify(eventType, data) <span class="keyword">is</span></span><br><span class="line">        foreach (listener <span class="keyword">in</span> listeners.<span class="keyword">of</span>(eventType)) <span class="keyword">do</span></span><br><span class="line">            listener.update(data)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“å‘å¸ƒè€…åŒ…å«ä¸€äº›è®¢é˜…è€…æ„Ÿå…´è¶£çš„å®é™…ä¸šåŠ¡é€»è¾‘ã€‚æˆ‘ä»¬å¯ä»¥ä»å‘å¸ƒè€…åŸºç±»ä¸­æ‰©</span></span><br><span class="line"><span class="comment">// å±•å‡ºè¯¥ç±»ï¼Œä½†åœ¨å®é™…æƒ…å†µä¸‹å¹¶ä¸æ€»èƒ½åšåˆ°ï¼Œå› ä¸ºå…·ä½“å‘å¸ƒè€…å¯èƒ½å·²ç»æ˜¯å­ç±»äº†ã€‚</span></span><br><span class="line"><span class="comment">// åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ç”¨ç»„åˆæ¥ä¿®è¡¥è®¢é˜…é€»è¾‘ï¼Œå°±åƒæˆ‘ä»¬åœ¨è¿™é‡Œåšçš„ä¸€æ ·ã€‚</span></span><br><span class="line"><span class="keyword">class</span> Editor <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">public</span> field events: EventManager</span><br><span class="line">    <span class="keyword">private</span> field <span class="keyword">file</span>: <span class="keyword">File</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">Editor</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">events</span> = <span class="title">new</span> <span class="title">EventManager</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// ä¸šåŠ¡é€»è¾‘çš„æ–¹æ³•å¯å°†å˜åŒ–é€šçŸ¥ç»™è®¢é˜…è€…ã€‚</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">openFile</span><span class="params">(path)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">file</span> = <span class="title">new</span> <span class="title">File</span><span class="params">(path)</span></span></span><br><span class="line"><span class="function">        <span class="title">events</span>.<span class="title">notify</span><span class="params">(&quot;open&quot;, <span class="keyword">file</span>.<span class="keyword">name</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">saveFile</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">file</span>.<span class="title">write</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">events</span>.<span class="title">notify</span><span class="params">(&quot;save&quot;, <span class="keyword">file</span>.<span class="keyword">name</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// è¿™é‡Œæ˜¯è®¢é˜…è€…æ¥å£ã€‚å¦‚æœä½ çš„ç¼–ç¨‹è¯­è¨€æ”¯æŒå‡½æ•°ç±»å‹ï¼Œåˆ™å¯ç”¨ä¸€ç»„å‡½æ•°æ¥ä»£æ›¿æ•´</span></span></span><br><span class="line"><span class="function"><span class="comment">// ä¸ªè®¢é˜…è€…çš„å±‚æ¬¡ç»“æ„ã€‚</span></span></span><br><span class="line"><span class="function"><span class="title">interface</span> <span class="title">EventListener</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">update</span><span class="params">(filename)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// å…·ä½“è®¢é˜…è€…ä¼šå¯¹å…¶æ³¨å†Œçš„å‘å¸ƒè€…æ‰€å‘å‡ºçš„æ›´æ–°æ¶ˆæ¯åšå‡ºå“åº”ã€‚</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">LoggingListener</span> <span class="title">implements</span> <span class="title">EventListener</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">private</span> <span class="title">field</span> <span class="title">log</span>:</span> <span class="keyword">File</span></span><br><span class="line">    <span class="keyword">private</span> field <span class="keyword">message</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">LoggingListener</span><span class="params">(log_filename, <span class="keyword">message</span>)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">log</span> = <span class="title">new</span> <span class="title">File</span><span class="params">(log_filename)</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">message</span> = <span class="title">message</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">update</span><span class="params">(filename)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">log</span>.<span class="title">write</span><span class="params">(replace(<span class="string">&#x27;%s&#x27;</span>,filename,<span class="keyword">message</span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">EmailAlertsListener</span> <span class="title">implements</span> <span class="title">EventListener</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">private</span> <span class="title">field</span> <span class="title">email</span>:</span> <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">EmailAlertsListener</span><span class="params">(email, <span class="keyword">message</span>)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">email</span> = <span class="title">email</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">message</span> = <span class="title">message</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">update</span><span class="params">(filename)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">system</span>.<span class="title">email</span><span class="params">(email, replace(<span class="string">&#x27;%s&#x27;</span>,filename,<span class="keyword">message</span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// åº”ç”¨ç¨‹åºå¯åœ¨è¿è¡Œæ—¶é…ç½®å‘å¸ƒè€…å’Œè®¢é˜…è€…ã€‚</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">Application</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">config</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">editor</span> = <span class="title">new</span> <span class="title">Editor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">logger</span> = <span class="title">new</span> <span class="title">LoggingListener</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            &quot;/path/<span class="keyword">to</span>/log.txt&quot;,</span></span></span><br><span class="line"><span class="function"><span class="params">            &quot;æœ‰äººæ‰“å¼€äº†æ–‡ä»¶ï¼š%s&quot;)</span>;</span></span><br><span class="line">        editor.events.subscribe(&quot;open&quot;, logger)</span><br><span class="line"></span><br><span class="line">        emailAlerts = new EmailAlertsListener(</span><br><span class="line">            &quot;admin@example.com&quot;,</span><br><span class="line">            &quot;æœ‰äººæ›´æ”¹äº†æ–‡ä»¶ï¼š%s&quot;)</span><br><span class="line">        editor.events.subscribe(&quot;save&quot;, emailAlerts)</span><br></pre></td></tr></table></figure><h2 id="è§‚å¯Ÿè€…æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"><a href="#è§‚å¯Ÿè€…æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯"></a>è§‚å¯Ÿè€…æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯</h2><p><strong>å½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€çš„æ”¹å˜éœ€è¦æ”¹å˜å…¶ä»–å¯¹è±¡ï¼Œæˆ–å®é™…å¯¹è±¡æ˜¯äº‹å…ˆæœªçŸ¥çš„æˆ–åŠ¨æ€å˜åŒ–çš„æ—¶ï¼Œå¯ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ã€‚</strong></p><p>å½“ä½ ä½¿ç”¨å›¾å½¢ç”¨æˆ·ç•Œé¢ç±»æ—¶é€šå¸¸ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚ æ¯”å¦‚ï¼Œ ä½ åˆ›å»ºäº†è‡ªå®šä¹‰æŒ‰é’®ç±»å¹¶å…è®¸å®¢æˆ·ç«¯åœ¨æŒ‰é’®ä¸­æ³¨å…¥è‡ªå®šä¹‰ä»£ç ï¼Œ è¿™æ ·å½“ç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®æ—¶å°±ä¼šè§¦å‘è¿™äº›ä»£ç ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼å…è®¸ä»»ä½•å®ç°äº†è®¢é˜…è€…æ¥å£çš„å¯¹è±¡è®¢é˜…å‘å¸ƒè€…å¯¹è±¡çš„äº‹ä»¶é€šçŸ¥ã€‚ ä½ å¯åœ¨æŒ‰é’®ä¸­æ·»åŠ è®¢é˜…æœºåˆ¶ï¼Œ å…è®¸å®¢æˆ·ç«¯é€šè¿‡è‡ªå®šä¹‰è®¢é˜…ç±»æ³¨å…¥è‡ªå®šä¹‰ä»£ç ã€‚</p><p><strong>å½“åº”ç”¨ä¸­çš„ä¸€äº›å¯¹è±¡å¿…é¡»è§‚å¯Ÿå…¶ä»–å¯¹è±¡æ—¶ï¼Œå¯ä½¿ç”¨è¯¥æ¨¡å¼ã€‚ä½†ä»…èƒ½åœ¨æœ‰é™æ—¶é—´å†…æˆ–ç‰¹å®šæƒ…å†µä¸‹ä½¿ç”¨ã€‚</strong></p><p>è®¢é˜…åˆ—è¡¨æ˜¯åŠ¨æ€çš„ï¼Œ å› æ­¤è®¢é˜…è€…å¯éšæ—¶åŠ å…¥æˆ–ç¦»å¼€è¯¥åˆ—è¡¨ã€‚</p><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><ol><li><p>ä»”ç»†æ£€æŸ¥ä½ çš„ä¸šåŠ¡é€»è¾‘ï¼Œ è¯•ç€å°†å…¶æ‹†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š ç‹¬ç«‹äºå…¶ä»–ä»£ç çš„æ ¸å¿ƒåŠŸèƒ½å°†ä½œä¸ºå‘å¸ƒè€…ï¼› å…¶ä»–ä»£ç åˆ™å°†è½¬åŒ–ä¸ºä¸€ç»„è®¢é˜…ç±»ã€‚</p></li><li><p>å£°æ˜è®¢é˜…è€…æ¥å£ã€‚ è¯¥æ¥å£è‡³å°‘åº”å£°æ˜ä¸€ä¸ª <code>update</code>æ–¹æ³•ã€‚</p></li><li><p>å£°æ˜å‘å¸ƒè€…æ¥å£å¹¶å®šä¹‰ä¸€äº›æ¥å£æ¥åœ¨åˆ—è¡¨ä¸­æ·»åŠ å’Œåˆ é™¤è®¢é˜…å¯¹è±¡ã€‚ è®°ä½å‘å¸ƒè€…å¿…é¡»ä»…é€šè¿‡è®¢é˜…è€…æ¥å£ä¸å®ƒä»¬è¿›è¡Œäº¤äº’ã€‚</p></li><li><p>ç¡®å®šå­˜æ”¾å®é™…è®¢é˜…åˆ—è¡¨çš„ä½ç½®å¹¶å®ç°è®¢é˜…æ–¹æ³•ã€‚ é€šå¸¸æ‰€æœ‰ç±»å‹çš„å‘å¸ƒè€…ä»£ç çœ‹ä¸Šå»éƒ½ä¸€æ ·ï¼Œ å› æ­¤å°†åˆ—è¡¨æ”¾ç½®åœ¨ç›´æ¥æ‰©å±•è‡ªå‘å¸ƒè€…æ¥å£çš„æŠ½è±¡ç±»ä¸­æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚ å…·ä½“å‘å¸ƒè€…ä¼šæ‰©å±•è¯¥ç±»ä»è€Œç»§æ‰¿æ‰€æœ‰çš„è®¢é˜…è¡Œä¸ºã€‚</p><p>ä½†æ˜¯ï¼Œ å¦‚æœä½ éœ€è¦åœ¨ç°æœ‰çš„ç±»å±‚æ¬¡ç»“æ„ä¸­åº”ç”¨è¯¥æ¨¡å¼ï¼Œ åˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨ç»„åˆçš„æ–¹å¼ï¼š å°†è®¢é˜…é€»è¾‘æ”¾å…¥ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œ ç„¶åè®©æ‰€æœ‰å®é™…è®¢é˜…è€…ä½¿ç”¨è¯¥å¯¹è±¡ã€‚</p></li><li><p>åˆ›å»ºå…·ä½“å‘å¸ƒè€…ç±»ã€‚ æ¯æ¬¡å‘å¸ƒè€…å‘ç”Ÿäº†é‡è¦äº‹ä»¶æ—¶éƒ½å¿…é¡»é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ã€‚</p></li><li><p>åœ¨å…·ä½“è®¢é˜…è€…ç±»ä¸­å®ç°é€šçŸ¥æ›´æ–°çš„æ–¹æ³•ã€‚ ç»å¤§éƒ¨åˆ†è®¢é˜…è€…éœ€è¦ä¸€äº›ä¸äº‹ä»¶ç›¸å…³çš„ä¸Šä¸‹æ–‡æ•°æ®ã€‚ è¿™äº›æ•°æ®å¯ä½œä¸ºé€šçŸ¥æ–¹æ³•çš„å‚æ•°æ¥ä¼ é€’ã€‚</p><p>ä½†è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ã€‚ è®¢é˜…è€…æ¥æ”¶åˆ°é€šçŸ¥åç›´æ¥ä»é€šçŸ¥ä¸­è·å–æ‰€æœ‰æ•°æ®ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ å‘å¸ƒè€…å¿…é¡»é€šè¿‡æ›´æ–°æ–¹æ³•å°†è‡ªèº«ä¼ é€’å‡ºå»ã€‚ å¦ä¸€ç§ä¸å¤ªçµæ´»çš„æ–¹å¼æ˜¯é€šè¿‡æ„é€ å‡½æ•°å°†å‘å¸ƒè€…ä¸è®¢é˜…è€…æ°¸ä¹…æ€§åœ°è¿æ¥èµ·æ¥ã€‚</p></li><li><p>å®¢æˆ·ç«¯å¿…é¡»ç”Ÿæˆæ‰€éœ€çš„å…¨éƒ¨è®¢é˜…è€…ï¼Œ å¹¶åœ¨ç›¸åº”çš„å‘å¸ƒè€…å¤„å®Œæˆæ³¨å†Œå·¥ä½œã€‚</p></li></ol><h2 id="è§‚å¯Ÿè€…æ¨¡å¼ä¼˜ç¼ºç‚¹"><a href="#è§‚å¯Ÿè€…æ¨¡å¼ä¼˜ç¼ºç‚¹" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼ä¼˜ç¼ºç‚¹"></a>è§‚å¯Ÿè€…æ¨¡å¼ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹</p><ul><li><em>å¼€é—­åŸåˆ™</em>ã€‚ ä½ æ— éœ€ä¿®æ”¹å‘å¸ƒè€…ä»£ç å°±èƒ½å¼•å…¥æ–°çš„è®¢é˜…è€…ç±» ï¼ˆå¦‚æœæ˜¯å‘å¸ƒè€…æ¥å£åˆ™å¯è½»æ¾å¼•å…¥å‘å¸ƒè€…ç±»ï¼‰ã€‚</li><li>ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶å»ºç«‹å¯¹è±¡ä¹‹é—´çš„è”ç³»ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>è®¢é˜…è€…çš„é€šçŸ¥é¡ºåºæ˜¯éšæœºçš„ã€‚</li></ul><h2 id="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"><a href="#ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»" class="headerlink" title="ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»"></a>ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2><ul><li><p><a href="https://refactoringguru.cn/design-patterns/chain-of-responsibility">è´£ä»»é“¾æ¨¡å¼</a>ã€ <a href="https://refactoringguru.cn/design-patterns/command">å‘½ä»¤æ¨¡å¼</a>ã€ <a href="https://refactoringguru.cn/design-patterns/mediator">ä¸­ä»‹è€…æ¨¡å¼</a>å’Œ<a href="https://refactoringguru.cn/design-patterns/observer">è§‚å¯Ÿè€…æ¨¡å¼</a>ç”¨äºå¤„ç†è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„ä¸åŒè¿æ¥æ–¹å¼ï¼š</p><ul><li><em>è´£ä»»é“¾</em>æŒ‰ç…§é¡ºåºå°†è¯·æ±‚åŠ¨æ€ä¼ é€’ç»™ä¸€ç³»åˆ—çš„æ½œåœ¨æ¥æ”¶è€…ï¼Œ ç›´è‡³å…¶ä¸­ä¸€åæ¥æ”¶è€…å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</li><li><em>å‘½ä»¤</em>åœ¨å‘é€è€…å’Œè¯·æ±‚è€…ä¹‹é—´å»ºç«‹å•å‘è¿æ¥ã€‚</li><li><em>ä¸­ä»‹è€…</em>æ¸…é™¤äº†å‘é€è€…å’Œè¯·æ±‚è€…ä¹‹é—´çš„ç›´æ¥è¿æ¥ï¼Œ å¼ºåˆ¶å®ƒä»¬é€šè¿‡ä¸€ä¸ªä¸­ä»‹å¯¹è±¡è¿›è¡Œé—´æ¥æ²Ÿé€šã€‚</li><li><em>è§‚å¯Ÿè€…</em>å…è®¸æ¥æ”¶è€…åŠ¨æ€åœ°è®¢é˜…æˆ–å–æ¶ˆæ¥æ”¶è¯·æ±‚ã€‚</li></ul></li><li><p><a href="https://refactoringguru.cn/design-patterns/mediator">ä¸­ä»‹è€…</a>å’Œ<a href="https://refactoringguru.cn/design-patterns/observer">è§‚å¯Ÿè€…</a>ä¹‹é—´çš„åŒºåˆ«å¾€å¾€å¾ˆéš¾è®°ä½ã€‚ åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œ ä½ å¯ä»¥ä½¿ç”¨å…¶ä¸­ä¸€ç§æ¨¡å¼ï¼Œ è€Œæœ‰æ—¶å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p><em>ä¸­ä»‹è€…</em>çš„ä¸»è¦ç›®æ ‡æ˜¯æ¶ˆé™¤ä¸€ç³»åˆ—ç³»ç»Ÿç»„ä»¶ä¹‹é—´çš„ç›¸äº’ä¾èµ–ã€‚ è¿™äº›ç»„ä»¶å°†ä¾èµ–äºåŒä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡ã€‚ <em>è§‚å¯Ÿè€…</em>çš„ç›®æ ‡æ˜¯åœ¨å¯¹è±¡ä¹‹é—´å»ºç«‹åŠ¨æ€çš„å•å‘è¿æ¥ï¼Œ ä½¿å¾—éƒ¨åˆ†å¯¹è±¡å¯ä½œä¸ºå…¶ä»–å¯¹è±¡çš„é™„å±å‘æŒ¥ä½œç”¨ã€‚</p><p>æœ‰ä¸€ç§æµè¡Œçš„ä¸­ä»‹è€…æ¨¡å¼å®ç°æ–¹å¼ä¾èµ–äº<em>è§‚å¯Ÿè€…</em>ã€‚ ä¸­ä»‹è€…å¯¹è±¡æ‹…å½“å‘å¸ƒè€…çš„è§’è‰²ï¼Œ å…¶ä»–ç»„ä»¶åˆ™ä½œä¸ºè®¢é˜…è€…ï¼Œ å¯ä»¥è®¢é˜…ä¸­ä»‹è€…çš„äº‹ä»¶æˆ–å–æ¶ˆè®¢é˜…ã€‚ å½“<em>ä¸­ä»‹è€…</em>ä»¥è¿™ç§æ–¹å¼å®ç°æ—¶ï¼Œ å®ƒå¯èƒ½çœ‹ä¸Šå»ä¸<em>è§‚å¯Ÿè€…</em>éå¸¸ç›¸ä¼¼ã€‚</p><p>å½“ä½ æ„Ÿåˆ°ç–‘æƒ‘æ—¶ï¼Œ è®°ä½å¯ä»¥é‡‡ç”¨å…¶ä»–æ–¹å¼æ¥å®ç°ä¸­ä»‹è€…ã€‚ ä¾‹å¦‚ï¼Œ ä½ å¯æ°¸ä¹…æ€§åœ°å°†æ‰€æœ‰ç»„ä»¶é“¾æ¥åˆ°åŒä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡ã€‚ è¿™ç§å®ç°æ–¹å¼å’Œ<em>è§‚å¯Ÿè€…</em>å¹¶ä¸ç›¸åŒï¼Œ ä½†è¿™ä»æ˜¯ä¸€ç§ä¸­ä»‹è€…æ¨¡å¼ã€‚</p><p>å‡è®¾æœ‰ä¸€ä¸ªç¨‹åºï¼Œ å…¶æ‰€æœ‰çš„ç»„ä»¶éƒ½å˜æˆäº†å‘å¸ƒè€…ï¼Œ å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’å»ºç«‹åŠ¨æ€è¿æ¥ã€‚ è¿™æ ·ç¨‹åºä¸­å°±æ²¡æœ‰ä¸­å¿ƒåŒ–çš„ä¸­ä»‹è€…å¯¹è±¡ï¼Œ è€Œåªæœ‰ä¸€äº›åˆ†å¸ƒå¼çš„è§‚å¯Ÿè€…ã€‚</p></li></ul><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p><strong>è§‚å¯Ÿè€…</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å…è®¸ä¸€ä¸ªå¯¹è±¡å°†å…¶çŠ¶æ€çš„æ”¹å˜é€šçŸ¥å…¶ä»–å¯¹è±¡</p><p>è§‚å¯Ÿè€…æ¨¡å¼æä¾›äº†ä¸€ç§ä½œç”¨äºä»»ä½•å®ç°äº†è®¢é˜…è€…æ¥å£çš„å¯¹è±¡çš„æœºåˆ¶ï¼Œ å¯å¯¹å…¶äº‹ä»¶è¿›è¡Œè®¢é˜…å’Œå–æ¶ˆè®¢é˜…ã€‚</p><div class="tabs" id="tags"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#tags-1">C#</button></li><li class="tab"><button type="button" data-href="#tags-2">C++</button></li><li class="tab"><button type="button" data-href="#tags-3">JAVA</button></li><li class="tab"><button type="button" data-href="#tags-4">PHP</button></li><li class="tab"><button type="button" data-href="#tags-5">Python</button></li><li class="tab"><button type="button" data-href="#tags-6">Ruby</button></li><li class="tab"><button type="button" data-href="#tags-7">Swift</button></li><li class="tab"><button type="button" data-href="#tags-8">TypeScrit</button></li><li class="tab"><button type="button" data-href="#tags-9">Golang</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="tags-1"><p><strong>åœ¨ C# ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è§‚å¯Ÿè€…æ¨¡å¼åœ¨ C# ä»£ç ä¸­å¾ˆå¸¸è§ï¼Œ ç‰¹åˆ«æ˜¯åœ¨ GUI ç»„ä»¶ä¸­ã€‚ å®ƒæä¾›äº†åœ¨ä¸ä¸å…¶ä»–å¯¹è±¡æ‰€å±ç±»è€¦åˆçš„æƒ…å†µä¸‹å¯¹å…¶äº‹ä»¶åšå‡ºååº”çš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å°†å¯¹è±¡å­˜å‚¨åœ¨åˆ—è¡¨ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œ å’Œå¯¹äºé¢å‘è¯¥åˆ—è¡¨ä¸­å¯¹è±¡çš„æ›´æ–°æ–¹æ³•çš„è°ƒç”¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è§‚å¯Ÿè€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>Program.cs:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.Observer.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IObserver</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Receive update from subject</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params">ISubject subject</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISubject</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Attach an observer to the subject.</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Attach</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Detach an observer from the subject.</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Detach</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Notify all observers about an event.</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Notify</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Subject owns some important state and notifies observers when the</span></span><br><span class="line">    <span class="comment">// state changes.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Subject</span> : <span class="title">ISubject</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// For the sake of simplicity, the Subject&#x27;s state, essential to all</span></span><br><span class="line">        <span class="comment">// subscribers, is stored in this variable.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> State &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="number">-0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// List of subscribers. In real life, the list of subscribers can be</span></span><br><span class="line">        <span class="comment">// stored more comprehensively (categorized by event type, etc.).</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">List</span>&lt;<span class="title">IObserver</span>&gt; _observers</span> = <span class="keyword">new</span> List&lt;IObserver&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The subscription management methods.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attach</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Subject: Attached an observer.&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>._observers.Add(observer);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Detach</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>._observers.Remove(observer);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Subject: Detached an observer.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Trigger an update in each subscriber.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Notify</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Subject: Notifying observers...&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> observer <span class="keyword">in</span> _observers)</span><br><span class="line">            &#123;</span><br><span class="line">                observer.Update(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Usually, the subscription logic is only a fraction of what a Subject</span></span><br><span class="line">        <span class="comment">// can really do. Subjects commonly hold some important business logic,</span></span><br><span class="line">        <span class="comment">// that triggers a notification method whenever something important is</span></span><br><span class="line">        <span class="comment">// about to happen (or after it).</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SomeBusinessLogic</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;\nSubject: I&#x27;m doing something important.&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>.State = <span class="keyword">new</span> Random().Next(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">            Thread.Sleep(<span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Subject: My state has just changed to: &quot;</span> + <span class="keyword">this</span>.State);</span><br><span class="line">            <span class="keyword">this</span>.Notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete Observers react to the updates issued by the Subject they had</span></span><br><span class="line">    <span class="comment">// been attached to.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteObserverA</span> : <span class="title">IObserver</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">ISubject subject</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;            </span><br><span class="line">            <span class="keyword">if</span> ((subject <span class="keyword">as</span> Subject).State &lt; <span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;ConcreteObserverA: Reacted to the event.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteObserverB</span> : <span class="title">IObserver</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">ISubject subject</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> ((subject <span class="keyword">as</span> Subject).State == <span class="number">0</span> || (subject <span class="keyword">as</span> Subject).State &gt;= <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;ConcreteObserverB: Reacted to the event.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// The client code.</span></span><br><span class="line">            <span class="keyword">var</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line">            <span class="keyword">var</span> observerA = <span class="keyword">new</span> ConcreteObserverA();</span><br><span class="line">            subject.Attach(observerA);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> observerB = <span class="keyword">new</span> ConcreteObserverB();</span><br><span class="line">            subject.Attach(observerB);</span><br><span class="line"></span><br><span class="line">            subject.SomeBusinessLogic();</span><br><span class="line">            subject.SomeBusinessLogic();</span><br><span class="line"></span><br><span class="line">            subject.Detach(observerB);</span><br><span class="line"></span><br><span class="line">            subject.SomeBusinessLogic();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 1</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line">Subject: Detached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 5</span><br><span class="line">Subject: Notifying observers...</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-2"><p><strong>åœ¨ C++ ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è§‚å¯Ÿè€…æ¨¡å¼åœ¨ C++ ä»£ç ä¸­å¾ˆå¸¸è§ï¼Œ ç‰¹åˆ«æ˜¯åœ¨ GUI ç»„ä»¶ä¸­ã€‚ å®ƒæä¾›äº†åœ¨ä¸ä¸å…¶ä»–å¯¹è±¡æ‰€å±ç±»è€¦åˆçš„æƒ…å†µä¸‹å¯¹å…¶äº‹ä»¶åšå‡ºååº”çš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å°†å¯¹è±¡å­˜å‚¨åœ¨åˆ—è¡¨ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œ å’Œå¯¹äºé¢å‘è¯¥åˆ—è¡¨ä¸­å¯¹è±¡çš„æ›´æ–°æ–¹æ³•çš„è°ƒç”¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è§‚å¯Ÿè€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.cc:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Observer Design Pattern</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Intent: Lets you define a subscription mechanism to notify multiple objects</span></span><br><span class="line"><span class="comment"> * about any events that happen to the object they&#x27;re observing.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note that there&#x27;s a lot of different terms with similar meaning associated</span></span><br><span class="line"><span class="comment"> * with this pattern. Just remember that the Subject is also called the</span></span><br><span class="line"><span class="comment"> * Publisher and the Observer is often called the Subscriber and vice versa.</span></span><br><span class="line"><span class="comment"> * Also the verbs &quot;observe&quot;, &quot;listen&quot; or &quot;track&quot; usually mean the same thing.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IObserver</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~IObserver()&#123;&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;message_from_subject)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISubject</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~ISubject()&#123;&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Attach</span><span class="params">(IObserver *observer)</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Detach</span><span class="params">(IObserver *observer)</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Notify</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment"> * changes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> :</span> <span class="keyword">public</span> ISubject &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~Subject() &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Goodbye, I was the Subject.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The subscription management methods.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Attach</span><span class="params">(IObserver *observer)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    list_observer_.push_back(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Detach</span><span class="params">(IObserver *observer)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    list_observer_.remove(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Notify</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">list</span>&lt;IObserver *&gt;::iterator iterator = list_observer_.begin();</span><br><span class="line">    HowManyObserver();</span><br><span class="line">    <span class="keyword">while</span> (iterator != list_observer_.end()) &#123;</span><br><span class="line">      (*iterator)-&gt;Update(message_);</span><br><span class="line">      ++iterator;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">CreateMessage</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> message = <span class="string">&quot;Empty&quot;</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;message_ = message;</span><br><span class="line">    Notify();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">HowManyObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;There are &quot;</span> &lt;&lt; list_observer_.size() &lt;&lt; <span class="string">&quot; observers in the list.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line"><span class="comment">   * really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line"><span class="comment">   * triggers a notification method whenever something important is about to</span></span><br><span class="line"><span class="comment">   * happen (or after it).</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">SomeBusinessLogic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;message_ = <span class="string">&quot;change message message&quot;</span>;</span><br><span class="line">    Notify();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;I&#x27;m about to do some thing important\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">list</span>&lt;IObserver *&gt; list_observer_;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> message_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> :</span> <span class="keyword">public</span> IObserver &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  Observer(Subject &amp;subject) : subject_(subject) &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;subject_.Attach(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Hi, I&#x27;m the Observer \&quot;&quot;</span> &lt;&lt; ++Observer::static_number_ &lt;&lt; <span class="string">&quot;\&quot;.\n&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;number_ = Observer::static_number_;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">virtual</span> ~Observer() &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Goodbye, I was the Observer \&quot;&quot;</span> &lt;&lt; <span class="keyword">this</span>-&gt;number_ &lt;&lt; <span class="string">&quot;\&quot;.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;message_from_subject)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    message_from_subject_ = message_from_subject;</span><br><span class="line">    PrintInfo();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">RemoveMeFromTheList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    subject_.Detach(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Observer \&quot;&quot;</span> &lt;&lt; number_ &lt;&lt; <span class="string">&quot;\&quot; removed from the list.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">PrintInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Observer \&quot;&quot;</span> &lt;&lt; <span class="keyword">this</span>-&gt;number_ &lt;&lt; <span class="string">&quot;\&quot;: a new message is available --&gt; &quot;</span> &lt;&lt; <span class="keyword">this</span>-&gt;message_from_subject_ &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> message_from_subject_;</span><br><span class="line">  Subject &amp;subject_;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> static_number_;</span><br><span class="line">  <span class="keyword">int</span> number_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Observer::static_number_ = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClientCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Subject *subject = <span class="keyword">new</span> Subject;</span><br><span class="line">  Observer *observer1 = <span class="keyword">new</span> Observer(*subject);</span><br><span class="line">  Observer *observer2 = <span class="keyword">new</span> Observer(*subject);</span><br><span class="line">  Observer *observer3 = <span class="keyword">new</span> Observer(*subject);</span><br><span class="line">  Observer *observer4;</span><br><span class="line">  Observer *observer5;</span><br><span class="line"></span><br><span class="line">  subject-&gt;CreateMessage(<span class="string">&quot;Hello World! :D&quot;</span>);</span><br><span class="line">  observer3-&gt;RemoveMeFromTheList();</span><br><span class="line"></span><br><span class="line">  subject-&gt;CreateMessage(<span class="string">&quot;The weather is hot today! :p&quot;</span>);</span><br><span class="line">  observer4 = <span class="keyword">new</span> Observer(*subject);</span><br><span class="line"></span><br><span class="line">  observer2-&gt;RemoveMeFromTheList();</span><br><span class="line">  observer5 = <span class="keyword">new</span> Observer(*subject);</span><br><span class="line"></span><br><span class="line">  subject-&gt;CreateMessage(<span class="string">&quot;My new car is great! ;)&quot;</span>);</span><br><span class="line">  observer5-&gt;RemoveMeFromTheList();</span><br><span class="line"></span><br><span class="line">  observer4-&gt;RemoveMeFromTheList();</span><br><span class="line">  observer1-&gt;RemoveMeFromTheList();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> observer5;</span><br><span class="line">  <span class="keyword">delete</span> observer4;</span><br><span class="line">  <span class="keyword">delete</span> observer3;</span><br><span class="line">  <span class="keyword">delete</span> observer2;</span><br><span class="line">  <span class="keyword">delete</span> observer1;</span><br><span class="line">  <span class="keyword">delete</span> subject;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ClientCode();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Hi, I&#39;m the Observer &quot;1&quot;.</span><br><span class="line">Hi, I&#39;m the Observer &quot;2&quot;.</span><br><span class="line">Hi, I&#39;m the Observer &quot;3&quot;.</span><br><span class="line">There are 3 observers in the list.</span><br><span class="line">Observer &quot;1&quot;: a new message is available --&gt; Hello World! :D</span><br><span class="line">Observer &quot;2&quot;: a new message is available --&gt; Hello World! :D</span><br><span class="line">Observer &quot;3&quot;: a new message is available --&gt; Hello World! :D</span><br><span class="line">Observer &quot;3&quot; removed from the list.</span><br><span class="line">There are 2 observers in the list.</span><br><span class="line">Observer &quot;1&quot;: a new message is available --&gt; The weather is hot today! :p</span><br><span class="line">Observer &quot;2&quot;: a new message is available --&gt; The weather is hot today! :p</span><br><span class="line">Hi, I&#39;m the Observer &quot;4&quot;.</span><br><span class="line">Observer &quot;2&quot; removed from the list.</span><br><span class="line">Hi, I&#39;m the Observer &quot;5&quot;.</span><br><span class="line">There are 3 observers in the list.</span><br><span class="line">Observer &quot;1&quot;: a new message is available --&gt; My new car is great! ;)</span><br><span class="line">Observer &quot;4&quot;: a new message is available --&gt; My new car is great! ;)</span><br><span class="line">Observer &quot;5&quot;: a new message is available --&gt; My new car is great! ;)</span><br><span class="line">Observer &quot;5&quot; removed from the list.</span><br><span class="line">Observer &quot;4&quot; removed from the list.</span><br><span class="line">Observer &quot;1&quot; removed from the list.</span><br><span class="line">Goodbye, I was the Observer &quot;5&quot;.</span><br><span class="line">Goodbye, I was the Observer &quot;4&quot;.</span><br><span class="line">Goodbye, I was the Observer &quot;3&quot;.</span><br><span class="line">Goodbye, I was the Observer &quot;2&quot;.</span><br><span class="line">Goodbye, I was the Observer &quot;1&quot;.</span><br><span class="line">Goodbye, I was the Subject.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-3"><p><strong>åœ¨ Java ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è§‚å¯Ÿè€…æ¨¡å¼åœ¨ Java ä»£ç ä¸­å¾ˆå¸¸è§ï¼Œ ç‰¹åˆ«æ˜¯åœ¨ GUI ç»„ä»¶ä¸­ã€‚ å®ƒæä¾›äº†åœ¨ä¸ä¸å…¶ä»–å¯¹è±¡æ‰€å±ç±»è€¦åˆçš„æƒ…å†µä¸‹å¯¹å…¶äº‹ä»¶åšå‡ºååº”çš„æ–¹å¼ã€‚</p><p>è¿™é‡Œæ˜¯æ ¸å¿ƒ Java ç¨‹åºåº“ä¸­è¯¥æ¨¡å¼çš„ä¸€äº›ç¤ºä¾‹ï¼š</p><ul><li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/Observer.html"><code>java.util.Observer</code></a>/<a href="http://docs.oracle.com/javase/8/docs/api/java/util/Observable.html"> <code>java.util.Observable</code></a> ï¼ˆæå°‘åœ¨çœŸå®ä¸–ç•Œä¸­ä½¿ç”¨ï¼‰</li><li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/EventListener.html"><code>java.util.EventListener</code></a>çš„æ‰€æœ‰å®ç° ï¼ˆå‡ ä¹å¹¿æ³›å­˜åœ¨äº Swing ç»„ä»¶ä¸­ï¼‰</li><li><a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSessionBindingListener.html"><code>javax.servlet.http.HttpSessionBindingListener</code></a></li><li><a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSessionAttributeListener.html"><code>javax.servlet.http.HttpSessionAttributeListener</code></a></li><li><a href="http://docs.oracle.com/javaee/7/api/javax/faces/event/PhaseListener.html"><code>javax.faces.event.PhaseListener</code></a></li></ul><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å°†å¯¹è±¡å­˜å‚¨åœ¨åˆ—è¡¨ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œ å’Œå¯¹äºé¢å‘è¯¥åˆ—è¡¨ä¸­å¯¹è±¡çš„æ›´æ–°æ–¹æ³•çš„è°ƒç”¨æ¥è¯†åˆ«ã€‚</p><p><strong>äº‹ä»¶è®¢é˜…</strong></p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ è§‚å¯Ÿè€…æ¨¡å¼åœ¨æ–‡æœ¬ç¼–è¾‘å™¨çš„å¯¹è±¡ä¹‹é—´å»ºç«‹äº†é—´æ¥çš„åˆä½œå…³ç³»ã€‚ æ¯å½“ <code>ç¼–è¾‘å™¨</code> ï¼ˆEditorï¼‰ å¯¹è±¡æ”¹å˜æ—¶ï¼Œ å®ƒéƒ½ä¼šé€šçŸ¥å…¶è®¢é˜…è€…ã€‚  <code>é‚®ä»¶é€šçŸ¥ç›‘å¬å™¨</code> ï¼ˆEmailÂ­NotificationÂ­Listenerï¼‰ å’Œ <code>æ—¥å¿—å¼€å¯ç›‘å¬å™¨</code> ï¼ˆLogÂ­OpenÂ­Listenerï¼‰ éƒ½å°†é€šè¿‡æ‰§è¡Œå…¶åŸºæœ¬è¡Œä¸ºæ¥å¯¹è¿™äº›é€šçŸ¥åšå‡ºååº”ã€‚</p><p>è®¢é˜…è€…ç±»ä¸ä¸ç¼–è¾‘å™¨ç±»ç›¸è€¦åˆï¼Œ ä¸”èƒ½åœ¨éœ€è¦æ—¶åœ¨å…¶ä»–åº”ç”¨ä¸­å¤ç”¨ã€‚  <code>ç¼–è¾‘å™¨</code>ç±»ä»…ä¾èµ–äºæŠ½è±¡è®¢é˜…è€…æ¥å£ã€‚ è¿™æ ·å°±èƒ½å…è®¸åœ¨ä¸æ”¹å˜ç¼–è¾‘å™¨ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°çš„è®¢é˜…è€…ç±»å‹ã€‚</p><p><strong>publisher</strong></p><p><strong>publisher/EventManager.java:</strong> åŸºç¡€å‘å¸ƒè€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.publisher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.listeners.EventListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventManager</span> </span>&#123;</span><br><span class="line">    Map&lt;String, List&lt;EventListener&gt;&gt; listeners = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EventManager</span><span class="params">(String... operations)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String operation : operations) &#123;</span><br><span class="line">            <span class="keyword">this</span>.listeners.put(operation, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(String eventType, EventListener listener)</span> </span>&#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        users.add(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unsubscribe</span><span class="params">(String eventType, EventListener listener)</span> </span>&#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        users.remove(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notify</span><span class="params">(String eventType, File file)</span> </span>&#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        <span class="keyword">for</span> (EventListener listener : users) &#123;</span><br><span class="line">            listener.update(eventType, file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>editor</strong></p><p><strong>editor/Editor.java:</strong> å…·ä½“å‘å¸ƒè€…ï¼Œ ç”±å…¶ä»–å¯¹è±¡è¿½è¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.publisher.EventManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Editor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> EventManager events;</span><br><span class="line">    <span class="keyword">private</span> File file;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Editor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.events = <span class="keyword">new</span> EventManager(<span class="string">&quot;open&quot;</span>, <span class="string">&quot;save&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openFile</span><span class="params">(String filePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">        events.notify(<span class="string">&quot;open&quot;</span>, file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.file != <span class="keyword">null</span>) &#123;</span><br><span class="line">            events.notify(<span class="string">&quot;save&quot;</span>, file);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Please open a file first.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <strong>listeners</strong></p><p><strong>listeners/EventListener.java:</strong> é€šç”¨è§‚å¯Ÿè€…æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.listeners;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EventListener</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(String eventType, File file)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>listeners/EmailNotificationListener.java:</strong> æ”¶åˆ°é€šçŸ¥åå‘é€é‚®ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.listeners;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailNotificationListener</span> <span class="keyword">implements</span> <span class="title">EventListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmailNotificationListener</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String eventType, File file)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Email to &quot;</span> + email + <span class="string">&quot;: Someone has performed &quot;</span> + eventType + <span class="string">&quot; operation with the following file: &quot;</span> + file.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>listeners/LogOpenListener.java:</strong> æ”¶åˆ°é€šçŸ¥ååœ¨æ—¥å¿—ä¸­è®°å½•ä¸€æ¡æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.listeners;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogOpenListener</span> <span class="keyword">implements</span> <span class="title">EventListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> File log;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LogOpenListener</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.log = <span class="keyword">new</span> File(fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String eventType, File file)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Save to log &quot;</span> + log + <span class="string">&quot;: Someone has performed &quot;</span> + eventType + <span class="string">&quot; operation with the following file: &quot;</span> + file.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Demo.java:</strong> åˆå§‹åŒ–ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.editor.Editor;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.listeners.EmailNotificationListener;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.listeners.LogOpenListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Editor editor = <span class="keyword">new</span> Editor();</span><br><span class="line">        editor.events.subscribe(<span class="string">&quot;open&quot;</span>, <span class="keyword">new</span> LogOpenListener(<span class="string">&quot;/path/to/log/file.txt&quot;</span>));</span><br><span class="line">        editor.events.subscribe(<span class="string">&quot;save&quot;</span>, <span class="keyword">new</span> EmailNotificationListener(<span class="string">&quot;admin@example.com&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            editor.openFile(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">            editor.saveFile();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>OutputDemo.png:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Save to log \path\to\log\file.txt: Someone has performed open operation with the following file: test.txt</span><br><span class="line">Email to admin@example.com: Someone has performed save operation with the following file: test.txt</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-4"><p><strong>åœ¨ PHP ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> PHP ä¸­åŒ…å«å‡ ä¸ªå†…ç½®æ¥å£ ï¼ˆ<a href="http://php.net/manual/en/class.splsubject.php">SplSubject</a>ã€ <a href="http://php.net/manual/en/class.splobserver.php">SplObserver</a>ï¼‰ï¼Œ å®ƒä»¬èƒ½è®©ä½ çš„è§‚å¯Ÿå™¨æ¨¡å¼å®ç°ä¸å…¶ä»– PHP ä»£ç å…¼å®¹ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å°†å¯¹è±¡å­˜å‚¨åœ¨åˆ—è¡¨ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œ å’Œå¯¹äºé¢å‘è¯¥åˆ—è¡¨ä¸­å¯¹è±¡çš„æ›´æ–°æ–¹æ³•çš„è°ƒç”¨æ¥è¯†åˆ«ã€‚</p><div class="tabs" id="php"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#php-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#php-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="php-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è§‚å¯Ÿè€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´è½»æ¾åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ PHP åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>index.php:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru</span>\<span class="title">Observer</span>\<span class="title">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PHP has a couple of built-in interfaces related to the Observer pattern.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Here&#x27;s what the Subject interface looks like:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> http://php.net/manual/en/class.splsubject.php</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     interface SplSubject</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *         // Attach an observer to the subject.</span></span><br><span class="line"><span class="comment"> *         public function attach(SplObserver $observer);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *         // Detach an observer from the subject.</span></span><br><span class="line"><span class="comment"> *         public function detach(SplObserver $observer);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *         // Notify all observers about an event.</span></span><br><span class="line"><span class="comment"> *         public function notify();</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * There&#x27;s also a built-in interface for Observers:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> http://php.net/manual/en/class.splobserver.php</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     interface SplObserver</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *         public function update(SplSubject $subject);</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment"> * changes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> <span class="keyword">implements</span> \<span class="title">SplSubject</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> int For the sake of simplicity, the Subject&#x27;s state, essential to</span></span><br><span class="line"><span class="comment">     * all subscribers, is stored in this variable.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> $state;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> \SplObjectStorage List of subscribers. In real life, the list of</span></span><br><span class="line"><span class="comment">     * subscribers can be stored more comprehensively (categorized by event</span></span><br><span class="line"><span class="comment">     * type, etc.).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $observers;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;observers = <span class="keyword">new</span> \<span class="built_in">SplObjectStorage</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The subscription management methods.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">attach</span>(<span class="params">\<span class="built_in">SplObserver</span> $observer</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Subject: Attached an observer.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;observers-&gt;attach($observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detach</span>(<span class="params">\<span class="built_in">SplObserver</span> $observer</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;observers-&gt;detach($observer);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Subject: Detached an observer.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Trigger an update in each subscriber.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Subject: Notifying observers...\n&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;observers <span class="keyword">as</span> $observer) &#123;</span><br><span class="line">            $observer-&gt;update(<span class="keyword">$this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line"><span class="comment">     * really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line"><span class="comment">     * triggers a notification method whenever something important is about to</span></span><br><span class="line"><span class="comment">     * happen (or after it).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">someBusinessLogic</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\nSubject: I&#x27;m doing something important.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state = rand(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Subject: My state has just changed to: <span class="subst">&#123;$this-&gt;state&#125;</span>\n&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;notify();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="comment"> * attached to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverA</span> <span class="keyword">implements</span> \<span class="title">SplObserver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">\<span class="built_in">SplSubject</span> $subject</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($subject-&gt;state &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ConcreteObserverA: Reacted to the event.\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverB</span> <span class="keyword">implements</span> \<span class="title">SplObserver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">\<span class="built_in">SplSubject</span> $subject</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($subject-&gt;state == <span class="number">0</span> || $subject-&gt;state &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ConcreteObserverB: Reacted to the event.\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">$subject = <span class="keyword">new</span> Subject();</span><br><span class="line"></span><br><span class="line">$o1 = <span class="keyword">new</span> ConcreteObserverA();</span><br><span class="line">$subject-&gt;attach($o1);</span><br><span class="line"></span><br><span class="line">$o2 = <span class="keyword">new</span> ConcreteObserverB();</span><br><span class="line">$subject-&gt;attach($o2);</span><br><span class="line"></span><br><span class="line">$subject-&gt;someBusinessLogic();</span><br><span class="line">$subject-&gt;someBusinessLogic();</span><br><span class="line"></span><br><span class="line">$subject-&gt;detach($o2);</span><br><span class="line"></span><br><span class="line">$subject-&gt;someBusinessLogic();</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 4</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line">Subject: Detached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 1</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="php-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ <strong>è§‚å¯Ÿè€…</strong>æ¨¡å¼å…è®¸å¤šç§å¯¹è±¡è§‚å¯Ÿç¨‹åºç”¨æˆ·ä»“åº“ä¸­å‘ç”Ÿçš„äº‹ä»¶ã€‚</p><p>ä»“åº“å‘å‡ºå„ç§ç±»å‹çš„äº‹ä»¶å¹¶å…è®¸è§‚å¯Ÿè€…ç›‘å¬æ‰€æœ‰æˆ–ä¸ªåˆ«äº‹ä»¶ã€‚</p><p><strong>index.php:</strong> çœŸå®ä¸–ç•Œç¤ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru</span>\<span class="title">Observer</span>\<span class="title">RealWorld</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The UserRepository represents a Subject. Various objects are interested in</span></span><br><span class="line"><span class="comment"> * tracking its internal state, whether it&#x27;s adding a new user or removing one.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRepository</span> <span class="keyword">implements</span> \<span class="title">SplSubject</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array The list of users.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $users = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Here goes the actual Observer management infrastructure. Note that it&#x27;s</span></span><br><span class="line">    <span class="comment">// not everything that our class is responsible for. Its primary business</span></span><br><span class="line">    <span class="comment">// logic is listed below these methods.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $observers = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// A special event group for observers that want to listen to all</span></span><br><span class="line">        <span class="comment">// events.</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;observers[<span class="string">&quot;*&quot;</span>] = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">initEventGroup</span>(<span class="params"><span class="keyword">string</span> $event = <span class="string">&quot;*&quot;</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;observers[$event])) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;observers[$event] = [];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getEventObservers</span>(<span class="params"><span class="keyword">string</span> $event = <span class="string">&quot;*&quot;</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;initEventGroup($event);</span><br><span class="line">        $group = <span class="keyword">$this</span>-&gt;observers[$event];</span><br><span class="line">        $all = <span class="keyword">$this</span>-&gt;observers[<span class="string">&quot;*&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> array_merge($group, $all);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">attach</span>(<span class="params">\<span class="built_in">SplObserver</span> $observer, <span class="keyword">string</span> $event = <span class="string">&quot;*&quot;</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;initEventGroup($event);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;observers[$event][] = $observer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detach</span>(<span class="params">\<span class="built_in">SplObserver</span> $observer, <span class="keyword">string</span> $event = <span class="string">&quot;*&quot;</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;getEventObservers($event) <span class="keyword">as</span> $key =&gt; $s) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($s === $observer) &#123;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;observers[$event][$key]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"><span class="keyword">string</span> $event = <span class="string">&quot;*&quot;</span>, $data = <span class="literal">null</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Broadcasting the &#x27;<span class="subst">$event</span>&#x27; event.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;getEventObservers($event) <span class="keyword">as</span> $observer) &#123;</span><br><span class="line">            $observer-&gt;update(<span class="keyword">$this</span>, $event, $data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Here are the methods representing the business logic of the class.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">initialize</span>(<span class="params">$filename</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Loading user records from a file.\n&quot;</span>;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;notify(<span class="string">&quot;users:init&quot;</span>, $filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createUser</span>(<span class="params"><span class="keyword">array</span> $data</span>): <span class="title">User</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Creating a user.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        $user = <span class="keyword">new</span> User();</span><br><span class="line">        $user-&gt;update($data);</span><br><span class="line"></span><br><span class="line">        $id = bin2hex(openssl_random_pseudo_bytes(<span class="number">16</span>));</span><br><span class="line">        $user-&gt;update([<span class="string">&quot;id&quot;</span> =&gt; $id]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;users[$id] = $user;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;notify(<span class="string">&quot;users:created&quot;</span>, $user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updateUser</span>(<span class="params">User $user, <span class="keyword">array</span> $data</span>): <span class="title">User</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Updating a user.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        $id = $user-&gt;attributes[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;users[$id])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $user = <span class="keyword">$this</span>-&gt;users[$id];</span><br><span class="line">        $user-&gt;update($data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;notify(<span class="string">&quot;users:updated&quot;</span>, $user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteUser</span>(<span class="params">User $user</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Deleting a user.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        $id = $user-&gt;attributes[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;users[$id])) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;users[$id]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;notify(<span class="string">&quot;users:deleted&quot;</span>, $user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Let&#x27;s keep the User class trivial since it&#x27;s not the focus of our example.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $attributes = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">$data</span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;attributes = array_merge(<span class="keyword">$this</span>-&gt;attributes, $data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Component logs any events it&#x27;s subscribed to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> <span class="keyword">implements</span> \<span class="title">SplObserver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $filename;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$filename</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = $filename;</span><br><span class="line">        <span class="keyword">if</span> (file_exists(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            unlink(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">\<span class="built_in">SplSubject</span> $repository, <span class="keyword">string</span> $event = <span class="literal">null</span>, $data = <span class="literal">null</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $entry = date(<span class="string">&quot;Y-m-d H:i:s&quot;</span>) . <span class="string">&quot;: &#x27;<span class="subst">$event</span>&#x27; with data &#x27;&quot;</span> . json_encode($data) . <span class="string">&quot;&#x27;\n&quot;</span>;</span><br><span class="line">        file_put_contents(<span class="keyword">$this</span>-&gt;filename, $entry, FILE_APPEND);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Logger: I&#x27;ve written &#x27;<span class="subst">$event</span>&#x27; entry to the log.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Component sends initial instructions to new users. The client</span></span><br><span class="line"><span class="comment"> * is responsible for attaching this component to a proper user creation event.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingNotification</span> <span class="keyword">implements</span> \<span class="title">SplObserver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $adminEmail;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$adminEmail</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;adminEmail = $adminEmail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">\<span class="built_in">SplSubject</span> $repository, <span class="keyword">string</span> $event = <span class="literal">null</span>, $data = <span class="literal">null</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// mail($this-&gt;adminEmail,</span></span><br><span class="line">        <span class="comment">//     &quot;Onboarding required&quot;,</span></span><br><span class="line">        <span class="comment">//     &quot;We have a new user. Here&#x27;s his info: &quot; .json_encode($data));</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OnboardingNotification: The notification has been emailed!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">$repository = <span class="keyword">new</span> UserRepository();</span><br><span class="line">$repository-&gt;attach(<span class="keyword">new</span> Logger(<span class="keyword">__DIR__</span> . <span class="string">&quot;/log.txt&quot;</span>), <span class="string">&quot;*&quot;</span>);</span><br><span class="line">$repository-&gt;attach(<span class="keyword">new</span> OnboardingNotification(<span class="string">&quot;1@example.com&quot;</span>), <span class="string">&quot;users:created&quot;</span>);</span><br><span class="line"></span><br><span class="line">$repository-&gt;initialize(<span class="keyword">__DIR__</span> . <span class="string">&quot;/users.csv&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">$user = $repository-&gt;createUser([</span><br><span class="line">    <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;John Smith&quot;</span>,</span><br><span class="line">    <span class="string">&quot;email&quot;</span> =&gt; <span class="string">&quot;john99@example.com&quot;</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">$repository-&gt;deleteUser($user);</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UserRepository: Loading user records from a file.</span><br><span class="line">UserRepository: Broadcasting the &#39;users:init&#39; event.</span><br><span class="line">Logger: I&#39;ve written &#39;users:init&#39; entry to the log.</span><br><span class="line">UserRepository: Creating a user.</span><br><span class="line">UserRepository: Broadcasting the &#39;users:created&#39; event.</span><br><span class="line">OnboardingNotification: The notification has been emailed!</span><br><span class="line">Logger: I&#39;ve written &#39;users:created&#39; entry to the log.</span><br><span class="line">UserRepository: Deleting a user.</span><br><span class="line">UserRepository: Broadcasting the &#39;users:deleted&#39; event.</span><br><span class="line">Logger: I&#39;ve written &#39;users:deleted&#39; entry to the log.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-5"><p><strong>åœ¨ Python ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è§‚å¯Ÿè€…æ¨¡å¼åœ¨ Python ä»£ç ä¸­å¾ˆå¸¸è§ï¼Œ ç‰¹åˆ«æ˜¯åœ¨ GUI ç»„ä»¶ä¸­ã€‚ å®ƒæä¾›äº†åœ¨ä¸ä¸å…¶ä»–å¯¹è±¡æ‰€å±ç±»è€¦åˆçš„æƒ…å†µä¸‹å¯¹å…¶äº‹ä»¶åšå‡ºååº”çš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å°†å¯¹è±¡å­˜å‚¨åœ¨åˆ—è¡¨ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œ å’Œå¯¹äºé¢å‘è¯¥åˆ—è¡¨ä¸­å¯¹è±¡çš„æ›´æ–°æ–¹æ³•çš„è°ƒç”¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è§‚å¯Ÿè€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.py:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Subject interface declares a set of methods for managing subscribers.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Attach an observer to the subject.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">detach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Detach an observer from the subject.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">notify</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Notify all observers about an event.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span>(<span class="params">Subject</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="string">    changes.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _state: <span class="built_in">int</span> = <span class="literal">None</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    For the sake of simplicity, the Subject&#x27;s state, essential to all</span></span><br><span class="line"><span class="string">    subscribers, is stored in this variable.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _observers: List[Observer] = []</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    List of subscribers. In real life, the list of subscribers can be stored</span></span><br><span class="line"><span class="string">    more comprehensively (categorized by event type, etc.).</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;Subject: Attached an observer.&quot;</span>)</span><br><span class="line">        self._observers.append(observer)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">detach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self._observers.remove(observer)</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The subscription management methods.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">notify</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Trigger an update in each subscriber.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;Subject: Notifying observers...&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> self._observers:</span><br><span class="line">            observer.update(self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">some_business_logic</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line"><span class="string">        really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line"><span class="string">        triggers a notification method whenever something important is about to</span></span><br><span class="line"><span class="string">        happen (or after it).</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;\nSubject: I&#x27;m doing something important.&quot;</span>)</span><br><span class="line">        self._state = randrange(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">f&quot;Subject: My state has just changed to: <span class="subst">&#123;self._state&#125;</span>&quot;</span>)</span><br><span class="line">        self.notify()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Observer interface declares the update method, used by subjects.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, subject: Subject</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Receive update from subject.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="string">attached to.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverA</span>(<span class="params">Observer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, subject: Subject</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> subject._state &lt; <span class="number">3</span>:</span><br><span class="line">            print(<span class="string">&quot;ConcreteObserverA: Reacted to the event&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverB</span>(<span class="params">Observer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, subject: Subject</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> subject._state == <span class="number">0</span> <span class="keyword">or</span> subject._state &gt;= <span class="number">2</span>:</span><br><span class="line">            print(<span class="string">&quot;ConcreteObserverB: Reacted to the event&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># The client code.</span></span><br><span class="line"></span><br><span class="line">    subject = ConcreteSubject()</span><br><span class="line"></span><br><span class="line">    observer_a = ConcreteObserverA()</span><br><span class="line">    subject.attach(observer_a)</span><br><span class="line"></span><br><span class="line">    observer_b = ConcreteObserverB()</span><br><span class="line">    subject.attach(observer_b)</span><br><span class="line"></span><br><span class="line">    subject.some_business_logic()</span><br><span class="line">    subject.some_business_logic()</span><br><span class="line"></span><br><span class="line">    subject.detach(observer_a)</span><br><span class="line"></span><br><span class="line">    subject.some_business_logic()</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 0</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 5</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 0</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-6"><p><strong>åœ¨ Ruby ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è§‚å¯Ÿè€…æ¨¡å¼åœ¨ Ruby ä»£ç ä¸­å¾ˆå¸¸è§ï¼Œ ç‰¹åˆ«æ˜¯åœ¨ GUI ç»„ä»¶ä¸­ã€‚ å®ƒæä¾›äº†åœ¨ä¸ä¸å…¶ä»–å¯¹è±¡æ‰€å±ç±»è€¦åˆçš„æƒ…å†µä¸‹å¯¹å…¶äº‹ä»¶åšå‡ºååº”çš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å°†å¯¹è±¡å­˜å‚¨åœ¨åˆ—è¡¨ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œ å’Œå¯¹äºé¢å‘è¯¥åˆ—è¡¨ä¸­å¯¹è±¡çš„æ›´æ–°æ–¹æ³•çš„è°ƒç”¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è§‚å¯Ÿè€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>main.rb:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The Subject interface declares a set of methods for managing subscribers.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span></span></span><br><span class="line">  <span class="comment"># Attach an observer to the subject.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">attach</span><span class="params">(observer)</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Detach an observer from the subject.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">detach</span><span class="params">(observer)</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Notify all observers about an event.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">notify</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment"># changes.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> &lt; Subject</span></span><br><span class="line">  <span class="comment"># For the sake of simplicity, the Subject&#x27;s state, essential to all</span></span><br><span class="line">  <span class="comment"># subscribers, is stored in this variable.</span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:state</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># @!attribute observers</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@return</span> [Array&lt;Observer&gt;] attr_accessor :observers private :observers</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span></span></span><br><span class="line">    @observers = []</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># List of subscribers. In real life, the list of subscribers can be stored</span></span><br><span class="line">  <span class="comment"># more comprehensively (categorized by event type, etc.).</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Obserser] observer</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">attach</span><span class="params">(observer)</span></span></span><br><span class="line">    puts <span class="string">&#x27;Subject: Attached an observer.&#x27;</span></span><br><span class="line">    @observers &lt;&lt; observer</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Obserser] observer</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">detach</span><span class="params">(observer)</span></span></span><br><span class="line">    @observers.delete(observer)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The subscription management methods.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Trigger an update in each subscriber.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">notify</span></span></span><br><span class="line">    puts <span class="string">&#x27;Subject: Notifying observers...&#x27;</span></span><br><span class="line">    @observers.each &#123; <span class="params">|observer|</span> observer.update(<span class="keyword">self</span>) &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line">  <span class="comment"># really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line">  <span class="comment"># triggers a notification method whenever something important is about to</span></span><br><span class="line">  <span class="comment"># happen (or after it).</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_business_logic</span></span></span><br><span class="line">    puts <span class="string">&quot;\nSubject: I&#x27;m doing something important.&quot;</span></span><br><span class="line">    @state = rand(<span class="number">0</span>..<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    puts <span class="string">&quot;Subject: My state has just changed to: <span class="subst">#&#123;@state&#125;</span>&quot;</span></span><br><span class="line">    notify</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Observer interface declares the update method, used by subjects.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span></span></span><br><span class="line">  <span class="comment"># Receive update from subject.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(_subject)</span></span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method_<span class="number">_</span>&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="comment"># attached to.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverA</span> &lt; Observer</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Subject] subject</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(subject)</span></span></span><br><span class="line">    puts <span class="string">&#x27;ConcreteObserverA: Reacted to the event&#x27;</span> <span class="keyword">if</span> subject.state &lt; <span class="number">3</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverB</span> &lt; Observer</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Subject] subject</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(subject)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">unless</span> subject.state.zero? <span class="params">||</span> subject.state &gt;= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    puts <span class="string">&#x27;ConcreteObserverB: Reacted to the event&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code.</span></span><br><span class="line"></span><br><span class="line">subject = ConcreteSubject.new</span><br><span class="line"></span><br><span class="line">observer_a = ConcreteObserverA.new</span><br><span class="line">subject.attach(observer_a)</span><br><span class="line"></span><br><span class="line">observer_b = ConcreteObserverB.new</span><br><span class="line">subject.attach(observer_b)</span><br><span class="line"></span><br><span class="line">subject.some_business_logic</span><br><span class="line">subject.some_business_logic</span><br><span class="line"></span><br><span class="line">subject.detach(observer_a)</span><br><span class="line"></span><br><span class="line">subject.some_business_logic</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 10</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-7"><p><strong>åœ¨ Swift ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è§‚å¯Ÿè€…æ¨¡å¼åœ¨ Swift ä»£ç ä¸­å¾ˆå¸¸è§ï¼Œ ç‰¹åˆ«æ˜¯åœ¨ GUI ç»„ä»¶ä¸­ã€‚ å®ƒæä¾›äº†åœ¨ä¸ä¸å…¶ä»–å¯¹è±¡æ‰€å±ç±»è€¦åˆçš„æƒ…å†µä¸‹å¯¹å…¶äº‹ä»¶åšå‡ºååº”çš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å°†å¯¹è±¡å­˜å‚¨åœ¨åˆ—è¡¨ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œ å’Œå¯¹äºé¢å‘è¯¥åˆ—è¡¨ä¸­å¯¹è±¡çš„æ›´æ–°æ–¹æ³•çš„è°ƒç”¨æ¥è¯†åˆ«ã€‚</p><div class="tabs" id="swift"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#swift-1">æ¦‚å¿µç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#swift-2">çœŸå®ä¸–ç•Œç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="swift-1"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è§‚å¯Ÿè€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p>äº†è§£è¯¥æ¨¡å¼çš„ç»“æ„åï¼Œ ä½ å¯ä»¥æ›´è½»æ¾åœ°ç†è§£ä¸‹é¢åŸºäºçœŸå®ä¸–ç•Œçš„ Swift åº”ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>Example.swift:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment">/// changes.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// For the sake of simplicity, the Subject&#x27;s state, essential to all</span></span><br><span class="line">    <span class="comment">/// subscribers, is stored in this variable.</span></span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">Int</span> = &#123; <span class="keyword">return</span> <span class="type">Int</span>(arc4random_uniform(<span class="number">10</span>)) &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @var array List of subscribers. In real life, the list of subscribers</span></span><br><span class="line">    <span class="comment">/// can be stored more comprehensively (categorized by event type, etc.).</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> observers = [<span class="type">Observer</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The subscription management methods.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">attach</span><span class="params">(<span class="number">_</span> observer: Observer)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: Attached an observer.\n&quot;</span>)</span><br><span class="line">        observers.append(observer)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">detach</span><span class="params">(<span class="number">_</span> observer: Observer)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> idx = observers.firstIndex(<span class="keyword">where</span>: &#123; $<span class="number">0</span> === observer &#125;) &#123;</span><br><span class="line">            observers.remove(at: idx)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Subject: Detached an observer.\n&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Trigger an update in each subscriber.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">notify</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: Notifying observers...\n&quot;</span>)</span><br><span class="line">        observers.forEach(&#123; $<span class="number">0</span>.update(subject: <span class="keyword">self</span>)&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line">    <span class="comment">/// really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line">    <span class="comment">/// triggers a notification method whenever something important is about to</span></span><br><span class="line">    <span class="comment">/// happen (or after it).</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">someBusinessLogic</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nSubject: I&#x27;m doing something important.\n&quot;</span>)</span><br><span class="line">        state = <span class="type">Int</span>(arc4random_uniform(<span class="number">10</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: My state has just changed to: \(state)\n&quot;</span>)</span><br><span class="line">        notify()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Observer protocol declares the update method, used by subjects.</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Observer</span>: <span class="title">class</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(subject: Subject)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="comment">/// attached to.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverA</span>: <span class="title">Observer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(subject: Subject)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> subject.state &lt; <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ConcreteObserverA: Reacted to the event.\n&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverB</span>: <span class="title">Observer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(subject: Subject)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> subject.state &gt;= <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ConcreteObserverB: Reacted to the event.\n&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all works together.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObserverConceptual</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testObserverConceptual</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> subject = <span class="type">Subject</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> observer1 = <span class="type">ConcreteObserverA</span>()</span><br><span class="line">        <span class="keyword">let</span> observer2 = <span class="type">ConcreteObserverB</span>()</span><br><span class="line"></span><br><span class="line">        subject.attach(observer1)</span><br><span class="line">        subject.attach(observer2)</span><br><span class="line"></span><br><span class="line">        subject.someBusinessLogic()</span><br><span class="line">        subject.someBusinessLogic()</span><br><span class="line">        subject.detach(observer2)</span><br><span class="line">        subject.someBusinessLogic()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line"></span><br><span class="line">Subject: My state has just changed to: 4</span><br><span class="line"></span><br><span class="line">Subject: Notifying observers...</span><br><span class="line"></span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line"></span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line"></span><br><span class="line">Subject: Notifying observers...</span><br><span class="line"></span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line"></span><br><span class="line">Subject: Detached an observer.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line"></span><br><span class="line">Subject: My state has just changed to: 8</span><br><span class="line"></span><br><span class="line">Subject: Notifying observers...</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="swift-2"><p><strong>çœŸå®ä¸–ç•Œç¤ºä¾‹</strong></p><p><strong>Example.swift:</strong> çœŸå®ä¸–ç•Œç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObserverRealWorld</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> cartManager = <span class="type">CartManager</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> navigationBar = <span class="type">UINavigationBar</span>()</span><br><span class="line">        <span class="keyword">let</span> cartVC = <span class="type">CartViewController</span>()</span><br><span class="line"></span><br><span class="line">        cartManager.add(subscriber: navigationBar)</span><br><span class="line">        cartManager.add(subscriber: cartVC)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> apple = <span class="type">Food</span>(id: <span class="number">111</span>, name: <span class="string">&quot;Apple&quot;</span>, price: <span class="number">10</span>, calories: <span class="number">20</span>)</span><br><span class="line">        cartManager.add(product: apple)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> tShirt = <span class="type">Clothes</span>(id: <span class="number">222</span>, name: <span class="string">&quot;T-shirt&quot;</span>, price: <span class="number">200</span>, size: <span class="string">&quot;L&quot;</span>)</span><br><span class="line">        cartManager.add(product: tShirt)</span><br><span class="line"></span><br><span class="line">        cartManager.remove(product: apple)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">CartSubscriber</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(changed cart: [Product])</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> price: <span class="type">Double</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isEqual</span><span class="params">(to product: Product)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isEqual</span><span class="params">(to product: Product)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id == product.id</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Food</span>: <span class="title">Product</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> price: <span class="type">Double</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Food-specific properties</span></span><br><span class="line">    <span class="keyword">var</span> calories: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Clothes</span>: <span class="title">Product</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> price: <span class="type">Double</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Clothes-specific properties</span></span><br><span class="line">    <span class="keyword">var</span> size: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CartManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> cart = [<span class="type">Product</span>]()</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> subscribers = [<span class="type">CartSubscriber</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(subscriber: CartSubscriber)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;CartManager: I&#x27;am adding a new subscriber: \(subscriber.description)&quot;</span>)</span><br><span class="line">        subscribers.append(subscriber)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(product: Product)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nCartManager: I&#x27;am adding a new product: \(product.name)&quot;</span>)</span><br><span class="line">        cart.append(product)</span><br><span class="line">        notifySubscribers()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(subscriber <span class="built_in">filter</span>: <span class="params">(CartSubscriber)</span></span></span> -&gt; (<span class="type">Bool</span>)) &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> index = subscribers.firstIndex(<span class="keyword">where</span>: <span class="built_in">filter</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        subscribers.remove(at: index)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(product: Product)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> index = cart.firstIndex(<span class="keyword">where</span>: &#123; $<span class="number">0</span>.isEqual(to: product) &#125;) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nCartManager: Product &#x27;\(product.name)&#x27; is removed from a cart&quot;</span>)</span><br><span class="line">        cart.remove(at: index)</span><br><span class="line">        notifySubscribers()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">notifySubscribers</span><span class="params">()</span></span> &#123;</span><br><span class="line">        subscribers.forEach(&#123; $<span class="number">0</span>.accept(changed: cart) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UINavigationBar</span>: <span class="title">CartSubscriber</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(changed cart: [Product])</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;UINavigationBar: Updating an appearance of navigation items&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;UINavigationBar&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CartViewController</span>: <span class="title">UIViewController</span>, <span class="title">CartSubscriber</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(changed cart: [Product])</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;CartViewController: Updating an appearance of a list view with products&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;CartViewController&quot;</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CartManager: I&#39;am adding a new subscriber: UINavigationBar</span><br><span class="line">CartManager: I&#39;am adding a new subscriber: CartViewController</span><br><span class="line"></span><br><span class="line">CartManager: I&#39;am adding a new product: Apple</span><br><span class="line">UINavigationBar: Updating an appearance of navigation items</span><br><span class="line">CartViewController: Updating an appearance of a list view with products</span><br><span class="line"></span><br><span class="line">CartManager: I&#39;am adding a new product: T-shirt</span><br><span class="line">UINavigationBar: Updating an appearance of navigation items</span><br><span class="line">CartViewController: Updating an appearance of a list view with products</span><br><span class="line"></span><br><span class="line">CartManager: Product &#39;Apple&#39; is removed from a cart</span><br><span class="line">UINavigationBar: Updating an appearance of navigation items</span><br><span class="line">CartViewController: Updating an appearance of a list view with products</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-8"><p><strong>åœ¨ TypeScript ä¸­ä½¿ç”¨æ¨¡å¼</strong></p><p><strong>å¤æ‚åº¦ï¼š</strong> â˜…â˜…â˜†</p><p><strong>æµè¡Œåº¦ï¼š</strong> â˜…â˜…â˜…</p><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong> è§‚å¯Ÿè€…æ¨¡å¼åœ¨ TypeScript ä»£ç ä¸­å¾ˆå¸¸è§ï¼Œ ç‰¹åˆ«æ˜¯åœ¨ GUI ç»„ä»¶ä¸­ã€‚ å®ƒæä¾›äº†åœ¨ä¸ä¸å…¶ä»–å¯¹è±¡æ‰€å±ç±»è€¦åˆçš„æƒ…å†µä¸‹å¯¹å…¶äº‹ä»¶åšå‡ºååº”çš„æ–¹å¼ã€‚</p><p><strong>è¯†åˆ«æ–¹æ³•ï¼š</strong> è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å°†å¯¹è±¡å­˜å‚¨åœ¨åˆ—è¡¨ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œ å’Œå¯¹äºé¢å‘è¯¥åˆ—è¡¨ä¸­å¯¹è±¡çš„æ›´æ–°æ–¹æ³•çš„è°ƒç”¨æ¥è¯†åˆ«ã€‚</p><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>æœ¬ä¾‹è¯´æ˜äº†<strong>è§‚å¯Ÿè€…</strong>è®¾è®¡æ¨¡å¼çš„ç»“æ„å¹¶é‡ç‚¹å›ç­”äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>å®ƒç”±å“ªäº›ç±»ç»„æˆï¼Ÿ</li><li>è¿™äº›ç±»æ‰®æ¼”äº†å“ªäº›è§’è‰²ï¼Ÿ</li><li>æ¨¡å¼ä¸­çš„å„ä¸ªå…ƒç´ ä¼šä»¥ä½•ç§æ–¹å¼ç›¸äº’å…³è”ï¼Ÿ</li></ul><p><strong>index.ts:</strong> æ¦‚å¿µç¤ºä¾‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Subject interface declares a set of methods for managing subscribers.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> Subject &#123;</span><br><span class="line">    <span class="comment">// Attach an observer to the subject.</span></span><br><span class="line">    attach(observer: Observer): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Detach an observer from the subject.</span></span><br><span class="line">    detach(observer: Observer): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Notify all observers about an event.</span></span><br><span class="line">    notify(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment"> * changes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> <span class="title">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type <span class="type">&#123;number&#125;</span> </span>For the sake of simplicity, the Subject&#x27;s state, essential</span></span><br><span class="line"><span class="comment">     * to all subscribers, is stored in this variable.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> state: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type <span class="type">&#123;Observer[]&#125;</span> </span>List of subscribers. In real life, the list of</span></span><br><span class="line"><span class="comment">     * subscribers can be stored more comprehensively (categorized by event</span></span><br><span class="line"><span class="comment">     * type, etc.).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> observers: Observer[] = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The subscription management methods.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> attach(observer: Observer): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isExist = <span class="built_in">this</span>.observers.includes(observer);</span><br><span class="line">        <span class="keyword">if</span> (isExist) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&#x27;Subject: Observer has been attached already.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Subject: Attached an observer.&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.observers.push(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> detach(observer: Observer): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> observerIndex = <span class="built_in">this</span>.observers.indexOf(observer);</span><br><span class="line">        <span class="keyword">if</span> (observerIndex === -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&#x27;Subject: Nonexistent observer.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.observers.splice(observerIndex, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Subject: Detached an observer.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Trigger an update in each subscriber.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> notify(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Subject: Notifying observers...&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> observer <span class="keyword">of</span> <span class="built_in">this</span>.observers) &#123;</span><br><span class="line">            observer.update(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line"><span class="comment">     * really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line"><span class="comment">     * triggers a notification method whenever something important is about to</span></span><br><span class="line"><span class="comment">     * happen (or after it).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> someBusinessLogic(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;\nSubject: I\&#x27;m doing something important.&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.state = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (<span class="number">10</span> + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`Subject: My state has just changed to: <span class="subst">$&#123;<span class="built_in">this</span>.state&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">this</span>.notify();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Observer interface declares the update method, used by subjects.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> Observer &#123;</span><br><span class="line">    <span class="comment">// Receive update from subject.</span></span><br><span class="line">    update(subject: Subject): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="comment"> * attached to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverA</span> <span class="title">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> update(subject: Subject): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (subject <span class="keyword">instanceof</span> ConcreteSubject &amp;&amp; subject.state &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteObserverA: Reacted to the event.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverB</span> <span class="title">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> update(subject: Subject): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (subject <span class="keyword">instanceof</span> ConcreteSubject &amp;&amp; (subject.state === <span class="number">0</span> || subject.state &gt;= <span class="number">2</span>)) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;ConcreteObserverB: Reacted to the event.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> ConcreteSubject();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observer1 = <span class="keyword">new</span> ConcreteObserverA();</span><br><span class="line">subject.attach(observer1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observer2 = <span class="keyword">new</span> ConcreteObserverB();</span><br><span class="line">subject.attach(observer2);</span><br><span class="line"></span><br><span class="line">subject.someBusinessLogic();</span><br><span class="line">subject.someBusinessLogic();</span><br><span class="line"></span><br><span class="line">subject.detach(observer2);</span><br><span class="line"></span><br><span class="line">subject.someBusinessLogic();</span><br></pre></td></tr></table></figure><p><strong>Output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 6</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 1</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line">Subject: Detached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#39;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 5</span><br><span class="line">Subject: Notifying observers...</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-9"><p><strong>æ¦‚å¿µç¤ºä¾‹</strong></p><p>åœ¨ç”µå•†ç½‘ç«™ä¸­ï¼Œ å•†å“æ—¶ä¸æ—¶åœ°ä¼šå‡ºç°ç¼ºè´§æƒ…å†µã€‚ å¯èƒ½ä¼šæœ‰å®¢æˆ·å¯¹äºç¼ºè´§çš„ç‰¹å®šå•†å“è¡¨ç°å‡ºå…´è¶£ã€‚ è¿™ä¸€é—®é¢˜æœ‰ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>å®¢æˆ·ä»¥ä¸€å®šçš„é¢‘ç‡æŸ¥çœ‹å•†å“çš„å¯ç”¨æ€§ã€‚</li><li>ç”µå•†ç½‘ç«™å‘å®¢æˆ·å‘é€æœ‰åº“å­˜çš„æ‰€æœ‰æ–°å•†å“ã€‚</li><li>å®¢æˆ·åªè®¢é˜…å…¶æ„Ÿå…´è¶£çš„ç‰¹å®šå•†å“ï¼Œ å•†å“å¯ç”¨æ—¶ä¾¿ä¼šæ”¶åˆ°é€šçŸ¥ã€‚ åŒæ—¶ï¼Œ å¤šåå®¢æˆ·ä¹Ÿå¯è®¢é˜…åŒä¸€æ¬¾äº§å“ã€‚</li></ol><p>é€‰é¡¹ 3 æ˜¯æœ€å…·å¯è¡Œæ€§çš„ï¼Œ è¿™å…¶å®å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„æ€æƒ³ã€‚ è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸»è¦ç»„æˆéƒ¨åˆ†æœ‰ï¼š</p><ul><li>ä¼šåœ¨æœ‰ä»»ä½•äº‹å‘ç”Ÿæ—¶å‘å¸ƒäº‹ä»¶çš„ä¸»ä½“ã€‚</li><li>è®¢é˜…äº†ä¸»ä½“äº‹ä»¶å¹¶ä¼šåœ¨äº‹ä»¶å‘ç”Ÿæ—¶æ”¶åˆ°é€šçŸ¥çš„è§‚å¯Ÿè€…ã€‚</li></ul><p><strong>subject.go:</strong> ä¸»ä½“</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> subject <span class="keyword">interface</span> &#123;</span><br><span class="line">    register(Observer observer)</span><br><span class="line">    deregister(Observer observer)</span><br><span class="line">    notifyAll()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>item.go:</strong> å…·ä½“ä¸»ä½“</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> item <span class="keyword">struct</span> &#123;</span><br><span class="line">    observerList []observer</span><br><span class="line">    name         <span class="keyword">string</span></span><br><span class="line">    inStock      <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newItem</span><span class="params">(name <span class="keyword">string</span>)</span> *<span class="title">item</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;item&#123;</span><br><span class="line">        name: name,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *item)</span> <span class="title">updateAvailability</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Item %s is now in stock\n&quot;</span>, i.name)</span><br><span class="line">    i.inStock = <span class="literal">true</span></span><br><span class="line">    i.notifyAll()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *item)</span> <span class="title">register</span><span class="params">(o observer)</span></span> &#123;</span><br><span class="line">    i.observerList = <span class="built_in">append</span>(i.observerList, o)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *item)</span> <span class="title">deregister</span><span class="params">(o observer)</span></span> &#123;</span><br><span class="line">    i.observerList = removeFromslice(i.observerList, o)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *item)</span> <span class="title">notifyAll</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, observer := <span class="keyword">range</span> i.observerList &#123;</span><br><span class="line">        observer.update(i.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeFromslice</span><span class="params">(observerList []observer, observerToRemove observer)</span> []<span class="title">observer</span></span> &#123;</span><br><span class="line">    observerListLength := <span class="built_in">len</span>(observerList)</span><br><span class="line">    <span class="keyword">for</span> i, observer := <span class="keyword">range</span> observerList &#123;</span><br><span class="line">        <span class="keyword">if</span> observerToRemove.getID() == observer.getID() &#123;</span><br><span class="line">            observerList[observerListLength<span class="number">-1</span>], observerList[i] = observerList[i], observerList[observerListLength<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">return</span> observerList[:observerListLength<span class="number">-1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> observerList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>observer.go:</strong> è§‚å¯Ÿè€…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> observer <span class="keyword">interface</span> &#123;</span><br><span class="line">    update(<span class="keyword">string</span>)</span><br><span class="line">    getID() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>customer.go:</strong> å…·ä½“è§‚å¯Ÿè€…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> customer <span class="keyword">struct</span> &#123;</span><br><span class="line">    id <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *customer)</span> <span class="title">update</span><span class="params">(itemName <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Sending email to customer %s for item %s\n&quot;</span>, c.id, itemName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *customer)</span> <span class="title">getID</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>main.go:</strong> å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    shirtItem := newItem(<span class="string">&quot;Nike Shirt&quot;</span>)</span><br><span class="line"></span><br><span class="line">    observerFirst := &amp;customer&#123;id: <span class="string">&quot;abc@gmail.com&quot;</span>&#125;</span><br><span class="line">    observerSecond := &amp;customer&#123;id: <span class="string">&quot;xyz@gmail.com&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    shirtItem.register(observerFirst)</span><br><span class="line">    shirtItem.register(observerSecond)</span><br><span class="line"></span><br><span class="line">    shirtItem.updateAvailability()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>output.txt:</strong> æ‰§è¡Œç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Item Nike Shirt is now in stock</span><br><span class="line">Sending email to customer abc@gmail.com for item Nike Shirt</span><br><span class="line">Sending email to customer xyz@gmail.com for item Nike Shirt</span><br></pre></td></tr></table></figure><p><em>æ ¹æ®ï¼š <a href="https://golangbyexample.com/observer-design-pattern-golang/">Golang By Example</a></em></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://refactoringguru.cn/design-patterns/observer&quot;&gt;https://refactoringguru.cn/design-patterns/observer&lt;/a&gt;&lt;/p&gt;
&lt;/
      
    
    </summary>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/categories/pattern/"/>
    
    
      <category term="pattern" scheme="http://wangyangyangisme.github.io/tags/pattern/"/>
    
  </entry>
  
</feed>
