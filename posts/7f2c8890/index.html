<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Natsç®¡ç†æœåŠ¡å™¨ | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Natsç®¡ç†æœåŠ¡å™¨å®‰è£…NATSæœåŠ¡å™¨æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥å®‰è£…NATSæœåŠ¡å™¨ã€‚ ä»äºŒè¿›åˆ¶å®‰è£…GitHubç‰ˆæœ¬é¡µé¢ä¸Šå§‹ç»ˆæä¾›æœ€æ–°çš„å®˜æ–¹å‘è¡Œç‰ˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¹³å°ï¼š  Linux (x86, x86_64, ARM) Windows (x86, x86_64) macOS  å¹³å°ç‰¹å®šæ–¹æ³• ä»¥ä¸‹æ–¹æ³•å¯èƒ½å¹¶éå…¨éƒ¨å®‰è£…æœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬  GO ç¡®ä¿è®¾ç½®äº†Goç¯å¢ƒï¼Œç„¶åä½¿ç”¨go getè¿›è¡Œå®‰è£…ã€‚ 1go get">
<meta property="og:type" content="article">
<meta property="og:title" content="Natsç®¡ç†æœåŠ¡å™¨">
<meta property="og:url" content="http://wangyangyangisme.github.io/posts/7f2c8890/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="Natsç®¡ç†æœåŠ¡å™¨å®‰è£…NATSæœåŠ¡å™¨æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥å®‰è£…NATSæœåŠ¡å™¨ã€‚ ä»äºŒè¿›åˆ¶å®‰è£…GitHubç‰ˆæœ¬é¡µé¢ä¸Šå§‹ç»ˆæä¾›æœ€æ–°çš„å®˜æ–¹å‘è¡Œç‰ˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¹³å°ï¼š  Linux (x86, x86_64, ARM) Windows (x86, x86_64) macOS  å¹³å°ç‰¹å®šæ–¹æ³• ä»¥ä¸‹æ–¹æ³•å¯èƒ½å¹¶éå…¨éƒ¨å®‰è£…æœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬  GO ç¡®ä¿è®¾ç½®äº†Goç¯å¢ƒï¼Œç„¶åä½¿ç”¨go getè¿›è¡Œå®‰è£…ã€‚ 1go get">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/285494672816019cfb027039031cb3ca.jpg">
<meta property="article:published_time" content="2019-09-27T07:55:36.000Z">
<meta property="article:modified_time" content="2019-09-27T07:55:36.000Z">
<meta property="article:author" content="Blank">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/285494672816019cfb027039031cb3ca.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/theme/favicon.ico"><link rel="canonical" href="http://wangyangyangisme.github.io/posts/7f2c8890/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"è·ç¦»ä¸Šæ¬¡æ›´æ–°å·²ç»è¿‡äº†","messageNext":"å¤©ï¼Œæ–‡ç« æ‰€æè¿°çš„å…§å®¹å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–ï¼Œè¯·ç•™æ„ã€‚"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Natsç®¡ç†æœåŠ¡å™¨',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2019-09-27 15:55:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/theme/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">305</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">30</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">49</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fa fa-image"></i><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> æ•™ç¨‹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿé–‹å§‹</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¡Œé é¢</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¡Œé…ç½®-1</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> âš”ï¸ ä¸»é¡Œé…ç½®-2</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> â“ ä¸»é¡Œå•ç­”</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> âš¡ï¸ é€²éšæ•™ç¨‹</span></a></li><li><a class="site-page child" href="/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥èªŒ</span></a></li><li><a class="site-page child" href="/posts/507c070f/"><span> ğŸ“‘ Aplayeræ•™ç¨‹</span></a></li><li><a class="site-page child" href="/posts/2df239ce/"><span> ğŸ“‘ æ¨™ç±¤å¤–æ›</span></a></li><li><a class="site-page child" href="/posts/b37b5fe3/"><span> ğŸ“‘ è‡ªå®šç¾©ä»£ç¢¼é…è‰²</span></a></li><li><a class="site-page child" href="/posts/ea33ab97/"><span> ğŸ“‘ è‡ªå®šç¾©å´é‚Šæ¬„</span></a></li><li><a class="site-page child" href="/posts/89757140/"><span> ğŸ“‘ Markdown</span></a></li><li><a class="site-page child" href="/posts/9db656e5/"><span> ğŸ“‘ ä»£ç é«˜äº®æµ‹è¯•</span></a></li><li><a class="site-page child" href="/posts/c9711c19/"><span> ğŸ“‘ ç•¶è¨­ç½®top_imgç‚ºfalseæ™‚</span></a></li><li><a class="site-page child" href="/posts/39b121ef/"><span> ğŸ“‘ Hexoå…§ç½®æ¨™ç±¤å¤–æ›</span></a></li><li><a class="site-page child" href="/posts/7670b080/"><span> ğŸ“‘ Butterfly ç¾åŒ–/å„ªåŒ–/é­”æ”¹ æ•™ç¨‹åˆé›†</span></a></li><li><a class="site-page child" href="/posts/913b2502/"><span> ğŸ“‘ æ²¡æœ‰å°é¢</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/285494672816019cfb027039031cb3ca.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Blank</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fa fa-image"></i><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> æ•™ç¨‹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿé–‹å§‹</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¡Œé é¢</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¡Œé…ç½®-1</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> âš”ï¸ ä¸»é¡Œé…ç½®-2</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> â“ ä¸»é¡Œå•ç­”</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> âš¡ï¸ é€²éšæ•™ç¨‹</span></a></li><li><a class="site-page child" href="/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥èªŒ</span></a></li><li><a class="site-page child" href="/posts/507c070f/"><span> ğŸ“‘ Aplayeræ•™ç¨‹</span></a></li><li><a class="site-page child" href="/posts/2df239ce/"><span> ğŸ“‘ æ¨™ç±¤å¤–æ›</span></a></li><li><a class="site-page child" href="/posts/b37b5fe3/"><span> ğŸ“‘ è‡ªå®šç¾©ä»£ç¢¼é…è‰²</span></a></li><li><a class="site-page child" href="/posts/ea33ab97/"><span> ğŸ“‘ è‡ªå®šç¾©å´é‚Šæ¬„</span></a></li><li><a class="site-page child" href="/posts/89757140/"><span> ğŸ“‘ Markdown</span></a></li><li><a class="site-page child" href="/posts/9db656e5/"><span> ğŸ“‘ ä»£ç é«˜äº®æµ‹è¯•</span></a></li><li><a class="site-page child" href="/posts/c9711c19/"><span> ğŸ“‘ ç•¶è¨­ç½®top_imgç‚ºfalseæ™‚</span></a></li><li><a class="site-page child" href="/posts/39b121ef/"><span> ğŸ“‘ Hexoå…§ç½®æ¨™ç±¤å¤–æ›</span></a></li><li><a class="site-page child" href="/posts/7670b080/"><span> ğŸ“‘ Butterfly ç¾åŒ–/å„ªåŒ–/é­”æ”¹ æ•™ç¨‹åˆé›†</span></a></li><li><a class="site-page child" href="/posts/913b2502/"><span> ğŸ“‘ æ²¡æœ‰å°é¢</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Natsç®¡ç†æœåŠ¡å™¨</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2019-09-27T07:55:36.000Z" title="å‘è¡¨äº 2019-09-27 15:55:36">2019-09-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2019-09-27T07:55:36.000Z" title="æ›´æ–°äº 2019-09-27 15:55:36">2019-09-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservice/">microservice</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservice/nats/">nats</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">13.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>55åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Natsç®¡ç†æœåŠ¡å™¨"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Natsç®¡ç†æœåŠ¡å™¨"><a href="#Natsç®¡ç†æœåŠ¡å™¨" class="headerlink" title="Natsç®¡ç†æœåŠ¡å™¨"></a>Natsç®¡ç†æœåŠ¡å™¨</h1><h2 id="å®‰è£…NATSæœåŠ¡å™¨"><a href="#å®‰è£…NATSæœåŠ¡å™¨" class="headerlink" title="å®‰è£…NATSæœåŠ¡å™¨"></a>å®‰è£…NATSæœåŠ¡å™¨</h2><p>æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥å®‰è£…NATSæœåŠ¡å™¨ã€‚</p>
<h3 id="ä»äºŒè¿›åˆ¶å®‰è£…"><a href="#ä»äºŒè¿›åˆ¶å®‰è£…" class="headerlink" title="ä»äºŒè¿›åˆ¶å®‰è£…"></a>ä»äºŒè¿›åˆ¶å®‰è£…</h3><p>GitHubç‰ˆæœ¬é¡µé¢ä¸Šå§‹ç»ˆæä¾›æœ€æ–°çš„å®˜æ–¹å‘è¡Œç‰ˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¹³å°ï¼š</p>
<ul>
<li>Linux (x86, x86_64, ARM)</li>
<li>Windows (x86, x86_64)</li>
<li>macOS</li>
</ul>
<h3 id="å¹³å°ç‰¹å®šæ–¹æ³•"><a href="#å¹³å°ç‰¹å®šæ–¹æ³•" class="headerlink" title="å¹³å°ç‰¹å®šæ–¹æ³•"></a>å¹³å°ç‰¹å®šæ–¹æ³•</h3><blockquote>
<p>ä»¥ä¸‹æ–¹æ³•å¯èƒ½å¹¶éå…¨éƒ¨å®‰è£…æœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬</p>
</blockquote>
<p><strong>GO</strong></p>
<p>ç¡®ä¿è®¾ç½®äº†Goç¯å¢ƒï¼Œç„¶åä½¿ç”¨go getè¿›è¡Œå®‰è£…ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/nats-io/nats-server</span><br></pre></td></tr></table></figure>

<p><strong>Docker Hub</strong></p>
<p>Docker Hubä¸Šæä¾›äº†æœ€æ–°çš„å®˜æ–¹Dockeré•œåƒã€‚<br><strong>Windows</strong></p>
<p>åœ¨Windowsä¸Šï¼Œå¯ä»¥é€šè¿‡<a target="_blank" rel="noopener" href="https://hub.docker.com/nats/">Chocolatey</a>å®‰è£…NATSæœåŠ¡å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco install nats-server</span><br></pre></td></tr></table></figure>

<p><strong>macOS</strong></p>
<p>åœ¨macOSä¸Šï¼Œå¯ä»¥é€šè¿‡Homebrewå®‰è£…NATSæœåŠ¡å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nats-server</span><br></pre></td></tr></table></figure>

<h3 id="æµ‹è¯•æ‚¨çš„å®‰è£…"><a href="#æµ‹è¯•æ‚¨çš„å®‰è£…" class="headerlink" title="æµ‹è¯•æ‚¨çš„å®‰è£…"></a>æµ‹è¯•æ‚¨çš„å®‰è£…</h3><p>è¦æµ‹è¯•æ‚¨çš„å®‰è£…ï¼Œæ‚¨å¯ä»¥è°ƒç”¨NATSæœåŠ¡å™¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ²¡æœ‰é€‰é¡¹ï¼Œä¹Ÿæ²¡æœ‰é…ç½®æ–‡ä»¶ï¼ˆæ²¡æœ‰èº«ä»½éªŒè¯ï¼Œæ²¡æœ‰ç¾¤é›†ï¼‰ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server</span><br></pre></td></tr></table></figure>

<p>å½“æœåŠ¡å™¨æˆåŠŸå¯åŠ¨æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°NATSæœåŠ¡å™¨åœ¨TCPç«¯å£4222ä¸Šä¾¦å¬å®¢æˆ·ç«¯è¿æ¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[18141] 2016/10/31 13:13:40.732616 [INF] Starting nats-server version 0.9.4</span><br><span class="line">[18141] 2016/10/31 13:13:40.732704 [INF] Listening for client connections on 0.0.0.0:4222</span><br><span class="line">[18141] 2016/10/31 13:13:40.732967 [INF] Server is ready</span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡ŒNATSæœåŠ¡å™¨"><a href="#è¿è¡ŒNATSæœåŠ¡å™¨" class="headerlink" title="è¿è¡ŒNATSæœåŠ¡å™¨"></a>è¿è¡ŒNATSæœåŠ¡å™¨</h2><p>å¼€ç®±å³ç”¨ï¼Œæ‚¨å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½•è‡ªå®šä¹‰è®¾ç½®çš„æƒ…å†µä¸‹è¿è¡ŒNATSæœåŠ¡å™¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server</span><br></pre></td></tr></table></figure>

<h3 id="å¯ç”¨å¸¦ç›‘æ§çš„NATSæœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰"><a href="#å¯ç”¨å¸¦ç›‘æ§çš„NATSæœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="å¯ç”¨å¸¦ç›‘æ§çš„NATSæœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰"></a>å¯ç”¨å¸¦ç›‘æ§çš„NATSæœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰</h3><p>NATSæœåŠ¡å™¨åœ¨ç«¯å£8222ä¸Šå…¬å¼€ç›‘æ§æ¥å£ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -m 8222</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨å¯ç”¨ç›‘æ§çš„æƒ…å†µä¸‹è¿è¡ŒNATSæœåŠ¡å™¨ï¼Œåˆ™ä¼šçœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[18159] 2016/10/31 13:14:03.055572 [INF] Starting nats-server version 0.9.4</span><br><span class="line">[18159] 2016/10/31 13:14:03.055692 [INF] Starting http monitor on 0.0.0.0:8222</span><br><span class="line">[18159] 2016/10/31 13:14:03.055762 [INF] Listening for client connections on 0.0.0.0:4222</span><br><span class="line">[18159] 2016/10/31 13:14:03.055796 [INF] Server is ready</span><br></pre></td></tr></table></figure>



<h3 id="å‘½ä»¤è¡Œé€‰é¡¹"><a href="#å‘½ä»¤è¡Œé€‰é¡¹" class="headerlink" title="å‘½ä»¤è¡Œé€‰é¡¹"></a>å‘½ä»¤è¡Œé€‰é¡¹</h3><p>æœ‰ä¸¤ç§é…ç½®æœåŠ¡å™¨çš„æ–¹æ³•ã€‚æ‚¨å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œå¦‚ä¸‹æ‰€è¿°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶ã€‚<br><strong>å¸¸è§é€‰é¡¹</strong></p>
<ul>
<li>-hï¼Œ - help          æ˜¾ç¤ºå¸®åŠ©æ¶ˆæ¯</li>
<li>-vï¼Œ - version      æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯</li>
</ul>
<p><strong>æœåŠ¡å™¨é€‰é¡¹</strong></p>
<ul>
<li>-aï¼Œ â€“addr HOST ç»‘å®šä¸»æœºIPåœ°å€ï¼ˆé»˜è®¤æ˜¯0.0.0.0ï¼‰</li>
<li>-pï¼Œ â€“port PORT å®¢æˆ·ç«¯è¿æ¥NATSæœåŠ¡å™¨ä½¿ç”¨çš„ç«¯å£ï¼ˆé»˜è®¤æ˜¯4222ï¼‰</li>
<li>-Pï¼Œ â€“pid FILE å­˜å‚¨PIDçš„æ–‡ä»¶</li>
<li>-mï¼Œ â€“http_port PORT ä½¿ç”¨HTTPç«¯å£ä½œä¸ºç›‘å¬ç«¯å£</li>
<li>-msï¼Œ â€“https_port PORT ä½¿ç”¨HTTPSç«¯å£ä½œä¸ºç›‘å¬ç«¯å£</li>
<li>-cï¼Œ â€“config FILE æŒ‡å®šé…ç½®æ–‡ä»¶</li>
<li>-client_advertise HOSTï¼šPORTé…ç½®INFOæ¶ˆæ¯ä¸­è¿”å›çš„HOSTå’ŒPORT</li>
</ul>
<p><strong>æ—¥å¿—é€‰é¡¹</strong></p>
<ul>
<li>-lï¼Œ â€“log FILE æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„æ–‡ä»¶</li>
<li>-Tï¼Œ â€“logtime æ˜¯å¦å¼€å¯æ—¥å¿—çš„æ—¶é—´æˆ³ï¼ˆé»˜è®¤ä¸ºtrueï¼‰</li>
<li>-sï¼Œ â€“syslog å¯ç”¨syslogä½œä¸ºæ—¥å¿—æ–¹æ³•</li>
<li>-rï¼Œ â€“remote_syslog è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨çš„åœ°å€ï¼ˆé»˜è®¤ä¸ºudp://localhost:514ï¼‰</li>
<li>-Dï¼Œ â€“debug å¼€å¯è°ƒè¯•è¾“å‡º</li>
<li>-V, â€“trace è·Ÿè¸ªåŸå§‹çš„åè®®</li>
<li>-DV è°ƒè¯•å¹¶è·Ÿè¸ª</li>
</ul>
<p><strong>æˆæƒè®¤è¯é€‰é¡¹</strong></p>
<ul>
<li><p>--user user         è¿æ¥éœ€è¦çš„ç”¨æˆ·å</p>
</li>
<li><p>--pass password     è¿æ¥éœ€è¦çš„å¯†ç </p>
</li>
<li><p>--auth token    è¿æ¥æ‰€éœ€çš„ä»¤ç‰Œ</p>
</li>
</ul>
<p><strong>TLSå®‰å…¨é€‰é¡¹</strong></p>
<ul>
<li><p>--help_tls      TLS å¸®åŠ©</p>
</li>
<li><p>--tls å¯ç”¨TLSï¼Œä¸éªŒè¯å®¢æˆ·ç«¯ï¼ˆé»˜è®¤ä¸ºfalseï¼‰</p>
</li>
<li><p>--tlscert FILE æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶</p>
</li>
<li><p>--tlskey FILE æœåŠ¡å™¨è¯ä¹¦ç§é’¥</p>
</li>
<li><p>--tlsverify å¯ç”¨TLSï¼Œæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½è¦è®¤è¯</p>
</li>
<li><p>--tlscacert FILE å®¢æˆ·ç«¯è¯ä¹¦CAç”¨äºè®¤è¯</p>
</li>
</ul>
<p><strong>ç¾¤é›†é€‰é¡¹</strong></p>
<ul>
<li>--routes [rurl-1ï¼Œrurl-2]è·¯çº¿å¾æ±‚å’Œè¿æ¥</li>
<li>--cluster [cluster url]è¯·æ±‚è·¯ç”±çš„ç¾¤é›†URL</li>
</ul>
<p>å¦‚æœå¯ç”¨äº†è·¯ç”±ï¼Œåˆ™è·¯ç”±ï¼ˆæœåŠ¡å™¨ï¼‰è¿æ¥å°†ä¾¦å¬ç«¯å£6222ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[18159] 2016/10/31 13:14:03.055572 [INF] Starting nats-server version 0.9.4</span><br><span class="line">[18159] 2016/10/31 13:14:03.055692 [INF] Starting http monitor on 0.0.0.0:8222</span><br><span class="line">[18159] 2016/10/31 13:14:03.055707 [INF] Listening for route connections on 0.0.0.0:6222</span><br><span class="line">[18159] 2016/10/31 13:14:03.055762 [INF] Listening for client connections on 0.0.0.0:4222</span><br><span class="line">[18159] 2016/10/31 13:14:03.055796 [INF] Server is ready</span><br></pre></td></tr></table></figure>

<h2 id="NATSæœåŠ¡å™¨èº«ä»½éªŒè¯"><a href="#NATSæœåŠ¡å™¨èº«ä»½éªŒè¯" class="headerlink" title="NATSæœåŠ¡å™¨èº«ä»½éªŒè¯"></a>NATSæœåŠ¡å™¨èº«ä»½éªŒè¯</h2><p>æ‚¨å¯ä»¥åœ¨NATSæœåŠ¡å™¨ä¸Šå¯ç”¨èº«ä»½éªŒè¯ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯åœ¨è¿æ¥æ—¶å¿…é¡»éªŒè¯å…¶èº«ä»½ã€‚ NATSæœåŠ¡å™¨é€šè¿‡å‘½ä»¤è¡Œæˆ–ä½¿ç”¨é…ç½®æ–‡ä»¶æ”¯æŒå•ç”¨æˆ·èº«ä»½éªŒè¯ï¼Œå¹¶é€šè¿‡é…ç½®æ–‡ä»¶æ”¯æŒå¤šç”¨æˆ·èº«ä»½éªŒè¯ã€‚å•ç”¨æˆ·èº«ä»½éªŒè¯æ˜¯çœŸæ­£çš„å•ç”¨æˆ·ã€‚æœåŠ¡å™¨å°†æ¥å—ä¸€ç»„è®¾ç½®å¥½çš„å‡­æ®è€Œä¸æ¥å—å…¶ä»–å‡­æ®ã€‚</p>
<h3 id="å‘½ä»¤è¡Œé€‰é¡¹-1"><a href="#å‘½ä»¤è¡Œé€‰é¡¹-1" class="headerlink" title="å‘½ä»¤è¡Œé€‰é¡¹"></a>å‘½ä»¤è¡Œé€‰é¡¹</h3><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’æ‰€éœ€çš„å‡­æ®æ¥å¯ç”¨å¯ç”¨äº†å•ç”¨æˆ·èº«ä»½éªŒè¯çš„NATSæœåŠ¡å™¨ã€‚å‘½ä»¤è¡Œæ”¯æŒä»¥ä¸‹æœåŠ¡å™¨èº«ä»½éªŒè¯é€‰é¡¹ï¼š</p>
<ul>
<li>--user userè¿æ¥æ‰€éœ€çš„ç”¨æˆ·</li>
<li>--pass passwordè¿æ¥æ‰€éœ€çš„å¯†ç </li>
<li>--authä»¤ç‰Œè¿æ¥æ‰€éœ€çš„æˆæƒä»¤ç‰Œ</li>
</ul>
<p>ä»¤ç‰Œä¸ç”¨æˆ·å’Œå¯†ç äº’æ–¥ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -DV --user foo --pass bar</span><br></pre></td></tr></table></figure>

<p>å°†å…è®¸ç”¨æˆ·fooä½¿ç”¨å¯†ç ç™»å½•ã€‚</p>
<p>ä½¿ç”¨å¸¦æœ‰æˆæƒä»¤ç‰Œçš„å‘½ä»¤è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -DV -auth&#x27;S3Cr3T0k3n!&#x27;</span><br></pre></td></tr></table></figure>

<p>å°†å…è®¸å…·æœ‰è¯¥ä»¤ç‰Œçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œè€Œä¸å…è®¸å…¶ä»–å®¢æˆ·ç«¯ã€‚</p>
<h3 id="å•ç”¨æˆ·é…ç½®é€‰é¡¹"><a href="#å•ç”¨æˆ·é…ç½®é€‰é¡¹" class="headerlink" title="å•ç”¨æˆ·é…ç½®é€‰é¡¹"></a>å•ç”¨æˆ·é…ç½®é€‰é¡¹</h3><p>å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å•ç”¨æˆ·èº«ä»½éªŒè¯ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  user:     derek</span><br><span class="line">  password: T0pS3cr3t</span><br><span class="line">  timeout:  1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœåŠ¡å™¨æ˜¯ç¾¤é›†çš„ä¸€éƒ¨åˆ†ï¼Œæ‚¨è¿˜å¯ä»¥ä¸ºè·¯ç”±è¿æ¥è®¾ç½®å•ç”¨æˆ·èº«ä»½éªŒè¯ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  user:     derek</span><br><span class="line">  password: T0pS3cr3t</span><br><span class="line">  timeout:  1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ç§é…ç½®éƒ½è®¾ç½®ç”¨æˆ·å’Œå¯†ç ä»¥åŠè¿æ¥è¶…æ—¶ã€‚ authé€‰é¡¹ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºä½¿ç”¨ä»¤ç‰Œè€Œä¸æ˜¯ç”¨æˆ·/å¯†ç ã€‚</p>
<h3 id="å¤šç”¨æˆ·èº«ä»½éªŒè¯"><a href="#å¤šç”¨æˆ·èº«ä»½éªŒè¯" class="headerlink" title="å¤šç”¨æˆ·èº«ä»½éªŒè¯"></a>å¤šç”¨æˆ·èº«ä»½éªŒè¯</h3><p>å¤šç”¨æˆ·èº«ä»½éªŒè¯åªèƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ã€‚ç”¨æˆ·åœ¨å…·æœ‰ç”¨æˆ·/å¯†ç å¯¹çš„åˆ—è¡¨ä¸­å®šä¹‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¦å®šä¹‰ä¸¤ä¸ªç”¨æˆ·aliceå’Œbobï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  users = [</span><br><span class="line">    &#123;user: alice, password: foo&#125;</span><br><span class="line">    &#123;user: bob,   password: bar&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å˜é‡æ¥è®¾ç½®ç”¨æˆ·å’Œå¯†ç å€¼ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œå°†å¯†ç å£°æ˜ä¸ºåä¸ºPASSçš„å˜é‡å¹¶åˆ†é…ç»™Joeã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  PASS: abcdefghijklmnopqrstuvwxyz0123456789</span><br><span class="line">  users = [</span><br><span class="line">    &#123;user: alice, password: foo&#125;</span><br><span class="line">    &#123;user: bob,   password: bar&#125;</span><br><span class="line">    &#123;user: joe,   password: $PASS&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nats-serveræºä»£ç åŒ…å«ä¸€ä¸ªå¯ç”¨äºåŠ å¯†é…ç½®æ–‡ä»¶å¯†ç çš„å·¥å…·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> go run mkpasswd.go -p</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> password: password</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> bcrypt <span class="built_in">hash</span>: <span class="variable">$2a</span><span class="variable">$11</span><span class="variable">$1oJy</span>/wZYNTxr9jNwMNwS3eUGhBpHT3On8CL9o7ey89mpgo88VG6ba</span></span><br></pre></td></tr></table></figure>

<p>è¿™å…è®¸æ‚¨å­˜å‚¨æ•£åˆ—å¯†ç è€Œä¸æ˜¯çº¯æ–‡æœ¬å¯†ç ã€‚</p>
<h3 id="å®¢æˆ·è¿æ¥å­—ç¬¦ä¸²"><a href="#å®¢æˆ·è¿æ¥å­—ç¬¦ä¸²" class="headerlink" title="å®¢æˆ·è¿æ¥å­—ç¬¦ä¸²"></a>å®¢æˆ·è¿æ¥å­—ç¬¦ä¸²</h3><p>è¦ä½œä¸ºç»è¿‡èº«ä»½éªŒè¯çš„å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥åœ¨è¿æ¥å­—ç¬¦ä¸²ä¸­ä¼ å…¥å‡­æ®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç”¨æˆ·&#39;foo&#39;ï¼Œå¯†ç ä¸º&#39;bar&#39;ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats://foo:bar@localhost:4222</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä»¤ç‰Œ&#39;S3Cr3T0k3nï¼&#39;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats://foo:bar@localhost:4222</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨è¿˜æ”¯æŒâ€œå®‰å…¨/åŠ å¯†â€éƒ¨åˆ†ä¸­è®°å½•çš„TLSç›¸äº’èº«ä»½éªŒè¯ã€‚å¼€å‘äººå‘˜æ–‡æ¡£ä¸­è¿˜è®¨è®ºäº†å…¶ä»–æ–¹æ³•ã€‚</p>
<h2 id="ç¾¤é›†å‡çº§"><a href="#ç¾¤é›†å‡çº§" class="headerlink" title="ç¾¤é›†å‡çº§"></a>ç¾¤é›†å‡çº§</h2><p>å‡çº§ç¾¤é›†çš„åŸºæœ¬ç­–ç•¥æ˜¯å›´ç»•æœåŠ¡å™¨å°†ç¾¤é›†é…ç½®é—²ç½®åˆ°å®¢æˆ·ç«¯å’Œå…¶ä»–æœåŠ¡å™¨çš„èƒ½åŠ›ã€‚å½“ç¾¤é›†é…ç½®æ›´æ”¹æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨äº†è§£æ–°æœåŠ¡å™¨ã€‚åœ¨æ–­å¼€è¿æ¥çš„æƒ…å†µä¸‹ï¼Œé™¤äº†ä»å…¶è¿æ¥è®¾ç½®çŸ¥é“çš„æœåŠ¡å™¨ä¹‹å¤–ï¼Œå®¢æˆ·ç«¯è¿˜å…·æœ‰åŠ å…¥ç¾¤é›†çš„æœåŠ¡å™¨åˆ—è¡¨ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œç”±äºæ¯ä¸ªæœåŠ¡å™¨éƒ½å­˜å‚¨è‡ªå·±çš„æƒé™å’Œèº«ä»½éªŒè¯é…ç½®ï¼Œå› æ­¤æ·»åŠ åˆ°ç¾¤é›†çš„æ–°æœåŠ¡å™¨åº”æä¾›ç›¸åŒçš„ç”¨æˆ·å’Œæˆæƒï¼Œä»¥é˜²æ­¢å®¢æˆ·ç«¯è¢«æ‹’ç»æˆ–è·å¾—æ„å¤–æƒé™ã€‚</p>
<p>ä¸ºäº†æè¿°åœºæ™¯ï¼Œè®©æˆ‘ä»¬åœ¨é”®ç›˜ä¸Šè·å–ä¸€äº›æ‰‹æŒ‡ï¼Œå¹¶å®ŒæˆåŠ¨ä½œã€‚è®©æˆ‘ä»¬è€ƒè™‘ä¸¤ä¸ªæœåŠ¡å™¨çš„é›†ç¾¤ï¼š&#39;A&#39;å’Œ&#39;B&#39;ï¼Œä»¥åŠ - é›†ç¾¤åº”è¯¥æ˜¯ä¸‰åˆ°äº”ä¸ªæœåŠ¡å™¨ï¼Œä½†ä¸ºäº†æè¿°è¡Œä¸ºå’Œé›†ç¾¤å‡çº§è¿‡ç¨‹ï¼Œä¸¤ä¸ªæœåŠ¡å™¨çš„é›†ç¾¤å°±è¶³å¤Ÿäº†ã€‚</p>
<p>è®©æˆ‘ä»¬æ„å»ºè¿™ä¸ªé›†ç¾¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -D -p 4222 -cluster nats://localhost:6222 -routes nats://localhost:6222,nats://localhost:6333</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„å‘½ä»¤å¯åŠ¨å¯ç”¨äº†è°ƒè¯•è¾“å‡ºçš„<code>nats-server</code>ï¼Œåœ¨ç«¯å£4222ä¸Šä¾¦å¬å®¢æˆ·ç«¯ï¼Œä»¥åŠåœ¨ç«¯å£6222ä¸Šæ¥å—é›†ç¾¤è¿æ¥ã€‚<code>-routes</code>é€‰é¡¹æŒ‡å®šæœåŠ¡å™¨å°†å°è¯•è¿æ¥åˆ°å…¶ä»–æœåŠ¡å™¨çš„nats URLåˆ—è¡¨ã€‚è¿™äº›URLå®šä¹‰åœ¨ç¾¤é›†å¯¹ç­‰æ–¹ä¸Šå¯ç”¨çš„ç¾¤é›†ç«¯å£ã€‚</p>
<p>æ•é”çš„è¯»è€…ä¼šæ³¨æ„åˆ°è‡ªæˆ‘è·¯çº¿ã€‚ Gnatsdå°†å¿½ç•¥è‡ªæˆ‘è·¯ç”±ï¼Œä½†å®ƒä¸ºæ‰€æœ‰æœåŠ¡å™¨æä¾›å•ä¸€ä¸€è‡´çš„é…ç½®ã€‚</p>
<p>æ‚¨å°†çœ‹åˆ°æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å®ƒä¼šå‘å‡ºä¸€äº›è­¦å‘Šï¼Œå› ä¸ºå®ƒæ— æ³•è¿æ¥åˆ°â€œlocalhostï¼š6333â€ã€‚æ¶ˆæ¯æ›´å‡†ç¡®åœ°è¯»å–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error trying to connect to route: dial tcp localhost:6333: connect: connection refused</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬é€šè¿‡å¯åŠ¨ç¬¬äºŒå°æœåŠ¡å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -D -p 4333 -cluster nats://localhost:6333 -routes nats://localhost:6222,nats://localhost:6333</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒå°æœåŠ¡å™¨åœ¨ç«¯å£4333ä¸Šå¯åŠ¨ï¼Œå…¶é›†ç¾¤ç«¯å£åœ¨6333ä¸Šã€‚å¦åˆ™ä¸â€œAâ€ç›¸åŒã€‚</p>
<p>è®©æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå®ƒåœ¨æœåŠ¡å™¨è¢«ç§»é™¤ååœ¨æœåŠ¡å™¨ä¹‹é—´ç§»åŠ¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-sub -s nats://localhost:4222 &quot;&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>Nats-subæ˜¯æ‰€æœ‰NATSå®¢æˆ·ç«¯éƒ½åŒ…å«çš„è®¢æˆ·æ ·æœ¬ã€‚ Nats-subè®¢é˜…ä¸»é¢˜å¹¶æ‰“å°å‡ºæ”¶åˆ°çš„ä»»ä½•æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥åœ¨nats-sub [here]ï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/nats-io/go-nats/tree/master/examplesï¼‰çš„goç‰ˆæœ¬ä¸­æ‰¾åˆ°æºä»£ç ã€‚å¯åŠ¨è®¢é˜…è€…åï¼Œæ‚¨åº”è¯¥åœ¨â€œAâ€ä¸Šçœ‹åˆ°æ–°å®¢æˆ·ç«¯è¿æ¥çš„æ¶ˆæ¯ã€‚">https://github.com/nats-io/go-nats/tree/master/examplesï¼‰çš„goç‰ˆæœ¬ä¸­æ‰¾åˆ°æºä»£ç ã€‚å¯åŠ¨è®¢é˜…è€…åï¼Œæ‚¨åº”è¯¥åœ¨â€œAâ€ä¸Šçœ‹åˆ°æ–°å®¢æˆ·ç«¯è¿æ¥çš„æ¶ˆæ¯ã€‚</a></p>
<p>æˆ‘ä»¬æœ‰ä¸¤å°æœåŠ¡å™¨å’Œä¸€å°å®¢æˆ·ç«¯ã€‚æ˜¯æ—¶å€™æ¨¡æ‹Ÿæˆ‘ä»¬çš„æ»šåŠ¨å‡çº§äº†ã€‚ä½†ç­‰ç­‰ï¼Œåœ¨æˆ‘ä»¬å‡çº§&#39;A&#39;ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä»‹ç»ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨&#39;T.&#39;æœåŠ¡&#39;T&#39;å°†åœ¨æˆ‘ä»¬æ‰§è¡Œå‡çº§æ—¶åŠ å…¥ç°æœ‰çš„é›†ç¾¤ã€‚å®ƒçš„å”¯ä¸€ç›®çš„æ˜¯ä¸ºå®¢æˆ·æä¾›ä¸€ä¸ªé¢å¤–çš„åœ°æ–¹ï¼Œé™¤äº†&#39;A&#39;ä¹‹å¤–ï¼Œç¡®ä¿æˆ‘ä»¬ä¸ä¼šåœ¨å‡çº§è¿‡ç¨‹ä¹‹åä¸ºæ‰€æœ‰å®¢æˆ·æä¾›æœåŠ¡ã€‚å®¢æˆ·ç«¯å°†åœ¨è¿æ¥æ—¶éšæœºé€‰æ‹©æœåŠ¡å™¨ï¼Œé™¤éæä¾›ç¦ç”¨è¯¥åŠŸèƒ½çš„ç‰¹æ®Šé€‰é¡¹ï¼ˆé€šå¸¸ç§°ä¸ºâ€œDontRandomizeâ€æˆ–â€œnoRandomizeâ€ï¼‰ã€‚æ‚¨å¯ä»¥é˜…è¯»æ›´å¤šå…³äºâ€œé¿å…é›·é¸£ç¾¤â€çš„ä¿¡æ¯ã€‚å¯ä»¥è¯´å®¢æˆ·ç«¯åœ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨ä¹‹é—´å‡åŒ€åœ°é‡æ–°åˆ†é…ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œ&#39;A&#39;çš„1/2å®¢æˆ·å°†è·³è½¬åˆ°&#39;B&#39;ï¼Œå‰©ä¸‹çš„ä¸€åŠå°†è½¬ä¸º&#39;T&#39;ã€‚</p>
<p>è®©æˆ‘ä»¬å¼€å§‹æˆ‘ä»¬çš„ä¸´æ—¶æœåŠ¡å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -D -p 4444 -cluster nats://localhost:6444 -routes nats://localhost:6222,nats://localhost:6333</span><br></pre></td></tr></table></figure>

<p>å¤§çº¦ä¸€ç¬é—´ï¼Œ&#39;A&#39;ä¸Šçš„å®¢æˆ·äº†è§£åŠ å…¥çš„æ–°é›†ç¾¤æˆå‘˜ã€‚åœ¨æˆ‘ä»¬çš„åŠ¨æ‰‹æ•™ç¨‹ä¸­ï¼Œnats-subç°åœ¨çŸ¥é“3ä¸ªå¯èƒ½çš„æœåŠ¡å™¨ï¼Œ&#39;A&#39;ï¼ˆåœ¨æˆ‘ä»¬å¯åŠ¨å·¥å…·æ—¶æŒ‡å®šï¼‰å’Œä»ç¾¤é›†å…«å¦ä¸­å­¦ä¹ çš„&#39;B&#39;å’Œ&#39;T&#39;ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡å‘&#39;A&#39;ä¸Šçš„ç»ˆç«¯å‘å‡ºCTRL + Cæ¥è°ƒç”¨æˆ‘ä»¬çš„ç®¡ç†å‘˜æƒé™å¹¶å…³é—­&#39;A&#39;ï¼Œå¹¶è§‚å¯Ÿ&#39;B&#39;æˆ–&#39;T&#39;æŠ¥å‘Šæ–°å®¢æˆ·ç«¯å·²è¿æ¥ã€‚é‚£æ˜¯æˆ‘ä»¬çš„nats-subå®¢æˆ·ç«¯ã€‚</p>
<p>æˆ‘ä»¬æ‰§è¡Œå‡çº§è¿‡ç¨‹ï¼Œæ›´æ–°â€œAâ€çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åé‡æ–°å¯åŠ¨â€œAâ€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -D -p 4222 -cluster nats://localhost:6222 -routes nats://localhost:6222,nats://localhost:6333</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç»§ç»­å‡çº§&#39;B&#39;ã€‚è¯·æ³¨æ„ï¼Œæ¥è‡ªâ€œBâ€çš„å®¢æˆ·ç«¯é‡æ–°è¿æ¥åˆ°â€œAâ€å’Œâ€œTâ€ã€‚æˆ‘ä»¬å‡çº§å¹¶é‡æ–°å¯åŠ¨&#39;B&#39;ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -D -p 4333 -cluster nats://localhost:6333 -routes nats://localhost:6222,nats://localhost:6333</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬æœ‰æ›´å¤šæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†ç»§ç»­åœæ­¢ï¼Œæ›´æ–°ï¼Œé‡æ–°å¯åŠ¨æ—‹è½¬ï¼Œå°±åƒæˆ‘ä»¬å¯¹&#39;A&#39;å’Œ&#39;B&#39;æ‰€åšçš„é‚£æ ·ã€‚é‡æ–°å¯åŠ¨æœ€åä¸€å°æœåŠ¡å™¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å…³é—­&#39;T&#39;&#39;&#39;T&#39;ä¸Šçš„ä»»ä½•å®¢æˆ·ç«¯&#39;å°†é‡æ–°åˆ†é…ç»™æˆ‘ä»¬çš„æ°¸ä¹…é›†ç¾¤æˆå‘˜ã€‚</p>
<h3 id="ç§å­æœåŠ¡å™¨"><a href="#ç§å­æœåŠ¡å™¨" class="headerlink" title="ç§å­æœåŠ¡å™¨"></a>ç§å­æœåŠ¡å™¨</h3><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯åŠ¨äº†nats-serveræŒ‡å®šä¸¤ä¸ªèšç±»è·¯ç”±ã€‚å¯ä»¥å…è®¸æœåŠ¡å™¨åè®®é©±åŠ¨å®ƒå¹¶å‡å°‘é…ç½®é‡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å¯åŠ¨Aï¼ŒBå’ŒCï¼š<br>A - ç§å­æœåŠ¡å™¨</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -D -p 4222 -cluster natsï¼š// localhostï¼š6222</span><br></pre></td></tr></table></figure>

<p>B</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -D -p 4333 -cluster nats://localhost:6333 -routes nats://localhost:6222</span><br></pre></td></tr></table></figure>

<p>C</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -D -p 4444 -cluster nats://localhost:6444 -routes nats://localhost:6222</span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦å®ƒä»¬è¿æ¥åˆ°â€œç§å­æœåŠ¡å™¨â€ï¼Œå®ƒå°†äº†è§£æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨å¹¶ç›¸äº’è¿æ¥å½¢æˆå®Œæ•´ç½‘æ ¼ã€‚</p>
<h2 id="NATSæœåŠ¡å™¨å®‰å…¨æ€§"><a href="#NATSæœåŠ¡å™¨å®‰å…¨æ€§" class="headerlink" title="NATSæœåŠ¡å™¨å®‰å…¨æ€§"></a>NATSæœåŠ¡å™¨å®‰å…¨æ€§</h2><p>ä»ç‰ˆæœ¬0.7.0å¼€å§‹ï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ç°ä»£TLSè¯­ä¹‰è¿›è¡Œå®¢æˆ·ç«¯è¿æ¥ï¼Œè·¯ç”±è¿æ¥å’ŒHTTPSç›‘æ§ç«¯å£ã€‚è¦åœ¨å®¢æˆ·ç«¯ç«¯å£ä¸Šå¯ç”¨TLSï¼Œè¯·æŒ‰å¦‚ä¸‹æ‰€ç¤ºæ·»åŠ TLSé…ç½®éƒ¨åˆ†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Simple TLS config file</span></span><br><span class="line"></span><br><span class="line">listen: 127.0.0.1:4443</span><br><span class="line"></span><br><span class="line">tls &#123;</span><br><span class="line">  cert_file:  &quot;./configs/certs/server-cert.pem&quot;</span><br><span class="line">  key_file:   &quot;./configs/certs/server-key.pem&quot;</span><br><span class="line">  timeout:    2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">authorization &#123;</span><br><span class="line">  user:     derek</span><br><span class="line">  password: $2a$11$W2zko751KUvVy59mUTWmpOdWjpEm5qhcCZRd05GjI/sSOT.xtiHyG</span><br><span class="line">  timeout:  1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨https_porté€‰é¡¹å¯ç”¨ï¼Œåˆ™æ­¤TLSé…ç½®ä¹Ÿç”¨äºç›‘æ§ç«¯å£ã€‚</p>
<p>æœåŠ¡å™¨éœ€è¦è¯ä¹¦å’Œç§é’¥ã€‚ç”Ÿæˆè‡ªç­¾åè¯ä¹¦å’Œä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¶…å‡ºäº†æ­¤èŒƒå›´ï¼Œä½†é™¤äº†Googleæœç´¢ä¹‹å¤–ï¼Œæ­¤æ–‡æ¡£ä¹Ÿå¾ˆæœ‰å¸®åŠ©ï¼šhttpsï¼š//docs.docker.com/engine/articles/https/</p>
<p>å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°è¿è¡ŒæœåŠ¡å™¨ä»¥å¯ç”¨TLSåŠŸèƒ½ã€‚</p>
<ul>
<li><p>--help_tls      TLS å¸®åŠ©</p>
</li>
<li><p>--tls å¯ç”¨TLSï¼Œä¸éªŒè¯å®¢æˆ·ç«¯ï¼ˆé»˜è®¤ä¸ºfalseï¼‰</p>
</li>
<li><p>--tlscert FILE æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶</p>
</li>
<li><p>--tlskey FILE æœåŠ¡å™¨è¯ä¹¦ç§é’¥</p>
</li>
<li><p>--tlsverify å¯ç”¨TLSï¼Œæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½è¦è®¤è¯</p>
</li>
<li><p>--tlscacert FILE å®¢æˆ·ç«¯è¯ä¹¦CAç”¨äºè®¤è¯</p>
</li>
</ul>
<p>ä½¿ç”¨ä¸ºlocalhostå’Œ127.0.0.1è‡ªç­¾åçš„æµ‹è¯•è¯ä¹¦çš„ç¤ºä¾‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> ./nats-server --tls --tlscert=./<span class="built_in">test</span>/configs/certs/server-cert.pem --tlskey=./<span class="built_in">test</span>/configs/certs/server-key.pem</span></span><br><span class="line"></span><br><span class="line">[2935] 2016/04/26 13:34:30.685413 [INF] Starting nats-server version 0.8.0.beta</span><br><span class="line">[2935] 2016/04/26 13:34:30.685509 [INF] Listening for client connections on 0.0.0.0:4222</span><br><span class="line">[2935] 2016/04/26 13:34:30.685656 [INF] TLS required for client connections</span><br><span class="line">[2935] 2016/04/26 13:34:30.685660 [INF] Server is ready</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼Œæ—¥å¿—è¡¨æ˜å®¢æˆ·ç«¯è¿æ¥å°†éœ€è¦ä½¿ç”¨TLSã€‚å¦‚æœä½¿ç”¨-Dæˆ–-DVåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿è¡ŒæœåŠ¡å™¨ï¼Œåˆ™æ—¥å¿—å°†æ˜¾ç¤ºæ¯ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯çš„å¯†ç å¥—ä»¶é€‰æ‹©ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[15146] 2015/12/03 12:38:37.733139 [DBG] ::1:63330 - cid:1 - Starting TLS client connection handshake</span><br><span class="line">[15146] 2015/12/03 12:38:37.751948 [DBG] ::1:63330 - cid:1 - TLS handshake complete</span><br><span class="line">[15146] 2015/12/03 12:38:37.751959 [DBG] ::1:63330 - cid:1 - TLS version 1.2, cipher suite TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><br></pre></td></tr></table></figure>

<h3 id="TLSå¯†ç "><a href="#TLSå¯†ç " class="headerlink" title="TLSå¯†ç "></a>TLSå¯†ç </h3><p>æœåŠ¡å™¨éœ€è¦TLS 1.2ç‰ˆï¼Œå¹¶è®¾ç½®ç°ä»£å¯†ç å¥—ä»¶çš„é¦–é€‰é¡¹ï¼Œä»¥é¿å…å·²çŸ¥çš„æ¼æ´ã€‚ä½¿ç”¨Go1.5æ„å»ºæ—¶ï¼ŒæœåŠ¡å™¨çš„é»˜è®¤é¦–é€‰é¡¹å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">defaultCipherSuites</span><span class="params">()</span> []<span class="title">uint16</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> []<span class="keyword">uint16</span>&#123;</span><br><span class="line">    <span class="comment">// The SHA384 versions are only in Go1.5+</span></span><br><span class="line">    tls.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,</span><br><span class="line">    tls.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,</span><br><span class="line">    tls.TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,</span><br><span class="line">    tls.TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,</span><br><span class="line">    tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,</span><br><span class="line">    tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯é€‰åœ°ï¼Œå¦‚æœæ‚¨çš„ç»„ç»‡éœ€è¦ç‰¹å®šå¯†ç æˆ–å¯†ç åˆ—è¡¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨cipher_suitesé€‰é¡¹å¯¹å…¶è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tls &#123;</span><br><span class="line">  cert_file:  &quot;./configs/certs/server.pem&quot;</span><br><span class="line">  key_file:   &quot;./configs/certs/key.pem&quot;</span><br><span class="line">  timeout: 2</span><br><span class="line">  cipher_suites: [</span><br><span class="line">    &quot;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&quot;,</span><br><span class="line">    &quot;TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384&quot;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨ä½äºcipherMapå˜é‡ä¸­ã€‚</p>
<h3 id="å®¢æˆ·ç«¯TLSç›¸äº’èº«ä»½éªŒè¯"><a href="#å®¢æˆ·ç«¯TLSç›¸äº’èº«ä»½éªŒè¯" class="headerlink" title="å®¢æˆ·ç«¯TLSç›¸äº’èº«ä»½éªŒè¯"></a>å®¢æˆ·ç«¯TLSç›¸äº’èº«ä»½éªŒè¯</h3><p>å¯é€‰åœ°ï¼ŒæœåŠ¡å™¨å¯ä»¥è¦æ±‚å®¢æˆ·ç«¯éœ€è¦æä¾›è¯ä¹¦ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨CAæƒé™é…ç½®æœåŠ¡å™¨ä»¥éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚åªéœ€æ·»åŠ é€‰é¡¹éªŒè¯TLSé…ç½®éƒ¨åˆ†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tls &#123;</span><br><span class="line">  cert_file: &quot;./configs/certs/server-cert.pem&quot;</span><br><span class="line">  key_file:  &quot;./configs/certs/server-key.pem&quot;</span><br><span class="line">  ca_file:   &quot;./configs/certs/ca.pem&quot;</span><br><span class="line">  verify:    true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‚¨å¸Œæœ›æœåŠ¡å™¨é€šè¿‡å‘½ä»¤è¡Œå¼ºåˆ¶æ‰§è¡Œå¹¶éœ€è¦å®¢æˆ·ç«¯è¯ä¹¦ï¼Œè¯·ä½¿ç”¨æ­¤ç¤ºä¾‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> ./nats-server --tlsverify --tlscert=./<span class="built_in">test</span>/configs/certs/server-cert.pem --tlskey=./<span class="built_in">test</span>/configs/certs/server-key.pem --tlscacert=./<span class="built_in">test</span>/configs/certs/ca.pem</span></span><br></pre></td></tr></table></figure>

<p>æ­¤é€‰é¡¹ä»…éªŒè¯å®¢æˆ·ç«¯çš„è¯ä¹¦æ˜¯å¦å·²ç”±ca_fileé€‰é¡¹ä¸­æŒ‡å®šçš„CAç­¾åã€‚ä½†æ˜¯ï¼Œå®ƒä¸ä¼šå°†å®¢æˆ·ç«¯è¯ä¹¦çš„ä»»ä½•å±æ€§æ˜ å°„åˆ°ç”¨æˆ·çš„èº«ä»½ã€‚</p>
<p><code>è¦ä½¿TLSç›¸äº’èº«ä»½éªŒè¯å°†è¯ä¹¦å±æ€§æ˜ å°„åˆ°ç”¨æˆ·èº«ä»½ï¼Œè¯·å°†é€‰é¡¹</code>verify<code>æ›¿æ¢ä¸ºverify_and_map</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tls &#123;</span><br><span class="line">  cert_file: &quot;./configs/certs/server-cert.pem&quot;</span><br><span class="line">  key_file:  &quot;./configs/certs/server-key.pem&quot;</span><br><span class="line">  ca_file:   &quot;./configs/certs/ca.pem&quot;</span><br><span class="line">  # Require a client certificate and map user id from certificate</span><br><span class="line">  verify_and_map: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯ä¹¦å±æ€§æœ‰ä¸¤ä¸ªé€‰é¡¹å¯ä»¥æ˜ å°„åˆ°ç”¨æˆ·åã€‚ç¬¬ä¸€ä¸ªæ˜¯è¯ä¹¦çš„ä¸»é¢˜å¤‡ç”¨åç§°ï¼ˆSANï¼‰å­—æ®µä¸­çš„ç”µå­é‚®ä»¶åœ°å€ã€‚è™½ç„¶ä½¿ç”¨æ­¤å±æ€§ç”Ÿæˆè¯ä¹¦è¶…å‡ºäº†æœ¬æ–‡æ¡£çš„èŒƒå›´ï¼Œä½†æˆ‘ä»¬å°†ä½¿ç”¨OpenSSLæŸ¥çœ‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> openssl x509 -noout -text -<span class="keyword">in</span>  <span class="built_in">test</span>/configs/certs/client-id-auth-cert.pem</span></span><br><span class="line">Certificate:</span><br><span class="line">  -------------&lt;truncated&gt;-------------</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Subject Alternative Name:</span><br><span class="line">                DNS:localhost, IP Address:127.0.0.1, email:derek@nats.io</span><br><span class="line">            X509v3 Extended Key Usage:</span><br><span class="line">                TLS Web Client Authentication</span><br><span class="line">  -------------&lt;truncated&gt;-------------</span><br></pre></td></tr></table></figure>

<p>æˆæƒæ­¤ç”¨æˆ·çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  users = [</span><br><span class="line">    &#123;user: &quot;derek@nats.io&quot;, permissions: &#123; publish: &quot;foo&quot; &#125;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šå¦‚æœSANå­—æ®µä¸­æœ‰å¤šå°ç”µå­é‚®ä»¶ï¼Œåˆ™æ­¤é…ç½®ä»…é€‚ç”¨äºç¬¬ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€ã€‚</p>
<p>ç¬¬äºŒä¸ªé€‰é¡¹æ˜¯ä½¿ç”¨è¯ä¹¦ä¸»é¢˜ä¸­çš„RFC 2253å¯åˆ†è¾¨åç§°è¯­æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> openssl x509 -noout -text -<span class="keyword">in</span>  <span class="built_in">test</span>/configs/certs/tlsauth/client2.pem</span></span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">  -------------&lt;truncated&gt;-------------</span><br><span class="line">        Subject: OU=CNCF, CN=example.com</span><br><span class="line">  -------------&lt;truncated&gt;-------------</span><br></pre></td></tr></table></figure>

<p>æˆæƒæ­¤ç”¨æˆ·çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  users = [</span><br><span class="line">    &#123;user: &quot;CN=example.com,OU=CNCF&quot;, permissions: &#123; publish: &quot;foo&quot; &#125;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¾¤é›†TLSç›¸äº’èº«ä»½éªŒè¯"><a href="#ç¾¤é›†TLSç›¸äº’èº«ä»½éªŒè¯" class="headerlink" title="ç¾¤é›†TLSç›¸äº’èº«ä»½éªŒè¯"></a>ç¾¤é›†TLSç›¸äº’èº«ä»½éªŒè¯</h3><p>è®¾ç½®ç¾¤é›†æ—¶ï¼Œç¾¤é›†ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨ï¼ˆå¦‚æœä½¿ç”¨TLSï¼‰éƒ½å°†éªŒè¯è¿æ¥ç«¯ç‚¹å’ŒæœåŠ¡å™¨å“åº”ã€‚å› æ­¤ï¼ŒåŒå‘æ£€æŸ¥è¯ä¹¦ã€‚åªèƒ½ä¸ºæœåŠ¡å™¨çš„ç¾¤é›†æ ‡è¯†é…ç½®è¯ä¹¦ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¯ä¹¦ä¸ç¾¤é›†å½¢æˆåˆ†å¼€ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cluster &#123;</span><br><span class="line">  listen: 127.0.0.1:4244</span><br><span class="line"></span><br><span class="line">  tls &#123;</span><br><span class="line">    # Route cert</span><br><span class="line">    cert_file: &quot;./configs/certs/srva-cert.pem&quot;</span><br><span class="line">    # Private key</span><br><span class="line">    key_file:  &quot;./configs/certs/srva-key.pem&quot;</span><br><span class="line">    # Optional certificate authority verifying connected routes</span><br><span class="line">    # Required when we have self-signed CA, etc.</span><br><span class="line">    ca_file:   &quot;./configs/certs/ca.pem&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  # Routes are actively solicited and connected to from this server.</span><br><span class="line">  # Other servers can connect to us if they supply the correct credentials</span><br><span class="line">  # in their routes definitions from above.</span><br><span class="line">  routes = [</span><br><span class="line">    nats-route://127.0.0.1:4246</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨bcryptä¿æŠ¤å¯†ç "><a href="#ä½¿ç”¨bcryptä¿æŠ¤å¯†ç " class="headerlink" title="ä½¿ç”¨bcryptä¿æŠ¤å¯†ç "></a>ä½¿ç”¨bcryptä¿æŠ¤å¯†ç </h3><p>é™¤äº†TLSåŠŸèƒ½å¤–ï¼ŒæœåŠ¡å™¨ç°åœ¨è¿˜æ”¯æŒä½¿ç”¨<code>bcrypt</code>æ•£åˆ—å¯†ç å’Œèº«ä»½éªŒè¯ä»¤ç‰Œã€‚è¦åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œåªéœ€ä½¿ç”¨å…¶bcryptå“ˆå¸Œæ›¿æ¢é…ç½®ä¸­çš„æ˜æ–‡å¯†ç ï¼ŒæœåŠ¡å™¨å°†æ ¹æ®éœ€è¦è‡ªåŠ¨ä½¿ç”¨<code>bcrypt</code>ã€‚</p>
<p><code>nats-server</code>å‘è¡Œç‰ˆåŒ…å«ä¸€ä¸ªç”¨äºåˆ›å»º<code>bcrypt</code>å“ˆå¸Œçš„å®ç”¨ç¨‹åºï¼ˆ<code>util / mkpasswd.go</code>ï¼‰ã€‚ä¸å¸¦å‚æ•°è¿è¡Œå®ƒå°†ç”Ÿæˆæ–°çš„å®‰å…¨å¯†ç ä»¥åŠç›¸å…³çš„å“ˆå¸Œã€‚è¿™å¯ç”¨äºé…ç½®ä¸­çš„å¯†ç æˆ–ä»¤ç‰Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/go/src/github.com/nats-io/nats-server/util&gt; go get golang.org/x/crypto/ssh/terminal</span><br><span class="line">~/go/src/github.com/nats-io/nats-server/util&gt; go build mkpasswd.go</span><br><span class="line">~/go/src/github.com/nats-io/nats-server/util&gt; ./mkpasswd</span><br><span class="line">pass: #IclkRPHUpsTmACWzmIGXr</span><br><span class="line">bcrypt hash: $2a$11$3kIDaCxw.Glsl1.u5nKa6eUnNDLV5HV9tIuUp7EHhMt6Nm9myW1aS</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‚¨å·²ç»é€‰æ‹©äº†å¯†ç ï¼Œåˆ™å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šæä¾›-pæ ‡å¿—ï¼Œè¾“å…¥æ‰€éœ€çš„å¯†ç ï¼Œå¹¶ä¸ºå…¶ç”Ÿæˆbcryptå“ˆå¸Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/go/src/github.com/nats-io/nats-server/util&gt; ./mkpasswd -p</span><br><span class="line">Enter Password: *******</span><br><span class="line">Reenter Password: ******</span><br><span class="line">bcrypt hash: $2a$11$3kIDaCxw.Glsl1.u5nKa6eUnNDLV5HV9tIuUp7EHhMt6Nm9myW1aS</span><br></pre></td></tr></table></figure>

<p>å°†å“ˆå¸Œæ·»åŠ åˆ°æœåŠ¡å™¨é…ç½®æ–‡ä»¶çš„æˆæƒéƒ¨åˆ†ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  user: derek</span><br><span class="line">  password: $2a$11$3kIDaCxw.Glsl1.u5nKa6eUnNDLV5HV9tIuUp7EHhMt6Nm9myW1aS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NATSæœåŠ¡å™¨æˆæƒ"><a href="#NATSæœåŠ¡å™¨æˆæƒ" class="headerlink" title="NATSæœåŠ¡å™¨æˆæƒ"></a>NATSæœåŠ¡å™¨æˆæƒ</h2><p>NATSæœåŠ¡å™¨æ”¯æŒåŸºäºæ¯ä¸ªç”¨æˆ·ä½¿ç”¨ä¸»é¢˜çº§æƒé™çš„æˆæƒã€‚åŸºäºæƒé™çš„æˆæƒå¯ç”¨äºå¤šç”¨æˆ·èº«ä»½éªŒè¯ã€‚</p>
<p>æ¯ä¸ªæƒé™æˆäºˆéƒ½æ˜¯ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªå­—æ®µçš„å¯¹è±¡ï¼šç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯ä»¥å‘å¸ƒåˆ°å“ªäº›ä¸»é¢˜ï¼Œä»¥åŠç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯ä»¥è®¢é˜…å“ªäº›ä¸»é¢˜ã€‚è§£æå™¨æ…·æ…¨è§£é‡Šæ„å›¾æ˜¯ä»€ä¹ˆï¼Œå› æ­¤å¤„ç†æ•°ç»„å’Œå•ä¾‹ã€‚ä¸»é¢˜æœ¬èº«å¯ä»¥åŒ…å«é€šé…ç¬¦ã€‚æƒé™å¯ä»¥ä½¿ç”¨å˜é‡ã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡åœ¨æˆæƒé…ç½®å—å†…åˆ›å»ºç¬¦åˆä»¥ä¸‹è¯­æ³•çš„æ¡ç›®æ¥è®¾ç½®æƒé™ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  PERMISSION_NAME = &#123;</span><br><span class="line">    publish = &quot;singleton&quot; or [&quot;array&quot;, ...]</span><br><span class="line">    subscribe = &quot;singleton&quot; or [&quot;array&quot;, ...]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡è¦è¯´æ˜NATSæˆæƒä»…ä¸ºç™½åå•ï¼Œè¿™æ„å‘³ç€ä¸ºäº†ä¸ç ´åè¯·æ±‚/å›å¤æ¨¡å¼ï¼Œæ‚¨éœ€è¦ä½¿ç”¨Aliceå’ŒBobä¸º_INBOXã€‚&gt;æ¨¡å¼æ·»åŠ ä¸Šè¿°è§„åˆ™ã€‚å¦‚æœæœªç»æˆæƒçš„å®¢æˆ·ç«¯å‘å¸ƒæˆ–å°è¯•è®¢é˜…å°šæœªåˆ—å…¥ç™½åå•çš„ä¸»é¢˜ï¼Œåˆ™æ“ä½œå°†å¤±è´¥å¹¶è®°å½•åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¹¶å‘å®¢æˆ·ç«¯è¿”å›é”™è¯¯æ¶ˆæ¯ã€‚</p>
<h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹æˆæƒé…ç½®ï¼Œå®ƒå®šä¹‰äº†å››ä¸ªç”¨æˆ·ï¼Œå…¶ä¸­ä¸‰ä¸ªç”¨æˆ·è¢«åˆ†é…äº†æ˜¾å¼æƒé™ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  ADMIN = &#123;</span><br><span class="line">    publish = &quot;&gt;&quot;</span><br><span class="line">    subscribe = &quot;&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  REQUESTOR = &#123;</span><br><span class="line">    publish = [&quot;req.foo&quot;, &quot;req.bar&quot;]</span><br><span class="line">    subscribe = &quot;_INBOX.&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  RESPONDER = &#123;</span><br><span class="line">    subscribe = [&quot;req.foo&quot;, &quot;req.bar&quot;]</span><br><span class="line">    publish = &quot;_INBOX.&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  DEFAULT_PERMISSIONS = &#123;</span><br><span class="line">    publish = &quot;SANDBOX.*&quot;</span><br><span class="line">    subscribe = [&quot;PUBLIC.&gt;&quot;, &quot;_INBOX.&gt;&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">  PASS: abcdefghijklmnopqrstuvwxwz0123456789</span><br><span class="line">  users = [</span><br><span class="line">    &#123;user: joe,     password: foo,   permissions: $ADMIN&#125;</span><br><span class="line">    &#123;user: alice,   password: bar,   permissions: $REQUESTOR&#125;</span><br><span class="line">    &#123;user: bob,     password: $PASS, permissions: $RESPONDER&#125;</span><br><span class="line">    &#123;user: charlie, password: bar&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äºJoeæ˜¯ADMINï¼Œä»–å¯ä»¥å‘å¸ƒ/è®¢é˜…ä»»ä½•ä¸»é¢˜ã€‚æˆ‘ä»¬ä½¿ç”¨é€šé…ç¬¦&gt;æ¥åŒ¹é…ä»»ä½•ä¸»é¢˜ã€‚</p>
<p>Aliceæ˜¯ä¸€ä¸ªè¯·æ±‚è€…ï¼Œå¯ä»¥åœ¨ä¸»é¢˜<code>req.foo</code>æˆ–<code>req.bar</code>ä¸Šå‘å¸ƒè¯·æ±‚ï¼Œå¹¶è®¢é˜…ä»»ä½•å“åº”ï¼ˆ<code>_INBOX.&gt;</code>ï¼‰ã€‚</p>
<p>Charlieæ²¡æœ‰æˆäºˆæƒé™ï¼Œå› æ­¤ç»§æ‰¿äº†é»˜è®¤æƒé™é›†ã€‚æ‚¨å¯ä»¥é€šè¿‡å°†ç»§æ‰¿çš„é»˜è®¤æƒé™åˆ†é…ç»™æˆæƒé…ç½®å—å†…çš„default_permissionsæ¡ç›®æ¥è®¾ç½®å®ƒä»¬ã€‚</p>
<p>Bobæ˜¯Aliceçš„ä»»ä½•è¯·æ±‚çš„å“åº”è€…ï¼Œå› æ­¤Bobéœ€è¦èƒ½å¤Ÿè®¢é˜…è¯·æ±‚ä¸»é¢˜å¹¶å›å¤Aliceçš„å›å¤ä¸»é¢˜ï¼Œè¿™å°†æ˜¯ä¸€ä¸ª<code>_INBOX.&gt;</code>ã€‚</p>
<h2 id="NATSæœåŠ¡å™¨é…ç½®"><a href="#NATSæœåŠ¡å™¨é…ç½®" class="headerlink" title="NATSæœåŠ¡å™¨é…ç½®"></a>NATSæœåŠ¡å™¨é…ç½®</h2><p>æ‚¨å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶æ¥é…ç½®NATSæœåŠ¡å™¨ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ä¾¦å¬ç«¯å£</li>
<li>HTTPç›‘æ§ç«¯å£</li>
<li>å®¢æˆ·ç«¯è®¤è¯</li>
<li>ç¾¤é›†å®šä¹‰</li>
<li>é›†ç¾¤è·¯çº¿</li>
<li>æ—¥å¿—</li>
<li>æœ€å¤§å®¢æˆ·ç«¯è¿æ¥</li>
<li>æœ€å¤§æœ‰æ•ˆè½½è·</li>
</ul>
<p>æ­¤å¤–ï¼ŒæœåŠ¡å™¨é…ç½®è¯­è¨€æ”¯æŒç”¨äºè‡ªåŠ¨åŒ–çš„å—èŒƒå›´å˜é‡ã€‚</p>
<h3 id="é…ç½®æ–‡ä»¶æ ¼å¼"><a href="#é…ç½®æ–‡ä»¶æ ¼å¼" class="headerlink" title="é…ç½®æ–‡ä»¶æ ¼å¼"></a>é…ç½®æ–‡ä»¶æ ¼å¼</h3><p>æœåŠ¡å™¨é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯ä¸€ç§çµæ´»çš„æ ¼å¼ï¼Œå®ƒç»“åˆäº†ä¼ ç»Ÿé…ç½®æ ¼å¼ä¸­çš„æœ€ä½³æ ¼å¼ä»¥åŠJSONå’ŒYAMLç­‰è¾ƒæ–°çš„æ ·å¼ã€‚</p>
<p>é…ç½®æ–‡ä»¶æ ¼å¼æ”¯æŒä»¥ä¸‹è¯­æ³•ï¼š</p>
<ul>
<li>Mixed Arrays: <code>[...]</code></li>
<li>Nested Maps: <code>&#123;...&#125;</code></li>
<li>Multiple comment types: <code>#</code> and <code>//</code></li>
<li>Key value assignments using:<ul>
<li>Equals sign (<code>foo = 2</code>)</li>
<li>Colon (<code>foo: 2</code>)</li>
<li>Whitespace (<code>foo 2</code>)</li>
</ul>
</li>
<li>Maps can be assigned with no key separator</li>
<li>Semicolons as value terminators in key/value assignments are optional</li>
</ul>
<p>é€šå¸¸ï¼Œé…ç½®å‚æ•°ä¸å‘½ä»¤è¡Œå‚æ•°ç›¸åŒã€‚ä½†è¯·æ³¨æ„ä»¥ä¸‹å·®å¼‚ï¼š</p>
<ul>
<li>The listen option is host:port for connections, on the server command line it is -a and -p, no hostport is supported.</li>
<li>http/https  is only a port on the command line, on the config it is host:port  (thereâ€™s no config flag for the interface for the monitoring)</li>
<li>The  -cluster flag is used for defining the host:port where routes can be  solicited, on the config file this is called â€˜listenâ€™ as part property  of a â€˜clusterâ€™ object.</li>
</ul>
<h3 id="ç¤ºä¾‹æœåŠ¡å™¨é…ç½®æ–‡ä»¶"><a href="#ç¤ºä¾‹æœåŠ¡å™¨é…ç½®æ–‡ä»¶" class="headerlink" title="ç¤ºä¾‹æœåŠ¡å™¨é…ç½®æ–‡ä»¶"></a>ç¤ºä¾‹æœåŠ¡å™¨é…ç½®æ–‡ä»¶</h3><p>ä»¥ä¸‹æ¼”ç¤ºäº†NATSæœåŠ¡å™¨é…ç½®æ–‡ä»¶çš„ç¤ºä¾‹ã€‚å¦è¯·å‚è§NATSæœåŠ¡å™¨è‡ªè¿°æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">port: 4242      # port to listen for client connections</span><br><span class="line">net: localhost # optional listen interface, default is 0.0.0.0 (all)</span><br><span class="line"></span><br><span class="line">http_port: 8222 # HTTP monitoring port</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Authorization <span class="keyword">for</span> client connections</span></span><br><span class="line">authorization &#123;</span><br><span class="line">  user:     derek</span><br><span class="line"><span class="meta">  #</span><span class="bash"> ./util/mkpasswd -p T0pS3cr3t</span></span><br><span class="line">    password: $2a$11$W2zko751KUvVy59mUTWmpOdWjpEm5qhcCZRd05GjI/sSOT.xtiHyG</span><br><span class="line">  timeout:  1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Cluster definition</span></span><br><span class="line">cluster &#123;</span><br><span class="line"></span><br><span class="line">  listen: localhost:4244 # host/port for inbound route connections</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Authorization <span class="keyword">for</span> route connections</span></span><br><span class="line">  authorization &#123;</span><br><span class="line">    user: route_user</span><br><span class="line">    # ./util/mkpasswd -p T0pS3cr3tT00!</span><br><span class="line">        password: $2a$11$xH8dkGrty1cBNtZjhPeWJewu/YPbSU.rXJWmS6SFilOBXzmZoMk9m</span><br><span class="line">    timeout: 0.5</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Routes are actively solicited and connected to from this server.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Other servers can connect to us <span class="keyword">if</span> they supply the correct credentials</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> <span class="keyword">in</span> their routes definitions from above.</span></span><br><span class="line">  routes = [</span><br><span class="line">    nats-route://user1:pass1@127.0.0.1:4245</span><br><span class="line">    nats-route://user2:pass2@127.0.0.1:4246</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> logging options</span></span><br><span class="line">debug:   false</span><br><span class="line">trace:   true</span><br><span class="line">logtime: false</span><br><span class="line">log_file: &quot;/tmp/nats-server.log&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> pid file</span></span><br><span class="line">pid_file: &quot;/tmp/nats-server.pid&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Some system overides</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> max_connections</span></span><br><span class="line">max_connections: 100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> maximum protocol control line</span></span><br><span class="line">max_control_line: 512</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> maximum payload</span></span><br><span class="line">max_payload: 65536</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Duration the server can block on a socket write to a client.  Exceeding the </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> deadline will designate a client as a slow consumer.</span></span><br><span class="line"> write_deadline: &quot;2s&quot;</span><br></pre></td></tr></table></figure>

<h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p>NATSæœåŠ¡å™¨é…ç½®æ–‡ä»¶æ ¼å¼æ”¯æŒä½¿ç”¨å—èŒƒå›´çš„å˜é‡ï¼Œè¿™äº›å˜é‡å¯ç”¨äºé…ç½®æ–‡ä»¶ä¸­çš„æ¨¡æ¿ï¼Œç‰¹åˆ«æ˜¯å¯ä»¥è½»æ¾è®¾ç½®æƒé™å­—æ®µçš„ç»„å€¼ã€‚</p>
<p>å˜é‡å¯ä»¥é€šè¿‡å‰ç¼€$å¼•ç”¨ï¼Œä¾‹å¦‚$ PASSWORDã€‚ å˜é‡å¯ä»¥åœ¨é…ç½®æ–‡ä»¶æœ¬èº«æˆ–å‚è€ƒç¯å¢ƒå˜é‡ä¸­å®šä¹‰ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">authorization &#123;</span><br><span class="line">  PASS: abcdefghijklmnopqrstuvwxyz0123456789</span><br><span class="line">  users = [</span><br><span class="line">    &#123;user: alice, password: foo&#125;</span><br><span class="line">    &#123;user: bob,   password: bar&#125;</span><br><span class="line">    &#123;user: joe,   password: $PASS&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ„å»ºNATSæœåŠ¡å™¨ç¾¤é›†"><a href="#æ„å»ºNATSæœåŠ¡å™¨ç¾¤é›†" class="headerlink" title="æ„å»ºNATSæœåŠ¡å™¨ç¾¤é›†"></a>æ„å»ºNATSæœåŠ¡å™¨ç¾¤é›†</h2><p>NATSæ”¯æŒä»¥ç¾¤é›†æ¨¡å¼è¿è¡Œæ¯ä¸ªæœåŠ¡å™¨ã€‚æ‚¨å¯ä»¥å°†æœåŠ¡å™¨é›†ç¾¤åœ¨ä¸€èµ·ï¼Œä»¥å®ç°é«˜å®¹é‡é‚®ä»¶ç³»ç»Ÿä»¥åŠå¼¹æ€§å’Œé«˜å¯ç”¨æ€§ã€‚å®¢æˆ·ç«¯æ˜¯ç¾¤é›†æ„ŸçŸ¥çš„ã€‚</p>
<p>è¯·æ³¨æ„ï¼ŒNATSç¾¤é›†æœåŠ¡å™¨çš„è½¬å‘é™åˆ¶ä¸ºä¸€è·³ã€‚è¿™æ„å‘³ç€æ¯ä¸ªnats-serverå®ä¾‹åªä¼šå°†ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„æ¶ˆæ¯è½¬å‘åˆ°å®ƒæœ‰è·¯ç”±çš„ç´§é‚»çš„nats-serverå®ä¾‹ã€‚ä»è·¯ç”±æ¥æ”¶çš„æ¶ˆæ¯å°†ä»…åˆ†å‘ç»™æœ¬åœ°å®¢æˆ·ç«¯ã€‚å› æ­¤ï¼Œå»ºè®®ä½¿ç”¨å…¨ç½‘çŠ¶é›†ç¾¤æˆ–å®Œæ•´å›¾è¡¨ï¼Œä»¥ä½¿NATSæŒ‰é¢„æœŸè¿è¡Œï¼Œå¹¶åœ¨æ•´ä¸ªæ–‡æ¡£ä¸­è¿›è¡Œæè¿°ã€‚</p>
<h3 id="ç¾¤é›†URL"><a href="#ç¾¤é›†URL" class="headerlink" title="ç¾¤é›†URL"></a>ç¾¤é›†URL</h3><p>é™¤äº†ç”¨äºä¾¦å¬å®¢æˆ·ç«¯çš„ç«¯å£ä¹‹å¤–ï¼Œnats-serverè¿˜å¯ä»¥ä¾¦å¬â€œé›†ç¾¤â€URLï¼ˆ-clusteré€‰é¡¹ï¼‰ã€‚ç„¶åï¼Œå…¶ä»–nats-serveræœåŠ¡å™¨å¯ä»¥å°†è¯¥URLæ·»åŠ åˆ°å…¶-routeså‚æ•°ä»¥åŠ å…¥ç¾¤é›†ã€‚è¿™äº›é€‰é¡¹ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šï¼Œä½†ä¸ºç®€å•èµ·è§ï¼Œæœ¬æ¦‚è¿°ä¸­ä»…æ˜¾ç¤ºå‘½ä»¤è¡Œç‰ˆæœ¬ã€‚<br><strong>æ²¡æœ‰ç¾¤é›†è¿è¡Œ</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -p 4222</span><br></pre></td></tr></table></figure>

<p><strong>è¿è¡Œç®€å•ç¾¤é›†</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Server A on 10.10.0.1</span></span><br><span class="line">nats-server -p 4222 -cluster nats://10.10.0.1:5222</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Server B on 10.10.0.2</span></span><br><span class="line">nats-server -p 4222 -cluster nats://10.10.0.2:5222 -routes nats://10.10.0.1:5222</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Server A on 10.10.0.1</span></span><br><span class="line">nats-server -p 4222 -cluster nats://10.10.0.1:5222 -routes nats://10.10.0.2:5222</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Server B on 10.10.0.2</span></span><br><span class="line">nats-server -p 4222 -cluster nats://10.10.0.2:5222 -routes nats://10.10.0.1:5222</span><br></pre></td></tr></table></figure>

<p>è¿æ¥åˆ°ç¾¤é›†ä¸­ä»»ä½•æœåŠ¡å™¨çš„å®¢æˆ·ç«¯å°†ä¿æŒè¿æ¥åˆ°ç¾¤é›†ï¼Œå³ä½¿å®ƒæœ€åˆè¿æ¥åˆ°çš„æœåŠ¡å™¨å·²å…³é—­ï¼Œåªè¦è‡³å°‘ä¿ç•™ä¸€ä¸ªæœåŠ¡å™¨å³å¯ã€‚</p>
<h3 id="å‘½ä»¤è¡Œé€‰é¡¹-2"><a href="#å‘½ä»¤è¡Œé€‰é¡¹-2" class="headerlink" title="å‘½ä»¤è¡Œé€‰é¡¹"></a>å‘½ä»¤è¡Œé€‰é¡¹</h3><p>æ”¯æŒä»¥ä¸‹ç¾¤é›†é€‰é¡¹ï¼š</p>
<ul>
<li>--routes [rurl-1ï¼Œrurl-2]è·¯çº¿å¾æ±‚å’Œè¿æ¥</li>
<li>--cluster nats://host:portè¯·æ±‚è·¯ç”±çš„é›†ç¾¤URL</li>
</ul>
<p>å½“NATSæœåŠ¡å™¨è·¯ç”±åˆ°æŒ‡å®šçš„URLæ—¶ï¼Œå®ƒä¼šå°†è‡ªå·±çš„é›†ç¾¤URLé€šå‘Šç»™è·¯ç”±è·¯ç”±ä¸­çš„æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨ï¼Œä»è€Œæœ‰æ•ˆåœ°ä¸ºæ‰€æœ‰å…¶ä»–æœåŠ¡å™¨åˆ›å»ºè·¯ç”±ç½‘æ ¼ã€‚</p>
<p>æ³¨æ„ï¼šä½¿ç”¨-routesé€‰é¡¹æ—¶ï¼Œè¿˜å¿…é¡»æŒ‡å®š-clusteré€‰é¡¹ã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶é…ç½®ç¾¤é›†ã€‚</p>
<h3 id="ä¸‰ä¸ªæœåŠ¡å™¨ç¾¤é›†ç¤ºä¾‹"><a href="#ä¸‰ä¸ªæœåŠ¡å™¨ç¾¤é›†ç¤ºä¾‹" class="headerlink" title="ä¸‰ä¸ªæœåŠ¡å™¨ç¾¤é›†ç¤ºä¾‹"></a>ä¸‰ä¸ªæœåŠ¡å™¨ç¾¤é›†ç¤ºä¾‹</h3><p>ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•åœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œ3ä¸ªæœåŠ¡å™¨çš„é›†ç¾¤ã€‚æˆ‘ä»¬å°†ä»ç§å­æœåŠ¡å™¨å¼€å§‹ï¼Œå¹¶ä½¿ç”¨-Då‘½ä»¤è¡Œå‚æ•°æ¥ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -p 4222 -cluster nats://localhost:4248 -D</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºseed.confï¼Œå…¶å†…å®¹ç±»ä¼¼äºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Cluster Seed Node</span><br><span class="line"></span><br><span class="line">listen: 127.0.0.1:4222</span><br><span class="line">http: 8222</span><br><span class="line"></span><br><span class="line">cluster &#123;</span><br><span class="line">  listen: 127.0.0.1:4248</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶åƒè¿™æ ·å¯åŠ¨æœåŠ¡å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -config ./seed.conf -D</span><br></pre></td></tr></table></figure>

<p>è¿™å°†äº§ç”Ÿç±»ä¼¼äºçš„è¾“å‡ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[75653] 2016/04/26 15:14:47.339321 [INF] Listening for route connections on 127.0.0.1:4248</span><br><span class="line">[75653] 2016/04/26 15:14:47.340787 [INF] Listening for client connections on 127.0.0.1:4222</span><br><span class="line">[75653] 2016/04/26 15:14:47.340822 [DBG] server id is xZfu3u7usAPWkuThomoGzM</span><br><span class="line">[75653] 2016/04/26 15:14:47.340825 [INF] server is ready</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥å•ç‹¬æŒ‡å®šä¸»æœºåå’Œç«¯å£ã€‚è‡³å°‘éœ€è¦ç«¯å£ã€‚å¦‚æœæ‚¨ä¿ç•™ä¸»æœºåï¼Œå®ƒå°†ç»‘å®šåˆ°æ‰€æœ‰æ¥å£ï¼ˆ&#39;0.0.0.0&#39;ï¼‰ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cluster &#123;</span><br><span class="line">  host: 127.0.0.1</span><br><span class="line">  port: 4248</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è®©æˆ‘ä»¬å†å¯åŠ¨ä¸¤å°æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨éƒ½è¿æ¥åˆ°ç§å­æœåŠ¡å™¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -p 5222 -cluster nats://localhost:5248 -routes nats://localhost:4248 -D</span><br></pre></td></tr></table></figure>

<p>å½“åœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå®¢æˆ·ç«¯è¿æ¥é€‰æ‹©ä¸åŒçš„ç«¯å£<code>-p</code>ï¼Œå¹¶ä¸ºç”¨äºæ¥å—å…¶ä»–è·¯ç”±çš„ç«¯å£é€‰æ‹©<code>-cluster</code>ã€‚è¯·æ³¨æ„ï¼Œ<code>-routes</code>æŒ‡å‘ç§å­æœåŠ¡å™¨çš„<code>-cluster</code>åœ°å€ï¼ˆ<code>localhost:4248</code>ï¼‰ã€‚</p>
<p>è¿™æ˜¯ç”Ÿæˆçš„æ—¥å¿—ã€‚äº†è§£å®ƒå¦‚ä½•è¿æ¥å¹¶æ³¨å†Œåˆ°ç§å­æœåŠ¡å™¨çš„è·¯ç”±ï¼ˆ... GzMï¼‰ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[75665] 2016/04/26 15:14:59.970014 [INF] Listening for route connections on localhost:5248</span><br><span class="line">[75665] 2016/04/26 15:14:59.971150 [INF] Listening for client connections on 0.0.0.0:5222</span><br><span class="line">[75665] 2016/04/26 15:14:59.971176 [DBG] server id is 53Yi78q96t52QdyyWLKIyE</span><br><span class="line">[75665] 2016/04/26 15:14:59.971179 [INF] server is ready</span><br><span class="line">[75665] 2016/04/26 15:14:59.971199 [DBG] Trying to connect to route on localhost:4248</span><br><span class="line">[75665] 2016/04/26 15:14:59.971551 [DBG] 127.0.0.1:4248 - rid:1 - Route connection created</span><br><span class="line">[75665] 2016/04/26 15:14:59.971559 [DBG] 127.0.0.1:4248 - rid:1 - Route connect msg sent</span><br><span class="line">[75665] 2016/04/26 15:14:59.971720 [DBG] 127.0.0.1:4248 - rid:1 - Registering remote route &quot;xZfu3u7usAPWkuThomoGzM&quot;</span><br><span class="line">[75665] 2016/04/26 15:14:59.971731 [DBG] 127.0.0.1:4248 - rid:1 - Route sent local subscriptions</span><br></pre></td></tr></table></figure>

<p>ä»ç§å­çš„æœåŠ¡å™¨æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°è·¯ç”±ç¡®å®è¢«æ¥å—ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[75653] 2016/04/26 15:14:59.971602 [DBG] 127.0.0.1:52679 - rid:1 - Route connection created</span><br><span class="line">[75653] 2016/04/26 15:14:59.971733 [DBG] 127.0.0.1:52679 - rid:1 - Registering remote route &quot;53Yi78q96t52QdyyWLKIyE&quot;</span><br><span class="line">[75653] 2016/04/26 15:14:59.971739 [DBG] 127.0.0.1:52679 - rid:1 - Route sent local subscriptions</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œè®©æˆ‘ä»¬å¯åŠ¨ç¬¬ä¸‰å°æœåŠ¡å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -p 6222 -cluster nats://localhost:6248 -routes nats://localhost:4248 -D</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„å®¢æˆ·ç«¯ç«¯å£å’Œé›†ç¾¤åœ°å€ï¼Œä½†ä»æŒ‡å‘åœ°å€ä¸º<code>nats:// localhost:4248</code>çš„ç›¸åŒç§å­æœåŠ¡å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[75764] 2016/04/26 15:19:11.528185 [INF] Listening for route connections on localhost:6248</span><br><span class="line">[75764] 2016/04/26 15:19:11.529787 [INF] Listening for client connections on 0.0.0.0:6222</span><br><span class="line">[75764] 2016/04/26 15:19:11.529829 [DBG] server id is IRepas80TBwJByULX1ulAp</span><br><span class="line">[75764] 2016/04/26 15:19:11.529842 [INF] server is ready</span><br><span class="line">[75764] 2016/04/26 15:19:11.529872 [DBG] Trying to connect to route on localhost:4248</span><br><span class="line">[75764] 2016/04/26 15:19:11.530272 [DBG] 127.0.0.1:4248 - rid:1 - Route connection created</span><br><span class="line">[75764] 2016/04/26 15:19:11.530281 [DBG] 127.0.0.1:4248 - rid:1 - Route connect msg sent</span><br><span class="line">[75764] 2016/04/26 15:19:11.530408 [DBG] 127.0.0.1:4248 - rid:1 - Registering remote route &quot;xZfu3u7usAPWkuThomoGzM&quot;</span><br><span class="line">[75764] 2016/04/26 15:19:11.530414 [DBG] 127.0.0.1:4248 - rid:1 - Route sent local subscriptions</span><br><span class="line">[75764] 2016/04/26 15:19:11.530595 [DBG] 127.0.0.1:52727 - rid:2 - Route connection created</span><br><span class="line">[75764] 2016/04/26 15:19:11.530659 [DBG] 127.0.0.1:52727 - rid:2 - Registering remote route &quot;53Yi78q96t52QdyyWLKIyE&quot;</span><br><span class="line">[75764] 2016/04/26 15:19:11.530664 [DBG] 127.0.0.1:52727 - rid:2 - Route sent local subscriptions</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆï¼Œä¸ºç§å­æœåŠ¡å™¨ï¼ˆ... GzMï¼‰åˆ›å»ºä¸€ä¸ªè·¯ç”±ï¼Œç„¶åï¼Œæ¥å—æ¥è‡ª... IyEçš„è·¯ç”± - è¿™æ˜¯ç¬¬äºŒä¸ªæœåŠ¡å™¨çš„IDã€‚</p>
<p>ç§å­æœåŠ¡å™¨çš„æ—¥å¿—æ˜¾ç¤ºå®ƒæ¥å—äº†æ¥è‡ªç¬¬ä¸‰å°æœåŠ¡å™¨çš„è·¯ç”±ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[75653] 2016/04/26 15:19:11.530308 [DBG] 127.0.0.1:52726 - rid:2 - Route connection created</span><br><span class="line">[75653] 2016/04/26 15:19:11.530384 [DBG] 127.0.0.1:52726 - rid:2 - Registering remote route &quot;IRepas80TBwJByULX1ulAp&quot;</span><br><span class="line">[75653] 2016/04/26 15:19:11.530389 [DBG] 127.0.0.1:52726 - rid:2 - Route sent local subscriptions</span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”æ¥è‡ªç¬¬äºŒå°æœåŠ¡å™¨çš„æ—¥å¿—æ˜¾ç¤ºå®ƒè¿æ¥åˆ°ç¬¬ä¸‰å°æœåŠ¡å™¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[75665] 2016/04/26 15:19:11.530469 [DBG] Trying to connect to route on 127.0.0.1:6248</span><br><span class="line">[75665] 2016/04/26 15:19:11.530565 [DBG] 127.0.0.1:6248 - rid:2 - Route connection created</span><br><span class="line">[75665] 2016/04/26 15:19:11.530570 [DBG] 127.0.0.1:6248 - rid:2 - Route connect msg sent</span><br><span class="line">[75665] 2016/04/26 15:19:11.530644 [DBG] 127.0.0.1:6248 - rid:2 - Registering remote route &quot;IRepas80TBwJByULX1ulAp&quot;</span><br><span class="line">[75665] 2016/04/26 15:19:11.530650 [DBG] 127.0.0.1:6248 - rid:2 - Route sent local subscriptions</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼Œæœ‰ä¸€ä¸ªå®Œæ•´çš„ç½‘çŠ¶NATSæœåŠ¡å™¨é›†ç¾¤ã€‚<br><strong>æµ‹è¯•ç¾¤é›†</strong></p>
<p>ç°åœ¨ï¼Œä»¥ä¸‹åº”è¯¥å·¥ä½œï¼šè®¢é˜…èŠ‚ç‚¹Aç„¶åå‘å¸ƒåˆ°èŠ‚ç‚¹C.æ‚¨åº”è¯¥èƒ½å¤Ÿæ¯«æ— é—®é¢˜åœ°æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nats-sub -s &quot;nats://192.168.59.103:7222&quot; hello &amp;</span><br><span class="line"></span><br><span class="line">nats-pub -s &quot;nats://192.168.59.105:7222&quot; hello world</span><br><span class="line"></span><br><span class="line"><span class="meta">[#</span><span class="bash">1] Received on [hello] : <span class="string">&#x27;world&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GNATSD on Node C logs:</span></span><br><span class="line">[1] 2015/06/23 05:20:31.100032 [TRC] 192.168.59.103:7244 - rid:2 - &lt;&lt;- [MSG hello RSID:8:2 5]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GNATSD on Node A logs:</span></span><br><span class="line">[1] 2015/06/23 05:20:31.100600 [TRC] 10.0.2.2:51007 - cid:8 - &lt;&lt;- [MSG hello 2 5]</span><br></pre></td></tr></table></figure>

<h2 id="å®¹å™¨åŒ–NATSæœåŠ¡å™¨"><a href="#å®¹å™¨åŒ–NATSæœåŠ¡å™¨" class="headerlink" title="å®¹å™¨åŒ–NATSæœåŠ¡å™¨"></a>å®¹å™¨åŒ–NATSæœåŠ¡å™¨</h2><p>NATSæœåŠ¡å™¨ä½œä¸ºDocker Hubä¸Šçš„Dockeré•œåƒæä¾›ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Dockerå®ˆæŠ¤ç¨‹åºè¿è¡Œã€‚ NATSæœåŠ¡å™¨Dockeré•œåƒéå¸¸è½»å·§ï¼Œå¤§å°ä¸åˆ°10 MBã€‚</p>
<p>Synadiaç§¯æç»´æŠ¤å’Œæ”¯æŒNATSæœåŠ¡å™¨Dockeré•œåƒã€‚<br>ç”¨æ³•</p>
<p>è¦ä½¿ç”¨Dockerå®¹å™¨æ˜ åƒï¼Œè¯·å®‰è£…Dockerå¹¶æ‹‰å‡ºå…¬å…±æ˜ åƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nats</span><br></pre></td></tr></table></figure>

<p>è¿è¡ŒNATSæœåŠ¡å™¨é•œåƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nats-main nats</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNATSæœåŠ¡å™¨å…¬å¼€å¤šä¸ªç«¯å£ï¼š</p>
<ul>
<li>4222 is for clients.</li>
<li>8222 is an HTTP management port for information reporting.</li>
<li>6222 is a routing port for clustering.</li>
<li>Use -p or -P to customize.</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --name nats-main nats</span></span><br><span class="line">[INF] Starting nats-server version 0.6.6</span><br><span class="line">[INF] Starting http monitor on port 8222</span><br><span class="line">[INF] Listening for route connections on 0.0.0.0:6222</span><br><span class="line">[INF] Listening for client connections on 0.0.0.0:4222</span><br><span class="line">[INF] nats-server is ready</span><br></pre></td></tr></table></figure>

<p>è¦ä¸ä¸»æœºä¸Šå…¬å¼€çš„ç«¯å£ä¸€èµ·è¿è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 4222ï¼š4222 -p 6222ï¼š6222 -p 8222ï¼š8222 --name nats-main nats</span><br></pre></td></tr></table></figure>

<p>è¦è¿è¡Œç¬¬äºŒå°æœåŠ¡å™¨å¹¶å°†å®ƒä»¬èšé›†åœ¨ä¸€èµ·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name = nats-2 --link nats-main nats --routes = nats-routeï¼š// ruserï¼šT0pS3cr3t @ nats-mainï¼š6222</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ç”±äºDockeré•œåƒä½¿ç”¨å‡­æ®ä¿æŠ¤è·¯ç”±ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸Šé¢æä¾›å®ƒä»¬ã€‚ä»<a target="_blank" rel="noopener" href="https://github.com/nats-io/nats-docker/blob/master/amd64/nats-server.conf#L16-L20">Dockeré•œåƒé…ç½®ä¸­æå–</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Routes are protected, so need to use them with --routes flag</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> e.g. --routes=nats-route://ruser:T0pS3cr3t@otherdockerhost:6222</span></span><br><span class="line">authorization &#123;</span><br><span class="line">  user: ruser</span><br><span class="line">  password: T0pS3cr3t</span><br><span class="line">  timeout: 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦éªŒè¯è·¯ç”±æ˜¯å¦å·²è¿æ¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --name=nats-2 --link nats-main nats --routes=nats-route://ruser:T0pS3cr3t@nats-main:6222 -DV</span></span><br><span class="line">[INF] Starting nats-server version 0.6.6</span><br><span class="line">[INF] Starting http monitor on port 8222</span><br><span class="line">[INF] Listening for route connections on :6222</span><br><span class="line">[INF] Listening for client connections on 0.0.0.0:4222</span><br><span class="line">[INF] nats-server is ready</span><br><span class="line">[DBG] Trying to connect to route on nats-main:6222</span><br><span class="line">[DBG] 172.17.0.52:6222 - rid:1 - Route connection created</span><br><span class="line">[DBG] 172.17.0.52:6222 - rid:1 - Route connect msg sent</span><br><span class="line">[DBG] 172.17.0.52:6222 - rid:1 - Registering remote route &quot;ee35d227433a738c729f9422a59667bb&quot;</span><br><span class="line">[DBG] 172.17.0.52:6222 - rid:1 - Route sent local subscriptions</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨Dockerè¿›è¡Œç¾¤é›†"><a href="#ä½¿ç”¨Dockerè¿›è¡Œç¾¤é›†" class="headerlink" title="ä½¿ç”¨Dockerè¿›è¡Œç¾¤é›†"></a>ä½¿ç”¨Dockerè¿›è¡Œç¾¤é›†</h3><p>ä¸‹é¢æ˜¯ä¸€äº›å¦‚ä½•ä½¿ç”¨Dockerè®¾ç½®nats-serveré›†ç¾¤çš„ç¤ºä¾‹ã€‚æˆ‘ä»¬åœ¨åä¸ºconfçš„æ–‡ä»¶å¤¹ä¸‹æ”¾ç½®äº†3ç§ä¸åŒçš„é…ç½®ï¼ˆæ¯ä¸ªnats-serveræœåŠ¡å™¨ä¸€ä¸ªï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|-- conf</span><br><span class="line">    |-- nats-server-A.conf</span><br><span class="line">    |-- nats-server-B.conf</span><br><span class="line">    |-- nats-server-C.conf</span><br></pre></td></tr></table></figure>

<p>è¿™äº›æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªéƒ½å…·æœ‰ä»¥ä¸‹å†…å®¹:(è¿™é‡Œæˆ‘ä½¿ç”¨ip 192.168.59.103ä½œä¸ºç¤ºä¾‹ï¼Œæ‰€ä»¥åªéœ€ç”¨æœåŠ¡å™¨ä¸­çš„æ­£ç¡®ipæ›¿æ¢ï¼‰<br><strong>ç¤ºä¾‹1ï¼šåœ¨é¢„å…ˆé…ç½®çš„3ä¸ªä¸åŒæœåŠ¡å™¨ä¸Šè®¾ç½®é›†ç¾¤</strong></p>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¸‰ä¸ªæœåŠ¡å™¨ä½¿ç”¨äº†è§£å…¶ä»–æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶å¯åŠ¨ã€‚<br><strong>NATSæœåŠ¡å™¨-A</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Cluster Server A</span></span><br><span class="line"></span><br><span class="line">port: 7222</span><br><span class="line"></span><br><span class="line">cluster &#123;</span><br><span class="line">  host: &#x27;0.0.0.0&#x27;</span><br><span class="line">  port: 7244</span><br><span class="line"></span><br><span class="line">  routes = [</span><br><span class="line">    nats-route://192.168.59.103:7246</span><br><span class="line">    nats-route://192.168.59.103:7248</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>NATSæœåŠ¡å™¨-B</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Cluster Server B</span></span><br><span class="line"></span><br><span class="line">port: 8222</span><br><span class="line"></span><br><span class="line">cluster &#123;</span><br><span class="line">  host: &#x27;0.0.0.0&#x27;</span><br><span class="line">  port: 7246</span><br><span class="line"></span><br><span class="line">  routes = [</span><br><span class="line">    nats-route://192.168.59.103:7244</span><br><span class="line">    nats-route://192.168.59.103:7248</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>NATSæœåŠ¡å™¨-C</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Cluster Server C</span></span><br><span class="line"></span><br><span class="line">port: 9222</span><br><span class="line"></span><br><span class="line">cluster &#123;</span><br><span class="line">  host: &#x27;0.0.0.0&#x27;</span><br><span class="line">  port: 7248</span><br><span class="line"></span><br><span class="line">  routes = [</span><br><span class="line">    nats-route://192.168.59.103:7244</span><br><span class="line">    nats-route://192.168.59.103:7246</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦å¯åŠ¨å®¹å™¨ï¼Œåœ¨æ¯å°æœåŠ¡å™¨ä¸Šï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæŒ‰å¦‚ä¸‹æ–¹å¼å¯åŠ¨nats-serveræ˜ åƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 0.0.0.0:7222:7222 -p 0.0.0.0:7244:7244 --rm -v $(pwd)/conf/nats-server-A.conf:/tmp/cluster.conf nats -c /tmp/cluster.conf -p 7222 -D -V</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 0.0.0.0:8222:8222 -p 0.0.0.0:7246:7246 --rm -v $ï¼ˆpwdï¼‰/conf/nats-server-B.conf:/tmp/cluster.conf nats - c /tmp/cluster.conf -p 8222 -D -V</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 0.0.0.0:9222:9222 -p 0.0.0.0:7248:7248 --rm -v $ï¼ˆpwdï¼‰/conf/nats-server-C.conf:/tmp/cluster.conf nats - c /tmp/cluster.conf -p 9222 -D -V</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹2ï¼šé€ä¸ªè®¾ç½®nats-serveré›†ç¾¤</strong></p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š</p>
<ul>
<li>We bring up A and get its ip (nats-route://192.168.59.103:7244)</li>
<li>Then create B and then use address of A in its configuration.</li>
<li>Get the address of B nats-route://192.168.59.104:7246 and create C and use the addresses of A and B.</li>
</ul>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºèŠ‚ç‚¹Aå¹¶ä½¿ç”¨ä»¥ä¸‹é…ç½®å¯åŠ¨nats-serveræœåŠ¡å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Cluster Server A</span></span><br><span class="line"></span><br><span class="line">port: 4222</span><br><span class="line"></span><br><span class="line">cluster &#123;</span><br><span class="line">  host: &#x27;0.0.0.0&#x27;</span><br><span class="line">  port: 7244</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 0.0.0.0:4222:4222 -p 0.0.0.0:7244:7244 --rm -v $(pwd)/conf/nats-server-A.conf:/tmp/cluster.conf nats -c /tmp/cluster.conf -p 4222 -D -V</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬ç»§ç»­åˆ›å»ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚æˆ‘ä»¬æ„è¯†åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ipï¼športä¸º192.168.59.103:7244ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒæ·»åŠ åˆ°routesé…ç½®ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Cluster Server B</span></span><br><span class="line"></span><br><span class="line">port: 4222</span><br><span class="line"></span><br><span class="line">cluster &#123;</span><br><span class="line">  host: &#x27;0.0.0.0&#x27;</span><br><span class="line">  port: 7244</span><br><span class="line"></span><br><span class="line">  routes = [</span><br><span class="line">    nats-route://192.168.59.103:7244</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯åŠ¨æœåŠ¡å™¨Bï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 0.0.0.0:4222:4222 -p 0.0.0.0:7244:7244 --rm -v $(pwd)/conf/nats-server-B.conf:/tmp/cluster.conf nats -c /tmp/cluster.conf -p 4222 -D -V</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªNode C.æˆ‘ä»¬ç°åœ¨çŸ¥é“Aå’ŒBçš„è·¯ç”±ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†å…¶æ·»åŠ åˆ°å…¶é…ç½®ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Cluster Server C</span></span><br><span class="line"></span><br><span class="line">port: 4222</span><br><span class="line"></span><br><span class="line">cluster &#123;</span><br><span class="line">  host: &#x27;0.0.0.0&#x27;</span><br><span class="line">  port: 7244</span><br><span class="line"></span><br><span class="line">  routes = [</span><br><span class="line">    nats-route://192.168.59.103:7244</span><br><span class="line">    nats-route://192.168.59.104:7244</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¸¯å£ï¼š4222</p>
<p>é›†ç¾¤{<br>  ä¸»æŒäººï¼š&#39;0.0.0.0&#39;<br>  æ¸¯å£ï¼š7244</p>
<p>  è·¯çº¿= [<br>    NATSè·¯çº¿ï¼š//192.168.59.103ï¼š7244<br>    NATSè·¯çº¿ï¼š//192.168.59.104ï¼š7244<br>  ]<br>}</p>
<p>ç„¶åå¼€å§‹å§ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 0.0.0.0:4222:4222 -p 0.0.0.0:7244:7244 --rm -v $(pwd)/conf/nats-server-C.conf:/tmp/cluster.conf nats -c /tmp/cluster.conf -p 9222 -D -V</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•é›†ç¾¤</strong></p>
<p>ç°åœ¨ï¼Œä»¥ä¸‹åº”è¯¥å·¥ä½œï¼šè®¢é˜…èŠ‚ç‚¹Aç„¶åå‘å¸ƒåˆ°èŠ‚ç‚¹C.æ‚¨åº”è¯¥èƒ½å¤Ÿæ¯«æ— é—®é¢˜åœ°æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nats-sub -s &quot;nats://192.168.59.103:7222&quot; hello &amp;</span><br><span class="line"></span><br><span class="line">nats-pub -s &quot;nats://192.168.59.105:7222&quot; hello world</span><br><span class="line"></span><br><span class="line"><span class="meta">[#</span><span class="bash">1] Received on [hello] : <span class="string">&#x27;world&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GNATSD on Node C logs:</span></span><br><span class="line">[1] 2015/06/23 05:20:31.100032 [TRC] 192.168.59.103:7244 - rid:2 - &lt;&lt;- [MSG hello RSID:8:2 5]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GNATSD on Node A logs:</span></span><br><span class="line">[1] 2015/06/23 05:20:31.100600 [TRC] 10.0.2.2:51007 - cid:8 - &lt;&lt;- [MSG hello 2 5]</span><br></pre></td></tr></table></figure>

<p>nats-pub -sâ€œnatsï¼š//192.168.59.105ï¼š7222â€ä½ å¥½ä¸–ç•Œ</p>
<p>[ï¼ƒ1]æ”¶åˆ°[ä½ å¥½]ï¼š&#39;ä¸–ç•Œ&#39;</p>
<p>èŠ‚ç‚¹Cæ—¥å¿—ä¸Šçš„#GNATSDï¼š<br>[1] 2015/06/23 05ï¼š20ï¼š31.100032 [TRC] 192.168.59.103:7244 - ridï¼š2 - &lt;&lt; - [MSG hello RSIDï¼š8ï¼š2 5]</p>
<p>èŠ‚ç‚¹Aæ—¥å¿—ä¸Šçš„#GNATSDï¼š<br>[1] 2015/06/23 05ï¼š20ï¼š31.100600 [TRC] 10.0.2.2:51007 - cidï¼š8 - &lt;&lt; - [MSGä½ å¥½2 5]</p>
<h3 id="æ•™ç¨‹"><a href="#æ•™ç¨‹" class="headerlink" title="æ•™ç¨‹"></a>æ•™ç¨‹</h3><p>æœ‰å…³ä½¿ç”¨NATSæœåŠ¡å™¨Dockeré•œåƒçš„æ›´å¤šè¯´æ˜ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://www.nats.io/documentation/additional_documentation/nats-server-docker/">NATS Dockeræ•™ç¨‹</a>ã€‚</p>
<h2 id="NATSæœåŠ¡å™¨æ—¥å¿—è®°å½•"><a href="#NATSæœåŠ¡å™¨æ—¥å¿—è®°å½•" class="headerlink" title="NATSæœåŠ¡å™¨æ—¥å¿—è®°å½•"></a>NATSæœåŠ¡å™¨æ—¥å¿—è®°å½•</h2><p>NATSæœåŠ¡å™¨æä¾›å„ç§æ—¥å¿—è®°å½•é€‰é¡¹ï¼Œæ‚¨å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæˆ–é…ç½®æ–‡ä»¶è®¾ç½®è¿™äº›é€‰é¡¹ã€‚</p>
<h3 id="é…ç½®æ—¥å¿—è®°å½•"><a href="#é…ç½®æ—¥å¿—è®°å½•" class="headerlink" title="é…ç½®æ—¥å¿—è®°å½•"></a>é…ç½®æ—¥å¿—è®°å½•</h3><p><strong>å‘½ä»¤è¡Œé€‰é¡¹</strong></p>
<p>æ”¯æŒä»¥ä¸‹æ—¥å¿—è®°å½•æ“ä½œï¼š</p>
<ul>
<li>-lï¼Œ â€“log FILE æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„æ–‡ä»¶</li>
<li>-Tï¼Œ â€“logtime æ˜¯å¦å¼€å¯æ—¥å¿—çš„æ—¶é—´æˆ³ï¼ˆé»˜è®¤ä¸ºtrueï¼‰</li>
<li>-sï¼Œ â€“syslog å¯ç”¨syslogä½œä¸ºæ—¥å¿—æ–¹æ³•</li>
<li>-rï¼Œ â€“remote_syslog è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨çš„åœ°å€ï¼ˆé»˜è®¤ä¸ºudp://localhost:514ï¼‰</li>
<li>-Dï¼Œ â€“debug å¼€å¯è°ƒè¯•è¾“å‡º</li>
<li>-V, â€“trace è·Ÿè¸ªåŸå§‹çš„åè®®</li>
<li>-DV è°ƒè¯•å¹¶è·Ÿè¸ª</li>
</ul>
<p><strong>è°ƒè¯•å’Œè·Ÿè¸ª</strong></p>
<p>-DVæ ‡å¿—å¯ç”¨æœåŠ¡å™¨çš„è·Ÿè¸ªå’Œè°ƒè¯•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -DV -m 8222 -user foo -pass bar</span><br></pre></td></tr></table></figure>

<p><strong>æ—¥å¿—æ–‡ä»¶é‡å®šå‘</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -DV -m 8222 -l nats.log</span><br></pre></td></tr></table></figure>

<p><strong>æ—¶é—´æˆ³</strong></p>
<p>å¦‚æœ<code>-T false</code>ï¼Œåˆ™æ—¥å¿—æ¡ç›®ä¸å¸¦æ—¶é—´æˆ³ã€‚é»˜è®¤ä¸ºtrueã€‚<br><strong>ç³»ç»Ÿæ—¥å¿—</strong></p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨UDPé…ç½®syslogï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -s udp://localhost:514</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ç³»ç»Ÿæ—¥å¿—ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-server -r syslog://&lt;hostname&gt;:&lt;port&gt;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syslog://logs.papertrailapp.com:26900</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨é…ç½®æ–‡ä»¶</strong></p>
<p>æ‰€æœ‰è¿™äº›è®¾ç½®ä¹Ÿå¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">debug:   false</span><br><span class="line">trace:   true</span><br><span class="line">logtime: false</span><br><span class="line">log_file: &quot;/tmp/nats-server.log&quot;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨logrotateè®°å½•æ—‹è½¬"><a href="#ä½¿ç”¨logrotateè®°å½•æ—‹è½¬" class="headerlink" title="ä½¿ç”¨logrotateè®°å½•æ—‹è½¬"></a>ä½¿ç”¨logrotateè®°å½•æ—‹è½¬</h3><p>NATSæœåŠ¡å™¨ä¸æä¾›ç®¡ç†æ—¥å¿—æ–‡ä»¶çš„å·¥å…·ï¼Œä½†å®ƒç¡®å®åŒ…å«ä½¿æ—¥å¿—è½®æ¢ç®€å•çš„æœºåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨logrotateè¿™ä¸ªæœºåˆ¶;ä¸€ä¸ªç®€å•çš„æ ‡å‡†Linuxå®ç”¨ç¨‹åºï¼Œç”¨äºæ—‹è½¬å¤§å¤šæ•°å‘è¡Œç‰ˆä¸Šå¯ç”¨çš„æ—¥å¿—ï¼Œå¦‚Debianï¼ŒUbuntuï¼ŒRedHatï¼ˆCentOSï¼‰ç­‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é…ç½®<code>logrotate</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/path/to/nats-server.log &#123;</span><br><span class="line">    daily</span><br><span class="line">    rotate 30</span><br><span class="line">    compress</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    postrotate</span><br><span class="line">        kill -SIGUSR1 `cat /var/run/nats-server.pid`</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€è¡ŒæŒ‡å®šåç»­è¡Œå°†åº”ç”¨äºçš„ä½ç½®ã€‚</p>
<p>æ–‡ä»¶çš„å…¶ä½™éƒ¨åˆ†æŒ‡å®šæ—¥å¿—å°†æ¯å¤©è½®æ¢ï¼ˆâ€œæ¯æ—¥â€é€‰é¡¹ï¼‰ï¼Œå¹¶ä¿ç•™30ä¸ªæ—§ç‰ˆæœ¬ï¼ˆâ€œæ—‹è½¬â€é€‰é¡¹ï¼‰ã€‚å…¶ä»–é€‰é¡¹åœ¨logrorateæ–‡æ¡£ä¸­æè¿°ã€‚</p>
<p>â€œ<code>postrotate</code>â€éƒ¨åˆ†å‘Šè¯‰NATSæœåŠ¡å™¨åœ¨è½®æ¢å®Œæˆåé‡æ–°åŠ è½½æ—¥å¿—æ–‡ä»¶ã€‚å‘½ä»¤kill -SIGUSR1<code>cat / var / run / nats-server.pid</code>ä¸ä¼šç»ˆæ­¢NATSæœåŠ¡å™¨è¿›ç¨‹ï¼Œè€Œæ˜¯å‘å…¶å‘é€ä¸€ä¸ªä¿¡å·ï¼Œä½¿å…¶é‡æ–°åŠ è½½å…¶æ—¥å¿—æ–‡ä»¶ã€‚è¿™å°†å¯¼è‡´å°†æ–°è¯·æ±‚è®°å½•åˆ°åˆ·æ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p>
<p><code>/var/run/nats-server.pid</code>æ–‡ä»¶æ˜¯NATSæœåŠ¡å™¨å­˜å‚¨ä¸»è¿›ç¨‹çš„pidçš„ä½ç½®ã€‚</p>
<h3 id="ä¸€äº›è®°å½•ç¬”è®°"><a href="#ä¸€äº›è®°å½•ç¬”è®°" class="headerlink" title="ä¸€äº›è®°å½•ç¬”è®°"></a>ä¸€äº›è®°å½•ç¬”è®°</h3><ul>
<li>è¯¦ç»†æ¨¡å¼ä¸‹çš„NATSæœåŠ¡å™¨å°†è®°å½•UNSUBæ¶ˆæ¯çš„æ¥æ”¶ï¼Œä½†è¿™å¹¶ä¸è¡¨ç¤ºè®¢é˜…å·²æ¶ˆå¤±ï¼Œä»…è¡¨ç¤ºå·²æ”¶åˆ°æ¶ˆæ¯ã€‚æ—¥å¿—ä¸­çš„DELSUBæ¶ˆæ¯å¯ç”¨äºç¡®å®šä½•æ—¶åˆ é™¤å®é™…çš„è®¢é˜…ã€‚</li>
</ul>
<h2 id="ç›‘æ§NATSæœåŠ¡å™¨"><a href="#ç›‘æ§NATSæœåŠ¡å™¨" class="headerlink" title="ç›‘æ§NATSæœåŠ¡å™¨"></a>ç›‘æ§NATSæœåŠ¡å™¨</h2><p>ä¸ºäº†ç›‘è§†NATSæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œgnatsdåœ¨ä¸“ç”¨ç›‘è§†ç«¯å£ä¸Šæä¾›è½»é‡çº§HTTPæœåŠ¡å™¨ã€‚ç›‘è§†æœåŠ¡å™¨æä¾›å¤šä¸ªç«¯ç‚¹ï¼ŒåŒ…æ‹¬varzï¼Œconnzï¼Œroutezå’Œsubszã€‚æ‰€æœ‰ç«¯ç‚¹éƒ½è¿”å›ä¸€ä¸ªJSONå¯¹è±¡ã€‚</p>
<p>NATSç›‘æ§ç«¯ç‚¹æ”¯æŒJSONPå’ŒCORSï¼Œå¯ä»¥è½»æ¾åˆ›å»ºå•é¡µé¢ç›‘æ§Webåº”ç”¨ç¨‹åºã€‚</p>
<h3 id="å¯ç”¨ç›‘æ§"><a href="#å¯ç”¨ç›‘æ§" class="headerlink" title="å¯ç”¨ç›‘æ§"></a>å¯ç”¨ç›‘æ§</h3><p>è¦å¯ç”¨ç›‘è§†æœåŠ¡å™¨ï¼Œè¯·ä½¿ç”¨ç›‘è§†æ ‡å¿—-må’Œç›‘è§†ç«¯å£å¯åŠ¨NATSæœåŠ¡å™¨ï¼Œæˆ–åœ¨é…ç½®æ–‡ä»¶ä¸­å°†å…¶æ‰“å¼€ã€‚</p>
<ul>
<li>-mï¼Œ - http_port PORT HTTP PORTç”¨äºç›‘è§†</li>
<li>-msï¼Œ - https_port PORTä½¿ç”¨HTTPS PORTè¿›è¡Œç›‘æ§</li>
</ul>
<p>ä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gnatsd -m 8222</span></span><br><span class="line">[4528] 2015/08/19 20:09:58.572939 [INF] Starting gnatsd version 0.8.0</span><br><span class="line">[4528] 2015/08/19 20:09:58.573007 [INF] Starting http monitor on port 8222</span><br><span class="line">[4528] 2015/08/19 20:09:58.573071 [INF] Listening for client connections on 0.0.0.0:4222</span><br><span class="line">[4528] 2015/08/19 20:09:58.573090 [INF] gnatsd is ready&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<p>è¦æµ‹è¯•ï¼Œè¯·è¿è¡Œ<code>gnatsd -m 8222</code>ï¼Œç„¶åè½¬åˆ°<code>http://localhost:8222/</code></p>
<h3 id="ç›‘æ§ç«¯ç‚¹"><a href="#ç›‘æ§ç«¯ç‚¹" class="headerlink" title="ç›‘æ§ç«¯ç‚¹"></a>ç›‘æ§ç«¯ç‚¹</h3><p>ä»¥ä¸‹éƒ¨åˆ†æè¿°äº†æ¯ä¸ªå—æ”¯æŒçš„ç›‘æ§ç«¯ç‚¹ï¼švarzï¼Œconnzï¼Œroutezå’Œsubszã€‚<br><strong>/varz</strong></p>
<p>ç«¯ç‚¹<code>http://localhost:8222/varz</code>æŠ¥å‘Šå„ç§å¸¸è§„ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;server_id&quot;</span>: <span class="string">&quot;ec933edcd2bd86bcf71d555fc8b4fb2c&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.6.6&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;go&quot;</span>: <span class="string">&quot;go1.5.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;port&quot;</span>: <span class="number">4222</span>,</span><br><span class="line">  <span class="attr">&quot;auth_required&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;ssl_required&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;max_payload&quot;</span>: <span class="number">1048576</span>,</span><br><span class="line">  <span class="attr">&quot;max_connections&quot;</span>: <span class="number">65536</span>,</span><br><span class="line">  <span class="attr">&quot;ping_interval&quot;</span>: <span class="number">120000000000</span>,</span><br><span class="line">  <span class="attr">&quot;ping_max&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;http_port&quot;</span>: <span class="number">8222</span>,</span><br><span class="line">  <span class="attr">&quot;ssl_timeout&quot;</span>: <span class="number">0.5</span>,</span><br><span class="line">  <span class="attr">&quot;max_control_line&quot;</span>: <span class="number">1024</span>,</span><br><span class="line">  <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;2015-07-14T13:29:26.426805508-07:00&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;now&quot;</span>: <span class="string">&quot;2015-07-14T13:30:59.349179963-07:00&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;uptime&quot;</span>: <span class="string">&quot;1m33s&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;mem&quot;</span>: <span class="number">8445952</span>,</span><br><span class="line">  <span class="attr">&quot;cores&quot;</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">&quot;cpu&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;connections&quot;</span>: <span class="number">39</span>,</span><br><span class="line">  <span class="attr">&quot;routes&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;remotes&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;in_msgs&quot;</span>: <span class="number">100000</span>,</span><br><span class="line">  <span class="attr">&quot;out_msgs&quot;</span>: <span class="number">100000</span>,</span><br><span class="line">  <span class="attr">&quot;in_bytes&quot;</span>: <span class="number">1600000</span>,</span><br><span class="line">  <span class="attr">&quot;out_bytes&quot;</span>: <span class="number">1600000</span>,</span><br><span class="line">  <span class="attr">&quot;slow_consumers&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>/connz</strong></p>
<p>ç«¯ç‚¹<code>http://localhost:8222/connz</code>æŠ¥å‘Šæœ‰å…³å½“å‰è¿æ¥çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚å®ƒä½¿ç”¨åˆ†é¡µæœºåˆ¶ï¼Œé»˜è®¤ä¸º1024ä¸ªè¿æ¥ã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡URLå‚æ•°ï¼ˆé™åˆ¶å’Œåç§»ï¼‰æ§åˆ¶è¿™äº›ã€‚ä¾‹å¦‚ï¼š<code>http://localhostï¼š8222/connzlimit=1ï¼†offset=1</code>ã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨subs = 1æŠ¥å‘ŠåŸºäºæ¯ä¸ªè¿æ¥çš„è¯¦ç»†è®¢é˜…ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š<code>http:// localhost:8222/connz?limit=1ï¼†offset=1ï¼†subs=1</code>ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;now&quot;: &quot;2015-07-14T13:30:59.349179963-07:00&quot;,</span><br><span class="line">  &quot;num_connections&quot;: 2,</span><br><span class="line">  &quot;offset&quot;: 0,</span><br><span class="line">  &quot;limit&quot;: 1024,</span><br><span class="line">  &quot;connections&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;cid&quot;: 571,</span><br><span class="line">      &quot;ip&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">      &quot;port&quot;: 61572,</span><br><span class="line">      &quot;pending_size&quot;: 0,</span><br><span class="line">      &quot;in_msgs&quot;: 0,</span><br><span class="line">      &quot;out_msgs&quot;: 0,</span><br><span class="line">      &quot;in_bytes&quot;: 0,</span><br><span class="line">      &quot;out_bytes&quot;: 0,</span><br><span class="line">      &quot;subscriptions&quot;: 1,</span><br><span class="line">      &quot;lang&quot;: &quot;go&quot;,</span><br><span class="line">      &quot;version&quot;: &quot;1.0.9&quot;,</span><br><span class="line">      &quot;subscriptions_list&quot;: [</span><br><span class="line">        &quot;hello.world&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;cid&quot;: 574,</span><br><span class="line">      &quot;ip&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">      &quot;port&quot;: 61577,</span><br><span class="line">      &quot;pending_size&quot;: 0,</span><br><span class="line">      &quot;in_msgs&quot;: 0,</span><br><span class="line">      &quot;out_msgs&quot;: 0,</span><br><span class="line">      &quot;in_bytes&quot;: 0,</span><br><span class="line">      &quot;out_bytes&quot;: 0,</span><br><span class="line">      &quot;subscriptions&quot;: 1,</span><br><span class="line">      &quot;lang&quot;: &quot;ruby&quot;,</span><br><span class="line">      &quot;version&quot;: &quot;0.5.0&quot;,</span><br><span class="line">      &quot;subscriptions_list&quot;: [</span><br><span class="line">        &quot;hello.world&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>/routez</strong></p>
<p>ç«¯ç‚¹<code>http://localhost:8222/routez</code>æŠ¥å‘Šæœ‰å…³ç¾¤é›†çš„æ´»åŠ¨è·¯ç”±çš„ä¿¡æ¯ã€‚è·¯ç”±é¢„è®¡å¾ˆä½ï¼Œå› æ­¤è¯¥ç«¯ç‚¹æ²¡æœ‰åˆ†é¡µæœºåˆ¶ã€‚</p>
<p>routezç«¯ç‚¹ç¡®å®æ”¯æŒ/ connzç«¯ç‚¹çš„subså‚æ•°ã€‚ä¾‹å¦‚ï¼š<code>http://localhost:8222/routez?subs=1</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;now&quot;</span>: <span class="string">&quot;2015-07-14T13:30:59.349179963-07:00&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;num_routes&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;routes&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;rid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;remote_id&quot;</span>: <span class="string">&quot;de475c0041418afc799bccf0fdd61b47&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;did_solicit&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">&quot;ip&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;port&quot;</span>: <span class="number">61791</span>,</span><br><span class="line">      <span class="attr">&quot;pending_size&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;in_msgs&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;out_msgs&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;in_bytes&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;out_bytes&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;subscriptions&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>/subsz</strong></p>
<p>ç«¯ç‚¹<code>http://localhost:8222/subz</code>æŠ¥å‘Šæœ‰å…³å½“å‰è®¢é˜…å’Œè·¯ç”±æ•°æ®ç»“æ„çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;num_subscriptions&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;num_cache&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;num_inserts&quot;</span>: <span class="number">572</span>,</span><br><span class="line">  <span class="attr">&quot;num_removes&quot;</span>: <span class="number">569</span>,</span><br><span class="line">  <span class="attr">&quot;num_matches&quot;</span>: <span class="number">200000</span>,</span><br><span class="line">  <span class="attr">&quot;cache_hit_rate&quot;</span>: <span class="number">0.99999</span>,</span><br><span class="line">  <span class="attr">&quot;max_fanout&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;avg_fanout&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;stats_time&quot;</span>: <span class="string">&quot;2015-07-14T12:55:25.564818051-07:00&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="åˆ›å»ºç›‘æ§åº”ç”¨ç¨‹åº"><a href="#åˆ›å»ºç›‘æ§åº”ç”¨ç¨‹åº" class="headerlink" title="åˆ›å»ºç›‘æ§åº”ç”¨ç¨‹åº"></a>åˆ›å»ºç›‘æ§åº”ç”¨ç¨‹åº</h3><p>NATSç›‘æ§ç«¯ç‚¹æ”¯æŒJSONPå’ŒCORSã€‚æ‚¨å¯ä»¥è½»æ¾åˆ›å»ºå•é¡µWebåº”ç”¨ç¨‹åºä»¥è¿›è¡Œç›‘è§†ã€‚ä¸ºæ­¤ï¼Œæ‚¨åªéœ€å°†å›è°ƒæŸ¥è¯¢å‚æ•°ä¼ é€’ç»™ä»»ä½•ç«¯ç‚¹ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8222/connz?callback=cb</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªJQueryç¤ºä¾‹å®ç°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$.getJSON(<span class="string">&#x27;http://localhost:8222/connz?callback=?&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="è·Ÿè¸ªNATSç»Ÿè®¡ä¿¡æ¯"><a href="#è·Ÿè¸ªNATSç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="è·Ÿè¸ªNATSç»Ÿè®¡ä¿¡æ¯"></a>è·Ÿè¸ªNATSç»Ÿè®¡ä¿¡æ¯</h2><p>nats-topæ˜¯ä¸€ç§ç”¨äºç›‘æ§nats-serveræœåŠ¡å™¨çš„é¡¶çº§å·¥å…·ã€‚</p>
<p>nats-topå·¥å…·æä¾›NATSæœåŠ¡å™¨çš„åŠ¨æ€å®æ—¶è§†å›¾ã€‚ nats-topå¯ä»¥å®æ—¶æ˜¾ç¤ºæœ‰å…³NATSæœåŠ¡å™¨çš„å„ç§ç³»ç»Ÿæ‘˜è¦ä¿¡æ¯ï¼Œä¾‹å¦‚è®¢é˜…ï¼Œå¾…å¤„ç†å­—èŠ‚ï¼Œæ¶ˆæ¯æ•°ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nats-top</span><br><span class="line"></span><br><span class="line">nats-server version 0.6.4 (uptime: 31m42s)</span><br><span class="line">Server:</span><br><span class="line">  Load: CPU: 0.8%   Memory: 5.9M  Slow Consumers: 0</span><br><span class="line">  In:   Msgs: 34.2K  Bytes: 3.0M  Msgs/Sec: 37.9  Bytes/Sec: 3389.7</span><br><span class="line">  Out:  Msgs: 68.3K  Bytes: 6.0M  Msgs/Sec: 75.8  Bytes/Sec: 6779.4</span><br><span class="line"></span><br><span class="line">Connections: 4</span><br><span class="line">  HOST                 CID      SUBS    PENDING     MSGS_TO     MSGS_FROM   BYTES_TO    BYTES_FROM  LANG     VERSION SUBSCRIPTIONS</span><br><span class="line">  127.0.0.1:56134      2        5       0           11.6K       11.6K       1.1M        905.1K      go       1.1.0   foo, hello</span><br><span class="line">  127.0.1.1:56138      3        1       0           34.2K       0           3.0M        0           go       1.1.0    _INBOX.a96f3f6853616154d23d1b5072</span><br><span class="line">  127.0.0.1:56144      4        5       0           11.2K       11.1K       873.5K      1.1M        go       1.1.0   foo, hello</span><br><span class="line">  127.0.0.1:56151      5        8       0           11.4K       11.5K       1014.6K     1.0M        go       1.1.0   foo, hello</span><br></pre></td></tr></table></figure>



<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å¯ä»¥ä½¿ç”¨go getå®‰è£…nats-topã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/nats-io/nats-top</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šæ‚¨å¯èƒ½å¿…é¡»ä»¥ç”¨æˆ·sudoèº«ä»½è¿è¡Œä¸Šè¿°å‘½ä»¤ï¼Œå…·ä½“å–å†³äºæ‚¨çš„è®¾ç½®ã€‚å¦‚æœä½ æ”¶åˆ°ä¸€ä¸ªä½ æ— æ³•å®‰è£…nats-topçš„é”™è¯¯ï¼Œå› ä¸ºä½ çš„$ GOPATHæ²¡æœ‰è®¾ç½®ï¼Œå®é™…ä¸Šå·²ç»è®¾ç½®äº†ï¼Œè¯·ä½¿ç”¨å‘½ä»¤<code>sudo -E go get github.com/nats-io/nats-top</code>æ¥å®‰è£…nats-top ã€‚ -Eæ ‡å¿—å‘Šè¯‰sudoä¿ç•™å½“å‰ç”¨æˆ·çš„ç¯å¢ƒã€‚</p>
<h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤nats-topå’Œoptionalå‚æ•°è¿è¡Œnats-topã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nats-top [-s server] [-m monitor] [-n num_connections] [-d delay_in_secs] [-sort by]</span><br></pre></td></tr></table></figure>

<h3 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h3><p>å¯é€‰å‚æ•°åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>-m monitor</code></td>
<td>ç›‘è§†nats-serverçš„httpç«¯å£</td>
</tr>
<tr>
<td><code>-n num_connections</code></td>
<td>é™åˆ¶è¯·æ±‚ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼ˆé»˜è®¤ä¸º1024ï¼‰</td>
</tr>
<tr>
<td><code>-d delay_in_secs</code></td>
<td>å±å¹•åˆ·æ–°é—´éš”ï¼ˆé»˜è®¤ä¸º1ç§’ï¼‰</td>
</tr>
<tr>
<td><code>-sort by</code></td>
<td>Fieldç”¨äºæ’åºè¿æ¥</td>
</tr>
</tbody></table>
<h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><p>åœ¨nats-topè§†å›¾ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ã€‚<br><strong>é€‰é¡¹</strong></p>
<p>ä½¿ç”¨o <option>å‘½ä»¤å°†ä¸»æ’åºé”®è®¾ç½®ä¸º<option>å€¼ã€‚é€‰é¡¹å€¼å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼šcidï¼Œsubsï¼Œpendingï¼Œmsgs_toï¼Œmsgs_fromï¼Œbytes_toï¼Œbytes_fromï¼Œlangï¼Œversionã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨-sortæ ‡å¿—åœ¨å‘½ä»¤è¡Œä¸Šè®¾ç½®æ’åºé€‰é¡¹ã€‚ä¾‹å¦‚ï¼šnats-top -sort bytes_toã€‚<br><strong>limit</strong></p>
<p>ä½¿ç”¨<code>n &lt;limit&gt;</code>å‘½ä»¤è®¾ç½®è¦ä»æœåŠ¡å™¨è¯·æ±‚çš„è¿æ¥çš„æ ·æœ¬å¤§å°ã€‚</p>
<p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨<code>-n num_connections</code>æ ‡å¿—åœ¨å‘½ä»¤è¡Œä¸Šè®¾ç½®å®ƒã€‚ä¾‹å¦‚ï¼š<code>nats-top -n 1</code>ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå¦‚æœ<code>n &lt;limit&gt;</code>ä¸<code>-sort</code>ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™æœåŠ¡å™¨å°†éµå¾ªå…è®¸æŸ¥è¯¢çš„ä¸¤ä¸ªé€‰é¡¹ï¼Œä¾‹å¦‚ï¼šæŸ¥è¯¢å…·æœ‰æœ€å¤§è®¢é˜…æ•°çš„è¿æ¥ï¼š<code>nats-top -n 1 -sort subs</code>ã€‚<br><strong>sï¼Œï¼Ÿå’Œqå‘½ä»¤</strong></p>
<p>ä½¿ç”¨<code>s</code>å‘½ä»¤åˆ‡æ¢æ˜¾ç¤ºè¿æ¥è®¢é˜…ã€‚</p>
<p>ä½¿ç”¨<code>?</code>å‘½ä»¤æ˜¾ç¤ºå¸¦æœ‰é€‰é¡¹çš„å¸®åŠ©æ¶ˆæ¯ã€‚</p>
<p>ä½¿ç”¨<code>q</code>å‘½ä»¤é€€å‡º<code>nats-top</code>ã€‚<br><strong>æ•™ç¨‹</strong></p>
<p>æœ‰å…³nats-topçš„æ¼”ç»ƒï¼Œè¯·æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://www.nats.io/documentation/additional_documentation/nats-top">æ•™ç¨‹</a>ã€‚</p>
<h2 id="æ¶ˆè´¹è€…ç¼“æ…¢"><a href="#æ¶ˆè´¹è€…ç¼“æ…¢" class="headerlink" title="æ¶ˆè´¹è€…ç¼“æ…¢"></a>æ¶ˆè´¹è€…ç¼“æ…¢</h2><p>ä¸ºäº†æ”¯æŒå¼¹æ€§å’Œé«˜å¯ç”¨æ€§ï¼ŒNATSæä¾›äº†å†…ç½®æœºåˆ¶æ¥è‡ªåŠ¨ä¿®å‰ªç”¨äºè·Ÿè¸ªè®¢é˜…è€…çš„æ³¨å†Œä¾¦å¬å™¨å…´è¶£å›¾ï¼ŒåŒ…æ‹¬ç¼“æ…¢çš„æ¶ˆè´¹è€…å’Œæ‡’æƒ°çš„ä¾¦å¬å™¨ã€‚ NATSè‡ªåŠ¨å¤„ç†ç¼“æ…¢çš„æ¶ˆè´¹è€…ã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰è¶³å¤Ÿå¿«åœ°å¤„ç†æ¶ˆæ¯ï¼Œåˆ™NATSæœåŠ¡å™¨ä¼šå°†å…¶å…³é—­ã€‚ä¸ºäº†æ”¯æŒæ‰©å±•ï¼ŒNATSæä¾›äº†å¯¹å®¢æˆ·ç«¯è¿æ¥çš„è‡ªåŠ¨ä¿®å‰ªã€‚å¦‚æœè®¢æˆ·åœ¨ä¹’ä¹“é—´éš”å†…æ²¡æœ‰å“åº”æ¥è‡ªæœåŠ¡å™¨çš„pingè¯·æ±‚ï¼Œåˆ™å®¢æˆ·ç«¯è¢«åˆ‡æ–­ï¼ˆæ–­å¼€è¿æ¥ï¼‰ã€‚å®¢æˆ·ç«¯éœ€è¦é‡æ–°è¿æ¥é€»è¾‘æ‰èƒ½ä¸æœåŠ¡å™¨é‡æ–°è¿æ¥ã€‚</p>
<h3 id="æ¶ˆè´¹è€…ç¼“æ…¢-1"><a href="#æ¶ˆè´¹è€…ç¼“æ…¢-1" class="headerlink" title="æ¶ˆè´¹è€…ç¼“æ…¢"></a>æ¶ˆè´¹è€…ç¼“æ…¢</h3><p>åœ¨æ ¸å¿ƒNATSä¸­ï¼Œæ— æ³•è·Ÿä¸Šçš„æ¶ˆè´¹è€…ä¸è®¸å¤šå…¶ä»–æ¶ˆæ¯ç³»ç»Ÿçš„å¤„ç†æ–¹å¼ä¸åŒï¼šNATSå€¾å‘äºä¿æŠ¤æ•´ä¸ªç³»ç»Ÿè€Œä¸æ˜¯å®¹çº³ç‰¹å®šæ¶ˆè´¹è€…ä»¥ç¡®ä¿æ¶ˆæ¯ä¼ é€’ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯æ…¢æ¶ˆè´¹è€…ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ…¢æ¶ˆè´¹è€…ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ…¢æ¶ˆè´¹è€…ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ…¢æ¶ˆè´¹è€…ï¼Ÿ</h4><p>æ…¢é€Ÿæ¶ˆè´¹è€…æ˜¯æ— æ³•è·Ÿä¸Šä»NATSæœåŠ¡å™¨ä¼ é€’çš„æ¶ˆæ¯æµçš„è®¢æˆ·ã€‚è¿™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¸¸è§æƒ…å†µï¼Œå› ä¸ºç”Ÿæˆæ•°æ®é€šå¸¸æ¯”å¤„ç†æ•°æ®æ›´å®¹æ˜“ã€‚å½“æ¶ˆè´¹è€…æ— æ³•è¶³å¤Ÿå¿«åœ°å¤„ç†æ•°æ®æ—¶ï¼ŒèƒŒå‹å°†åº”ç”¨äºç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†ã€‚ NATSæœ‰å‡å°‘è¿™ç§èƒŒå‹çš„æœºåˆ¶ã€‚</p>
<p>NATSè¯†åˆ«å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ä¸­çš„æ…¢é€Ÿæ¶ˆè´¹è€…ï¼Œé€šè¿‡æœåŠ¡å™¨ç›‘æ§ç«¯ç‚¹ä¸­çš„å·²æ³¨å†Œå›è°ƒï¼Œæ—¥å¿—æ¶ˆæ¯å’Œç»Ÿè®¡ä¿¡æ¯æä¾›é€šçŸ¥ã€‚</p>
<h4 id="æ…¢æ¶ˆè´¹è€…ä¼šæ€ä¹ˆæ ·ï¼Ÿ"><a href="#æ…¢æ¶ˆè´¹è€…ä¼šæ€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="æ…¢æ¶ˆè´¹è€…ä¼šæ€ä¹ˆæ ·ï¼Ÿ"></a>æ…¢æ¶ˆè´¹è€…ä¼šæ€ä¹ˆæ ·ï¼Ÿ</h4><p>å½“åœ¨å®¢æˆ·ç«¯æ£€æµ‹åˆ°æ—¶ï¼Œé€šçŸ¥åº”ç”¨ç¨‹åºå¹¶ä¸¢å¼ƒæ¶ˆæ¯ä»¥å…è®¸æ¶ˆè´¹è€…ç»§ç»­å¹¶å‡å°‘æ½œåœ¨çš„èƒŒå‹ã€‚åœ¨æœåŠ¡å™¨ä¸­æ£€æµ‹åˆ°æ—¶ï¼ŒæœåŠ¡å™¨å°†æ–­å¼€ä¸æ…¢é€Ÿæ¶ˆè´¹è€…çš„è¿æ¥ä»¥ä¿æŠ¤è‡ªèº«å’Œæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„å®Œæ•´æ€§ã€‚</p>
<h4 id="å®¢æˆ·ä¸­å‘ç°çš„æ¶ˆè´¹è€…ç¼“æ…¢"><a href="#å®¢æˆ·ä¸­å‘ç°çš„æ¶ˆè´¹è€…ç¼“æ…¢" class="headerlink" title="å®¢æˆ·ä¸­å‘ç°çš„æ¶ˆè´¹è€…ç¼“æ…¢"></a>å®¢æˆ·ä¸­å‘ç°çš„æ¶ˆè´¹è€…ç¼“æ…¢</h4><p>å®¢æˆ·ç«¯å¯ä»¥æ£€æµ‹åˆ°å®ƒæ˜¯æœ¬åœ°è¿æ¥ä¸Šçš„æ…¢ä½¿ç”¨è€…ï¼Œå¹¶é€šè¿‡ä½¿ç”¨å¼‚æ­¥é”™è¯¯å›è°ƒé€šçŸ¥åº”ç”¨ç¨‹åºã€‚æœ€å¥½åœ¨å®¢æˆ·ç«¯æœ¬åœ°æ•è·æ…¢é€Ÿæ¶ˆè´¹è€…ï¼Œè€Œä¸æ˜¯è®©æœåŠ¡å™¨æ£€æµ‹åˆ°è¿™ç§æƒ…å†µã€‚æ­¤ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•å®šä¹‰å’Œæ³¨å†Œå°†å¤„ç†ç¼“æ…¢çš„ä½¿ç”¨è€…é”™è¯¯çš„å¼‚æ­¥é”™è¯¯å¤„ç†ç¨‹åºã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">natsErrHandler</span><span class="params">(nc *nats.Conn, sub *nats.Subscription, natsErr error)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;error: %v\n&quot;</span>, natsErr)</span><br><span class="line">	<span class="keyword">if</span> natsErr == nats.ErrSlowConsumer &#123;</span><br><span class="line">		pendingMsgs, _, err := sub.Pending()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;couldn&#x27;t get pending messages: %v&quot;</span>, err)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Falling behind with %d pending messages on subject %q.\n&quot;</span>,</span><br><span class="line">			pendingMsgs, sub.Subject)</span><br><span class="line">		<span class="comment">// Log error, notify operations...</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// check for other errors</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set the error handler when creating a connection.</span></span><br><span class="line">nc, err := nats.Connect(<span class="string">&quot;nats://localhost:4222&quot;</span>,</span><br><span class="line">  nats.ErrorHandler(natsErrHandler))</span><br></pre></td></tr></table></figure>

<p>//åœ¨åˆ›å»ºè¿æ¥æ—¶è®¾ç½®é”™è¯¯å¤„ç†ç¨‹åºã€‚<br>ncï¼Œerrï¼š= nats.Connectï¼ˆâ€œnatsï¼š// localhostï¼š4222â€ï¼Œ<br>  nats.ErrorHandlerï¼ˆnatsErrHandlerï¼‰ï¼‰</p>
<p>ä½¿ç”¨æ­¤ç¤ºä¾‹ä»£ç å’Œé»˜è®¤è®¾ç½®ï¼Œç¼“æ…¢çš„ä½¿ç”¨è€…é”™è¯¯å°†ç”Ÿæˆå¦‚ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">error: nats: slow consumer, messages dropped</span><br><span class="line">Falling behind with 65536 pending messages on subject &quot;foo&quot;.</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯åŒæ­¥è®¢é˜…è€…ï¼Œåˆ™Subscription.NextMsgï¼ˆtimeout time.Durationï¼‰ä¹Ÿå°†è¿”å›é”™è¯¯ï¼ŒæŒ‡ç¤ºæ¶ˆè´¹è€…é€Ÿåº¦è¾ƒæ…¢ä¸”æ¶ˆæ¯å·²è¢«åˆ é™¤ã€‚</p>
<h4 id="æœåŠ¡å™¨è¯†åˆ«çš„æ¶ˆè´¹è€…ç¼“æ…¢"><a href="#æœåŠ¡å™¨è¯†åˆ«çš„æ¶ˆè´¹è€…ç¼“æ…¢" class="headerlink" title="æœåŠ¡å™¨è¯†åˆ«çš„æ¶ˆè´¹è€…ç¼“æ…¢"></a>æœåŠ¡å™¨è¯†åˆ«çš„æ¶ˆè´¹è€…ç¼“æ…¢</h4><p>å½“å®¢æˆ·ç«¯æ²¡æœ‰è¶³å¤Ÿå¿«åœ°å¤„ç†æ¶ˆæ¯æ—¶ï¼ŒæœåŠ¡å™¨å°†ç¼“å†²å‡ºç«™è¿æ¥ä¸­çš„æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µå¹¶ä¸”æœåŠ¡å™¨æ— æ³•è¶³å¤Ÿå¿«åœ°å‘å®¢æˆ·ç«¯å†™å…¥æ•°æ®æ—¶ï¼Œä¸ºäº†ä¿æŠ¤è‡ªèº«ï¼Œå®ƒä¼šå°†è®¢æˆ·æŒ‡å®šä¸ºâ€œæ…¢é€Ÿæ¶ˆè´¹è€…â€å¹¶ä¸”å¯èƒ½ä¸¢å¼ƒå…³è”çš„è¿æ¥ã€‚</p>
<p>å½“æœåŠ¡å™¨å¯åŠ¨ç¼“æ…¢çš„ä½¿ç”¨è€…é”™è¯¯æ—¶ï¼Œæ‚¨å°†åœ¨æœåŠ¡å™¨è¾“å‡ºä¸­çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[54083] 2017/09/28 14:45:18.001357 [INF] ::1:63283 - cid:7 - Slow Consumer Detected</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨è¿˜å°†è®°å½•é‡åˆ°çš„æ…¢é€Ÿæ¶ˆè´¹è€…é”™è¯¯çš„æ•°é‡ï¼Œå¯é€šè¿‡slow_consumerså­—æ®µä¸­çš„ç›‘æ§varzç«¯ç‚¹è·å¾—ã€‚</p>
<h4 id="å¤„ç†æ…¢æ¶ˆè´¹è€…"><a href="#å¤„ç†æ…¢æ¶ˆè´¹è€…" class="headerlink" title="å¤„ç†æ…¢æ¶ˆè´¹è€…"></a>å¤„ç†æ…¢æ¶ˆè´¹è€…</h4><p>é™¤äº†ä½¿ç”¨NATSæµåª’ä½“æˆ–ä¼˜åŒ–æ‚¨çš„æ¶ˆè´¹åº”ç”¨ç¨‹åºå¤–ï¼Œè¿˜æœ‰ä¸€äº›é€‰é¡¹å¯ç”¨ï¼šç¼©æ”¾ï¼Œè®¡é‡æˆ–è°ƒæ•´NATSåˆ°æ‚¨çš„ç¯å¢ƒã€‚</p>
<p><strong>æ‰©å±•é˜Ÿåˆ—è®¢é˜…è€…</strong></p>
<p>å¦‚æœæ‚¨ä¸ä¾èµ–äºæ¶ˆæ¯é¡ºåºï¼Œè¿™æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚ç¡®ä¿æ‚¨çš„NATSè®¢é˜…å±äºé˜Ÿåˆ—ç»„ï¼Œç„¶åæ ¹æ®éœ€è¦é€šè¿‡åˆ›å»ºæ›´å¤šæœåŠ¡æˆ–åº”ç”¨ç¨‹åºå®ä¾‹è¿›è¡Œæ‰©å±•ã€‚å¯¹äºå¾®æœåŠ¡æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹æ³• - å¾®æœåŠ¡çš„æ¯ä¸ªå®ä¾‹éƒ½ä¼šæ”¶åˆ°ä¸€éƒ¨åˆ†è¦å¤„ç†çš„æ¶ˆæ¯ï¼Œåªéœ€æ·»åŠ æ›´å¤šæœåŠ¡å®ä¾‹å³å¯ã€‚æ— éœ€æ›´æ”¹ä»£ç ï¼Œé…ç½®æ›´æ”¹æˆ–åœæœºæ—¶é—´ã€‚</p>
<p><strong>åˆ›å»ºå¯ä»¥æ‰©å±•çš„ä¸»é¢˜åç§°ç©ºé—´</strong></p>
<p>æ‚¨å¯ä»¥é€šè¿‡ä¸»é¢˜åç§°ç©ºé—´è¿›ä¸€æ­¥åˆ†å‘å·¥ä½œï¼Œå¹¶åœ¨è®¾è®¡ä¸­è¿›è¡Œä¸€äº›é¢„è§ã€‚å¦‚æœæ‚¨éœ€è¦ä¿ç•™æ¶ˆæ¯é¡ºåºï¼Œæ­¤æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚ä¸€èˆ¬çš„æƒ³æ³•æ˜¯å‘å¸ƒåˆ°ä¸€ä¸ªæ·±åº¦ä¸»é¢˜å‘½åç©ºé—´ï¼Œå¹¶ä½¿ç”¨é€šé…ç¬¦è®¢é˜…ï¼ŒåŒæ—¶ä¸ºå°†æ¥è‡ªå·±æ‰©å±•å’Œåˆ†å‘å·¥ä½œç•™å‡ºç©ºé—´ã€‚</p>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªæœåŠ¡ä»ä½äºæ•´ä¸ªåŸå¸‚çš„ç‰©è”ç½‘è®¾å¤‡æ¥æ”¶é¥æµ‹æ•°æ®ï¼Œæ‚¨å¯ä»¥å‘å¸ƒåˆ°ä¸»é¢˜åç§°ç©ºé—´ï¼Œå¦‚Sensors.Northï¼ŒSensors.Southï¼ŒSensors.Eastå’ŒSensors.Westã€‚æœ€åˆï¼Œæ‚¨å°†è®¢é˜…Sensorsã€‚&gt;å¤„ç†ä¸€ä¸ªæ¶ˆè´¹è€…ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚éšç€ä¼ä¸šçš„å‘å±•å’Œæ•°æ®é€Ÿç‡è¶…è¿‡æ¶ˆè´¹è€…å¯ä»¥å¤„ç†çš„æ•°é‡ï¼Œæ‚¨å¯ä»¥ç”¨å››ä¸ªæ¶ˆè´¹åº”ç”¨ç¨‹åºæ›¿æ¢å•ä¸ªæ¶ˆè´¹è€…ï¼Œä»¥è®¢é˜…ä»£è¡¨è¾ƒå°æ•°æ®æ®µçš„æ¯ä¸ªä¸»é¢˜ã€‚è¯·æ³¨æ„ï¼Œæ‚¨çš„å‘å¸ƒåº”ç”¨ç¨‹åºä¿æŒä¸å˜ã€‚</p>
<h4 id="è¡¡é‡å‘å¸ƒè€…"><a href="#è¡¡é‡å‘å¸ƒè€…" class="headerlink" title="è¡¡é‡å‘å¸ƒè€…"></a>è¡¡é‡å‘å¸ƒè€…</h4><p>ä¸å¤ªæœ‰åˆ©çš„é€‰æ‹©å¯èƒ½æ˜¯è®¡é‡å‘å¸ƒè€…ã€‚æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å®ç°è¿™ä¸€ç‚¹ï¼Œä»ç®€å•åœ°å‡æ…¢å‘å¸ƒè€…é€Ÿåº¦åˆ°å®šæœŸå‘å¸ƒé˜»æ­¢è¯·æ±‚/å›å¤ä»¥åŒ¹é…è®¢é˜…è€…è´¹ç‡çš„æ›´å¤æ‚æ–¹æ³•ã€‚</p>
<h4 id="é€šè¿‡é…ç½®è°ƒæ•´NATS"><a href="#é€šè¿‡é…ç½®è°ƒæ•´NATS" class="headerlink" title="é€šè¿‡é…ç½®è°ƒæ•´NATS"></a>é€šè¿‡é…ç½®è°ƒæ•´NATS</h4><p>å¯ä»¥è°ƒæ•´NATSæœåŠ¡å™¨ä»¥ç¡®å®šåœ¨æ¶ˆè´¹è€…è¢«è®¤ä¸ºæ˜¯æ…¢é€Ÿä¹‹å‰å¯ä»¥ç¼“å†²å¤šå°‘æ•°æ®ï¼Œå¹¶ä¸”ä¸€äº›å®˜æ–¹æ”¯æŒçš„å®¢æˆ·ç«¯å…è®¸è°ƒæ•´ç¼“å†²åŒºå¤§å°ã€‚å‡å°ç¼“å†²åŒºå¤§å°å¯ä»¥è®©æ‚¨æ›´å¿«åœ°è¯†åˆ«ç¼“æ…¢çš„æ¶ˆè´¹è€…ã€‚é™¤éæ‚¨æ­£åœ¨å¤„ç†ä¸´æ—¶çš„æ•°æ®çªå‘ï¼Œå¦åˆ™é€šå¸¸ä¸å»ºè®®å¢åŠ ç¼“å†²åŒºå¤§å°ã€‚é€šå¸¸ï¼Œå¢åŠ ç¼“å†²å®¹é‡åªä¼šæ¨è¿Ÿç¼“æ…¢çš„æ¶ˆè´¹è€…é—®é¢˜ã€‚</p>
<h3 id="æœåŠ¡å™¨é…ç½®"><a href="#æœåŠ¡å™¨é…ç½®" class="headerlink" title="æœåŠ¡å™¨é…ç½®"></a>æœåŠ¡å™¨é…ç½®</h3><p>NATSæœåŠ¡å™¨å…·æœ‰å†™å…¥è¿æ¥çš„å†™å…¥æœŸé™ã€‚å½“è¶…è¿‡æ­¤å†™å…¥æˆªæ­¢æ—¥æœŸæ—¶ï¼Œå®¢æˆ·ç«¯è¢«è§†ä¸ºå…·æœ‰è¾ƒæ…¢çš„æ¶ˆè´¹è€…ã€‚å¦‚æœæ‚¨åœ¨æœåŠ¡å™¨ä¸­é‡åˆ°ç¼“æ…¢çš„ä½¿ç”¨è€…é”™è¯¯ï¼Œåˆ™å¯ä»¥å¢åŠ å†™å…¥æœŸé™ä»¥ç¼“å†²æ›´å¤šæ•°æ®ã€‚</p>
<p>NATSæœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­çš„write_deadlineé…ç½®é€‰é¡¹å°†å¯¹æ­¤è¿›è¡Œè°ƒæ•´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write_deadlineï¼š2s</span><br></pre></td></tr></table></figure>

<p>å½“æ‚¨æœ‰æ•°æ®çªå‘å¯ä»¥å®¹çº³æ—¶ï¼Œè°ƒæ•´æ­¤å‚æ•°æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚ç¡®ä¿æ‚¨ä¸ä»…ä»…æ˜¯æ¨è¿Ÿäº†ä¸€ä¸ªç¼“æ…¢çš„æ¶ˆè´¹è€…é”™è¯¯ã€‚</p>
<h3 id="å®¢æˆ·ç«¯é…ç½®"><a href="#å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®"></a>å®¢æˆ·ç«¯é…ç½®</h3><p>å¤§å¤šæ•°å®˜æ–¹æ”¯æŒçš„å®¢æˆ·ç«¯éƒ½æœ‰ä¸€ä¸ªå¾…å¤„ç†æ¶ˆæ¯çš„å†…éƒ¨ç¼“å†²åŒºï¼Œå¦‚æœæœ¬åœ°è®¢é˜…æ²¡æœ‰èµ¶ä¸Šï¼Œå®ƒå°†é€šè¿‡å¼‚æ­¥é”™è¯¯å›è°ƒé€šçŸ¥æ‚¨çš„åº”ç”¨ç¨‹åºã€‚åœ¨æœ¬åœ°æ¥æ”¶é”™è¯¯å¹¶ä¸ä¸€å®šæ„å‘³ç€æœåŠ¡å™¨å·²å°†è®¢é˜…æ ‡è¯†ä¸ºæ…¢é€Ÿæ¶ˆè´¹è€…ã€‚</p>
<p>å¯ä»¥é€šè¿‡åœ¨åˆ›å»ºè®¢é˜…åè®¾ç½®æŒ‚èµ·é™åˆ¶æ¥é…ç½®æ­¤ç¼“å†²åŒºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if err := sub.SetPendingLimits(1024*500, 1024*5000); err != nil &#123;</span><br><span class="line">  log.Fatalf(&quot;Unable to set pending limits: %v&quot;, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤è®¢é˜…è€…æš‚æŒ‚æ¶ˆæ¯é™åˆ¶ä¸º65536ï¼Œé»˜è®¤è®¢é˜…è€…æš‚æŒ‚å­—èŠ‚é™åˆ¶ä¸º65536 * 1024</p>
<p>å¦‚æœå®¢æˆ·ç«¯è¾¾åˆ°æ­¤å†…éƒ¨é™åˆ¶ï¼Œå®ƒå°†ä¸¢å¼ƒé‚®ä»¶å¹¶ç»§ç»­å¤„ç†æ–°é‚®ä»¶ã€‚è¿™ä¸NATSæœ€å¤šä¸€æ¬¡äº¤ä»˜æ—¶ä¸€è‡´ã€‚åº”ç”¨ç¨‹åºå¯ä»¥æ£€æµ‹ä¸¢å¤±çš„æ¶ˆæ¯å¹¶ä»æ­¤çŠ¶æ€æ¢å¤ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:null">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://wangyangyangisme.github.io/posts/7f2c8890/">http://wangyangyangisme.github.io/posts/7f2c8890/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://wangyangyangisme.github.io" target="_blank">Blank</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/285494672816019cfb027039031cb3ca.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/e845c472/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/95994a9aea31be452e66c89e68ba4a27.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">NATS Streaming</div></div></a></div><div class="next-post pull-right"><a href="/posts/89a3b30b/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/mysql/9607ad2cb25982d37fccf7443bf654b4.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">MySqlæŸ¥è¯¢ä¸åŒºåˆ†å¤§å°å†™è§£å†³æ–¹æ¡ˆ</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Blank</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">305</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">30</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">49</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Nats%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">Natsç®¡ç†æœåŠ¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85NATS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">å®‰è£…NATSæœåŠ¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85"><span class="toc-text">ä»äºŒè¿›åˆ¶å®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B3%E5%8F%B0%E7%89%B9%E5%AE%9A%E6%96%B9%E6%B3%95"><span class="toc-text">å¹³å°ç‰¹å®šæ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%82%A8%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-text">æµ‹è¯•æ‚¨çš„å®‰è£…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8CNATS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">è¿è¡ŒNATSæœåŠ¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E5%B8%A6%E7%9B%91%E6%8E%A7%E7%9A%84NATS%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-text">å¯ç”¨å¸¦ç›‘æ§çš„NATSæœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%80%89%E9%A1%B9"><span class="toc-text">å‘½ä»¤è¡Œé€‰é¡¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-text">NATSæœåŠ¡å™¨èº«ä»½éªŒè¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%80%89%E9%A1%B9-1"><span class="toc-text">å‘½ä»¤è¡Œé€‰é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-text">å•ç”¨æˆ·é…ç½®é€‰é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-text">å¤šç”¨æˆ·èº«ä»½éªŒè¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E8%BF%9E%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">å®¢æˆ·è¿æ¥å­—ç¬¦ä¸²</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E9%9B%86%E5%8D%87%E7%BA%A7"><span class="toc-text">ç¾¤é›†å‡çº§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%8D%E5%AD%90%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">ç§å­æœåŠ¡å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-text">NATSæœåŠ¡å™¨å®‰å…¨æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TLS%E5%AF%86%E7%A0%81"><span class="toc-text">TLSå¯†ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AFTLS%E7%9B%B8%E4%BA%92%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-text">å®¢æˆ·ç«¯TLSç›¸äº’èº«ä»½éªŒè¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BE%A4%E9%9B%86TLS%E7%9B%B8%E4%BA%92%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-text">ç¾¤é›†TLSç›¸äº’èº«ä»½éªŒè¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8bcrypt%E4%BF%9D%E6%8A%A4%E5%AF%86%E7%A0%81"><span class="toc-text">ä½¿ç”¨bcryptä¿æŠ¤å¯†ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8E%88%E6%9D%83"><span class="toc-text">NATSæœåŠ¡å™¨æˆæƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-text">ä¾‹å­</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">NATSæœåŠ¡å™¨é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-text">é…ç½®æ–‡ä»¶æ ¼å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">ç¤ºä¾‹æœåŠ¡å™¨é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-text">å˜é‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BANATS%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BE%A4%E9%9B%86"><span class="toc-text">æ„å»ºNATSæœåŠ¡å™¨ç¾¤é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BE%A4%E9%9B%86URL"><span class="toc-text">ç¾¤é›†URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%80%89%E9%A1%B9-2"><span class="toc-text">å‘½ä»¤è¡Œé€‰é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BE%A4%E9%9B%86%E7%A4%BA%E4%BE%8B"><span class="toc-text">ä¸‰ä¸ªæœåŠ¡å™¨ç¾¤é›†ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%8C%96NATS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">å®¹å™¨åŒ–NATSæœåŠ¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Docker%E8%BF%9B%E8%A1%8C%E7%BE%A4%E9%9B%86"><span class="toc-text">ä½¿ç”¨Dockerè¿›è¡Œç¾¤é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%99%E7%A8%8B"><span class="toc-text">æ•™ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-text">NATSæœåŠ¡å™¨æ—¥å¿—è®°å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-text">é…ç½®æ—¥å¿—è®°å½•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8logrotate%E8%AE%B0%E5%BD%95%E6%97%8B%E8%BD%AC"><span class="toc-text">ä½¿ç”¨logrotateè®°å½•æ—‹è½¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E8%AE%B0%E5%BD%95%E7%AC%94%E8%AE%B0"><span class="toc-text">ä¸€äº›è®°å½•ç¬”è®°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7NATS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">ç›‘æ§NATSæœåŠ¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E7%9B%91%E6%8E%A7"><span class="toc-text">å¯ç”¨ç›‘æ§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E7%AB%AF%E7%82%B9"><span class="toc-text">ç›‘æ§ç«¯ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%91%E6%8E%A7%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-text">åˆ›å»ºç›‘æ§åº”ç”¨ç¨‹åº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%9F%E8%B8%AANATS%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF"><span class="toc-text">è·Ÿè¸ªNATSç»Ÿè®¡ä¿¡æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-text">ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E9%A1%B9"><span class="toc-text">é€‰é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-text">å‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E7%BC%93%E6%85%A2"><span class="toc-text">æ¶ˆè´¹è€…ç¼“æ…¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E7%BC%93%E6%85%A2-1"><span class="toc-text">æ¶ˆè´¹è€…ç¼“æ…¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%85%A2%E6%B6%88%E8%B4%B9%E8%80%85%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯æ…¢æ¶ˆè´¹è€…ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%85%A2%E6%B6%88%E8%B4%B9%E8%80%85%E4%BC%9A%E6%80%8E%E4%B9%88%E6%A0%B7%EF%BC%9F"><span class="toc-text">æ…¢æ¶ˆè´¹è€…ä¼šæ€ä¹ˆæ ·ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E4%B8%AD%E5%8F%91%E7%8E%B0%E7%9A%84%E6%B6%88%E8%B4%B9%E8%80%85%E7%BC%93%E6%85%A2"><span class="toc-text">å®¢æˆ·ä¸­å‘ç°çš„æ¶ˆè´¹è€…ç¼“æ…¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AF%86%E5%88%AB%E7%9A%84%E6%B6%88%E8%B4%B9%E8%80%85%E7%BC%93%E6%85%A2"><span class="toc-text">æœåŠ¡å™¨è¯†åˆ«çš„æ¶ˆè´¹è€…ç¼“æ…¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%85%A2%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text">å¤„ç†æ…¢æ¶ˆè´¹è€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A1%E9%87%8F%E5%8F%91%E5%B8%83%E8%80%85"><span class="toc-text">è¡¡é‡å‘å¸ƒè€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E8%B0%83%E6%95%B4NATS"><span class="toc-text">é€šè¿‡é…ç½®è°ƒæ•´NATS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">æœåŠ¡å™¨é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-text">å®¢æˆ·ç«¯é…ç½®</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/168b0f7a/" title="ç»†æ•°TSä¸­é‚£äº›å¥‡æ€ªçš„ç¬¦å·"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/common/7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç»†æ•°TSä¸­é‚£äº›å¥‡æ€ªçš„ç¬¦å·"/></a><div class="content"><a class="title" href="/posts/168b0f7a/" title="ç»†æ•°TSä¸­é‚£äº›å¥‡æ€ªçš„ç¬¦å·">ç»†æ•°TSä¸­é‚£äº›å¥‡æ€ªçš„ç¬¦å·</a><time datetime="2021-07-03T04:26:48.000Z" title="å‘è¡¨äº 2021-07-03 12:26:48">2021-07-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/38d4c25a/" title="Nginx Ingressé…ç½®æ˜ å°„ConfigMap"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/common/0f2f8f38bdbff3a5f2b97f26b7ce3752.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx Ingressé…ç½®æ˜ å°„ConfigMap"/></a><div class="content"><a class="title" href="/posts/38d4c25a/" title="Nginx Ingressé…ç½®æ˜ å°„ConfigMap">Nginx Ingressé…ç½®æ˜ å°„ConfigMap</a><time datetime="2021-06-10T13:59:44.000Z" title="å‘è¡¨äº 2021-06-10 21:59:44">2021-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5b4d812a/" title="Nginx Ingressæ³¨è§£Annotations"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/common/7ad9570c1892b128f84b9971f7946fc4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx Ingressæ³¨è§£Annotations"/></a><div class="content"><a class="title" href="/posts/5b4d812a/" title="Nginx Ingressæ³¨è§£Annotations">Nginx Ingressæ³¨è§£Annotations</a><time datetime="2021-06-10T13:59:44.000Z" title="å‘è¡¨äº 2021-06-10 21:59:44">2021-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4353b432/" title="k8sæš´éœ²æœåŠ¡çš„æ–¹å¼"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/common/181a3c44c19e44a7e153e74abee69a73.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="k8sæš´éœ²æœåŠ¡çš„æ–¹å¼"/></a><div class="content"><a class="title" href="/posts/4353b432/" title="k8sæš´éœ²æœåŠ¡çš„æ–¹å¼">k8sæš´éœ²æœåŠ¡çš„æ–¹å¼</a><time datetime="2021-06-03T16:23:44.000Z" title="å‘è¡¨äº 2021-06-04 00:23:44">2021-06-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a4bf172f/" title="k8sé›†ç¾¤ä¸‰ç§IP"><img src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/common/57ee6e1c332782e5197f87bccd943163.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="k8sé›†ç¾¤ä¸‰ç§IP"/></a><div class="content"><a class="title" href="/posts/a4bf172f/" title="k8sé›†ç¾¤ä¸‰ç§IP">k8sé›†ç¾¤ä¸‰ç§IP</a><time datetime="2021-06-03T15:54:44.000Z" title="å‘è¡¨äº 2021-06-03 23:54:44">2021-06-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Blank</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://wangyangyangisme.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="æ”¾å¤§å­—ä½“"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="ç¼©å°å­—ä½“"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '49gEIIGN7uRbL6vHhieSpBzM-MdYXbMMI',
      appKey: 'uqts0urLKwikYQ0fKmIkMHBE',
      placeholder: 'è¯·ç•™ä¸‹ä½ çš„è„šå°',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="000PeZCQ1i4XVs" data-server="tencent" data-type="artist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script>(function(d, w, c) {
    w.ChatraID = '';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (false) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener toc scroll 
  window.removeEventListener('scroll', window.tocScrollFn)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>